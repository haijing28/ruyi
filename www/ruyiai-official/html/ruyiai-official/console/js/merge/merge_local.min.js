function actionSetCtrl(a,b,c,d){$(".list-group-item").removeClass("active"),$("[data-act=nav-robot-para]").addClass("active"),$("[data-act=nav-action-set]").addClass("active"),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200),$('[data-toggle="popover"]').popover(),b.getActionList=function(){$.ajax({url:ruyiai_host+"/ruyi-ai/action/query/list",data:{appId:appId,start:0,limit:1e3},method:"get",success:function(a){a=dataParse(a),0==a.code?(b.actionList=a.result,$(b.actionList).each(function(a,c){c.errorModels.length>0&&(c.errorList=b.getErrorList(c.errorModels)),$.isEmptyObject(c.header)&&(console.log(2222),c.header={})}),b.$apply(),b.changePostion(),$(".action-set-box-parent").delegate(".show-action .action-title-top","click",function(a){a.stopPropagation();var b=$(this),c=b.parent().find(".action-set-ul"),d=c.hasClass("open"),e=b.find(".trigger-icon");d?(c.css("border","none"),c.removeClass("open").addClass("close"),e.removeClass("icon-down").addClass("icon-right-copy-copy")):(c.css("border","1px solid #dcdddd"),c.removeClass("close").addClass("open"),e.removeClass("icon-right-copy-copy").addClass("icon-down"))})):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})},b.getActionList(),$("body").delegate(".show-action .common-blank-button","click",function(a){var c=$(this),d=c.closest(".action-set-box"),e=d.find(".action-set-ul"),f=d.find("[data-act=myindex]").val(),g=b.actionList[f];e.find("[data-act=name]").val(g.name),e.find("[data-act=url]").val(g.url);var h=[],i=g.header;for(header in i)h.push({key:header,value:i[header]});e.find(".header-list").empty();var j="";$(h).each(function(a,b){j="<li class='header-list-li clearfix'>",j+='<input type="text" placeholder="name" data-act="header-key" value="'+b.key+'">',j+='<input type="text" class="header-value" placeholder="value" data-act="header-value" value="'+b.value+'">',j+='<i class="iconfont icon-delete pull-right"></i></li>',e.find(".header-list").append(j)})}),b.getErrorList=function(a){var b="<ul style='color: #ee524f;'>";return $(a).each(function(a,c){b+="<li>"+(a+1)+"."+c.detail+"</li>"}),b+="</ul>"},b.changePostion=function(){$(".action-title-top").each(function(a,b){""!==$(b).find(".show-url").text()&&($(b).find(".icon-delete").css("margin-top","18px"),$(b).find(".icon-copy").css("margin-top","18px"))})},b.createOrUpdateAction=function(a,c,d){var e=[];d+="",d&&"undefined"!=d&&d>=0?$.ajax({url:ruyiai_host+"/ruyi-ai/action/update",traditional:!0,headers:{"Content-Type":"application/json"},data:JSON.stringify(a),method:"POST",success:function(c){if(c=dataParse(c),0==c.code){if(e=c.result.errorModels,a.errorModels=e,a.errorList=b.getErrorList(e),b.actionList[d]=a,b.$apply(),e.length>0){var f=$(".show-action").length;$($(".show-action")[f-1]).find(".icon-iconfontzhifushibai").show()}b.changePostion(),$.trace("已修改","success")}else 2==c.code?goIndex():c.msg&&$.trace(c.msg+"( "+c.detail+" )","error")}}):$.ajax({url:ruyiai_host+"/ruyi-ai/action/create",traditional:!0,headers:{"Content-Type":"application/json"},data:JSON.stringify(a),method:"POST",success:function(a){if(a=dataParse(a),0==a.code){e=a.result.errorModels,a.result.errorList=b.getErrorList(e),$.isEmptyObject(a.result.header)&&(console.log("111111"),a.result.header={}),b.actionList.push(a.result),b.$apply();var f=$(".show-action").length;$($(".show-action")[f-1]).find(".action-set-ul").removeClass("close").addClass("open"),$($(".show-action")[f-1]).find(".trigger-icon").removeClass("icon-right").addClass("icon-down"),e.length>0&&$($(".show-action")[f-1]).find(".icon-iconfontzhifushibai").show(),0>d?$.trace("复制成功","success"):(c.find("[data-act=name]").val(""),c.find("[data-act=method]").html('GET<span class="caret"></span>'),c.find("[data-act=url]").val(""),c.find(".header-list").html('<li class="header-list-li"> <input type="text" placeholder="key" data-act="header-key" /> <input type="text" placeholder="value" data-act="header-value" /> <i class="iconfont icon-delete pull-right"></i></li>'),c.find(".json-body-textarea").val(""),c.find(".is-need-cache button:first-child").addClass("active").siblings().removeClass("active"),c.find(".expire-time").get(0).selectedIndex=0,c.find(".add-cache-key-help").html('<span class="add-cache-key-span" style="position:relative;"><input placeholder="key名称"/></span><input placeholder="key名称" />'),c.find(".action-set-ul").removeClass("open").addClass("close"),$.trace("添加成功","success")),b.changePostion()}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})},b.restore=function(a){$.isEmptyObject(b.orignData)||($(a).find("[data-act=name]").val(b.orignData.name),$(a).find("[data-act=url]").val(b.orignData.url),$(a).find(".header-list-li").each(function(a,c){$(c).find("[data-act=header-key]").val(b.header[a].key),$(c).find("[data-act=header-value]").val(b.header[a].value)}),$(a).find(".btn").html(b.orignData.method+'<span class="caret"></span>'))},$(".action-set-box-parent").delegate(".action-set-box .common-active-button","click",function(a){a.stopPropagation();var c=$(this),d=c.closest(".action-set-box"),e=d.find("[data-act=myindex]").val(),f=d.find("[data-act=actionId]").val(),g=(d.find(".action-set-ul"),d.find("[data-act=name]").val().trim()),h=d.find("[data-act=url]").val(),i=d.find("[data-act=method]").text().trim(),j=d.find(".json-body-textarea").val(),k=d.find(".is-need-cache button.active").attr("data-act"),l=d.find(".expire-time").val(),m=[],n=d.find(".add-cache-key-box div input");n.each(function(){$(this).val()&&$.trim($(this).val()).length>0&&m.push($(this).val())});var o={},p=d.find(".header-list li");console.log(5555),p.each(function(a){var b=$(this);b.find("[data-act=header-key]").val()&&b.find("[data-act=header-key]").val().length>0&&(o[b.find("[data-act=header-key]").val()]=b.find("[data-act=header-value]").val())}),b.actionList||(b.actionList=[]);var q={};q.id=f,q.appId=appId,q.name=g,q.url=h,q.method=i,q.header=o,q.jsonBody=j,q.enableCache=k,q.expireTime=l,q.entitiesInCacheKey=m,b.isError=0,""!==q.name?(b.createOrUpdateAction(q,d,e),$(".add-action").find(".action-title-top").hide()):$.trace("触发器名称不能为空！","error")}),$(".action-set-box-parent").delegate(".action-set-ul .header-li .icon-ruyiaiaddscence","click",function(a){a.stopPropagation();var b=$(this);b.closest(".action-set-box").find(".header-list").append('<li class="header-list-li"> <input type="text" placeholder="name" data-act="header-key" /> <input type="text" placeholder="value" class="header-value" data-act="header-value" /><i class="iconfont icon-delete pull-right"></i> </li>')}),$(".action-set-box-parent").delegate(".header-list .icon-delete","click",function(){$(this).parent("li").remove()}),$(".action-set-box-parent").delegate(".icon-copy","click",function(a){a.stopPropagation();var c=$(this),d=c.closest(".action-set-box"),e=d.find("[data-act=actionId]").val(),f=c.parent().next("ul"),g=d.find("[data-act=name]").val().trim(),h=f.find("[data-act=url]").val(),i=f.find("[data-act=method]").text().trim(),j=f.find(".json-body-textarea").val(),k=f.find(".is-need-cache button.active").attr("data-act"),l=f.find(".expire-time").val(),m=[],n=f.find(".add-cache-key-box div input");n.each(function(){$(this).val()&&$.trim($(this).val()).length>0&&m.push($(this).val())});var o={},p=d.find(".header-list li");p.each(function(a){var b=$(this);o[b.find("[data-act=header-key]").val()]=b.find("[data-act=header-value]").val()}),b.actionList||(b.actionList=[]);var q={};q.id=e,q.appId=appId,q.name=g,q.url=h,q.method=i,q.header=o,q.jsonBody=j,q.enableCache=k,q.expireTime=l,q.entitiesInCacheKey=m,b.isError=0,b.createOrUpdateAction(q,d,-1)}),$(".action-set-box-parent").delegate("[data-act=delete-action]","click",function(a){a.stopPropagation();var c=$(this),d=c.attr("data-action-id"),e=c.attr("data-index");$.ajax({url:ruyiai_host+"/ruyi-ai/action/delete/"+d+"?appId="+appId,method:"DELETE",success:function(a){$.trace("已删除","success"),b.actionList.splice(e,1),b.$apply()}})}),$(".action-set-box-parent").delegate(".method-item","click",function(){var a=$(this).text();$(this).closest("[data-act=change-method]").find(".open .btn").html(a+'<span class="caret"></span>')}),$(".action-set-box-parent").delegate(".add-action .common-blank-button","click",function(){$(this).closest(".action-set-ul").removeClass("open").addClass("close");var a=$(".add-action");if(a.find("[data-act=name]").val(""),a.find("[data-act=method]").html('GET<span class="caret"></span>'),a.find("[data-act=url]").val(""),a.find(".header-list").html('<li class="header-list-li"> <input type="text" placeholder="key" data-act="header-key" /> <input type="text" placeholder="value" data-act="header-value" /> <i class="iconfont icon-delete pull-right"></i></li>'),a.find(".json-body-textarea").val(""),a.find(".is-need-cache button:first-child").addClass("active").siblings().removeClass("active"),a.find(".expire-time").get(0).selectedIndex=0,a.find(".add-cache-key-help").html('<span class="add-cache-key-span" style="position:relative;"><input placeholder="key名称"/></span><input placeholder="key名称" />'),$(".add-action").find(".header-list-li").length>0)$(".add-action").find(".header-list-li").each(function(a,b){0!=a&&$(b).remove()});else{var b="<li class='header-list-li clearfix'>";b+='<input type="text" placeholder="name" data-act="header-key">',b+='<input type="text" class="header-value" placeholder="value" data-act="header-value">',b+='<i class="iconfont icon-delete pull-right"></i></li>',$(".add-action").find(".header-list").append(b)}$(".add-action").find(".action-title-top").hide()}),$(".add-trigger").find(".icon-ruyiaiaddscence").on("click",function(){var a=$(".add-action").find(".action-set-ul");"block"==$(".add-action").find(".action-title-top").css("display")?$.trace("请先完成上一个触发器的创建"):($(".add-action").find(".action-title-top").show(),a.removeClass("close").addClass("open"))}),$(".action-set-box-parent").delegate(".trigger-name","click",function(a){a.stopPropagation()}),$(".action-set-box-parent").height(window.innerHeight-115),$(".action-set-box-parent").delegate(".is-need-cache button","click",function(a){var b=$(this);b.addClass("active").siblings("button").removeClass("active")}),$(".action-set-box-parent").delegate("#add-cache-key","click",function(a){var b=$(this);b.parent().find("div").append('<input placeholder="key名称" />'),b.parent().find("div input:last-child").focus()}),$(".action-set-box-parent").delegate(".add-cache-key-close","click",function(a){var b=$(this);b.parent().remove()})}function angularDemoCtrl(a,b,c,d){$(".list-group-item").removeClass("active"),$("[data-act=nav-test]").addClass("active"),$('[data-toggle="tooltip"]').tooltip(),$(".assistant-box ").height(),b.talks=[],b.responseJSONS=[];var e=Math.random();(e+"").substr(0,10);$("body").off("keydown","[data-act=sendMsg]").on("keydown","[data-act=sendMsg]",function(a){return 13==a.keyCode?(b.testSubmit(),!1):void 0}),b.testSubmit=function(){if(!$(".testTextarea textarea").val()||0==$(".testTextarea textarea").val().length)return $.trace("请填写你要说的话"),$(".testTextarea textarea").focus(),!1;$(".testTextarea textarea").val()&&(b.talks.push({serverLeft:!1,userRight:!0,talkText:$(".testTextarea textarea").val()}),$(".testContain").scrollTop($(".testContain")[0].scrollHeight),$(".testTextarea textarea").val(""));var a="https://api.ruyi.ai/v1/message";isproductDomain||(a="http://lab.ruyi.ai/ruyi-api/v1/message");var c=b.userSaysText,d="entities,intents,know,act",e=getCookie("appKey"),f="test",g={reference_time:(new Date).getTime(),timezone:"Asia/Shanghai",domains:f},c={app_key:e,q:c,options:d,user_id:appId,context:g},h=function(a){if(a=dataParse(a),0==a.code){var c=a.result,d="未匹配到意图";if(c.intents&&c.intents.length>0&&c.intents[0].outputs)for(var e in c.intents[0].outputs)switch(c.intents[0].outputs[e].type){case"wechat.text":d=c.intents[0].outputs[e].property.text,b.talks.push({serverLeft:!0,userRight:!1,talkText:d});break;case"wechat.image":d="微信图片："+c.intents[0].outputs[e].property.name,b.talks.push({serverLeft:!0,userRight:!1,talkText:d});break;case"wechat.voice":d="微信音频："+c.intents[0].outputs[e].property.name,b.talks.push({serverLeft:!0,userRight:!1,talkText:d});break;case"wechat.video":d="微信视频："+c.intents[0].outputs[e].property.name,b.talks.push({serverLeft:!0,userRight:!1,talkText:d});break;case"wechat.news":d="微信图文："+c.intents[0].outputs[e].property.name,b.talks.push({serverLeft:!0,userRight:!1,talkText:d})}"未匹配到意图"==d&&b.talks.push({serverLeft:!0,userRight:!1,talkText:d}),b.responseJSONS.push({request:c._text,response:JSON.stringify(c,null,4)}),b.$apply(),$(".testContain").scrollTop($(".testContain")[0].scrollHeight),$("#responseJson").scrollTop($("#responseJson")[0].scrollHeight)}else $.trace(a.msg)};(new Date).getTime();$.ajax({url:a,data:JSON.stringify(c),method:"post",success:function(a){h(a)}})}}function angularDemoTryCtrl(a,b,c,d){$("#try-try").css("display","none");var e=$(".list-group-item.active").attr("data-act");$(".scenario-object.list-group-item.active").attr("data-scenario-id");$(".list-group-item").removeClass("active"),$("[data-act=nav-test-try]").addClass("active"),$('[data-toggle="tooltip"]').tooltip(),$(".assistant-box ").height(),b.json=getCookie("json"),"json"==b.json?($(".try-nav-max .json").addClass("active").siblings().removeClass("active"),$("#json").addClass("active in").siblings().removeClass("active in")):"app-list"==b.json&&($(".try-nav-max .app-list").addClass("active").siblings().removeClass("active"),$("#app-list").addClass("active in").siblings().removeClass("active in")),"try-local"==getCookie("weixin_local")?($(".try-nav-left-max .try-local").addClass("active").siblings().removeClass("active"),$("#local-try-max").addClass("active in").siblings().removeClass("active in"),setTimeout(function(){$(".scrollContainLocal").scrollTop($(".scrollContainLocal")[0].scrollHeight)},0)):($(".try-nav-left-max .try-weixin").addClass("active").siblings().removeClass("active"),$("#weixin-try-max").addClass("active in").siblings().removeClass("active in"),setTimeout(function(){$(".scrollContain").scrollTop($(".scrollContain")[0].scrollHeight)},0)),setTimeout(function(){$("#responseJson").scrollTop(0)},0),setTimeout(function(){$("[data-act=sendMsg-max]").focus(),b.clickPlay(".testContain"),b.clickPlay(".testContainLocal")},300),$("body").off("keydown","[data-act=sendMsg-max]").on("keydown","[data-act=sendMsg-max]",function(a){if(13==a.keyCode){var c=$(a.currentTarget.parentNode);return c.attr("class").indexOf("testTextareaLocal")<0?b.testMaxSubmit():b.testSubmitMaxLocal(),!1}}),b.clearOtherPlay=function(a,b){b.find("audio").each(function(b,c){b!==a&&c.pause()})},b.stopOtherContainerAudio=function(a){var b=a.find("audio");b.length>0&&$(b).each(function(a,b){b.paused||b.pause()})},b.clickPlay=function(a){var c="";c=".testContain"===a?".testContainLocal":".testContain",$(a).find("audio").each(function(d,e){e.onplay=function(){b.clearOtherPlay(d,$(a)),b.stopOtherContainerAudio($(c))}})},b.handleSpecialChars=function(a){b.errorUserSaysTextTry=[];var c="";return a.indexOf("%")>-1?c="%":a.indexOf('"')>-1&&(c='"'),b.errorUserSaysTextTry=a.split(c),a="",$(b.errorUserSaysTextTry).each(function(b,c){""!==c&&(a+=c)}),a},b.testMaxSubmit=function(c){$(".tab-content-max .tab-pane.active").attr("id");if(!$(".testTextarea textarea").val()||0==$(".testTextarea textarea").val().length||""==$(".testTextarea textarea").val().replace(/(^\s*)|(\s*$)/g,""))return $.trace("请填写你要说的话"),$(".testTextarea textarea").focus(),!1;$(".testTextarea textarea").val()&&(b.talks.push({serverLeft:!1,userRight:!0,talkText:$(".testTextarea textarea").val()}),setTimeout(function(){$(".testContain").scrollTop($(".testContain")[0].scrollHeight)},500),$(".testTextarea textarea").val(""));var d="https://api.ruyi.ai/v1/message";isproductDomain||(d="http://lab.ruyi.ai/ruyi-api/v1/message");var e="entities,intents,know,act",f="test",g={reference_time:(new Date).getTime(),timezone:"Asia/Shanghai",domains:f};b.userSaysTextTry=b.handleSpecialChars(b.userSaysTextTry);var h=encodeURIComponent(b.userSaysTextTry);h={app_key:a.app_key,q:h,options:e,user_id:uuid,reset_session:wechatResetSession,context:g};var i=function(c){if(c=dataParse(c),0==c.code){wechatResetSession="false";var d=c.result,e="未匹配到意图",f="";if(d.intents&&d.intents.length>0&&d.intents[0].outputs)for(var g in d.intents[0].outputs)switch(d.intents[0].outputs[g].type){case"wechat.text":d.intents[0].outputs[g].property.text&&(e=d.intents[0].outputs[g].property.text,e=e.replace(/\\n/g,"<br/>")),b.talks.push({serverLeft:!0,userRight:!1,talkText:e,talkType:"微信文本",type:"wechat_text"});break;case"wechat.image":d.intents[0].outputs[g].property.name&&(e=d.intents[0].outputs[g].property.name),f=null==d.intents[0].outputs[g].property.media_id?d.intents[0].outputs[g].property.image_url:ruyi_wechat+"/ruyi-wechat/"+a.app_key+"/content/"+d.intents[0].outputs[g].property.media_id,b.talks.push({serverLeft:!0,userRight:!1,talkText:e,talkType:"微信图片",backgroundcolor:"#56D875",type:"wechat_image",url:f});break;case"wechat.music":d.intents[0].outputs[g].property.title&&(e=d.intents[0].outputs[g].property.title),b.talks.push({serverLeft:!0,userRight:!1,talkText:e,talkType:"微信音乐",backgroundcolor:"#FF9D00",type:"wechat_music",url:d.intents[0].outputs[g].property.music_url});break;case"wechat.voice":d.intents[0].outputs[g].property.name&&(e=d.intents[0].outputs[g].property.name),f=null==d.intents[0].outputs[g].property.media_id?d.intents[0].outputs[g].property.voice_url:ruyi_wechat+"/ruyi-wechat/"+a.app_key+"/content/"+d.intents[0].outputs[g].property.media_id,b.talks.push({serverLeft:!0,userRight:!1,talkText:e,talkType:"微信音频",backgroundcolor:"#5DC9DB",type:"wechat_voice",url:f});break;case"wechat.video":d.intents[0].outputs[g].property.name&&(e=d.intents[0].outputs[g].property.name),b.talks.push({serverLeft:!0,userRight:!1,talkText:e,talkType:"微信视频",backgroundcolor:"#6B89E1",type:"wechat_video",mediaId:d.intents[0].outputs[g].property.media_id,url:d.intents[0].outputs[g].property.video_url});break;case"wechat.news":if(d.intents[0].outputs[g].property.name&&(e=d.intents[0].outputs[g].property.name),null!=d.intents[0].outputs[g].property.media_id){var h=ruyiai_host+"/ruyi-ai/"+a.app_key+"/transfor/news/"+d.intents[0].outputs[g].property.media_id;$.ajax({url:h,method:"get",success:function(c){var d=[];if(c=dataParse(c),0==c.code){for(var f in c.result.news_item){var g=new Object;g.description=c.result.news_item[f].digest,g.title=c.result.news_item[f].title,g.pic_url=ruyi_wechat+"/ruyi-wechat/"+a.app_key+"/content/"+c.result.news_item[f].thumb_media_id,g.url=c.result.news_item[f].url,d.push(g)}b.talks.push({serverLeft:!0,userRight:!1,talkText:e,talkType:"微信图文",backgroundcolor:"#FFB800",type:"wechat_news",list:d}),b.$apply()}else c&&2==c.code&&goIndex()}})}else{var i=d.intents[0].outputs[g].list;b.talks.push({serverLeft:!0,userRight:!1,talkText:e,talkType:"微信图文",backgroundcolor:"#FFB800",type:"wechat_news",list:i})}}"未匹配到意图"==e&&(d.intents&&d.intents.length>0&&(e="该意图助理答为空"),b.talks.push({serverLeft:!0,userRight:!1,talkText:e,talkType:"未匹配到意图"})),b.responseJSONS.push({request:d._text,response:JSON.stringify(d,null,4)}),b.$apply(),b.clickPlay(".testContain"),$(".testContain").scrollTop($(".testContain")[0].scrollHeight),$("#responseJson").scrollTop($("#responseJson")[0].scrollHeight)}else $.trace(c.msg)};$.ajax({url:d,data:JSON.stringify(h),method:"post",success:function(a){i(a)}}),b.userSaysTextTry="",c&&c.target&&$($(c.target)[0])&&$($(c.target)[0]).css("background-color","#3794FF")},$(".testContain").delegate(".wechat-image","click",function(){var b=$(this).attr("talkURL"),c=ruyiai_host+"/ruyi-ai/"+a.app_key+"/transfor/video/"+b;$.ajax({url:c,method:"get",success:function(a){a=dataParse(a),0==a.code?window.open(a.result.down_url):a&&2==a.code&&goIndex()}})}),$(".testContain").delegate(".wechat-news-single","click",function(){var a=$(this).attr("go_url");window.open(a)}),b.testSubmitMaxLocal=function(c){if(!$(".testTextareaLocal textarea").val()||0==$(".testTextareaLocal textarea").val().length||""==$(".testTextareaLocal textarea").val().replace(/(^\s*)|(\s*$)/g,""))return $.trace("请填写你要说的话"),$(".testTextarea textarea").focus(),!1;$(".testTextareaLocal textarea").val()&&(b.localTalks.push({serverLeft:!1,userRight:!0,talkText:$(".testTextareaLocal textarea").val()}),setTimeout(function(){$(".testContainLocal").scrollTop($(".testContainLocal")[0].scrollHeight)},500),$(".testTextareaLocal textarea").val(""));var d="https://api.ruyi.ai/v1/message";isproductDomain||(d="http://lab.ruyi.ai/ruyi-api/v1/message");var e="entities,intents,know,act",f="test",g={reference_time:(new Date).getTime(),timezone:"Asia/Shanghai",domains:f};b.userSaysTextTryLocal=b.handleSpecialChars(b.userSaysTextTryLocal);var h=encodeURIComponent(b.userSaysTextTryLocal);h={app_key:a.app_key,q:h,options:e,user_id:uuid,reset_session:localResetSession,context:g};var i=function(a){if(a=dataParse(a),0==a.code){localResetSession="false";var c=a.result,d="未匹配到意图";if(c.intents&&c.intents.length>0&&c.intents[0].outputs)for(var e in c.intents[0].outputs)switch(c.intents[0].outputs[e].type){case"dialog":d=c.intents[0].outputs[e].property.text,d=d.replace(/\\n/g,"<br/>"),b.localTalks.push({serverLeft:!0,userRight:!1,talkText:d,talkType:"硬件文本",type:"dialog"});break;case"image":d=c.intents[0].outputs[e].property.name,b.localTalks.push({serverLeft:!0,userRight:!1,talkText:d,talkType:"硬件图片",type:"image",backgroundcolor:"#56D875",url:c.intents[0].outputs[e].property.image_url});break;case"voice":d=c.intents[0].outputs[e].property.name,b.localTalks.push({serverLeft:!0,userRight:!1,talkText:d,talkType:"硬件音频",type:"voice",backgroundcolor:"#5DC9DB",url:c.intents[0].outputs[e].property.voice_url});break;case"video":d=c.intents[0].outputs[e].property.name,b.localTalks.push({serverLeft:!0,userRight:!1,talkText:d,talkType:"硬件视频",type:"video",backgroundcolor:"#6B89E1",url:c.intents[0].outputs[e].property.video_url})}"未匹配到意图"==d&&(c.intents&&c.intents.length>0&&(d="该意图助理答为空"),b.localTalks.push({serverLeft:!0,userRight:!1,talkText:d,talkType:"未匹配到意图",type:"dialog"})),b.responseJSONS.push({request:c._text,response:JSON.stringify(c,null,4)}),b.$apply(),b.clickPlay(".testContainLocal"),$(".testContainLocal").scrollTop($(".testContainLocal")[0].scrollHeight),$("#responseJson").scrollTop($("#responseJson")[0].scrollHeight)}else $.trace(a.msg)};$.ajax({url:d,data:JSON.stringify(h),method:"post",success:function(a){i(a)}}),b.userSaysTextTryLocal="",c&&c.target&&(console.log(1),$($(c.target)[0])&&$($(c.target)[0]).css("background-color","#3794FF"))},$("body").off("dblclick",".try-nav-max").on("dblclick",".try-nav-max",function(a){$(".min-try-max").trigger("click")}),b.closeTry=function(){$(".list-group-item").removeClass("active"),$("[data-act="+e+"]").addClass("active");var a=getCookie("last-location-href");window.location.href==a?window.location.href=static_host+"/console/api_manager.html":window.location.href=a,setTimeout(function(){$("[data-act=sendMsg]").focus(),$(".testContainLocal").scrollTop($(".testContainLocal")[0].scrollHeight),$(".testContain").scrollTop($(".testContain")[0].scrollHeight),b.clickPlay(".testContain"),b.clickPlay(".testContainLocal")},0),$("[ng-model=userSaysTextTry]").val(b.userSaysTextTry),$("[ng-model=userSaysTextTryLocal]").val(b.userSaysTextTryLocal),"try-local"==getCookie("weixin_local")?($(".try-nav .try-local").addClass("active").siblings().removeClass("active"),$("#local-try").addClass("active in").siblings().removeClass("active in")):($(".try-nav .try-weixin").addClass("active").siblings().removeClass("active"),$("#weixin-try").addClass("active in").siblings().removeClass("active in"))},$(".min-try-max").click(function(){$(".try-dialog").addClass("ng-scope"),$("#try-try").css("display","block")});var f=function(){if(!b.appList){var a=getCookie("userId");$.ajax({url:ruyiai_host+"/ruyi-ai/app/query/list",method:"get",data:{userId:a},success:function(a){a=dataParse(a),0==a.code?(b.appList=a.result,b.$apply()):a&&2==a.code&&goIndex()}})}};f(),$("body").off("click","[data-act=changeApp]").on("click","[data-act=changeApp]",function(b){b.stopPropagation();var c=$(this);c.addClass("active").siblings().removeClass("active"),a.app_key=c.attr("data-app-key"),a.assistant_app_id=c.attr("data-app-id")}),$(".try-nav-max li").click(function(){setCookie("json",$(this).attr("class"))}),$(".try-nav-left-max li").click(function(){setCookie("weixin_local",$(this).attr("class")),"try-local"==getCookie("weixin_local")?($(".try-nav-left-max .try-local").addClass("active").siblings().removeClass("active"),$("#local-try-max").addClass("active in").siblings().removeClass("active in"),$(".try-nav .try-local").addClass("active").siblings().removeClass("active"),$("#local-try").addClass("active in").siblings().removeClass("active in")):($(".try-nav-left-max .try-weixin").addClass("active").siblings().removeClass("active"),$("#weixin-try-max").addClass("active in").siblings().removeClass("active in"),$(".try-nav .try-weixin").addClass("active").siblings().removeClass("active"),$("#weixin-try").addClass("active in").siblings().removeClass("active in")),setTimeout(function(){$("[data-act=sendMsg-max]").focus()},300)}),setTimeout(function(){$("#responseJson").scrollTop($("#responseJson")[0].scrollHeight)},200)}function assistantParaCtrl(a,b,c,d){function e(a,b){var c="魔羯水瓶双鱼牡羊金牛双子巨蟹狮子处女天秤天蝎射手魔羯",d=[20,19,21,21,21,22,23,23,23,23,22,22];return c.substr(2*a-(b<d[a-1]?2:0),2)+"座"}function f(a){var b=a%12,c=new Array("鼠","牛","虎","兔","龙","蛇","马","羊","猴","鸡","狗","猪");return c[b]}var g=$(".list-group-item.active").attr("data-act"),h=$(".scenario-object.list-group-item.active").attr("data-scenario-id");$(".list-group-item").removeClass("active"),$("[data-act=nav-test-try]").addClass("active");var i="";$('[data-toggle="tooltip"]').tooltip(),b.$watch("agent",function(a,b){var c=JSON.stringify(a);c==i?dataEditedFlag=!1:dataEditedFlag=!0},!0),$("#assistantParaModal [name=birthday]").datepicker({changeMonth:!0,changeYear:!0});var j=["name","habitualaction","play","eat","drink","thing","people","book","movie","tv","music","place","color","sport","dislike","skill","ability","dream","belief","friend","idol","secret","motto","language","checkedList"];$.ajax({url:ruyiai_host+"/ruyi-ai/app/"+appId,method:"get",success:function(a){if(a=dataParse(a),0==a.code){if(b.agent=a.result.attribute,b.defaultResponses=a.result.defaultResponses,b.agent.deleteTip="是",b.agent.isgrowth){"true"==b.agent.isgrowth?b.agent.isgrowth=!0:b.agent.isgrowth=!1;var c=b.agent.birthday;if(c&&c.length>0){c=parseInt(c);var d=new Date;d.setTime(c);var e=$.timeFormat(d,"MM/dd/yyyy");b.agent.birthdayDate=e}b.agent.deleteTip||(b.agent.deleteTip="是")}else{var f=new Object;f.name=[],f.whyname="",f.sex="",f.bloodtype="",f.birthday="",f.birthdayDate="",f.ageyear="",f.agemonth="",f.ageday="",f.isgrowth=!0,f.constellation="",f.zodiac="",f.sexuality="",f.face="",f.brow="",f.eye="",f.nose="",f.mouth="",f.skincolor="",f.personaltrait="",f.habitualaction=[],f.height="",f.weight="",f.personal="",f.favorite="",f.play=[],f.eat=[],f.drink=[],f.thing=[],f.people=[],f.book=[],f.movie=[],f.tv=[],f.music=[],f.place=[],f.color=[],f.sport=[],f.dislike=[],f.skill=[],f.ability=[],f.IQ="",f.dream=[],f.belief=[],f.friend=[],f.marry="",f.idol=[],f.experience="",f.secret=[],f.motto=[],f.mantra="",f.language=[],f.nationality="",f.birthplace="",f.family="",f.father="",f.foccupation="",f.fop="",f.mother="",f.moccupation="",f.mop="",f.bbro="",f.bbo="",f.bbop="",f.lbro="",f.lbo="",f.lbop="",f.bsis="",f.bso="",f.bsop="",f.lsis="",f.lso="",f.lsop="",f.occupation="",f.op="",f.edu="",f.school="",f.heightCM="",f.heightCustom="",f.heightCustomize="",f.deleteTip="是",f.checkedList=[],b.agent=f}b.$apply(),"string"==typeof b.agent.habitualaction&&b.agent.habitualaction.length>=2&&-1==b.agent.habitualaction.indexOf(";;")?b.agent.habitualaction=b.agent.habitualaction.split(";"):b.agent.habitualaction=[];for(var g in j)""!=b.agent[j[g]]&&"string"==typeof b.agent[j[g]]&&(b.agent[j[g]]=b.agent[j[g]].split(";"));for(var g in b.agent.checkedList)$("."+b.agent.checkedList[g]).parents(".btn-group").attr("class")&&(-1!=$("."+b.agent.checkedList[g]).parents(".btn-group").attr("class").indexOf("favorite")&&$(".favorite").show(),-1!=$("."+b.agent.checkedList[g]).parents(".btn-group").attr("class").indexOf("appearance")&&$(".appearance").show()),$(".dropdown-menu li."+b.agent.checkedList[g]).addClass("disabled").attr("disabled","disabled"),$(".btn."+b.agent.checkedList[g]).attr("disabled","disabled"),$("."+b.agent.checkedList[g]).removeClass("deleted").show();b.agent.checkedList=[],b.habitualactionList=["抖腿","皱眉","挠头","叉腰","耸肩","托腮","撩头发","托眼镜","二郎腿","摸耳朵","抿嘴巴","舔嘴唇","咬下唇","咬指甲","摸鼻子","掰手指","打响指","吹口哨","绕头发","翻白眼儿","双手抱胸","摇头晃脑"];var h=function(a,c,d){switch(d){case"habitualaction":if(b.agent.habitualaction||(b.agent.habitualaction=[]),"add"==a&&-1==b.agent.habitualaction.indexOf(c))b.agent.habitualaction.push(c);else if("remove"==a&&-1!=b.agent.habitualaction.indexOf(c)){var e=b.agent.habitualaction.indexOf(c);b.agent.habitualaction.splice(e,1)}}};b.updateSelection=function(a,b,c){var d=a.target,e=d.checked?"add":"remove";h(e,b,c)},b.isSelected=function(a,c){switch(c){case"habitualaction":return b.agent.habitualaction||(b.agent.habitualaction=[]),b.agent.habitualaction.indexOf(a)>=0}},i=JSON.stringify(b.agent),b.$apply()}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}),b.settingAppFunc=function(){setTimeout(function(){if(b.agent){b.agent.birthdayDate&&b.agent.birthdayDate.length>0&&(b.agent.birthday=new Date(b.agent.birthdayDate).getTime()),"cm"==b.agent.heightCustomize?b.agent.height=b.agent.heightCM:"其他"==b.agent.heightCustomize?b.agent.height=b.agent.heightCustom:""==b.agent.heightCustomize&&(b.agent.height="保密"),b.agent.checkedList=[];for(var a=0;a<$(".btn[disabled]").length;a++)b.agent.checkedList.push($(".btn[disabled]").eq(a).attr("class").split(" ")[2]);for(var a=0;a<$(".dropdown-menu li[disabled]").length;a++)b.agent.checkedList.push($(".dropdown-menu li[disabled]").eq(a).attr("class").split(" ")[0]);for(var a in j)if(b.agent[j[a]]&&b.agent[j[a]].length>0){var c=b.agent[j[a]].length,d="";for(var e in b.agent[j[a]])d+=b.agent[j[a]][e],e!=c-1&&(d+=";");b.agent[j[a]]=d}else b.agent[j[a]]="";$.ajax({url:ruyiai_host+"/ruyi-ai/app/"+appId,data:JSON.stringify({id:appId,attribute:b.agent,defaultResponses:b.defaultResponses}),traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(a){a=dataParse(a),0==a.code?($.trace("保存成功","success"),dataEditedFlag=!1):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}),"string"==typeof b.agent.habitualaction&&b.agent.habitualaction.length>=2&&-1==b.agent.habitualaction.indexOf(";;")?b.agent.habitualaction=b.agent.habitualaction.split(";"):b.agent.habitualaction=[];for(var a in j)""!=b.agent[j[a]]&&"string"==typeof b.agent[j[a]]&&(b.agent[j[a]]=b.agent[j[a]].split(";"))}},0)},b.isGrowthFunc=function(){b.agent.birthdayDate&&b.setBirthdayFunc(b.agent.birthdayDate)},b.setBirthdayFunc=function(a){a=new Date(a),setTimeout(function(){var c=a.getYear(),d=a.getMonth()+1,g=a.getDate(),h=e(d,g),i=f(c);if(b.agent.constellation=h,b.agent.zodiac=i,b.agent.isgrowth&&"false"!=b.agent.isgrowth){var j=1,k=0,l=0,m=(new Date).getTime(),n=m-a.getTime();n=Math.abs(n);var o=n/31536e6;o=parseInt(o),o>0?(j=o,n-=31536e6*o):j=0;var p=n/2592e6;p=parseInt(p),p>0?(k=p,n-=2592e6*p):k=0;var q=n/864e5;q=parseInt(q),l=q>0?q:0,a>m&&(j=-j,k=-k,l=-l),b.agent.ageyear=j,b.agent.agemonth=k,b.agent.ageday=l,b.$apply()}},100)},b.resetAgentParaFunc=function(){$.confirm({text:"你确定要重置所有助理属性吗？",title:"重置",ensureFn:function(){var a=new Object;a.name=[],a.whyname="",a.sex="",a.bloodtype="",a.birthday="",a.birthdayDate="",a.ageyear="",a.agemonth="",a.ageday="",a.isgrowth=!0,a.heightCM="",a.heightCustom="",a.heightCustomize="",a.constellation="",a.zodiac="",a.sexuality="",a.face="",a.brow="",a.eye="",a.nose="",a.mouth="",
a.skincolor="",a.personaltrait="",a.habitualaction=[],a.height="",a.weight="",a.IQ="",a.personal="",a.favorite="",a.play=[],a.eat=[],a.drink=[],a.thing=[],a.people=[],a.book=[],a.movie=[],a.tv=[],a.music=[],a.place=[],a.color=[],a.sport=[],a.dislike=[],a.skill=[],a.ability=[],a.dream=[],a.belief=[],a.friend=[],a.marry="",a.idol=[],a.experience="",a.secret=[],a.motto=[],a.mantra="",a.language=[],a.nationality="",a.birthplace="",a.family="",a.father="",a.foccupation="",a.fop="",a.mother="",a.moccupation="",a.mop="",a.bbro="",a.bbo="",a.bbop="",a.lbro="",a.lbo="",a.lbop="",a.bsis="",a.bso="",a.bsop="",a.lsis="",a.lso="",a.lsop="",a.occupation="",a.op="",a.edu="",a.school="",a.deleteTip="是",a.checkedList=[],b.agent=a,b.$apply(),$(".assistant-para-basic .btn").attr("disabled","disabled"),$(".assistant-para-personal .btn").removeAttr("disabled"),$(".assistant-para-family .btn").removeAttr("disabled"),$(".assistant-para-social .btn").removeAttr("disabled"),$(".dropdown-menu li").removeClass("disabled").removeAttr("disabled"),$(".assistant-para-basic li").show(),$(".assistant-para-personal .list-group-item:gt(1)").hide(),$(".assistant-para-family .list-group-item:gt(1)").hide(),$(".assistant-para-social .list-group-item:gt(1)").hide(),$("li.appearance > div").hide(),$("li.favorite > div").hide()}})},b.closeAssistantPara=function(){if(dataEditedFlag)$.confirm_save({text:"你的修改未保存，确定要离开助理属性页面吗？",title:"系统提示",ensureFn:function(){switch(dataEditedFlag=!1,$(".list-group-item").removeClass("active"),$("[data-act="+g+"]").addClass("active"),g){case"nav-scenario":window.location.href="#/intent_list/"+h;break;case"nav-entity":c.go("entity_list");break;case"nav-resource":c.go("resource");break;case"nav-log":c.go("user_log_list.log_statistics");break;case"nav-reference":c.go("skill_store");break;case"nav-test":c.go("angularDemo");break;case"nav-test-try":c.go("angularDemoTry")}},saveFn:function(){switch($(".assistant-footer .rating-submit").trigger("click"),dataEditedFlag=!1,$(".list-group-item").removeClass("active"),$("[data-act="+g+"]").addClass("active"),g){case"nav-scenario":window.location.href="#/intent_list/"+h;break;case"nav-entity":c.go("entity_list");break;case"nav-resource":c.go("resource");break;case"nav-log":c.go("user_log_list.log_statistics");break;case"nav-reference":c.go("skill_store");break;case"nav-test":c.go("angularDemo");break;case"nav-test-try":c.go("angularDemoTry")}}});else switch($(".list-group-item").removeClass("active"),$("[data-act="+g+"]").addClass("active"),g){case"nav-scenario":window.location.href="#/intent_list/"+h;break;case"nav-entity":c.go("entity_list");break;case"nav-resource":c.go("resource");break;case"nav-log":c.go("user_log_list.log_statistics");break;case"nav-reference":c.go("skill_store");break;case"nav-test":c.go("angularDemo");break;case"nav-test-try":c.go("angularDemoTry")}},$(".delete-tips input").click(function(){b.$apply()}),$(".assistant-para-box li i.delete").click(function(a){a.stopPropagation();var c=$(this);if(c.parents(".title").length)var d=c.parents(".title").attr("class").split(" ")[3];else var d=null;var e=c.parent().attr("class").split(" ")[1],f=c.parent().attr("class").split(" ")[0];if("是"==b.agent.deleteTip)$.confirm({text:"您确认删除该属性吗？",title:"删除属性",ensureFn:function(){if(null!=d)b.agent[d]="",c.parents(".title").addClass("deleted").hide(),c.parents(".list-group-item").siblings().children(".btn-group").find("."+d).removeClass("disabled").removeAttr("disabled"),9==c.parents(".appearance").children(".deleted").length&&c.parents(".appearance").hide();else if("deleted"!=e&&null!=e){if("height"==e)b.agent.height="",b.agent.heightCM="",b.agent.heightCustom="",b.agent.heightCustomize="";else if("father"==e||"mother"==e||"bbro"==e||"lbro"==e||"bsis"==e||"lsis"==e||"occupation"==e||"education"==e)for(var a=0;a<c.siblings("input").length;a++){var g=c.siblings("input").eq(a).attr("class").split(" ")[0];b.agent[g]=""}else"birthday"==e?(b.agent.birthdayDate="",b.agent.birthday="",b.agent.agemonth="",b.agent.ageyear="",b.agent.zodiac="",b.agent.constellation=""):b.agent[e]="";c.parent().hide().siblings().children(".btn."+e).removeClass("disabled").removeAttr("disabled")}else b.agent[f]="",c.parent().addClass("deleted").hide(),c.parents(".list-group-item").siblings().children(".btn-group").find("."+f).removeClass("disabled").removeAttr("disabled"),12==c.parents(".favorite").children(".deleted").length&&c.parents(".favorite").hide()}});else if(null!=d)b.agent[d]="",c.parents(".title").addClass("deleted").hide(),c.parents(".list-group-item").siblings().children(".btn-group").find("."+d).removeClass("disabled").removeAttr("disabled"),9==c.parents(".appearance").children(".deleted").length&&c.parents(".appearance").hide();else if(null!=e){if("height"==e)b.agent.height="",b.agent.heightCM="",b.agent.heightCustom="",b.agent.heightCustomize="";else if("father"==e||"mother"==e||"bbro"==e||"lbro"==e||"bsis"==e||"lsis"==e||"occupation"==e||"education"==e)for(var g=0;g<c.siblings("input").length;g++){var h=c.siblings("input").eq(g).attr("class").split(" ")[0];b.agent[h]=""}else"birthday"==e?(b.agent.birthdayDate="",b.agent.birthday="",b.agent.agemonth="",b.agent.ageyear="",b.agent.zodiac="",b.agent.constellation=""):b.agent[e]="";c.parent().hide().siblings().children(".btn."+e).removeClass("disabled").removeAttr("disabled")}else b.agent[f]="",c.parent().addClass("deleted").hide().parent().siblings().find("."+f).removeClass("disabled").removeAttr("disabled"),12==c.parents(".favorite").children(".deleted").length&&c.parents(".favorite").hide();b.$apply()}),$(".assistant-para-box li button.btn").click(function(){var a=$(this).attr("class").split(" ")[2];"appearance"!=a&&"favorite"!=a&&"myhelp"!=a&&$(this).attr("disabled","disabled").parents(".assistant-para-box").children("."+a).show().children("input").text(" ")}),$(".assistant-para-box li .btn-group li").click(function(){var a=$(this).parents(".btn-group").attr("class").split(" ")[1];"appearance"==a?$(".appearance").show():"favorite"==a&&$(".favorite").show();var b=$(this).attr("class");$(this).addClass("disabled").attr("disabled","disabled").parents(".assistant-para-box").find("."+b).removeClass("deleted").show().find("a").show()}),b.addMultiFeatureFunc=function(a,c,d){a&&$.trim(a).length>0&&(b.agent[c]||(b.agent[c]=new Array),-1==b.agent[c].indexOf(a)?(b.agent[c].push(a),b[d]=""):$.trace("请不要重复输入！"))},b.addMultiFeatureKeydownFunc=function(a,c,d,e){13==a.keyCode&&b.addMultiFeatureFunc(c,d,e)},b.deleteMultiFeatureFunc=function(a,c){for(var d in b.agent[c])b.agent[c][d]==a&&b.agent[c].splice(d,1)}}function userLogsStatisticsCtrl(a,b,c,d){$(".list-group-item").removeClass("active"),$("[data-act=nav-log-statistics]").addClass("active"),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200);var e=function(a,b,c,d){$("#rate-title").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:"问答对准确率"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!1,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},series:[{type:"pie",name:"准确率",data:[{name:"95% - 100%",y:a,sliced:!1,selected:!1,color:"#00AA88"},{name:"80% - 95%",y:b,sliced:!1,selected:!1,color:"#FFB800"},{name:"0% - 80%",y:c,sliced:!1,selected:!1,color:"#DD4B39"},{name:"0",y:d,sliced:!1,selected:!1,color:"#52656D"}]}]})},f=function(a,b,c,d){$("#container").highcharts({chart:{type:"column"},title:{text:"意图准确率"},xAxis:{categories:a},yAxis:{min:0,title:{text:""}},tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.percentage:.0f}%)<br/>',shared:!0},plotOptions:{column:{stacking:"percent"}},series:[{name:"0%-80%",color:"#DD4B39",data:b},{name:"80%-95%",color:"#FFB800",data:c},{name:"95%-100%",color:"#00AA88",data:d}]})},g=function(a){var c=[],d=[],e=[],g=[];b.intentNamesTemp=[];var h=a.intent_right,i=h.length;if(h){for(var j=i-1;i>j&&(h[j].name&&(c.push(h[j].name),b.intentNamesTemp.push({name:h[j].name}),d.push(h[j].rate[1]),e.push(h[j].rate[2]),g.push(h[j].rate[3])),!(i-5>=j||0>=j));j--);f(c,d,e,g)}};b.getStatisticsDataFunc=function(){$.ajax({url:ruyiai_host+"/ruyi-ai/app/stat/"+appId,data:{startTime:-1},timeout:2e3,method:"GET",success:function(c){c&&(c=dataParse(c),0==c.code?(c=c.result,b.statistics=c,g(b.statistics),$("[data-act=tips-text]").css("display","none"),$("[data-act=statistics-box]").css("display","block"),b.$apply(),a.$apply(),h()):2==c.code?goIndex():c.msg&&$.trace(c.msg+"( "+c.detail+" )","error"))},complete:function(a,b){"timeout"==b&&($("[data-act=tips-text]").css("display","none"),$("[data-act=empty-tips]").css("display","block"))}})},b.getStatisticsDataFunc();var h=function(a){var c=b.statistics.qa_right,d=0;for(var f in c)d+=c[f];var g=(c[0]/d).toFixed(2),h=(c[1]/d).toFixed(2),i=(c[2]/d).toFixed(2),j=(c[3]/d).toFixed(2);e(parseFloat(j),parseFloat(i),parseFloat(h),parseFloat(g))};$("body").off("click","[data-act=copy-link]").on("click","[data-act=copy-link]",function(a){a.stopPropagation();var b=($(this),navigator.userAgent);if(b.indexOf("Firefox")>-1||b.indexOf("Chrome")>-1){var c=document.getElementById("html5-link");c.value=encodeURI($("#html5-link").val()),c.select(),document.execCommand("Copy"),$.trace("已复制，可直接贴粘。","success")}}),b.exportHtml5LinkFunc=function(a,c){b.htmlLink=static_host+"/h5-wechat/wechat.html?appName="+a+"&appKey="+c,$("#export-html5-link").modal("show")},$("#export-html5-link").on("shown.bs.modal",function(){setTimeout(function(){$("#html5-link-extend").focus(),$("#html5-link-extend").select()},200)})}function deleteRobotCtrl(a,b,c,d){$(".list-group-item").removeClass("active"),$("[data-act=nav-robot-para]").addClass("active"),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200),$('[data-toggle="popover"]').popover(),$("body").off("click",".d-robot-delete-button").on("click",".d-robot-delete-button",function(a){$("#delete-text").val("");$(this);$("#deleteRobot").modal("show")}),$(".para-action-tips").css("display","none"),$("body").off("click","[data-act=delete-robot-submit]").on("click","[data-act=delete-robot-submit]",function(b){var c=($(this),$("#delete-text"));"删除"==c.val().trim()?$.ajax({url:ruyiai_host+"/ruyi-ai/app/"+a.currentRobot.id,method:"DELETE",success:function(a){a=dataParse(a),0==a.code?($.trace("删除成功","success"),window.location.href=static_host+"/app_manager.html"):2==a.code?goIndex():1==a.code&&$.trace(""+a.msg)}}):($.trace("请在文本框中输入’删除‘,以确认删除"),c.focus())})}function entityDetailCtrl(a,b,c,d){setTimeout(function(){$("[data-act=nav-entity-"+d.entity_id+"]").siblings().removeClass("active"),$("[data-act=nav-entity-"+d.entity_id+"]").addClass("active")},200),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200);var e="";b.checkShowHelp=function(){b.entityDetail&&b.entityDetail.entries&&0!=b.entityDetail.entries.length||$(".help-text").css("display","block")},b.deleteHelpText=function(){$(".help-text").css("display","none")};var f=function(a){if(a)if(a.entries){var b=a.entries[a.entries.length-1];!b||0==$.trim(b.value).length&&0==b.synonyms.length||a.entries.push({value:"",synonyms:[]})}else a.entries=[],a.entries.push({value:"",synonyms:[]});return a};b.getEntityDetailFunc=function(){$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/entity/"+d.entity_id,method:"GET",success:function(a){a=dataParse(a),0==a.code?(b.entityDetail=a.result,b.entityDetail=f(b.entityDetail),e=JSON.stringify(b.entityDetail),b.$apply(),b.checkShowHelp()):2==a.code?goIndex():(a.msg&&$.trace(a.msg+"( "+a.detail+" )","error"),1001==a.code&&(window.location.href=static_host+"/console/api_manager.html"))}})};var g=0;angular.element(".center-list-box-entity").scope().entityCount&&(g=angular.element(".center-list-box-entity").scope().entityCount);var h=function(){g+=1,b.entityDetail=new Object,b.entityDetail=f(b.entityDetail),b.entityDetail.name="未命名词典"+g,setTimeout(function(){b.addEntityFunc(i),$(".help-text").css("display","block")},20)};-1==d.entity_id?h():b.getEntityDetailFunc(),b.addEntityValueFunc=function(a,c){if(!isContainSpacesFunc(a)){if(!a||$.trim(a).length<=0)return!1;if(b.entityDetail.entries)if(b.entityDetail.entries[c])b.entityDetail.entries[c].value=a;else{var d=new Object;d.value=a,b.entityDetail.entries.push(d)}else{b.entityDetail.entries=new Array;var d=new Object;d.value=a,b.entityDetail.entries.push(d)}b.addEntityEntryValue="",b.addSynonymsValue=new Array,b.addEntitySynonym="",b.addSynonym="",dataEditedFlag=!0,f(b.entityDetail)}},b.addEntitySynonymFunc=function(a,c){if(!a||$.trim(a).length<=0)return!1;if(!isContainSpacesFunc(a)){if(b.entityDetail.entries)if(b.entityDetail.entries[c]){b.entityDetail.entries[c].synonyms||(b.entityDetail.entries[c].synonyms=new Array);var d=!1;for(var e in b.entityDetail.entries[c].synonyms)b.entityDetail.entries[c].synonyms[e]==a&&(d=!0);d||b.entityDetail.entries[c].synonyms.push(a)}else{var g=new Object;g.synonyms=new Array,g.synonyms.push(a),b.entityDetail.entries.push(g)}else{b.entityDetail.entries=new Array;var g=new Object;g.synonyms=new Array,g.synonyms.push(a),b.entityDetail.entries.push(g)}b.addEntityEntryValue="",b.addSynonymsValue=new Array,b.addEntitySynonym="",b.addSynonym="",$("[data-act=addEntitySynonym]").val(""),dataEditedFlag=!0,f(b.entityDetail)}},$("body").off("keyup","[data-act=addEntitySynonym]").on("keyup","[data-act=addEntitySynonym]",function(a){var c=$(this),d=c.attr("data-index");13==a.keyCode&&(c.val()&&0!=c.val().length?(b.addEntitySynonymFunc(c.val(),d),b.$apply()):(d=parseInt(d)+1,$("[data-act=entity-li-"+d+"]").find("[data-act=entity-similar-title]").focus()))}),$("body").off("keyup","[data-act=entity-name]").on("keyup","[data-act=entity-name]",function(a){$(this);13==a.keyCode&&$("[data-act=entity-li-0]").find("[data-act=entity-similar-title]").focus()}),b.addEntityFunc=function(c){$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/entity",data:JSON.stringify(b.entityDetail),traditional:!0,headers:{"Content-Type":"application/json"},method:"POST",success:function(d){if(d=dataParse(d),0==d.code){b.entityDetail.id=d.result.id,c&&c();var f=angular.element(".center-list-box-entity").scope().entityList;f||(f=new Array),f.push(b.entityDetail),angular.element(".center-list-box-entity").scope().entityList=f,angular.element(".center-list-box-entity").scope().entityCount=angular.element(".center-list-box-entity").scope().entityCount+1,b.$apply(),dataEditedFlag=!1,e=JSON.stringify(b.entityDetail),a.$apply(),setTimeout(function(){$("[data-act=entity-name]").focus(),setTimeout(function(){$("[data-act=entity-name]").select()},100)},20),window.location.href="#/entity_list/entity_detail/"+b.entityDetail.id}else 2==d.code?goIndex():d.msg.indexOf("already exists")>-1?h():d.msg&&$.trace(d.msg+"( "+d.detail+" )","error")},error:function(){$.trace("词典创建失败")}})},b.updateEntityFunc=function(c){$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/entity/"+d.entity_id,data:JSON.stringify(b.entityDetail),traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(d){if(d=dataParse(d),0==d.code){callAgentReloadTestFunc();var f=angular.element(".center-list-box-entity").scope().entityList;for(var g in f)f[g].id==b.entityDetail.id&&(f[g].name=b.entityDetail.name);angular.element(".center-list-box-entity").scope().entityList=f,b.$apply(),c&&c(),dataEditedFlag=!1,e=JSON.stringify(b.entityDetail),a.$apply()}else 2==d.code?goIndex():d.msg&&$.trace(d.msg+"( "+d.detail+" )","error")},error:function(){$.trace("词典更新失败")}})},b.checkRequiredParaments=function(a){!b.entityDetail.name||$.trim(b.entityDetail.name).length<=0?$.trace("请填写词典名称"):!b.entityDetail.entries||b.entityDetail.entries.length<=0?$.trace("至少创建一个参数"):a&&a()};var i=function(){setTimeout(function(){$(".save-and-apply .save-text").text("保存成功","success"),$(".save-and-apply .saveing").css("display","none"),$(".save-and-apply .saveing").css("width","0"),setTimeout(function(){$(".save-and-apply .saveing").css("display","block")},1e3),setTimeout(function(){$(".save-and-apply .save-text").text("保存并应用"),$(".save-and-apply .dim-div").css("display","none")},500)},1e3)};b.saveEntityDetailFunc=function(){"block"!=$(".save-and-apply .dim-div").css("display")&&($(".save-and-apply .dim-div").css("display","block"),$(".save-and-apply .save-text").text("保存中..."),$(".save-and-apply .saveing").css("width","90px"),b.checkRequiredParaments(function(){b.entityDetail.appId=appId,b.entityDetail.id&&b.entityDetail.id.length>0?b.updateEntityFunc(i):b.addEntityFunc(i)}))},b.deleteEntityFunc=function(a,c){$.confirm({text:'词条删除之后将无法恢复，你确定要删除"'+c+'"吗？',title:"删除",ensureFn:function(){for(var c in b.entityDetail.entries)if(c==a){b.entityDetail.entries.splice(c,1),b.$apply(),dataEditedFlag=!0;break}}})},b.deleteSynonymFunc=function(a,c){for(var d in b.entityDetail.entries)if(d==a)for(var e in b.entityDetail.entries[d].synonyms)e==c&&(b.entityDetail.entries[d].synonyms.splice(e,1),dataEditedFlag=!0)},$("body").off("keyup","[data-act=entity-similar-title]").on("keyup","[data-act=entity-similar-title]",function(a){var b=$(this);13==a.keyCode&&b.closest(".intent-row-box").find("[data-act=addEntitySynonym]").focus()}),b.entityNameChangeFunc=function(){dataEditedFlag=!0}}function entityListCtrl(a,b,c,d){$(".list-group-item").removeClass("active"),$("[data-act=nav-entity]").addClass("active"),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200),b.mycity="city",b.createEntityFunc=function(a){"/-1"==window.location.href.substring(window.location.href.length-3,window.location.href.length)?dataEditedFlag&&$.confirm_save({text:"你的修改未保存，确定要离开词典详情页面吗？",title:"系统提示",ensureFn:function(){window.location.reload()},saveFn:function(){$(".save-and-apply").trigger("click"),window.location.reload()}}):window.location.href="#/entity_list/entity_detail/"+a},$('[data-toggle="popover"]').popover(),b.pageSize=12;var e=function(){var a=$(window).height();b.pageSize=parseInt((a-242)/40),b.setPagingCountFunc&&b.setPagingCountFunc()};e(),$(window).resize(function(){e()}),b.searchEntityWords="",b.getEntityListFunc=function(a,c,d){d||(d=""),$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/entitys",data:{start:a,limit:c,keywords:d},method:"GET",success:function(a){d?$(".paging-box").hide():$(".paging-box").show(),a=dataParse(a),0==a.code?(b.entityList=a.result,b.$apply()):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})},b.getEntityListFunc(0,b.pageSize),b.entityListFilter=function(a){return b.searchEntity&&0!=b.searchEntity.length?a.name.indexOf(b.searchEntity)>-1?!0:!1:!0},b.deleteEntityNameFunc=function(a,c){$.confirm({text:'词典删除之后所有数据都将无法恢复，你确认要删除 <span class="delete-confirm-tip">"'+c+'"</span> 吗？',title:"删除词典",ensureFn:function(){return $.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/entity/"+a,method:"DELETE",success:function(c){if(c=dataParse(c),0==c.code){callAgentReloadTestFunc();for(var d in b.entityList)if(b.entityList[d].id==a){b.entityList.splice(d,1),b.$apply(),b.entityList.length<=0?window.location.href="#/entity_list":window.location.href="#/entity_list/entity_detail/"+b.entityList[0].id;break}$.trace("删除成功","success")}else 2==c.code?goIndex():c.msg&&$.trace(c.msg+"( "+c.detail+" )","error")}}),!1}})},b.goEntityDetail=function(a){dataEditedFlag&&$.confirm_save({text:"你的修改未保存，确定要离开词典详情页面吗？",title:"系统提示",ensureFn:function(){dataEditedFlag=!1,$("[data-act=confirmShow]").css("display")||(window.location.href="#/entity_list/entity_detail/"+a)},saveFn:function(){$(".save-and-apply").trigger("click"),dataEditedFlag=!1,$("[data-act=confirmShow]").css("display")||(window.location.href="#/entity_list/entity_detail/"+a)}}),dataEditedFlag||$("[data-act=confirmShow]").css("display")||(window.location.href="#/entity_list/entity_detail/"+a)},b.getEntityCountFunc=function(a){$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/entity/count ",method:"GET",success:function(c){c=dataParse(c),0==c.code?(b.entityCount=c.result,a&&a()):2==c.code?goIndex():c.msg&&$.trace(c.msg+"( "+c.detail+" )","error")}})},b.getEntityCountFunc(function(){b.setPagingCountFunc()}),b.setPagingCountFunc=function(){var a=Math.ceil(b.entityCount/b.pageSize);b.pageCount=a,b.entityPageNumList=[];for(var c=1;c<=b.pageCount&&b.entityPageNumList.length<=7;c++)b.entityPageNumList.push(c);var d=b.entityPageNumList[b.entityPageNumList.length-1];b.lastNum=d,b.$apply(),$(".paging-box li:nth-child(2)").addClass("active")},b.firstNum=1,$("body").off("click",".paging-box li a").on("click",".paging-box li a",function(a){var c=$(this),d=c.text();if("«"==d){var e=b.entityPageNumList[0];if(b.firstNum=e,e>=9){b.entityPageNumList=[];for(var f=e-1;f>=1&&b.entityPageNumList.length<=7;f--)b.entityPageNumList.unshift(f)}e=b.entityPageNumList[0],b.firstNum=e;var g=b.entityPageNumList[b.entityPageNumList.length-1];b.lastNum=g}else if("»"==d){var g=b.entityPageNumList[b.entityPageNumList.length-1];if(b.lastNum=g,g<b.pageCount){b.entityPageNumList=[];for(var f=g+1;f<=b.pageCount&&b.entityPageNumList.length<=7;f++)b.entityPageNumList.push(f)}var e=b.entityPageNumList[0];b.firstNum=e,g=b.entityPageNumList[b.entityPageNumList.length-1],b.lastNum=g}else d=parseInt(d),d-=1,b.getEntityListFunc(d*b.pageSize,b.pageSize,b.searchEntityWords),c.parent("li").addClass("active").siblings("li").removeClass("active")}),b.searchEntityWordsNameKeydownFunc=function(a,c){13==a.keyCode&&b.getEntityListFunc(0,b.pageSize,c)},b.searchEntityWordsNameFunc=function(a){b.getEntityListFunc(0,b.pageSize,a)},$('[data-toggle="popover"]').click(function(){var a=$(this),b=$(".popover-content");setTimeout(function(){b.attr("class")||a.popover("show")},200)})}function importKnowledgeBaseCtrl(a,b,c,d){function e(){$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/importlog/query",data:{type:"ENTITY"},method:"GET",success:function(a){a=dataParse(a),0==a.code?(b.entityImportLogList=a.result,b.$apply(),k()):2==a.code&&goIndex()}})}function f(){var a=$(".questions-answers-table"),b=a.offset().top+a.outerHeight(),c=$(".questions-answers-panel"),d=c.offset().top+c.outerHeight(),e=d-b;e>0&&$(".questions-answers-table").scrollTop($(".questions-answers-table").scrollTop()+e)}function g(a){if(el=$(a),el=el[0],el.focus(),$.support.msie){var b=document.selection.createRange();this.last=b,b.moveToElementText(el),b.select(),document.selection.empty(),console.log(1)}else{var b=document.createRange();b.selectNodeContents(el),b.collapse(!1);var c=window.getSelection();c.removeAllRanges(),c.addRange(b),console.log(2)}}function h(a){var b=$(a);if(b=b[0],document.body.createTextRange){var c=document.body.createTextRange();c.moveToElementText(b),c.select()}else if(window.getSelection){var d=window.getSelection(),c=document.createRange();c.selectNodeContents(b),d.removeAllRanges(),d.addRange(c)}else g(".questions-answers-content")}function i(a,c){var d=$("#query_question").val();$.ajax({url:ruyiai_host+"/ruyi-ai/faq/list/"+appId,data:{size:a,page:c,query:d},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var d=a.result;b.faqImportLogList=d.hits,b.$apply();var e=d.totalPage;o(c,e),setTimeout(function(){l()},300)}else 2==a.code&&goIndex()}})}function j(a,b){var c="";if(1==b)return!1;if(7>=b){for(var d=1;b>=d;d++)c+=d,d!=b&&(c+=" ");return a>1&&(c="上一页 "+c),b>a&&(c+=" 下一页"),c}c=a+"";var e=1;4>a&&(e=5-a);for(var d=1;e>=d;d++)a-d>2&&(c=a-d+" "+c),b>a+d&&(c=c+" "+(a+d));var f=b-a;if(2>=f)for(var d=2;4-f>=d;d++)c=a-d+" "+c;return a-4>=1&&(c="... "+c),a>2&&(c="2 "+c),a>1&&(c="上一页 1 "+c),b>a+3&&(c+=" ..."),b-a>2&&(c=c+" "+(b-1)),b-a>0&&(c=c+" "+b+" 下一页"),c}$(".list-group-item").removeClass("active"),$("[data-act=nav-import-knowledge-base]").addClass("active"),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200),$(document).click(function(a){var b=$(a.target);b.is(".questions-answers-panel")||b.is(".questions-answers-panel .questions-answers-content")||b.is(".questions-answers-panel .common-submit-button")||b.is(".questions-answers-content .common-cancel-modal")||$(".questions-answers-panel").fadeOut(500,function(a){$(this).remove()})}),$("body").off("keydown").on("keydown",function(a){$(this);"27"==a.keyCode&&$(".questions-answers-panel").fadeOut(500,function(a){$(this).remove()})}),$("body").off("click","#importEntityKnowledgeBaseButton").on("click","#importEntityKnowledgeBaseButton",function(a){$("[data-act=chooseImportEntityInput]").trigger("click")}),$("body").off("change","[data-act=chooseImportEntityInput]").on("change","[data-act=chooseImportEntityInput]",function(a){var c=new FormData($("#importEntityKnowledgeBaseForm")[0]);$.ajax({url:ruyiai_host+"/ruyi-ai/dictionary/import/"+appId,type:"POST",data:c,async:!1,cache:!1,contentType:!1,processData:!1,success:function(a){a=dataParse(a),0==a.code?($.trace("总共"+a.result.total+"个词条，成功导入"+a.result.success+"个，失败"+a.result.fail+"个","success"),b.entityImportLogList.push(a.result),b.$apply(),$("[data-act=chooseImportEntityInput]").val("")):2==a.code?goIndex():$.trace(a.msg,"error")},error:function(a){}})}),e(),b.deleteImportLog=function(a,c){$.confirm({text:c+"文件对应上传的词典数据删除之后将无法恢复，你确认要删除吗？",title:"删除词典",ensureFn:function(){return $.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/importlog/del",data:{logId:a},method:"GET",success:function(c){if(c=dataParse(c),0==c.code){for(var d in b.entityImportLogList)if(b.entityImportLogList[d].id==a){b.entityImportLogList.splice(d,1);break}$.trace("删除成功","success"),b.$apply()}else 2==c.code&&goIndex()}}),!1}})},b.downloadEntityFile=function(a){window.open(ruyiai_host+"/ruyi-ai/dictionary/export/"+appId+"?hashId="+a)},$("body").off("click","#exportEntityKnowledgeBaseButton").on("click","#exportEntityKnowledgeBaseButton",function(a){window.open(ruyiai_host+"/ruyi-ai/dictionary/export/"+appId)}),$("body").off("click","[data-act=download-example-entity]").on("click","[data-act=download-example-entity]",function(a){window.open(static_host+"/console/example-file/词典示例.zip")}),$("body").off("click","[data-act=download-example-faq]").on("click","[data-act=download-example-faq]",function(a){window.open(static_host+"/console/example-file/问答对示例.zip")}),$("body").off("click","#importFaqKnowledgeBaseButton").on("click","#importFaqKnowledgeBaseButton",function(a){$("[data-act=chooseImportFaqInput]").trigger("click")}),$("body").off("change","[data-act=chooseImportFaqInput]").on("change","[data-act=chooseImportFaqInput]",function(a){var b=new FormData($("#importFaqKnowledgeBaseForm")[0]);$.ajax({url:ruyiai_host+"/ruyi-ai/faq/import/"+appId,type:"POST",data:b,async:!1,cache:!1,contentType:!1,processData:!1,success:function(a){a=dataParse(a),0==a.code?($("[data-act=chooseImportFaqInput]").val(""),setTimeout(function(){i(m,1)},1e3),$.trace("总共"+a.result.totalCount+"个问答对，成功导入"+a.result.successCount+"个，失败"+a.result.errorCount+"个","success")):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")},error:function(a){}})}),b.downloadFaqFile=function(a){window.open(ruyiai_host+"/ruyi-ai/faq/export/"+appId+"?hashId="+a)},b.deleteImportFaqLog=function(a,c){$.confirm({text:c+"文件对应上传的问答对数据删除之后将无法恢复，你确认要删除吗？",title:"删除问答对",ensureFn:function(){return $.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/importlog/del",data:{logId:a},method:"GET",success:function(c){if(c=dataParse(c),0==c.code){for(var d in b.faqImportLogList)if(b.faqImportLogList[d].id==a){b.faqImportLogList.splice(d,1);break}$.trace("删除成功","success"),b.$apply()}else 2==c.code&&goIndex()}}),!1}})},$("body").off("click","[data-act-focus=questions-answers]").on("click","[data-act-focus=questions-answers]",function(a){var b=$(this);b.closest("tr").find(".trash-icon").css("display","none"),setTimeout(function(){var a=b.closest(".questions-answers-parent").attr("data-type"),c=b.closest("tr").attr("data-id"),d=b.parent().outerWidth()+40,e=b.position().top-20,g=b.html();b.closest(".questions-answers-parent").append('<div class="questions-answers-panel" data-id="'+c+'" data-type="'+a+'" style="top:'+e+"px;width:"+d+'px;"><div contenteditable="true" class="questions-answers-content"> '+g+' </div><button class="pull-right common-submit-button" data-act-submit="questions-answers-submit">确 定</button><button class="pull-right common-cancel-modal" data-act-cancel="questions-answers-cancel">取 消</button></div>'),setTimeout(function(){h(".questions-answers-content"),f()},500)},100)}),$("body").off("keydown",".questions-answers-content").on("keydown",".questions-answers-content",function(a){var b=$(this);return 13==a.keyCode?(b.parent(".questions-answers-panel").find("[data-act-submit=questions-answers-submit]").trigger("click"),a.stopPropagation(),!1):void 0}),b.updateFaqFunc=function(a){$.ajax({url:ruyiai_host+"/ruyi-ai/faq/update/"+appId,data:JSON.stringify(a),traditional:!0,headers:{"Content-Type":"application/json"},method:"POST",success:function(a){a=dataParse(a),0==a.code||2==a.code&&goIndex()}})},$("body").off("click","[data-act-submit=questions-answers-submit]").on("click","[data-act-submit=questions-answers-submit]",function(a){var c=$(this),d=c.closest(".questions-answers-panel").attr("data-id"),e=c.closest(".questions-answers-panel").attr("data-type"),f=c.parent(".questions-answers-panel").find(".questions-answers-content"),g=f.html();if(g=$.trim(g).replace(/&nbsp;+/g,""),!g||0==g.length)return"question"==e?$.trace("用户说不能为空"):"answer"==e&&$.trace("机器人答不能为空"),f.focus(),!1;for(var h in b.faqImportLogList)if(d==b.faqImportLogList[h].id){"question"==e?b.faqImportLogList[h].question=g:"answer"==e&&(b.faqImportLogList[h].answer=g),b.updateFaqFunc(b.faqImportLogList[h]);break}b.$apply(),c.closest(".questions-answers-panel").fadeOut(500,function(){c.closest(".questions-answers-panel").remove()})}),b.deleteFaqFunc=function(a){$.ajax({url:ruyiai_host+"/ruyi-ai/faq/delete/"+appId+"/"+a,method:"DELETE",success:function(c){if(c=dataParse(c),0==c.code){for(var d in b.faqImportLogList)if(a==b.faqImportLogList[d].id){b.faqImportLogList.splice(d,1);break}b.$apply(),b.faqImportLogList.length<=1&&i(m,1)}else 2==c.code&&goIndex()}})},$("body").off("click","[data-act-cancel=questions-answers-cancel]").on("click","[data-act-cancel=questions-answers-cancel]",function(a){var b=$(this);b.closest(".questions-answers-panel").fadeOut(500,function(){b.closest(".questions-answers-panel").remove()})});var k=function(){$("#entity-library-box").css("max-height",$(window).height()-422+"px")},l=function(){$(".questions-answers-table").css("max-height",$(window).height()-342+"px"),$(".questions-answers-table").css("height",$(window).height()-342+"px")};$(window).resize(function(){k(),l()});var m=10,n=1;i(m,n);var o=function(a,b){if(b>1){var c=j(a,b).split(" "),d="";for(var e in c)d+=c[e]==a?"<li class='pull-left active'>"+c[e]+"</li>":"<li class='pull-left'>"+c[e]+"</li>";$(".common-paging-box").html("").append(d)}else $(".common-paging-box").html("")};$("body").off("click",".common-paging-box li").on("click",".common-paging-box li",function(a){var b=$(this),c=$(".common-paging-box li.active").html(),d=b.html();return"..."==d?!1:(d="上一页"==d?parseInt(c)-1:"下一页"==d?parseInt(c)+1:parseInt(d),void i(m,d))}),$("body").off("keydown","#query_question").on("keydown","#query_question",function(a){$(this);13==a.keyCode&&i(m,1)}),$("body").off("mouseover","[data-act=questions-answers-tr]").on("mouseover","[data-act=questions-answers-tr]",function(a){var b=$(this);0==b.find(".questions-answers-panel").length&&b.find(".trash-icon").css("display","block")}),$("body").off("mouseout","[data-act=questions-answers-tr]").on("mouseout","[data-act=questions-answers-tr]",function(a){var b=$(this);b.find(".trash-icon").css("display","none")})}function intentDetailCtrl($rootScope,$scope,$state,$stateParams,$sce){function lengthCheckFunc(a,b){for(var c=!1,d=0,e=0;e<a.length;e++){var f=a.charCodeAt(e);if(f>=1&&126>=f||f>=65376&&65439>=f?d++:d+=2,d>b){c=!0;break}}return c}function checkAt(a){if(window.getSelection){var b=window.getSelection(),c=b.getRangeAt(0),d=b.focusNode.textContent,e=c.startOffset;"@"==d.substr(e-1,1)&&(insertAt(a),isAtStatus=!0)}}function insertAt(a){$("body").find("span#prompt").remove(),insertnode(),insertMention(a);
var b=$(".mention-popup");return b.find("input").focus(),a.addClass("on"),autoGetPrompt(""),!1}function autoGetPrompt(a){$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/entity/list",method:"get",cache:!0,data:{keywords:a},success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.userentity,c=a.result.sysentity,d="";b.length>=10&&(b.length=10),c.length=10-b.length;for(var e in b)d+="<li class='user-box-row'>"+b[e]+"</li>";for(var e in c)d+="<li class='user-box-row'>"+c[e]+"</li>";$("body").find("div.user-box").html("<ul>"+d+"</ul>"),defaultItem()}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})}function insertnode(){var a=window.getSelection(),b=a.getRangeAt(0),c=document.createElement("span");c.id="prompt",b.insertNode(c),b.collapse(!1)}function insertMention(a){var b=$('<div class="mention-popup">						<div class="writing-bg">						<input type="text" id="mention-input" placeholder="获取词典(Esc取消)" data-act="atShow"/>						</div>						<div class="user-box"></div>					  </div>'),c=$("span#prompt").position().left+2,d=$(".mention-popup").height()+10,e=$("span#prompt").position().top-d+10;b.css({left:c,top:e}),$(".mention-popup").length>0&&($(".mention-popup").remove(),isAtStatus=!1),b.insertAfter(a),setTimeout(function(){defaultItem()},200)}function defaultItem(){$("body").find(".user-box .user-box-row").length&&$("body").find(".user-box .user-box-row").eq(0).addClass("on")}function choseFriend(a,b,c){var d="";if(d=c?a.val():$(".user-box-row.on").text()+":",window.getSelection){b.focus(),b.find("span#prompt").before(d);var e=window.getSelection(),f=document.createRange();if(f.selectNode(b.find("span#prompt").get(0)),e.removeAllRanges(),e.addRange(f),f.collapse(!1),!c){var e=window.getSelection(),f=e.getRangeAt(0),g=e.focusNode.textContent,h=g.lastIndexOf("@");h>-1&&(g=g.substr(h+1,g.length-1));for(var i=g.indexOf(".",0),j=g.substr(i+1,g.length-i-2),k=0;20>=k;k++)if(0==k){if(aliasExitsFunc(b.text(),j))break}else if(aliasExitsFunc(b.text(),j+k)){j=""+j+k;break}j=j.replace(new RegExp(/\./g),"-"),b.find("span#prompt").before(j+"&nbsp;");var e=window.getSelection(),f=document.createRange();f.selectNode(b.find("span#prompt").get(0)),e.removeAllRanges(),e.addRange(f),f.collapse(!1)}b.find("span#prompt").remove(),isAtStatus=!1}return!1}function aliasExitsFunc(text,alias){var userSysReg=eval("/:"+alias+"/g"),paras=text.match(userSysReg);return paras&&0!=paras.length?!1:!0}function supports_html5_storage(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}$('[data-toggle="tooltip"]').tooltip(),$scope.app_response=getCookie("app_response"),"app-response-weixin"==$scope.app_response?($(".speach-response .app-response-weixin").addClass("active").siblings().removeClass("active"),$("#myTabContent").find("#weixin").addClass("active in").siblings().removeClass("active in")):"app-response-local"==$scope.app_response&&($(".speach-response .app-response-local").addClass("active").siblings().removeClass("active"),$("#myTabContent").find("#local").addClass("active in").siblings().removeClass("active in"));var isAtStatus=!1;$scope.currentUserId=getCookie("userId");var checkIsChangeValue="";$scope.commonIntentDetailFocus=function(a){checkIsChangeValue=a},$scope.commonIntentDetailBlur=function(a){checkIsChangeValue!=a&&(dataEditedFlag=!0)},$scope.userSyaTest="",$('[data-toggle="popover"]').popover(),$scope.testTemplateKeydownFunc=function(){var a=$("#userSyaTest").text(),b=a.replace(/<span[^>]*>/g," ");b=b.replace(/<\/span>/g,"");var c=b.match(/(@[^:]+):([^\s]+)/g);for(var d in c)b=b.replace(c[d],"<span style='background-color:red;'>"+$.trim(c[d])+"</span>");b=$sce.trustAsHtml(b),$scope.userSyaTest=b};var removeDuplicate=function(a){for(var b={},c=[],d=0;d<a.length;d++)b[a[d]]||(b[a[d]]=!0,c.push(a[d]));return c};$("#myreset").click(function(){var a=$("#regTest").text(),b=a.replace(/<span[^>]*>/g," ");b=b.replace(/<\/span>/g,""),$("#regTest").text(b)}),$("#mysubmit").click(function(){var a=$("#regTest").text(),b=a.match(/(@[^:]+):([^\s]+)/g);for(var c in b)a=a.replace(b[c],"<span style='background-color:red;'>"+$.trim(b[c])+"</span>");$("#regTest").html(a)}),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200);var intentDetailDuplicate="";$scope.isSaveSuccess=!0;var addEmptyParametersFunc=function(a){if(a)if($scope.response){var b=$scope.response;if(b.parameters){var c={};b.parameters&&b.parameters.length>0?(c=b.parameters[b.parameters.length-1],($.trim(c.dataType).length>0||$.trim(c.defaultValue).length>0||$.trim(c.name).length>0||$.trim(c.value).length>0||c.prompts.length>0||c.required)&&b.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""})):b.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""})}else b.parameters=[],b.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""})}else $scope.response={action:"",parameters:[],outputs:[[]]},$scope.response.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""});return a},deleteEmptyParametersFunc=function(a){if(a&&a.responses)for(var b in a.responses)if(a.responses[b].parameters)for(var c in a.responses[b].parameters)$.trim(a.responses[b].parameters[c].dataType).length<=0&&$.trim(a.responses[b].parameters[c].defaultValue).length<=0&&$.trim(a.responses[b].parameters[c].name).length<=0&&$.trim(a.responses[b].parameters[c].value).length<=0&&a.responses[b].parameters[c].prompts.length<=0&&!a.responses[b].parameters[c].required&&a.responses[b].parameters.splice(c,1);return a};$scope.newsPageSize=6,$scope.imagePageSize=12,$scope.voicePageSize=20,$scope.videoPageSize=20,$scope.createMediaObjectFunc=function(a){var b=new Object;a.indexOf("@mediaResourceResponse-news")>-1?b.type="news":a.indexOf("@mediaResourceResponse-image")>-1?b.type="image":a.indexOf("@mediaResourceResponse-voice")>-1?b.type="voice":a.indexOf("@mediaResourceResponse-video")>-1&&(b.type="video");var c="#####",d="&&&&&";-1==a.indexOf(c)&&(c="#",d=":");var e=a.split(c);for(var f in e){var g=e[f].split(d);"mediaid"==g[0]?b.mediaId=g[1]:"name"==g[0]&&(b.name=g[1])}return b.text=a,b},$scope.getMediaResponseFunc=function(a){if(a&&($scope.mediaResponseList=new Array),$scope.intentDetail.speech){var b=0;for(var c in $scope.intentDetail.speech)if($scope.intentDetail.speech[c]&&$scope.intentDetail.speech[c].indexOf("@mediaResourceResponse")>-1){var d=$scope.createMediaObjectFunc($scope.intentDetail.speech[c]);a&&$scope.mediaResponseList.push(d),b++}for(var e=0;b>e;e++)for(var c in $scope.intentDetail.speech)if($scope.intentDetail.speech[c].indexOf("@mediaResourceResponse")>-1){$scope.intentDetail.speech.splice(c,1);break}}};var splitOutputsFunc=function(){var a=[],b=[];for(var c in $scope.response.outputs)for(var d in $scope.response.outputs[c]){$scope.response.outputs[c][d]&&$scope.response.outputs[c][d].type&&($scope.response.outputs[c][d].type.indexOf("wechat.")>-1?a.push($scope.response.outputs[c]):b.push($scope.response.outputs[c]));break}0==a.length&&(a=[[]]),0==b.length&&(b=[[]]),$scope.wechatOutputs=a,$scope.localOutouts=b,$scope.$apply()};$scope.getIntentDetailFunc=function(a){a&&0!=a.length&&$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+$stateParams.scenes_id+"/intent/"+a,method:"GET",success:function(a){a=dataParse(a),0==a.code?($scope.intentDetail=a.result,$scope.getMediaResponseFunc(!0),$scope.intentDetail.responses&&$scope.intentDetail.responses.length>0?$scope.response=$scope.intentDetail.responses[0]:$scope.response=new Object,$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail),$scope.intentDetail.templates=removeDuplicate($scope.intentDetail.templates),intentDetailDuplicate=JSON.stringify($scope.intentDetail),$scope.intentDetail.templates.length>5&&($scope.userSayFlag=!1),splitOutputsFunc(),setLearnLevelFunc(),$scope.$apply(),setTimeout(function(){$("[data-act=nav-intent-"+$stateParams.intent_id+"]").siblings().removeClass("active"),$("[data-act=nav-intent-"+$stateParams.intent_id+"]").addClass("active")},200)):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})};var intentIndex=0;angular.element(".center-list-box").scope().intentCount&&(intentIndex=angular.element(".center-list-box").scope().intentCount);var createIntentCommonFunc=function(){intentIndex+=1,$scope.intentDetail=new Object,$scope.intentDetail.name="",$scope.intentDetail.auto=!0,$scope.intentDetail.priority=0,$scope.intentDetail.mlLevel="MIDDLE",$scope.mlLevel=!0,$scope.response={action:"",parameters:[],outputs:[[]]},$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail),$scope.mediaResponseList=[],$scope.wechatOutputs=[[]],$scope.localOutouts=[[]],$scope.intentDetail.name="未命名意图"+intentIndex,setTimeout(function(){$scope.addIntentDetailFunc()},20)};-1==$stateParams.intent_id?createIntentCommonFunc():$scope.getIntentDetailFunc($stateParams.intent_id);var validateIntentDetailFunc=function(){if($scope.intentDetail&&$scope.intentDetail.errorModels&&$scope.intentDetail.errorModels.length>0){var a="",b=1;for(var c in $scope.intentDetail.errorModels)b=parseInt(c)+1,$scope.intentDetail.errorModels[c].code&&"0"==$scope.intentDetail.errorModels[c].code.substring(0,1)?a+="<div style='color:#ee524f;max-height:300px;overflow:hidden;overflow-y:auto;'>"+b+"."+$scope.intentDetail.errorModels[c].detail+"</div>":$scope.intentDetail.errorModels[c].code&&"1"==$scope.intentDetail.errorModels[c].code.substring(0,1)&&(a+="<div style='color:#ffb64c;max-height:300px;overflow:hidden;overflow-y:auto;'>"+b+"."+$scope.intentDetail.errorModels[c].detail+"</div>");$scope.intentDetail.errorModelStr=a}else $scope.intentDetail.errorModelStr="";setTimeout(function(){$('[data-toggle="popover"]').popover()},500)},deleteBlankParaFunc=function(a){for(var b in a)0==$.trim(a[b]).length&&a.splice(b,1);return a};$scope.addIntentDetailFunc=function(){if(!$scope.isSaveSuccess)return!1;$scope.isSaveSuccess=!1,$scope.response.outputs=$scope.wechatOutputs.concat($scope.localOutouts);var a=$scope.intentDetail;a=deleteEmptyParametersFunc(a),a.speech||(a.speech=[]);for(var b in $scope.mediaResponseList){var c=!1;for(var d in a.speech)a.speech[d]==$scope.mediaResponseList[b].text&&(c=!0);c||a.speech.push($scope.mediaResponseList[b].text)}a.templates=deleteBlankParaFunc(a.templates),$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+$stateParams.scenes_id+"/intent",data:JSON.stringify(a),traditional:!0,headers:{"Content-Type":"application/json"},method:"POST",success:function(a){if(addEmptyParametersFunc($scope.intentDetail),$scope.getMediaResponseFunc(!1),a=dataParse(a),0==a.code){callAgentReloadTestFunc();var b={},c={};a.result.validateResult?(b=a.result.validateResult,c=a.result.intent):c=a.result,$.trace("意图创建成功","success"),$rootScope.$apply(),$scope.intentDetail.id=c.id,$scope.intentDetail.intentStatus=c.intentStatus,$scope.intentDetail.errorModels=c.errorModels,$scope.intentDetail.scenarioId=c.scenarioId;var d=angular.element(".center-list-box").scope().intentList;d&&d.length>0||(d=new Array),validateIntentDetailFunc(),d.unshift($scope.intentDetail),intentDetailDuplicate=JSON.stringify($scope.intentDetail),angular.element(".center-list-box").scope().intentList=d,angular.element(".center-list-box").scope().intentCount=angular.element(".center-list-box").scope().intentCount+1,angular.element(".center-list-box").scope().getIntentCountFunc(function(){angular.element(".center-list-box").scope().setPagingCountFunc()}),$scope.$apply(),setTimeout(function(){dataEditedFlag=!1},1e3),setTimeout(function(){$(".intent-name").focus(),setTimeout(function(){$(".intent-name").select()},200)},200),window.location.href="#/intent_list/"+$stateParams.scenes_id+"/intent_detail/"+$scope.intentDetail.id}else 2==a.code?goIndex():a.msg.indexOf("already exists")>-1?createIntentCommonFunc():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error");$scope.isSaveSuccess=!0},error:function(){addEmptyParametersFunc($scope.intentDetail),$.trace("意图创建失败")}})},$scope.updateIntentDetailFunc=function(){if(!$scope.isSaveSuccess)return!1;$scope.isSaveSuccess=!1,$scope.isExits&&$scope.wechatOutputs[0].length>1&&($scope.wechatOutputs[0].pop(),$scope.isExits=!1),$scope.isExits&&$scope.localOutouts[0].length>1&&($scope.localOutouts[0].pop(),$scope.isExits=!1),$scope.response.outputs=$scope.wechatOutputs.concat($scope.localOutouts);var a=$scope.intentDetail;a.speech||(a.speech=[]);for(var b in $scope.mediaResponseList){var c=!1;for(var d in a.speech)a.speech[d]==$scope.mediaResponseList[b].text&&(c=!0);c||a.speech.push($scope.mediaResponseList[b].text)}a=deleteEmptyParametersFunc(a),a.templates=deleteBlankParaFunc(a.templates),$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+$stateParams.scenes_id+"/intent/"+$scope.intentDetail.id,data:JSON.stringify(a),traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(a){if(addEmptyParametersFunc($scope.intentDetail),$scope.getMediaResponseFunc(!1),a=dataParse(a),0==a.code){callAgentReloadTestFunc();var b={},c={};a.result.validateResult?($(".save-and-apply .saveing").css("display","none"),$(".save-and-apply .saveing").css("width","0"),$(".save-and-apply .saveing").css("display","block"),$(".save-and-apply .save-text").text("保存并应用"),$(".save-and-apply .dim-div").css("display","none"),b=a.result.validateResult,c=a.result.intent,$.trace(b.message+"("+b.detail+")")):(c=a.result,setTimeout(function(){$(".save-and-apply .save-text").text("保存成功","success"),$(".save-and-apply .saveing").css("display","none"),$(".save-and-apply .saveing").css("width","0"),setTimeout(function(){$(".save-and-apply .saveing").css("display","block")},1e3),setTimeout(function(){$(".save-and-apply .save-text").text("保存并应用"),$(".save-and-apply .dim-div").css("display","none")},500)},1e3)),$scope.intentDetail=c;var d=angular.element(".center-list-box").scope().intentList;for(var e in d)if(d[e].id==$scope.intentDetail.id){validateIntentDetailFunc(),d[e]=$scope.intentDetail;break}intentDetailDuplicate=JSON.stringify($scope.intentDetail),angular.element(".center-list-box").scope().intentList=d,$scope.$apply(),angular.element(".center-list-box").scope().$apply(),setTimeout(function(){$("[data-act=nav-intent-"+$stateParams.intent_id+"]").siblings().removeClass("active"),$("[data-act=nav-intent-"+$stateParams.intent_id+"]").addClass("active")},20),dataEditedFlag=!1}else 2==a.code?goIndex():a.msg&&($(".save-and-apply .saveing").css("display","none"),$(".save-and-apply .saveing").css("width","0"),$(".save-and-apply .saveing").css("display","block"),$(".save-and-apply .save-text").text("保存并应用"),$(".save-and-apply .dim-div").css("display","none"),$.trace(a.msg+"( "+a.detail+" )","error"));$scope.isSaveSuccess=!0},error:function(){addEmptyParametersFunc($scope.intentDetail),$.trace("意图保存失败")}})},$scope.checkRequiredParaments=function(a){return $scope.intentDetail.name.length<=0?($.trace("请输入意图名称"),$(".intent-name").focus(),!1):void(a&&a())},$scope.saveIntentDetailFunc=function(){navigator.onLine?setTimeout(function(){"block"!=$(".save-and-apply .dim-div").css("display")&&$scope.checkRequiredParaments(function(){$(".save-and-apply .dim-div").css("display","block"),$(".save-and-apply .save-text").text("保存中..."),$(".save-and-apply .saveing").css("width","90px"),$scope.intentDetail.responses=new Array,($scope.response.action||$scope.response.affectedContexts||$scope.response.parameters)&&$scope.intentDetail.responses.push($scope.response),$scope.intentDetail.appId=appId,$scope.intentDetail.scenarioId=$stateParams.scenes_id,$scope.intentDetail.id&&$scope.intentDetail.id.length>0?$scope.updateIntentDetailFunc():$scope.addIntentDetailFunc()})},200):$.trace("您当前处于离线状态，保存意图失败！")};var createIntentProcessObjectFunc=function(a,b){var c=new Object;return c.dataType=b,c.defaultValue="",c.name=a,c.prompts=[],c.required=!1,c.value="$"+a,c};$(".max-modal").on("click",function(a){$(".user-says-input").each(function(a,b){b===document.activeElement&&("user-sya-add"===$(b).attr("data-act")||"user-sys-update"===$(b).attr("data-act"))&&b.blur()}),$(".input-weixin").each(function(a,b){b===document.activeElement&&b.blur()}),$(".input-local").each(function(a,b){b===document.activeElement&&b.blur()})}),$scope.addTemplateFunc=function(a,b,c,d){$(a.target);setTimeout(function(){if(isAtStatus)return isAtStatus=!1,!1;if(b=$(a.target).text().trim(),!(b&&0!=$.trim(b).length||13==a.keyCode||($(a.target).append('<div class="usersay-placeholder">请输入用户说</div>'),0===c||c)))return!1;setTimeout(function(){$(a.target).html(b)},2);var e,f;if($scope.intentDetail.templates){for(var e in $scope.intentDetail.templates)if(e!=c&&$.trim($scope.intentDetail.templates[e])==$.trim(b))return $.trace("此用户说已经存在，重复的只会保存一条"),!1;var f=!1;for(var e in $scope.intentDetail.templates)e==c&&($scope.intentDetail.templates[e]!==b&&(dataEditedFlag=!0,$scope.intentDetail.templates[e]=b),f=!0);f||($scope.intentDetail.templates.push(b),dataEditedFlag=!0)}else console.log("fal"),$scope.intentDetail.templates=new Array,$scope.intentDetail.templates.push(b);$scope.$apply(),$('[data-toggle="tooltip"]').tooltip(),"add"==d&&setTimeout(function(){$(a.target).html(""),$scope.userSayFlag=!0,$scope.$apply()},20)},20)},$scope.addTemplateKeydownFunc=function(a,b,c,d){var e=$(a.target);return 13==a.keyCode?($scope.addTemplateFunc(a,b,c,d),e.parent().next().children().eq(0).focus(),!1):void 0},$scope.deleteTemplateFunc=function(a){dataEditedFlag=!0;for(var b in $scope.intentDetail.templates)if(b==a){$scope.intentDetail.templates.splice(b,1);break}},$scope.copyTemplateFunc=function(a){console.log("cizhilou"),dataEditedFlag=!0;for(var b in $scope.intentDetail.templates)if($scope.intentDetail.templates[b]==a+"(副本)")return $.trace("此用户说副本已经存在"),!1;$scope.intentDetail.templates.push(a+"(副本)")},$scope.addInputIntentTagFunc=function(a){isContainSpacesFunc(a)||a&&$.trim(a).length>0&&($scope.intentDetail.contexts||($scope.intentDetail.contexts=new Array),$scope.intentDetail.contexts.push(a),$scope.addInputIntentTag="",dataEditedFlag=!0)},$scope.addInputIntentTagKeydownFunc=function(a,b){13==a.keyCode&&$scope.addInputIntentTagFunc(b)},$scope.deleteInputIntentTagFunc=function(a){for(var b in $scope.intentDetail.contexts)$scope.intentDetail.contexts[b]==a&&($scope.intentDetail.contexts.splice(b,1),dataEditedFlag=!0)},$scope.addAffectedContextFunc=function(a){if(!isContainSpacesFunc(a)&&a&&$.trim(a).length>0){var b=new Object;b.lifespan=1,b.name=a,$scope.response.affectedContexts||($scope.response.affectedContexts=new Array),$scope.response.affectedContexts.push(b),$scope.addAffectedContext="",dataEditedFlag=!0}},$scope.addAffectedContextKeydownFunc=function(a,b){13==a.keyCode&&$scope.addAffectedContextFunc(b)},$scope.deleteAffectedContextFunc=function(a){for(var b in $scope.response.affectedContexts)if($scope.response.affectedContexts[b].name==a){$scope.response.affectedContexts.splice(b,1),dataEditedFlag=!0;break}},$scope.addSpechFunc=function(a,b){if(!a||$.trim(a).length<=0)return!1;if($scope.intentDetail.speech){var c=!1;for(var d in $scope.intentDetail.speech)d==b&&($scope.intentDetail.speech[d]=a,c=!0);c||$scope.intentDetail.speech.push(a)}else $scope.intentDetail.speech=new Array,$scope.intentDetail.speech.push(a);$scope.addSpeech=""},$scope.addSpechKeydownFunc=function(a,b,c){13==a.keyCode&&$scope.addSpechFunc(b,c)},$scope.deleteSpechFunc=function(a){for(var b in $scope.intentDetail.speech)if($scope.intentDetail.speech[b]==a){$scope.intentDetail.speech.splice(b,1);break}},$scope.copySpechFunc=function(a){$scope.intentDetail.speech.push(a)},$scope.addParamentRequiredFunc=function(a,b){if(a&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].required=a;else{var c=new Object;c.required=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.required=a,$scope.response.parameters.push(c)}dataEditedFlag=!0,$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue="")}},$scope.addParamentNameFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].name=a;else{var c=new Object;c.name=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.name=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.addParamentValueFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].value=a;else{var c=new Object;c.value=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.value=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.addParamentDataTypeFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].dataType=a;else{var c=new Object;c.dataType=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.dataType=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.addParamentDefaultValueFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].defaultValue=a;else{var c=new Object;c.defaultValue=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.defaultValue=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.deleteParamentFunc=function(a){for(var b in $scope.response.parameters)if(b==a){$scope.response.parameters.splice(b,1),dataEditedFlag=!0;break}},$scope.copyParamentFunc=function(a){var b={},c={};for(var d in $scope.response.parameters)if(d==a){c=$scope.response.parameters[d];break}b.dataType=c.dataType,b.defaultValue=c.defaultValue,b.name=c.name;var e=[];for(var d in c.prompts)e.push(c.prompts[d]);b.prompts=e,b.required=c.required,b.value=c.value;var f=$scope.response.parameters.length-2;dataEditedFlag=!0,$scope.response.parameters.splice(f,0,b)},$scope.editPromptsList=function(a){$scope.response.parameters[a].prompts?$scope.prompts=$scope.response.parameters[a].prompts:$scope.prompts=new Array,$scope.promptIndex=a},$scope.promptSubmit=function(){$("#addPrompts").modal("hide")},$scope.check=function(a){console.log(1),$(a.target).scroll(function(){$(a.target).css("height",$(this)[0].scrollHeight)})},$scope.addPromptFunc=function(a,b){var c=$(b.target);c.next().css("visibility","visible"),c.nextAll(".copy-prompt").css("visibility","visible");var d=$(b.target).val()||$(b.target).text();setTimeout(function(){if(!d||$.trim(d).length<=0)return!1;if($scope.prompts){var b=!1;for(var c in $scope.prompts)c==a&&($scope.prompts[c]=d,b=!0);b||$scope.prompts.push(d)}else $scope.prompts=new Array,$scope.prompts.push(d);dataEditedFlag=!0,$scope.addPromptValue="",$scope.$apply()},200)},$scope.hideOprationIcon=function(a){var b=$(a.target);b.next().css("visibility","hidden"),b.nextAll(".copy-prompt").css("visibility","hidden")},$scope.calcuteHeight=function(a){var b=$(a.target);setTimeout(function(){var a=b.height();a>=60?(b.next().css("top","30px"),b.nextAll(".copy-prompt").css("top","30px")):a>=40?(b.next().css("top","20px"),b.nextAll(".copy-prompt").css("top","20px")):a>=20&&(b.next().css("top","10px"),b.nextAll(".copy-prompt").css("top","10px"))},100)},$scope.addPromptKeydownFunc=function(a,b,c){13==a.keyCode&&$scope.addPromptFunc(c,a)},$("#addPrompts").on("hidden.bs.modal",function(){$scope.response.parameters&&$scope.response.parameters[$scope.promptIndex]&&($scope.response.parameters[$scope.promptIndex].prompts=$scope.prompts)}),$scope.deletePromptFunc=function(a){for(var b in $scope.prompts)if(b==a){$scope.prompts.splice(b,1);break}},$scope.copyPromptFunc=function(a,b){var c=$(b.target).parent().find(".prompt-item").text()+"(副本)";$scope.prompts.push(c)},$scope.setPriorityFunc=function(a){dataEditedFlag=!0,$scope.intentDetail.priority=a},$("body").off("click","[data-act=showMoreTemplate] label").on("click","[data-act=showMoreTemplate] label",function(a){var b=$(this);"glyphicon glyphicon-triangle-bottom"==b.siblings("i").attr("class")?$scope.userSayFlag=!0:$scope.userSayFlag=!1,$scope.$apply()}),$("body").off("click","[data-act=learnLevel]").on("click","[data-act=learnLevel]",function(){var a=$(this),b=a.attr("class"),c=$("[data-act=learn-level-bar]");b.indexOf("CLOSE")>-1?(c.css("width","0%"),$("ul > .LOW i").removeClass("active"),$("ul > .MIDDLE i").removeClass("active"),$("ul > .HIGH i").removeClass("active"),$scope.intentDetail.mlLevel="CLOSE"):b.indexOf("LOW")>-1?(c.css("width","34%"),$("ul > .CLOSE i").addClass("active"),$("ul > .LOW i").addClass("active"),$("ul > .MIDDLE i").removeClass("active"),$("ul > .HIGH i").removeClass("active"),$scope.intentDetail.mlLevel="LOW"):b.indexOf("MIDDLE")>-1?(c.css("width","68%"),$("ul > .CLOSE i").addClass("active"),$("ul > .LOW i").addClass("active"),$("ul > .MIDDLE i").addClass("active"),$("ul > .HIGH i").removeClass("active"),$scope.intentDetail.mlLevel="MIDDLE"):b.indexOf("HIGH")>-1&&(c.css("width","100%"),$("ul > .CLOSE i").addClass("active"),$("ul > .LOW i").addClass("active"),$("ul > .MIDDLE i").addClass("active"),$("ul > .HIGH i").addClass("active"),$scope.intentDetail.mlLevel="HIGH")}),$scope.learnLevelFunc=function(a){a?$scope.intentDetail.mlLevel="MIDDLE":$scope.intentDetail.mlLevel="CLOSE"};var setLearnLevelFunc=function(){"CLOSE"==$scope.intentDetail.mlLevel?$scope.mlLevel=!1:$scope.mlLevel=!0};$scope.getMediaListFunc=function(a,b,c,d){$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+a,data:{start:b,limit:c},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&d&&d(a.result.item):2==a.code&&goIndex()}})},$rootScope.newsList=null,$rootScope.imageObjList=null,$rootScope.voiceList=null,$rootScope.videoList=null,$scope.loadMaterialFunc=function(a,b){var c=10;"news"==a?$rootScope.newsList||(c=$scope.newsPageSize,$scope.getMediaListFunc(a,0,c,b)):"image"==a?$rootScope.imageObjList||(c=$scope.imagePageSize,$scope.getMediaListFunc(a,0,c,b)):"voice"==a?$rootScope.voiceList||(c=$scope.voicePageSize,$scope.getMediaListFunc(a,0,c,b)):"video"==a&&($rootScope.videoList||(c=$scope.videoPageSize,$scope.getMediaListFunc(a,0,c,b)))},$scope.loadNewsFunc=function(){$scope.loadMaterialFunc("news",function(a){$rootScope.newsList=a,$scope.$apply()})},$scope.loadImageFunc=function(){$scope.loadMaterialFunc("image",function(a){$rootScope.imageObjList=a,$scope.$apply()})},$scope.loadVoiceFunc=function(){$scope.loadMaterialFunc("voice",function(a){$rootScope.voiceList=a;for(var b in $rootScope.voiceList)$rootScope.voiceList[b].selected=!1;$scope.$apply()})},$scope.loadVideoFunc=function(){$scope.loadMaterialFunc("video",function(a){$rootScope.videoList=a;for(var b in $rootScope.videoList)$rootScope.videoList[b].selected=!1;$scope.$apply()})},$scope.wechatMediaSetFunc=function(a,b){if($scope.currentWechatParentIndex=a,$scope.currentWechatIndex=b,$("#mediaResponseModal").modal("show"),-1!=a){var c=$scope.wechatOutputs[a][b];switch(c.type){case"wechat.image":$("#weixin-customize-image-chosen").trigger("click"),$("#weixin-customize-image-name").val(c.property.title),$("#weixin-customize-image-url").val(c.property.image_url);break;case"wechat.music":$("#weixin-customize-music-chosen").trigger("click"),$("#weixin-customize-music-name").val(c.property.title),$("#weixin-customize-music-abstract").val(c.property.description),$("#weixin-customize-music-url").val(c.property.music_url);break;case"wechat.voice":$("#weixin-customize-voice-chosen").trigger("click"),$("#weixin-customize-voice-name").val(c.property.title),$("#weixin-customize-voice-url").val(c.property.media_id);break;case"wechat.video":$("#weixin-customize-video-chosen").trigger("click"),$("#weixin-customize-video-name").val(c.property.title),$("#weixin-customize-video-url").val(c.property.media_id);break;case"wechat.news":$("#weixin-customize-news-chosen").trigger("click");for(var d=0;d<c.list.length;d++)d>$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").length-1&&$(".add-customize-news").trigger("click"),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-name").val(c.list[d].title),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-abstract").val(c.list[d].description),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-url").val(c.list[d].pic_url),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-jumpto").val(c.list[d].url)}}else $("#mediaResponseModal #myTab-media").children().eq(0).children("a").trigger("click"),resetCustomize()};var resetCustomize=function(){if($(".customize-body").find(".customize-news-body"))for(var a=0,b=$(".customize-body").find(".customize-news-body").children().length;b>a;a++)a>0&&$(".customize-body").find(".customize-news-body").children().eq(a).remove();$(".customize-body").find(".form-control").val("")};$scope.newsObjectClickFunc=function(a){for(var b in $rootScope.newsList)$rootScope.newsList[b].media_id==a?$rootScope.newsList[b].selected=!0:$rootScope.newsList[b].selected=!1},$scope.imageObjectClickFunc=function(a){for(var b in $rootScope.imageObjList)$rootScope.imageObjList[b].media_id==a?$rootScope.imageObjList[b].selected=!0:$rootScope.imageObjList[b].selected=!1},$scope.voiceObjectClickFunc=function(a){for(var b in $rootScope.voiceList)$rootScope.voiceList[b].media_id==a?$rootScope.voiceList[b].selected=!0:$rootScope.voiceList[b].selected=!1},$scope.videoObjectClickFunc=function(a){for(var b in $rootScope.videoList)$rootScope.videoList[b].media_id==a?$rootScope.videoList[b].selected=!0:$rootScope.videoList[b].selected=!1},$scope.setMediaSubmitFunc=function(){var a=$(".choose-media-response.active"),b=a.attr("data-type"),c={};switch(b){case"wechat.news":dataEditedFlag=!0;for(var d in $rootScope.newsList)if($rootScope.newsList[d].selected){c=createOutputObjectFunc(b,$rootScope.newsList[d].content.news_item[0].title,"",$rootScope.newsList[d].media_id);break}break;case"wechat.image":dataEditedFlag=!0;for(var d in $rootScope.imageObjList)if($rootScope.imageObjList[d].selected){c=createOutputObjectFunc(b,$rootScope.imageObjList[d].name,"",$rootScope.imageObjList[d].media_id);
break}break;case"wechat.voice":dataEditedFlag=!0;for(var d in $rootScope.voiceList)if($rootScope.voiceList[d].selected){c=createOutputObjectFunc(b,$rootScope.voiceList[d].name,"",$rootScope.voiceList[d].media_id);break}break;case"wechat.video":dataEditedFlag=!0;for(var d in $rootScope.videoList)if($rootScope.videoList[d].selected){c=createOutputObjectFunc(b,$rootScope.videoList[d].name,"",$rootScope.videoList[d].media_id);break}break;case"wechat.customize":dataEditedFlag=!0;var e=$(".customize-body .active"),f=e.attr("id");if("weixin-customize-image-detail"==f){var g=$("#weixin-customize-image-name").val(),h=$("#weixin-customize-image-url").val();c=createOutputObjectFunc("wechat.image",g,h,"")}else if("weixin-customize-music-detail"==f){var g=$("#weixin-customize-music-name").val(),h=$("#weixin-customize-music-url").val(),i=$("#weixin-customize-music-abstract").val();c=createOutputObjectFunc("wechat.music",g,h,"",i)}else if("weixin-customize-voice-detail"==f){var g=$("#weixin-customize-voice-name").val(),j=$("#weixin-customize-voice-url").val();c=createOutputObjectFunc("wechat.voice",g,"",j)}else if("weixin-customize-video-detail"==f){var g=$("#weixin-customize-video-name").val(),j=$("#weixin-customize-video-url").val();c=createOutputObjectFunc("wechat.video",g,"",j)}else if("weixin-customize-news-detail"==f){for(var k=$("#weixin-customize-news-detail .customize-news-body").children().length,l=new Array,d=0;k>d;d++){l[d]=new Object;var m=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-name").val(),n=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-url").val(),i=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-abstract").val(),h=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-jumpto").val();l[d].title=m,l[d].pic_url=n,l[d].description=i,l[d].url=h}c=createOutputObjectFunc("wechat.news","","","","",l)}}createOrUpdateOutputsWechatFunc(c),$("#mediaResponseModal").modal("hide")},$scope.mediaDeleteFunc=function(a){for(var b in $scope.mediaResponseList)if($scope.mediaResponseList[b].mediaId==a){$scope.mediaResponseList.splice(b,1);break}},$scope.mediaPreviewFunc=function(a){},$rootScope.newsLoadPageId=1,$rootScope.newsLoadMoreBox=!0,$(".news-box").on("scroll",function(a){var b="news",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.newsLoadMoreBox&&($rootScope.newsLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.newsLoadPageId*$scope.newsPageSize,limit:$scope.newsPageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.newsList.push(b[c]);$rootScope.newsLoadPageId++,$rootScope.newsLoadMoreBox=!0,$scope.$apply()}else $rootScope.newsLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$rootScope.imageObjLoadPageId=1,$rootScope.imageObjLoadMoreBox=!0,$(".image-box").on("scroll",function(a){var b="image",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.imageObjLoadMoreBox&&($rootScope.imageObjLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.imageObjLoadPageId*$scope.imagePageSize,limit:$scope.imagePageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.imageObjList.push(b[c]);$rootScope.imageObjLoadPageId++,$rootScope.imageObjLoadMoreBox=!0,$scope.$apply()}else $rootScope.imageObjLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$rootScope.voiceLoadPageId=1,$rootScope.voiceLoadMoreBox=!0,$(".voice-box").on("scroll",function(a){var b="voice",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.voiceLoadMoreBox&&($rootScope.voiceLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.voiceLoadPageId*$scope.voicePageSize,limit:$scope.voicePageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.voiceList.push(b[c]);$rootScope.voiceLoadPageId++,$rootScope.voiceLoadMoreBox=!0,$scope.$apply()}else $rootScope.voiceLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$rootScope.videoLoadPageId=1,$rootScope.videoLoadMoreBox=!0,$(".video-box").on("scroll",function(a){var b="video",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.videoLoadMoreBox&&($rootScope.videoLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.videoLoadPageId*$scope.videoPageSize,limit:$scope.videoPageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.videoList.push(b[c]);$rootScope.videoLoadPageId++,$rootScope.videoLoadMoreBox=!0,$scope.$apply()}else $rootScope.videoLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$("[data-act=change-media]").click(function(){var a=$(this),b=a.attr("href");"#weixin-news"==b?$scope.loadNewsFunc():"#weixin-image"==b?$scope.loadImageFunc():"#weixin-voice"==b?$scope.loadVoiceFunc():"#weixin-video"==b&&$scope.loadVideoFunc()}),$("[data-act=change-customize]").click(function(){var a=$(this),b=a.attr("href");$("#weixin-customize").addClass("in active").siblings().removeClass("in active"),$("#customize").addClass("in active").siblings().removeClass("in active"),$(b).addClass("active").show().siblings().removeClass("active").hide(),$(this).parents(".dropdown-menu-customize").siblings(".customize").text(a.text()),$(".customize").parent().addClass("active").siblings().removeClass("active")}),$('[data-toggle="popover"]').click(function(){var a=$(this),b=$(".popover-content");setTimeout(function(){b.attr("class")||a.popover("show")},200)}),$("body").off("keyup","[data-act=intent-detail-title]").on("keyup","[data-act=intent-detail-title]",function(a){$(this);13==a.keyCode&&$("[data-act=user-sya-add]").focus()}),$("body").off("keyup","[data-act=tab-help]").on("keyup","[data-act=tab-help]",function(a){var b=$(this);13==a.keyCode&&b.parent().next().children().eq(0).focus()}),$("body").off("keyup","[data-act=user-intent-dataType-update]").on("keyup","[data-act=user-intent-dataType-update]",function(a){var b=$(this);13==a.keyCode&&b.parent().next().next().find("input").focus()}),$("body").off("keyup","[data-act=user-intent-defaultValue-update]").on("keyup","[data-act=user-intent-defaultValue-update]",function(a){var b=$(this);13==a.keyCode&&b.parent().parent().next().children().eq(0).find("input").focus()}),$(".user-say-templates").sortable({items:".sortable-li",cancel:".delete,.copy,.user-says-input"}),$(".user-say-templates").sortable({stop:function(a,b){var c=[],d=$(".user-says-input");$.each(d,function(a,b){var d=$(b);d.attr("data-template")&&"undefined"!=d.attr("data-template")&&c.push(d.attr("data-template"))}),$scope.intentDetail.templates=c,$scope.$apply()}}),$("body").off("focus",".user-says-input").on("focus",".user-says-input",function(){var a=$(this);a.parent().find(".drop").css("visibility","hidden"),a.parent().find(".edit").css("visibility","hidden"),a.parent().find(".copy").css("visibility","hidden"),a.parent().find(".delete").css("visibility","hidden"),setTimeout(function(){a.find(".usersay-placeholder").remove()},20)}),$("body").off("blur",".user-says-input").on("blur",".user-says-input",function(){var a=$(this);a.parent().find(".drop").css("visibility","visible"),a.parent().find(".edit").css("visibility","visible"),a.parent().find(".copy").css("visibility","visible"),a.parent().find(".delete").css("visibility","visible")}),$scope.addResListTemp=[],$scope.resType="image";var loadpre="pre",loadnext="next",pageSize=20,initStyle=function(){$(".resource-manager .image-box").css("height",document.documentElement.clientHeight-290);var a=$(".image-box-ul").css("width");if(a){a=a.replace("px",""),a=+a;var b=parseInt(a/186);$("#image .reource-operation").css("width",186*b)}};$(window).resize(function(){initStyle()}),initStyle(),$('a[data-toggle="tab"]').on("shown.bs.tab",function(a){var b=$(a.target).text();"图片"==$.trim(b)?(initStyle(),$scope.resType="image",$scope.resImgList&&0!=$scope.resImgList.length||$scope.loadResourceFunc(0,20,$scope.loadResourceListFunc)):"音频"==$.trim(b)?($scope.resType="voice",$scope.resVoiceList&&0!=$scope.resVoiceList.length||$scope.loadResourceFunc(0,30,$scope.loadResourceListFunc)):"视频"==$.trim(b)?($scope.resType="video",$scope.resVideoList&&0!=$scope.resVideoList.length||$scope.loadResourceFunc(0,30,$scope.loadResourceListFunc)):"自定义"==$.trim(b)&&($scope.resType="customize",$scope.resVideoList&&0!=$scope.resVideoList.length||$scope.loadResourceFunc(0,30,$scope.loadResourceListFunc)),$scope.$apply()}),$scope.loadImage=function(){$.ajax({url:ruyiai_host+"/ruyi-ai/save/"+appId+"/multimedia",data:{mediaType:$scope.resType,liststr:JSON.stringify($scope.addResListTemp)},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0&&$scope.loadResourceListFunc(a.result,loadpre):a&&2==a.code&&goIndex(),$scope.addResListTemp=[],$scope.$apply()}})},$scope.loadResourceListFunc=function(a,b){if(a&&a.length){switch($scope.resType){case"image":if($scope.resImgList)for(var c in a)b==loadpre?$scope.resImgList.unshift(a[c]):b==loadnext&&$scope.resImgList.push(a[c]);else $scope.resImgList=a;break;case"voice":if($scope.resVoiceList)for(var c in a)b==loadpre?$scope.resVoiceList.unshift(a[c]):b==loadnext&&$scope.resVoiceList.push(a[c]);else $scope.resVoiceList=a;break;case"video":if($scope.resVideoList)for(var c in a)b==loadpre?$scope.resVideoList.unshift(a[c]):b==loadnext&&$scope.resVideoList.push(a[c]);else $scope.resVideoList=a}$scope.$apply()}},$scope.loadResourceFunc=function(a,b,c){$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:a,size:b},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&c&&c(a.result,loadpre):a&&2==a.code&&goIndex()}})},$scope.loadResourceFunc(0,20,$scope.loadResourceListFunc);var $imgLoadMoreBox=!0;$("[data-act=image-box]").on("scroll",function(a){var b=$(this),c=b[0].scrollTop,d=b[0].scrollHeight,e=b.height();c>=d-e-45&&1==$imgLoadMoreBox&&($imgLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:$scope.resImgList[$scope.resImgList.length-1].createTime,size:pageSize},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0?($scope.loadResourceListFunc(a.result,loadnext),$imgLoadMoreBox=!0,$scope.$apply()):$imgLoadMoreBox=!1:2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))});var deleteResourceFunc=function(a){var b="";for(var c in a)b+=a[c]+",";$.ajax({url:ruyiai_host+"/ruyi-ai/delete/"+appId+"/multimedia",data:{listid:b},method:"GET",success:function(b){if(b=dataParse(b),0==b.code){for(var c in a)if("image"==$scope.resType)for(var d in $scope.resImgList)a[c]==$scope.resImgList[d].id&&$scope.resImgList.splice(d,1);else if("voice"==$scope.resType)for(var d in $scope.resVoiceList)a[c]==$scope.resVoiceList[d].id&&$scope.resVoiceList.splice(d,1);else if("video"==$scope.resType)for(var d in $scope.resVideoList)a[c]==$scope.resVideoList[d].id&&$scope.resVideoList.splice(d,1);$scope.$apply()}else 2==b.code?goIndex():b.msg&&$.trace(b.msg+"( "+b.detail+" )","error")}})};$("body").off("click",".image-operation .delete").on("click",".image-operation .delete",function(a){var b=$(this),c=b.closest(".image-operation").attr("data-id"),d=b.closest(".image-operation").attr("data-title");$.confirm({text:'你确定要删除"'+d+'"吗？',title:"删除",ensureFn:function(){var a=[c];deleteResourceFunc(a)}})}),$("body").off("click",".image-operation .edit").on("click",".image-operation .edit",function(a){var b=$(this),c=b.closest(".image-operation").attr("data-id"),d=b.closest(".image-operation").attr("data-title");$("#updateResource").modal("show"),$("[data-act=resource-name]").val(d),$("[data-act=resource-id]").val(c)}),$("body").off("keydown","[data-act=resource-name]").on("keydown","[data-act=resource-name]",function(a){$(this);13==a.keyCode&&$("[data-act=submit-rename-resource]").trigger("click")}),$("#updateResource").on("shown.bs.modal",function(){$("[data-act=resource-name]").focus()}),$("body").off("click","[data-act=submit-rename-resource]").on("click","[data-act=submit-rename-resource]",function(a){var b=$("[data-act=resource-name]"),c=$("[data-act=resource-id]");0==$.trim(b.val()).length&&$.trace("资源名称不能为空"),$.ajax({url:ruyiai_host+"/ruyi-ai/update/"+appId+"/multimedia",data:{id:c.val(),name:b.val()},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){if("image"==$scope.resType){for(var b in $scope.resImgList)if(a.result&&$scope.resImgList[b].id==a.result.id){$scope.resImgList[b]=a.result;break}}else if("voice"==$scope.resType){for(var b in $scope.resVoiceList)if(a.result&&$scope.resVoiceList[b].id==a.result.id){$scope.resVoiceList[b]=a.result;break}}else if("video"==$scope.resType)for(var b in $scope.resVideoList)if(a.result&&$scope.resVideoList[b].id==a.result.id){$scope.resVideoList[b]=a.result;break}$scope.$apply(),$.trace("素材名称修改成功","success"),$("#updateResource").modal("hide")}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})}),$("body").off("click","[data-act=img-box-active]").on("click","[data-act=img-box-active]",function(a){var b=$(this),c=b.parent(".image-box-li"),d=c.attr("data-id");for(var e in $scope.resImgList)$scope.resImgList[e].id==d?$scope.resImgList[e].active?$scope.resImgList[e].active=!1:$scope.resImgList[e].active=!0:$scope.resImgList[e].active=!1;$scope.$apply()}),$("body").off("click","[data-act=all-choose]").on("click","[data-act=all-choose]",function(a){var b=$(this),c=b.find("input");if("image"==$scope.resType)if(c.is(":checked"))for(var d in $scope.resImgList)$scope.resImgList[d].active=!0;else for(var d in $scope.resImgList)$scope.resImgList[d].active=!1;else if("voice"==$scope.resType)if(c.is(":checked"))for(var d in $scope.resVoiceList)$scope.resVoiceList[d].active=!0;else for(var d in $scope.resVoiceList)$scope.resVoiceList[d].active=!1;else if("video"==$scope.resType)if(c.is(":checked"))for(var d in $scope.resVideoList)$scope.resVideoList[d].active=!0;else for(var d in $scope.resVideoList)$scope.resVideoList[d].active=!1;$scope.$apply()}),$("body").off("click","[data-act=all-delete]").on("click","[data-act=all-delete]",function(a){$.confirm({text:"你确定要批量删除所选素材吗？",title:"删除",ensureFn:function(){var a=($(this),0),b=[];if("image"==$scope.resType)for(var c in $scope.resImgList)$scope.resImgList[c].active&&(b.push($scope.resImgList[c].id),a++);else if("voice"==$scope.resType)for(var c in $scope.resVoiceList)$scope.resVoiceList[c].active&&(b.push($scope.resVoiceList[c].id),a++);else if("video"==$scope.resType)for(var c in $scope.resVideoList)$scope.resVideoList[c].active&&(b.push($scope.resVideoList[c].id),a++);0==a?$.trace("你未选择要删除的素材"):deleteResourceFunc(b)}})});var $voiceLoadMoreBox=!0;$("[data-act=voice-box]").on("scroll",function(a){var b=$(this),c=b[0].scrollTop,d=b[0].scrollHeight,e=b.height();c>=d-e-45&&1==$voiceLoadMoreBox&&($voiceLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:$scope.resVoiceList[$scope.resVoiceList.length-1].createTime,size:pageSize},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0?($scope.loadResourceListFunc(a.result,loadnext),$voiceLoadMoreBox=!0,$scope.$apply()):$voiceLoadMoreBox=!1:2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))});var $videoLoadMoreBox=!0;$("[data-act=video-box]").on("scroll",function(a){var b=$(this),c=b[0].scrollTop,d=b[0].scrollHeight,e=b.height();c>=d-e-45&&1==$videoLoadMoreBox&&($videoLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:$scope.resVideoList[$scope.resVideoList.length-1].createTime,size:pageSize},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0?($scope.loadResourceListFunc(a.result,loadnext),$imgLoadMoreBox=!0,$scope.$apply()):$imgLoadMoreBox=!1:2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$("body").off("click","#voice .delete,#video .delete").on("click","#voice .delete,#video .delete",function(a){var b=$(this),c=b.closest("tr").attr("data-id"),d=b.closest("tr").attr("data-title");$.confirm({text:'你确定要删除"'+d+'"吗？',title:"删除",ensureFn:function(){var a=[c];deleteResourceFunc(a)}})}),$("body").off("click","#voice .edit,#video .edit").on("click","#voice .edit,#video .edit",function(a){var b=$(this),c=b.closest("tr").attr("data-id"),d=b.closest("tr").attr("data-title");$("#updateResource").modal("show"),$("[data-act=resource-name]").val(d),$("[data-act=resource-id]").val(c)}),$("body").off("click","[name=local-choosed-voice]").on("click","[name=local-choosed-voice]",function(a){}),$scope.localResourceSetFunc=function(a,b){if($scope.currentWechatParentIndex=a,$scope.currentWechatIndex=b,$("#localResourceModal").modal("show"),-1!=a){var c=$scope.localOutouts[a][b];switch(c.type){case"image":$("#customize-image-chosen").trigger("click"),$("#customize-image-name").val(c.property.name),$("#customize-image-url").val(c.property.image_url);break;case"voice":$("#customize-voice-chosen").trigger("click"),$("#customize-voice-name").val(c.property.name),$("#customize-voice-url").val(c.property.voice_url);break;case"video":$("#customize-video-chosen").trigger("click"),$("#customize-video-name").val(c.property.name),$("#customize-video-url").val(c.property.video_url)}}else $("#localResourceModal #myTab-local").children().eq(0).children("a").trigger("click"),resetCustomize();setTimeout(function(){initStyle()},200)};var findResourceObjectById=function(a,b){for(var c in a)if(a[c].id==b)return a[c]},findResourceObjectByActive=function(a){for(var b in a)if(a[b].active)return a[b]},createOrUpdateOutputsWechatFunc=function(a){var b=!1;for(var c in $scope.wechatOutputs)if(!b)for(var d in $scope.wechatOutputs[c])if(c==$scope.currentWechatParentIndex&&d==$scope.currentWechatIndex){b=!0,$scope.wechatOutputs[c]||($scope.wechatOutputs[c]=[]),$scope.wechatOutputs[c][d]=a;break}b||($scope.wechatOutputs[$scope.currentWechatIndex]||($scope.wechatOutputs[$scope.currentWechatIndex]=[]),$scope.wechatOutputs[$scope.currentWechatIndex].push(a)),$scope.$apply()},createOrUpdateOutputsLocalFunc=function(a){var b=!1;for(var c in $scope.localOutouts)if(!b)for(var d in $scope.localOutouts[c])if(c==$scope.currentWechatParentIndex&&d==$scope.currentWechatIndex){b=!0,$scope.localOutouts[c]||($scope.localOutouts[c]=[]),$scope.localOutouts[c][d]=a;break}b||($scope.localOutouts[$scope.currentWechatIndex]||($scope.localOutouts[$scope.currentWechatIndex]=[]),$scope.localOutouts[$scope.currentWechatIndex].push(a)),$scope.$apply()};$scope.localResourceSubFunc=function(){var a=$(".choose-response.active"),b=a.attr("data-type"),c={},d={};if("image"==b)dataEditedFlag=!0,c=findResourceObjectByActive($scope.resImgList),d=createOutputObjectFunc(c.type,c.title,c.url,"");else if("voice"==$scope.resType){dataEditedFlag=!0;var e=$("[name=local-choosed-voice]:checked"),f=e.closest("tr");c=findResourceObjectById($scope.resVoiceList,f.attr("data-id")),d=createOutputObjectFunc(c.type,c.title,c.url,"")}else if("video"==b){dataEditedFlag=!0;var e=$("[name=local-choosed-video]:checked"),f=e.closest("tr");c=findResourceObjectById($scope.resVideoList,f.attr("data-id")),d=createOutputObjectFunc(c.type,c.title,c.url,"")}else if("customize"==b){dataEditedFlag=!0;var g=$("#customize .video-box .customize-body .active"),h=g.attr("id");if("customize-image-detail"==h){var i=$("#customize-image-name").val(),j=$("#customize-image-url").val();d=createOutputObjectFunc("image",i,j,"")}else if("customize-voice-detail"==h){var i=$("#customize-voice-name").val(),j=$("#customize-voice-url").val();d=createOutputObjectFunc("voice",i,j,"")}else if("customize-video-detail"==h){var i=$("#customize-video-name").val(),j=$("#customize-video-url").val();d=createOutputObjectFunc("video",i,j,"")}}createOrUpdateOutputsLocalFunc(d),$("#localResourceModal").modal("hide")},$("body").off("click",".response-action").on("click",".response-action",function(a){a.stopPropagation();var b=$(this),c=b.closest(".response-group").find(".response-box");"0px"==c.css("height")?c.animate({height:"100%"}):c.animate({height:"0"})});var createOutputObjectFunc=function(a,b,c,d,e,f){var g=new Object;switch(g.type=a,g.property=new Object,a){case"dialog":g.property.text=b;break;case"wechat.text":g.property.text=b;break;case"image":g.property.name=b,g.property.image_url=c;break;case"wechat.image":g.property.name=b,g.property.title=b,g.property.media_id=d,g.property.image_url=c;break;case"voice":g.property.name=b,g.property.voice_url=c;break;case"wechat.voice":g.property.name=b,g.property.title=b,g.property.media_id=d;break;case"video":g.property.name=b,g.property.video_url=c;break;case"wechat.video":g.property.name=b,g.property.title=b,g.property.media_id=d;break;case"wechat.news":f&&f.length>0?(g.list=f,g.property.name=f[0].title):(g.property.name=b,g.property.title=b,g.property.media_id=d);break;case"wechat.music":g.property.name=b,g.property.title=b,g.property.music_url=c,g.property.description=e}return g},checkDialogObjectExists=function(a,b,c){var d=!1;if(a)for(var e in a)if(a[e]&&a[e].property.text==b&&a[e].type==c){d=!0;break}return d};$scope.addTextOutputWechatFunc=function(a,b,c,d,e){return checkIsChangeValue!=b&&(dataEditedFlag=!0),!b||$.trim(b).length<=0?!1:void setTimeout(function(){var a=createOutputObjectFunc(e,b,"",""),f=!1;for(var g in $scope.wechatOutputs)if(!f)for(var h in $scope.wechatOutputs[g])if(g==c&&h==d){f=!0,$scope.wechatOutputs[g]||($scope.wechatOutputs[g]=[]),$scope.wechatOutputs[g][h]=a;break}f||($scope.wechatOutputs[d]||($scope.wechatOutputs[d]=[]),checkDialogObjectExists($scope.wechatOutputs[d],b,e)?$("[data-act=outputText]").val()&&$("[data-act=outputText]").val().length>0&&$.trace("此机器人答已经存在，重复的只会保留一条"):($scope.wechatOutputs[d].push(a),$("[data-act=outputText]").val(""))),$scope.$apply(),$('[data-toggle="tooltip"]').tooltip()},200)};var deleteEmptyAssistantAnswerFunc=function(a,b,c,d){for(var e in a)for(var f in a[e])if(e==c&&f==d)return void a[e].splice(e,1)};$scope.addTextOutputLocalFunc=function(a,b,c,d,e){return console.log("parentIndex:"+c),console.log("index:"+d),console.log("outputText:"+b),checkIsChangeValue!=b&&(dataEditedFlag=!0),!b||$.trim(b).length<=0?(deleteEmptyAssistantAnswerFunc($scope.localOutouts,b,c,d),!1):(console.log("错了"),void setTimeout(function(){var a=createOutputObjectFunc(e,b,"",""),f=!1;for(var g in $scope.localOutouts)if(!f)for(var h in $scope.localOutouts[g])if(g==c&&h==d){f=!0,$scope.localOutouts[g]||($scope.localOutouts[g]=[]),$scope.localOutouts[g][h]=a;break}f||($scope.localOutouts[d]||($scope.localOutouts[d]=[]),checkDialogObjectExists($scope.localOutouts[d],b,e)?$("[data-act=outputText-local]").val()&&$("[data-act=outputText-local]").val().length>0&&$.trace("此机器人答已经存在，重复的只会保留一条"):($scope.localOutouts[d].push(a),$("[data-act=outputText-local]").val(""))),$scope.$apply(),$('[data-toggle="tooltip"]').tooltip()},200))},$scope.addTextOutputWechatKeydownFunc=function(a,b,c,d,e){13==a.keyCode&&$scope.addTextOutputWechatFunc(a,b,c,d,e)},$scope.addTextOutputLocalKeydownFunc=function(a,b,c,d,e){13==a.keyCode&&$scope.addTextOutputLocalFunc(a,b,c,d,e)},$scope.deleteOutputWechatFunc=function(a,b){setTimeout(function(){dataEditedFlag=!0;for(var c in $scope.wechatOutputs)for(var d in $scope.wechatOutputs[c])if(c==a&&d==b){$scope.wechatOutputs[c].splice(d,1);break}$scope.$apply()},200)},$scope.deleteOutputLocalFunc=function(a,b){setTimeout(function(){for(var c in $scope.localOutouts)for(var d in $scope.localOutouts[c])if(c==a&&d==b){$scope.localOutouts[c].splice(d,1),dataEditedFlag=!0;break}$scope.$apply()},200)},$scope.copyOutputWechatFunc=function(a,b){for(var c in $scope.wechatOutputs)for(var d in $scope.wechatOutputs[c])if(c==a&&d==b){var e=$scope.wechatOutputs[c][d],f={type:"wechat.text",property:{text:e.property.text+"(副本)"}};$scope.wechatOutputs[c].push(f),dataEditedFlag=!0;break}},$scope.copyOutputLocalFunc=function(a,b){for(var c in $scope.localOutouts)for(var d in $scope.localOutouts[c])if(c==a&&d==b){var e=$scope.localOutouts[c][d],f={type:"wechat.text",property:{text:e.property.text+"(副本)"}};$scope.localOutouts[c].push(f),dataEditedFlag=!0;break}},$scope.editUserSayTextarea=function(a){$("#editUserSayTextarea").modal("show"),$("#userSayTextarea").attr("myIndex",a),$("#userSayTextarea").val($scope.intentDetail.templates[a]),setTimeout(function(){$("#userSayTextarea").focus()},200)},$scope.editUserSayTextareaSubmitFunc=function(){var a=!1,b=$("#userSayTextarea"),c=b.val(),d=b.attr("myIndex");$scope.intentDetail.templates[d]!=b.val()&&(dataEditedFlag=!0),$($scope.intentDetail.templates).each(function(b,e){$.trim(c)===$.trim(e)&&(b!=d&&$.trace("此用户说已经存在，重复的只会保留一条"),$("[data-act=user-sys-update]").eq(d).text(c),a=!0)}),a||($scope.intentDetail.templates[d]=c),$("#editUserSayTextarea").modal("hide")};var assistantEditStatus="isEmpty",checkAssistantEditStatusFunc=function(a){var b="";return $("[data-act="+a+"]").each(function(){$.trim($(this).val()).length>0&&(b=$(this).val())}),assistantEditStatus=b?"notEmpty":"isEmpty",b};$scope.editOutputWechatFunc=function(a,b){var c=checkAssistantEditStatusFunc("outputText");$("#editWeixinTextarea").modal("show");var d=$("#weixinTextarea");if(d.attr("myIndex",b),d.attr("parentIndex",a),-1==b){if($("#editor-iframe-box-wechat").html('<iframe id="editor-iframe-wechat" name="editor-iframe-wechat" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),!c||0==c.length)return!1;d.val(c);var e=setInterval(function(){try{$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val(c),$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(a){}},20)}else{$("#editor-iframe-box-wechat").html('<iframe id="editor-iframe-wechat" name="editor-iframe-wechat" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),d.val($scope.wechatOutputs[a][b].property.text);var e=setInterval(function(){try{$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val($scope.wechatOutputs[a][b].property.text),$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(c){}},20)}},$scope.editOutputLocalFunc=function(a,b){var c=checkAssistantEditStatusFunc("outputText-local");console.log("outputTextLocal:"+c),$("#editLocalTextarea").modal("show");var d=$("#localTextarea");if(d.attr("myIndex",b),d.attr("parentIndex",a),-1==b){if($("#editor-iframe-box-local").html('<iframe id="editor-iframe-local" name="editor-iframe-local" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),!c||0==c.length)return!1;d.val(c);var e=setInterval(function(){try{$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val(c),$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(a){}},20)}else{$("#editor-iframe-box-local").html('<iframe id="editor-iframe-local" name="editor-iframe-local" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),d.val($scope.localOutouts[a][b].property.text);var e=setInterval(function(){try{$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val($scope.localOutouts[a][b].property.text),$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(c){}},20)}},$scope.wechatTextFilter=function(a){return"wechat.text"==a.type?!0:!1},$scope.wechatMediaFilter=function(a){return a.type.indexOf("wechat.")>-1&&"wechat.text"!=a.type?!0:!1},$scope.addMoreResponseFunc=function(){var a=$("[data-act=response-type].active").find(".add-more-response section").attr("data-type");"wechat"==a?$scope.wechatOutputs?$scope.wechatOutputs.push([]):$scope.wechatOutputs=[[]]:"local"==a&&($scope.localOutouts?$scope.localOutouts.push([]):$scope.localOutouts=[[]]),setTimeout(function(){$("[data-act=response-type].active").find(".response-box:last").css("height","100%")},200)},$("body").off("click","[data-act=delete-response-block]").on("click","[data-act=delete-response-block]",function(a){var b=$(this).attr("data-index"),c=$(this).attr("data-type");b=+b,a.stopPropagation(),$.confirm({text:"你确定要删除吗？",title:"删除",ensureFn:function(){dataEditedFlag=!0,"wechat"==c?$scope.wechatOutputs&&$scope.wechatOutputs.splice(b,1):"local"==c&&$scope.localOutouts&&$scope.localOutouts.splice(b,1),$scope.$apply()}})}),$scope.editWeixinTextareaSubmitFunc=function(){var a=!1,b=$("#weixinTextarea"),c=b.attr("parentIndex"),d=b.attr("myIndex"),e=$(window.frames["editor-iframe-wechat"].document).find("#editor_content_textarea").val();if(-1==d||"-1"==d){var f=createOutputObjectFunc("wechat.text",e,"","");dataEditedFlag=!0,"isEmpty"==assistantEditStatus?e&&$.trim(e).length>0&&($($scope.wechatOutputs[c]).each(function(b,c){$.trim(e)===$.trim(c.property.text)&&($.trace("此机器人答已经存在，重复的只会保留一条"),a=!0)}),a?$(".input-weixin").eq(d).val(e):$scope.wechatOutputs[c].push(f)):"notEmpty"==assistantEditStatus&&(console.log("not"),$scope.wechatOutputs[c][$scope.wechatOutputs[c].length-1]=f)}else b.val(e),$scope.wechatOutputs[c][d].property.text!=b.val()&&(dataEditedFlag=!0),$($scope.wechatOutputs[c]).each(function(a,b){b.property.text===e&&($.trace("此机器人答已经存在，重复的只会保留一条"),$scope.isExits=!0)}),$scope.wechatOutputs[c][d].property.text=e;$("#editWeixinTextarea").modal("hide")},$scope.editLocalTextareaSubmitFunc=function(){var a=$("#localTextarea"),b=a.attr("parentIndex"),c=a.attr("myIndex"),d=$(window.frames["editor-iframe-local"].document).find("#editor_content_textarea").val();if(-1==c||"-1"==c){var e=createOutputObjectFunc("dialog",d,"","");dataEditedFlag=!0,"isEmpty"==assistantEditStatus?d&&d.length>0&&($($scope.localOutouts[b]).each(function(a,b){$.trim(d)===$.trim(b.property.text)&&($.trace("此机器人答已经存在，重复的只会保留一条"),$scope.isExits=!0)}),$scope.isExits?$(".input-local").eq(c).val(d):$scope.localOutouts[b].push(e)):"notEmpty"==assistantEditStatus&&($scope.localOutouts[b][$scope.localOutouts[b].length-1]=e)}else a.val(d),$scope.localOutouts[b][c].property.text!=a.val()&&(dataEditedFlag=!0),$($scope.localOutouts[b]).each(function(a,b){$.trim(b.property.text)===$.trim(d)&&($.trace("此机器人答已经存在，重复的只会保留一条"),$scope.isExits=!0)}),$scope.localOutouts[b][c].property.text=a.val();$("#editLocalTextarea").modal("hide")},$scope.addNewsFunc=function(){var a="<div class='customize-news clearfix' style='margin-top: 20px;'><div class='form-group' style='margin-bottom: 0;'><div class='col-md-10  col-md-offset-1'><label>名称：</label><input autocomplete='off' style='border-radius: 0px; box-shadow: none; border-top: 1px solid rgba(0,0,0,0);border-right: 1px solid rgba(0,0,0,0);' type='text' required='required' class='form-control weixin-customize-news-name' placeholder='名称' /></div></div><div class='form-group' style='margin-bottom: 0;'><div class='col-md-10  col-md-offset-1'><label>摘要：</label><textarea style='border-radius: 0px; box-shadow: none; vertical-align: middle;border-right: 1px solid rgba(0,0,0,0);width:85%;max-width:85%;' required='required' class='form-control weixin-customize-news-abstract' placeholder='摘要'></textarea>	</div></div><div class='form-group' style='margin-bottom: 25px;'><div class='col-md-10  col-md-offset-1'><label>封面URL：</label><input autocomplete='off' style='border-radius: 0px; box-shadow: none;border-right: 1px solid rgba(0,0,0,0);' type='text' required='required' class='form-control weixin-customize-news-url' placeholder='封面URL' /></div></div><div class='form-group' style='margin-bottom: 25px;'><div class='col-md-10  col-md-offset-1'><label>跳转链接：</label><input autocomplete='off' style='border-radius: 0px; box-shadow: none;border-right: 1px solid rgba(0,0,0,0);' type='text' required='required' class='form-control weixin-customize-news-jumpto' placeholder='跳转链接' /></div></div><div class='form-group' style='margin-bottom: 25px;'><div class='col-md-10  col-md-offset-1'><div class='delete-customize-news'>&nbsp;</div></div></div></div>";
$("#weixin-customize-news-detail .customize-news-body").append(a),setTimeout(function(){$("#weixin-customize .customize-news-body").scrollTop($("#weixin-customize .customize-news-body")[0].scrollHeight)},0)},$("#weixin-customize-news-detail").delegate(".delete-customize-news","click",function(){var a=$(this);$.confirm({text:"你确定要删除此图文消息吗？",title:"删除",ensureFn:function(){a.parents(".customize-news").remove()}})}),$(".speach-response .nav li").click(function(){setCookie("app_response",$(this).attr("class"))}),$("body").off("keyup",".user-says-input").on("keyup",".user-says-input",function(a){if(50==a.which){var b=$(this);setTimeout(function(){checkAt(b)},200)}}),$("body").off("mouseover",".user-box-row").on("mouseover",".user-box-row",function(){$(this).addClass("on").siblings(".user-box-row").removeClass("on")}),$("body").off("click",".user-box-row").on("click",".user-box-row",function(a){var b=$(this),c=b.closest(".user-box").siblings(".writing-bg").find("input"),d=b.closest(".mention-popup").siblings(".user-says-input");return choseFriend(c,d,!1),b.closest(".mention-popup").remove(),a.stopPropagation(),!1}),$("body").off("focusout","#mention-input").on("focusout","#mention-input",function(a){setTimeout(function(){$(".mention-popup").remove()},200)}),$("body").off("keyup","#mention-input").on("keyup","#mention-input",function(a){var b=$(this),c=b.closest(".mention-popup").siblings(".user-says-input");if("27"==a.keyCode)return choseFriend(b,c,!0),$("body").find(".mention-popup").remove(),!1;if("13"==a.keyCode){if(b.closest(".mention-popup").find(".user-box-row.on").length)return choseFriend(b,c,!1),b.closest(".mention-popup").remove(),!1}else{if("38"==a.keyCode&&b.closest(".mention-popup").find(".user-box-row.on").prev(".user-box-row").length){var d=b.closest(".mention-popup").find(".user-box-row.on");return d.prev(".user-box-row").addClass("on").siblings(".user-box-row").removeClass("on"),!1}if("40"==a.keyCode&&b.closest(".mention-popup").find(".user-box-row.on").next(".user-box-row").length){var d=b.closest(".mention-popup").find(".user-box-row.on");return d.next(".user-box-row").addClass("on").siblings(".user-box-row").removeClass("on"),!1}autoGetPrompt(b.val())}}),$("body").off("click",".upload-resource-button").on("click",".upload-resource-button",function(a){$("#localResourceModal").modal("hide"),setTimeout(function(){window.location.href="#/resource"},500)}),$("body").off("click","[data-act=action-list-trigger]").on("click","[data-act=action-list-trigger]",function(){var a=($(this),$(".my-action-name-list"));"block"==a.css("display")?a.css("display","none"):a.css("display","block")}),$scope.getActionListFunc=function(){$.ajax({url:ruyiai_host+"/ruyi-ai/action/query/list",data:{appId:appId,start:0,limit:1e3},method:"get",success:function(a){a=dataParse(a),0==a.code?($scope.actionList=a.result,$scope.$apply()):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})},$("body").off("click",".my-action-name-list li").on("click",".my-action-name-list li",function(){var a=$(this);$scope.response.action=a.text(),$scope.$apply(),$(".my-action-name-list").css("display","none")}),setTimeout(function(){$scope.getActionListFunc()},2e3),$("body").off("click",".intent-detail-more").on("click",".intent-detail-more",function(a){var b=$(this),c=$(".intent-detail-more-box");"block"==c.css("display")?(c.css("display","none"),b.find("i").removeClass("icon-arrow-down").addClass("icon-arrow-right"),supports_html5_storage()&&localStorage.removeItem("intentDetailMore"+$stateParams.intent_id)):(c.css("display","block"),b.find("i").removeClass("icon-arrow-right").addClass("icon-arrow-down"),supports_html5_storage()&&localStorage.setItem("intentDetailMore"+$stateParams.intent_id,"open"))}),supports_html5_storage()&&"open"==localStorage.getItem("intentDetailMore"+$stateParams.intent_id)&&($(".intent-detail-more-box").css("display","block"),$(".intent-detail-more").find("i").removeClass("icon-arrow-right").addClass("icon-arrow-down")),$scope.commonIntentDetailChange=function(){dataEditedFlag=!0}}function sysIntentDetailPage($rootScope,$scope,$state,$stateParams,$sce){function lengthCheckFunc(a,b){for(var c=!1,d=0,e=0;e<a.length;e++){var f=a.charCodeAt(e);if(f>=1&&126>=f||f>=65376&&65439>=f?d++:d+=2,d>b){c=!0;break}}return c}function checkAt(a){if(window.getSelection){var b=window.getSelection(),c=b.getRangeAt(0),d=b.focusNode.textContent,e=c.startOffset;"@"==d.substr(e-1,1)&&(insertAt(a),isAtStatus=!0)}}function insertAt(a){$("body").find("span#prompt").remove(),insertnode(),insertMention(a);var b=$(".mention-popup");return b.find("input").focus(),a.addClass("on"),autoGetPrompt(""),!1}function autoGetPrompt(a){$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/entity/list",method:"get",cache:!0,data:{keywords:a},success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.userentity,c=a.result.sysentity,d="";b.length>=10&&(b.length=10),c.length=10-b.length;for(var e in b)d+="<li class='user-box-row'>"+b[e]+"</li>";for(var e in c)d+="<li class='user-box-row'>"+c[e]+"</li>";$("body").find("div.user-box").html("<ul>"+d+"</ul>"),defaultItem()}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})}function insertnode(){var a=window.getSelection(),b=a.getRangeAt(0),c=document.createElement("span");c.id="prompt",b.insertNode(c),b.collapse(!1)}function insertMention(a){var b=$('<div class="mention-popup">                        <div class="writing-bg">                        <input type="text" id="mention-input" placeholder="获取词典(Esc取消)" data-act="atShow"/>                        </div>                        <div class="user-box"></div>                      </div>'),c=$("span#prompt").position().left+2,d=$(".mention-popup").height()+10,e=$("span#prompt").position().top-d+10;b.css({left:c,top:e}),$(".mention-popup").length>0&&($(".mention-popup").remove(),isAtStatus=!1),b.insertAfter(a),setTimeout(function(){defaultItem()},200)}function defaultItem(){$("body").find(".user-box .user-box-row").length&&$("body").find(".user-box .user-box-row").eq(0).addClass("on")}function choseFriend(a,b,c){var d="";if(d=c?a.val():$(".user-box-row.on").text()+":",window.getSelection){b.focus(),b.find("span#prompt").before(d);var e=window.getSelection(),f=document.createRange();if(f.selectNode(b.find("span#prompt").get(0)),e.removeAllRanges(),e.addRange(f),f.collapse(!1),!c){var e=window.getSelection(),f=e.getRangeAt(0),g=e.focusNode.textContent,h=g.lastIndexOf("@");h>-1&&(g=g.substr(h+1,g.length-1));for(var i=g.indexOf(".",0),j=g.substr(i+1,g.length-i-2),k=0;20>=k;k++)if(0==k){if(aliasExitsFunc(b.text(),j))break}else if(aliasExitsFunc(b.text(),j+k)){j=""+j+k;break}j=j.replace(new RegExp(/\./g),"-"),b.find("span#prompt").before(j+"&nbsp;");var e=window.getSelection(),f=document.createRange();f.selectNode(b.find("span#prompt").get(0)),e.removeAllRanges(),e.addRange(f),f.collapse(!1)}b.find("span#prompt").remove(),isAtStatus=!1}return!1}function aliasExitsFunc(text,alias){var userSysReg=eval("/:"+alias+"/g"),paras=text.match(userSysReg);return paras&&0!=paras.length?!1:!0}function supports_html5_storage(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}$('[data-toggle="tooltip"]').tooltip(),$scope.app_response=getCookie("app_response"),"app-response-weixin"==$scope.app_response?($(".speach-response .app-response-weixin").addClass("active").siblings().removeClass("active"),$("#myTabContent").find("#weixin").addClass("active in").siblings().removeClass("active in")):"app-response-local"==$scope.app_response&&($(".speach-response .app-response-local").addClass("active").siblings().removeClass("active"),$("#myTabContent").find("#local").addClass("active in").siblings().removeClass("active in"));var isAtStatus=!1;$scope.currentUserId=getCookie("userId");var checkIsChangeValue="";$scope.commonIntentDetailFocus=function(a){checkIsChangeValue=a},$scope.commonIntentDetailBlur=function(a){checkIsChangeValue!=a&&(dataEditedFlag=!0)},$scope.userSyaTest="",$('[data-toggle="popover"]').popover(),$scope.testTemplateKeydownFunc=function(){var a=$("#userSyaTest").text(),b=a.replace(/<span[^>]*>/g," ");b=b.replace(/<\/span>/g,"");var c=b.match(/(@[^:]+):([^\s]+)/g);for(var d in c)b=b.replace(c[d],"<span style='background-color:red;'>"+$.trim(c[d])+"</span>");b=$sce.trustAsHtml(b),$scope.userSyaTest=b};var removeDuplicate=function(a){for(var b={},c=[],d=0;d<a.length;d++)b[a[d]]||(b[a[d]]=!0,c.push(a[d]));return c};$("#myreset").click(function(){var a=$("#regTest").text(),b=a.replace(/<span[^>]*>/g," ");b=b.replace(/<\/span>/g,""),$("#regTest").text(b)}),$("#mysubmit").click(function(){var a=$("#regTest").text(),b=a.match(/(@[^:]+):([^\s]+)/g);for(var c in b)a=a.replace(b[c],"<span style='background-color:red;'>"+$.trim(b[c])+"</span>");$("#regTest").html(a)}),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200);var intentDetailDuplicate="";$scope.isSaveSuccess=!0;var addEmptyParametersFunc=function(a){if(a)if($scope.response){var b=$scope.response;if(b.parameters){var c={};b.parameters&&b.parameters.length>0?(c=b.parameters[b.parameters.length-1],($.trim(c.dataType).length>0||$.trim(c.defaultValue).length>0||$.trim(c.name).length>0||$.trim(c.value).length>0||c.prompts.length>0||c.required)&&b.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""})):b.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""})}else b.parameters=[],b.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""})}else $scope.response={action:"",parameters:[],outputs:[[]]},$scope.response.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""});return a},deleteEmptyParametersFunc=function(a){if(a&&a.responses)for(var b in a.responses)if(a.responses[b].parameters)for(var c in a.responses[b].parameters)$.trim(a.responses[b].parameters[c].dataType).length<=0&&$.trim(a.responses[b].parameters[c].defaultValue).length<=0&&$.trim(a.responses[b].parameters[c].name).length<=0&&$.trim(a.responses[b].parameters[c].value).length<=0&&a.responses[b].parameters[c].prompts.length<=0&&!a.responses[b].parameters[c].required&&a.responses[b].parameters.splice(c,1);return a};$scope.newsPageSize=6,$scope.imagePageSize=12,$scope.voicePageSize=20,$scope.videoPageSize=20,$scope.createMediaObjectFunc=function(a){var b=new Object;a.indexOf("@mediaResourceResponse-news")>-1?b.type="news":a.indexOf("@mediaResourceResponse-image")>-1?b.type="image":a.indexOf("@mediaResourceResponse-voice")>-1?b.type="voice":a.indexOf("@mediaResourceResponse-video")>-1&&(b.type="video");var c="#####",d="&&&&&";-1==a.indexOf(c)&&(c="#",d=":");var e=a.split(c);for(var f in e){var g=e[f].split(d);"mediaid"==g[0]?b.mediaId=g[1]:"name"==g[0]&&(b.name=g[1])}return b.text=a,b},$scope.getMediaResponseFunc=function(a){if(a&&($scope.mediaResponseList=new Array),$scope.intentDetail.speech){var b=0;for(var c in $scope.intentDetail.speech)if($scope.intentDetail.speech[c]&&$scope.intentDetail.speech[c].indexOf("@mediaResourceResponse")>-1){var d=$scope.createMediaObjectFunc($scope.intentDetail.speech[c]);a&&$scope.mediaResponseList.push(d),b++}for(var e=0;b>e;e++)for(var c in $scope.intentDetail.speech)if($scope.intentDetail.speech[c].indexOf("@mediaResourceResponse")>-1){$scope.intentDetail.speech.splice(c,1);break}}};var splitOutputsFunc=function(){var a=[],b=[];for(var c in $scope.response.outputs)for(var d in $scope.response.outputs[c]){$scope.response.outputs[c][d]&&$scope.response.outputs[c][d].type&&($scope.response.outputs[c][d].type.indexOf("wechat.")>-1?a.push($scope.response.outputs[c]):b.push($scope.response.outputs[c]));break}0==a.length&&(a=[[]]),0==b.length&&(b=[[]]),$scope.wechatOutputs=a,$scope.localOutouts=b,$scope.$apply()};$scope.getIntentDetailFunc=function(a){a&&0!=a.length&&$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+$stateParams.scenes_id+"/intent/"+a,method:"GET",success:function(a){a=dataParse(a),0==a.code?($scope.intentDetail=a.result,$scope.getMediaResponseFunc(!0),$scope.intentDetail.responses&&$scope.intentDetail.responses.length>0?$scope.response=$scope.intentDetail.responses[0]:$scope.response=new Object,$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail),$scope.intentDetail.templates=removeDuplicate($scope.intentDetail.templates),intentDetailDuplicate=JSON.stringify($scope.intentDetail),$scope.intentDetail.templates.length>5&&($scope.userSayFlag=!1),splitOutputsFunc(),setLearnLevelFunc(),$scope.$apply(),setTimeout(function(){$("[data-act=nav-intent-"+$stateParams.intent_id+"]").siblings().removeClass("active"),$("[data-act=nav-intent-"+$stateParams.intent_id+"]").addClass("active")},200)):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})};var intentIndex=0;angular.element(".center-list-box").scope().intentCount&&(intentIndex=angular.element(".center-list-box").scope().intentCount);var createIntentCommonFunc=function(){intentIndex+=1,$scope.intentDetail=new Object,$scope.intentDetail.name="",$scope.intentDetail.auto=!0,$scope.intentDetail.priority=0,$scope.intentDetail.mlLevel="MIDDLE",$scope.mlLevel=!0,$scope.response={action:"",parameters:[],outputs:[[]]},$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail),$scope.mediaResponseList=[],$scope.wechatOutputs=[[]],$scope.localOutouts=[[]],$scope.intentDetail.name="未命名意图"+intentIndex,setTimeout(function(){$scope.addIntentDetailFunc()},20)};-1==$stateParams.intent_id?createIntentCommonFunc():$scope.getIntentDetailFunc($stateParams.intent_id);var validateIntentDetailFunc=function(){if($scope.intentDetail&&$scope.intentDetail.errorModels&&$scope.intentDetail.errorModels.length>0){var a="",b=1;for(var c in $scope.intentDetail.errorModels)b=parseInt(c)+1,$scope.intentDetail.errorModels[c].code&&"0"==$scope.intentDetail.errorModels[c].code.substring(0,1)?a+="<div style='color:#ee524f;max-height:300px;overflow:hidden;overflow-y:auto;'>"+b+"."+$scope.intentDetail.errorModels[c].detail+"</div>":$scope.intentDetail.errorModels[c].code&&"1"==$scope.intentDetail.errorModels[c].code.substring(0,1)&&(a+="<div style='color:#ffb64c;max-height:300px;overflow:hidden;overflow-y:auto;'>"+b+"."+$scope.intentDetail.errorModels[c].detail+"</div>");$scope.intentDetail.errorModelStr=a}else $scope.intentDetail.errorModelStr="";setTimeout(function(){$('[data-toggle="popover"]').popover()},500)},deleteBlankParaFunc=function(a){for(var b in a)0==$.trim(a[b]).length&&a.splice(b,1);return a};$scope.addIntentDetailFunc=function(){if(!$scope.isSaveSuccess)return!1;$scope.isSaveSuccess=!1,$scope.response.outputs=$scope.wechatOutputs.concat($scope.localOutouts);var a=$scope.intentDetail;a=deleteEmptyParametersFunc(a),a.speech||(a.speech=[]);for(var b in $scope.mediaResponseList){var c=!1;for(var d in a.speech)a.speech[d]==$scope.mediaResponseList[b].text&&(c=!0);c||a.speech.push($scope.mediaResponseList[b].text)}a.templates=deleteBlankParaFunc(a.templates),$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+$stateParams.scenes_id+"/intent",data:JSON.stringify(a),traditional:!0,headers:{"Content-Type":"application/json"},method:"POST",success:function(a){if(addEmptyParametersFunc($scope.intentDetail),$scope.getMediaResponseFunc(!1),a=dataParse(a),0==a.code){callAgentReloadTestFunc();var b={},c={};a.result.validateResult?(b=a.result.validateResult,c=a.result.intent):c=a.result,$.trace("意图创建成功","success"),$rootScope.$apply(),$scope.intentDetail.id=c.id,$scope.intentDetail.intentStatus=c.intentStatus,$scope.intentDetail.errorModels=c.errorModels,$scope.intentDetail.scenarioId=c.scenarioId;var d=angular.element(".center-list-box").scope().intentList;d&&d.length>0||(d=new Array),validateIntentDetailFunc(),d.unshift($scope.intentDetail),intentDetailDuplicate=JSON.stringify($scope.intentDetail),angular.element(".center-list-box").scope().intentList=d,angular.element(".center-list-box").scope().intentCount=angular.element(".center-list-box").scope().intentCount+1,angular.element(".center-list-box").scope().getIntentCountFunc(function(){angular.element(".center-list-box").scope().setPagingCountFunc()}),$scope.$apply(),setTimeout(function(){dataEditedFlag=!1},1e3),setTimeout(function(){$(".intent-name").focus(),setTimeout(function(){$(".intent-name").select()},200)},200),window.location.href="#/intent_list/"+$stateParams.scenes_id+"/intent_detail/"+$scope.intentDetail.id}else 2==a.code?goIndex():a.msg.indexOf("already exists")>-1?createIntentCommonFunc():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error");$scope.isSaveSuccess=!0},error:function(){addEmptyParametersFunc($scope.intentDetail),$.trace("意图创建失败")}})},$scope.updateIntentDetailFunc=function(){if(!$scope.isSaveSuccess)return!1;$scope.isSaveSuccess=!1,$scope.isExits&&$scope.wechatOutputs[0].length>1&&($scope.wechatOutputs[0].pop(),$scope.isExits=!1),$scope.isExits&&$scope.localOutouts[0].length>1&&($scope.localOutouts[0].pop(),$scope.isExits=!1),$scope.response.outputs=$scope.wechatOutputs.concat($scope.localOutouts);var a=$scope.intentDetail;a.speech||(a.speech=[]);for(var b in $scope.mediaResponseList){var c=!1;for(var d in a.speech)a.speech[d]==$scope.mediaResponseList[b].text&&(c=!0);c||a.speech.push($scope.mediaResponseList[b].text)}a=deleteEmptyParametersFunc(a),a.templates=deleteBlankParaFunc(a.templates),$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+$stateParams.scenes_id+"/intent/"+$scope.intentDetail.id,data:JSON.stringify(a),traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(a){if(addEmptyParametersFunc($scope.intentDetail),$scope.getMediaResponseFunc(!1),a=dataParse(a),0==a.code){callAgentReloadTestFunc();var b={},c={};a.result.validateResult?($(".save-and-apply .saveing").css("display","none"),$(".save-and-apply .saveing").css("width","0"),$(".save-and-apply .saveing").css("display","block"),$(".save-and-apply .save-text").text("保存并应用"),$(".save-and-apply .dim-div").css("display","none"),b=a.result.validateResult,c=a.result.intent,$.trace(b.message+"("+b.detail+")")):(c=a.result,setTimeout(function(){$(".save-and-apply .save-text").text("保存成功","success"),$(".save-and-apply .saveing").css("display","none"),$(".save-and-apply .saveing").css("width","0"),setTimeout(function(){$(".save-and-apply .saveing").css("display","block")},1e3),setTimeout(function(){$(".save-and-apply .save-text").text("保存并应用"),$(".save-and-apply .dim-div").css("display","none")},500)},1e3)),$scope.intentDetail=c;var d=angular.element(".center-list-box").scope().intentList;for(var e in d)if(d[e].id==$scope.intentDetail.id){validateIntentDetailFunc(),d[e]=$scope.intentDetail;break}intentDetailDuplicate=JSON.stringify($scope.intentDetail),angular.element(".center-list-box").scope().intentList=d,$scope.$apply(),angular.element(".center-list-box").scope().$apply(),setTimeout(function(){$("[data-act=nav-intent-"+$stateParams.intent_id+"]").siblings().removeClass("active"),$("[data-act=nav-intent-"+$stateParams.intent_id+"]").addClass("active")},20),dataEditedFlag=!1}else 2==a.code?goIndex():a.msg&&($(".save-and-apply .saveing").css("display","none"),$(".save-and-apply .saveing").css("width","0"),$(".save-and-apply .saveing").css("display","block"),$(".save-and-apply .save-text").text("保存并应用"),$(".save-and-apply .dim-div").css("display","none"),$.trace(a.msg+"( "+a.detail+" )","error"));$scope.isSaveSuccess=!0},error:function(){addEmptyParametersFunc($scope.intentDetail),$.trace("意图保存失败")}})},$scope.checkRequiredParaments=function(a){return $scope.intentDetail.name.length<=0?($.trace("请输入意图名称"),$(".intent-name").focus(),!1):void(a&&a())},$scope.saveIntentDetailFunc=function(){navigator.onLine?setTimeout(function(){"block"!=$(".save-and-apply .dim-div").css("display")&&$scope.checkRequiredParaments(function(){$(".save-and-apply .dim-div").css("display","block"),$(".save-and-apply .save-text").text("保存中..."),$(".save-and-apply .saveing").css("width","90px"),$scope.intentDetail.responses=new Array,($scope.response.action||$scope.response.affectedContexts||$scope.response.parameters)&&$scope.intentDetail.responses.push($scope.response),$scope.intentDetail.appId=appId,$scope.intentDetail.scenarioId=$stateParams.scenes_id,$scope.intentDetail.id&&$scope.intentDetail.id.length>0?$scope.updateIntentDetailFunc():$scope.addIntentDetailFunc()})},200):$.trace("您当前处于离线状态，保存意图失败！")};var createIntentProcessObjectFunc=function(a,b){var c=new Object;return c.dataType=b,c.defaultValue="",c.name=a,c.prompts=[],c.required=!1,c.value="$"+a,c};$(".max-modal").on("click",function(a){$(".user-says-input").each(function(a,b){b===document.activeElement&&("user-sya-add"===$(b).attr("data-act")||"user-sys-update"===$(b).attr("data-act"))&&b.blur()}),$(".input-weixin").each(function(a,b){b===document.activeElement&&b.blur()}),$(".input-local").each(function(a,b){b===document.activeElement&&b.blur()})}),$scope.addTemplateFunc=function(a,b,c,d){$(a.target);setTimeout(function(){if(isAtStatus)return isAtStatus=!1,!1;if(b=$(a.target).text().trim(),!(b&&0!=$.trim(b).length||13==a.keyCode||($(a.target).append('<div class="usersay-placeholder">请输入用户说</div>'),0===c||c)))return!1;setTimeout(function(){$(a.target).html(b)},2);var e,f;if($scope.intentDetail.templates){for(var e in $scope.intentDetail.templates)if(e!=c&&$.trim($scope.intentDetail.templates[e])==$.trim(b))return $.trace("此用户说已经存在，重复的只会保存一条"),!1;var f=!1;for(var e in $scope.intentDetail.templates)e==c&&($scope.intentDetail.templates[e]!==b&&(dataEditedFlag=!0,$scope.intentDetail.templates[e]=b),f=!0);f||($scope.intentDetail.templates.push(b),dataEditedFlag=!0)}else console.log("fal"),$scope.intentDetail.templates=new Array,$scope.intentDetail.templates.push(b);$scope.$apply(),$('[data-toggle="tooltip"]').tooltip(),"add"==d&&setTimeout(function(){$(a.target).html(""),$scope.userSayFlag=!0,$scope.$apply()},20)},20)},$scope.addTemplateKeydownFunc=function(a,b,c,d){var e=$(a.target);return 13==a.keyCode?($scope.addTemplateFunc(a,b,c,d),e.parent().next().children().eq(0).focus(),!1):void 0},$scope.deleteTemplateFunc=function(a){dataEditedFlag=!0;for(var b in $scope.intentDetail.templates)if(b==a){$scope.intentDetail.templates.splice(b,1);break}},$scope.copyTemplateFunc=function(a){console.log("cizhilou"),dataEditedFlag=!0;for(var b in $scope.intentDetail.templates)if($scope.intentDetail.templates[b]==a+"(副本)")return $.trace("此用户说副本已经存在"),!1;$scope.intentDetail.templates.push(a+"(副本)")},$scope.addInputIntentTagFunc=function(a){isContainSpacesFunc(a)||a&&$.trim(a).length>0&&($scope.intentDetail.contexts||($scope.intentDetail.contexts=new Array),$scope.intentDetail.contexts.push(a),$scope.addInputIntentTag="",dataEditedFlag=!0)},$scope.addInputIntentTagKeydownFunc=function(a,b){13==a.keyCode&&$scope.addInputIntentTagFunc(b)},$scope.deleteInputIntentTagFunc=function(a){for(var b in $scope.intentDetail.contexts)$scope.intentDetail.contexts[b]==a&&($scope.intentDetail.contexts.splice(b,1),dataEditedFlag=!0)},$scope.addAffectedContextFunc=function(a){if(!isContainSpacesFunc(a)&&a&&$.trim(a).length>0){var b=new Object;b.lifespan=1,b.name=a,$scope.response.affectedContexts||($scope.response.affectedContexts=new Array),$scope.response.affectedContexts.push(b),$scope.addAffectedContext="",dataEditedFlag=!0}},$scope.addAffectedContextKeydownFunc=function(a,b){13==a.keyCode&&$scope.addAffectedContextFunc(b)},$scope.deleteAffectedContextFunc=function(a){for(var b in $scope.response.affectedContexts)if($scope.response.affectedContexts[b].name==a){$scope.response.affectedContexts.splice(b,1),dataEditedFlag=!0;break}},$scope.addSpechFunc=function(a,b){if(!a||$.trim(a).length<=0)return!1;if($scope.intentDetail.speech){var c=!1;for(var d in $scope.intentDetail.speech)d==b&&($scope.intentDetail.speech[d]=a,c=!0);c||$scope.intentDetail.speech.push(a)}else $scope.intentDetail.speech=new Array,$scope.intentDetail.speech.push(a);$scope.addSpeech=""},$scope.addSpechKeydownFunc=function(a,b,c){13==a.keyCode&&$scope.addSpechFunc(b,c)},$scope.deleteSpechFunc=function(a){for(var b in $scope.intentDetail.speech)if($scope.intentDetail.speech[b]==a){$scope.intentDetail.speech.splice(b,1);break}},$scope.copySpechFunc=function(a){$scope.intentDetail.speech.push(a)},$scope.addParamentRequiredFunc=function(a,b){if(a&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].required=a;else{var c=new Object;c.required=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.required=a,$scope.response.parameters.push(c)}dataEditedFlag=!0,$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue="")}},$scope.addParamentNameFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].name=a;else{var c=new Object;c.name=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.name=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.addParamentValueFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].value=a;else{var c=new Object;c.value=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.value=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.addParamentDataTypeFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].dataType=a;else{var c=new Object;c.dataType=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.dataType=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.addParamentDefaultValueFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].defaultValue=a;else{var c=new Object;c.defaultValue=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.defaultValue=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.deleteParamentFunc=function(a){for(var b in $scope.response.parameters)if(b==a){$scope.response.parameters.splice(b,1),dataEditedFlag=!0;break}},$scope.copyParamentFunc=function(a){var b={},c={};for(var d in $scope.response.parameters)if(d==a){c=$scope.response.parameters[d];break}b.dataType=c.dataType,b.defaultValue=c.defaultValue,b.name=c.name;var e=[];for(var d in c.prompts)e.push(c.prompts[d]);b.prompts=e,b.required=c.required,b.value=c.value;var f=$scope.response.parameters.length-2;dataEditedFlag=!0,$scope.response.parameters.splice(f,0,b)},$scope.editPromptsList=function(a){$scope.response.parameters[a].prompts?$scope.prompts=$scope.response.parameters[a].prompts:$scope.prompts=new Array,$scope.promptIndex=a},$scope.promptSubmit=function(){$("#addPrompts").modal("hide")},$scope.check=function(a){console.log(1),$(a.target).scroll(function(){$(a.target).css("height",$(this)[0].scrollHeight)})},$scope.addPromptFunc=function(a,b){var c=$(b.target);c.next().css("visibility","visible"),c.nextAll(".copy-prompt").css("visibility","visible");var d=$(b.target).val()||$(b.target).text();setTimeout(function(){if(!d||$.trim(d).length<=0)return!1;if($scope.prompts){var b=!1;for(var c in $scope.prompts)c==a&&($scope.prompts[c]=d,b=!0);b||$scope.prompts.push(d)}else $scope.prompts=new Array,$scope.prompts.push(d);dataEditedFlag=!0,$scope.addPromptValue="",$scope.$apply()},200)},$scope.hideOprationIcon=function(a){var b=$(a.target);b.next().css("visibility","hidden"),b.nextAll(".copy-prompt").css("visibility","hidden")},$scope.calcuteHeight=function(a){var b=$(a.target);setTimeout(function(){var a=b.height();a>=60?(b.next().css("top","30px"),b.nextAll(".copy-prompt").css("top","30px")):a>=40?(b.next().css("top","20px"),b.nextAll(".copy-prompt").css("top","20px")):a>=20&&(b.next().css("top","10px"),b.nextAll(".copy-prompt").css("top","10px"))},100)},$scope.addPromptKeydownFunc=function(a,b,c){13==a.keyCode&&$scope.addPromptFunc(c,a)},$("#addPrompts").on("hidden.bs.modal",function(){$scope.response.parameters&&$scope.response.parameters[$scope.promptIndex]&&($scope.response.parameters[$scope.promptIndex].prompts=$scope.prompts)}),$scope.deletePromptFunc=function(a){for(var b in $scope.prompts)if(b==a){$scope.prompts.splice(b,1);break}},$scope.copyPromptFunc=function(a,b){var c=$(b.target).parent().find(".prompt-item").text()+"(副本)";$scope.prompts.push(c)},$scope.setPriorityFunc=function(a){dataEditedFlag=!0,$scope.intentDetail.priority=a},$("body").off("click","[data-act=showMoreTemplate] label").on("click","[data-act=showMoreTemplate] label",function(a){var b=$(this);"glyphicon glyphicon-triangle-bottom"==b.siblings("i").attr("class")?$scope.userSayFlag=!0:$scope.userSayFlag=!1,$scope.$apply()}),$("body").off("click","[data-act=learnLevel]").on("click","[data-act=learnLevel]",function(){var a=$(this),b=a.attr("class"),c=$("[data-act=learn-level-bar]");b.indexOf("CLOSE")>-1?(c.css("width","0%"),$("ul > .LOW i").removeClass("active"),$("ul > .MIDDLE i").removeClass("active"),$("ul > .HIGH i").removeClass("active"),$scope.intentDetail.mlLevel="CLOSE"):b.indexOf("LOW")>-1?(c.css("width","34%"),$("ul > .CLOSE i").addClass("active"),$("ul > .LOW i").addClass("active"),$("ul > .MIDDLE i").removeClass("active"),$("ul > .HIGH i").removeClass("active"),$scope.intentDetail.mlLevel="LOW"):b.indexOf("MIDDLE")>-1?(c.css("width","68%"),$("ul > .CLOSE i").addClass("active"),$("ul > .LOW i").addClass("active"),$("ul > .MIDDLE i").addClass("active"),$("ul > .HIGH i").removeClass("active"),$scope.intentDetail.mlLevel="MIDDLE"):b.indexOf("HIGH")>-1&&(c.css("width","100%"),$("ul > .CLOSE i").addClass("active"),$("ul > .LOW i").addClass("active"),$("ul > .MIDDLE i").addClass("active"),$("ul > .HIGH i").addClass("active"),$scope.intentDetail.mlLevel="HIGH")}),$scope.learnLevelFunc=function(a){a?$scope.intentDetail.mlLevel="MIDDLE":$scope.intentDetail.mlLevel="CLOSE"};var setLearnLevelFunc=function(){"CLOSE"==$scope.intentDetail.mlLevel?$scope.mlLevel=!1:$scope.mlLevel=!0};$scope.getMediaListFunc=function(a,b,c,d){$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+a,data:{start:b,limit:c},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&d&&d(a.result.item):2==a.code&&goIndex()}})},$rootScope.newsList=null,
$rootScope.imageObjList=null,$rootScope.voiceList=null,$rootScope.videoList=null,$scope.loadMaterialFunc=function(a,b){var c=10;"news"==a?$rootScope.newsList||(c=$scope.newsPageSize,$scope.getMediaListFunc(a,0,c,b)):"image"==a?$rootScope.imageObjList||(c=$scope.imagePageSize,$scope.getMediaListFunc(a,0,c,b)):"voice"==a?$rootScope.voiceList||(c=$scope.voicePageSize,$scope.getMediaListFunc(a,0,c,b)):"video"==a&&($rootScope.videoList||(c=$scope.videoPageSize,$scope.getMediaListFunc(a,0,c,b)))},$scope.loadNewsFunc=function(){$scope.loadMaterialFunc("news",function(a){$rootScope.newsList=a,$scope.$apply()})},$scope.loadImageFunc=function(){$scope.loadMaterialFunc("image",function(a){$rootScope.imageObjList=a,$scope.$apply()})},$scope.loadVoiceFunc=function(){$scope.loadMaterialFunc("voice",function(a){$rootScope.voiceList=a;for(var b in $rootScope.voiceList)$rootScope.voiceList[b].selected=!1;$scope.$apply()})},$scope.loadVideoFunc=function(){$scope.loadMaterialFunc("video",function(a){$rootScope.videoList=a;for(var b in $rootScope.videoList)$rootScope.videoList[b].selected=!1;$scope.$apply()})},$scope.wechatMediaSetFunc=function(a,b){if($scope.currentWechatParentIndex=a,$scope.currentWechatIndex=b,$("#mediaResponseModal").modal("show"),-1!=a){var c=$scope.wechatOutputs[a][b];switch(c.type){case"wechat.image":$("#weixin-customize-image-chosen").trigger("click"),$("#weixin-customize-image-name").val(c.property.title),$("#weixin-customize-image-url").val(c.property.image_url);break;case"wechat.music":$("#weixin-customize-music-chosen").trigger("click"),$("#weixin-customize-music-name").val(c.property.title),$("#weixin-customize-music-abstract").val(c.property.description),$("#weixin-customize-music-url").val(c.property.music_url);break;case"wechat.voice":$("#weixin-customize-voice-chosen").trigger("click"),$("#weixin-customize-voice-name").val(c.property.title),$("#weixin-customize-voice-url").val(c.property.media_id);break;case"wechat.video":$("#weixin-customize-video-chosen").trigger("click"),$("#weixin-customize-video-name").val(c.property.title),$("#weixin-customize-video-url").val(c.property.media_id);break;case"wechat.news":$("#weixin-customize-news-chosen").trigger("click");for(var d=0;d<c.list.length;d++)d>$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").length-1&&$(".add-customize-news").trigger("click"),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-name").val(c.list[d].title),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-abstract").val(c.list[d].description),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-url").val(c.list[d].pic_url),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-jumpto").val(c.list[d].url)}}else $("#mediaResponseModal #myTab-media").children().eq(0).children("a").trigger("click"),resetCustomize()};var resetCustomize=function(){if($(".customize-body").find(".customize-news-body"))for(var a=0,b=$(".customize-body").find(".customize-news-body").children().length;b>a;a++)a>0&&$(".customize-body").find(".customize-news-body").children().eq(a).remove();$(".customize-body").find(".form-control").val("")};$scope.newsObjectClickFunc=function(a){for(var b in $rootScope.newsList)$rootScope.newsList[b].media_id==a?$rootScope.newsList[b].selected=!0:$rootScope.newsList[b].selected=!1},$scope.imageObjectClickFunc=function(a){for(var b in $rootScope.imageObjList)$rootScope.imageObjList[b].media_id==a?$rootScope.imageObjList[b].selected=!0:$rootScope.imageObjList[b].selected=!1},$scope.voiceObjectClickFunc=function(a){for(var b in $rootScope.voiceList)$rootScope.voiceList[b].media_id==a?$rootScope.voiceList[b].selected=!0:$rootScope.voiceList[b].selected=!1},$scope.videoObjectClickFunc=function(a){for(var b in $rootScope.videoList)$rootScope.videoList[b].media_id==a?$rootScope.videoList[b].selected=!0:$rootScope.videoList[b].selected=!1},$scope.setMediaSubmitFunc=function(){var a=$(".choose-media-response.active"),b=a.attr("data-type"),c={};switch(b){case"wechat.news":dataEditedFlag=!0;for(var d in $rootScope.newsList)if($rootScope.newsList[d].selected){c=createOutputObjectFunc(b,$rootScope.newsList[d].content.news_item[0].title,"",$rootScope.newsList[d].media_id);break}break;case"wechat.image":dataEditedFlag=!0;for(var d in $rootScope.imageObjList)if($rootScope.imageObjList[d].selected){c=createOutputObjectFunc(b,$rootScope.imageObjList[d].name,"",$rootScope.imageObjList[d].media_id);break}break;case"wechat.voice":dataEditedFlag=!0;for(var d in $rootScope.voiceList)if($rootScope.voiceList[d].selected){c=createOutputObjectFunc(b,$rootScope.voiceList[d].name,"",$rootScope.voiceList[d].media_id);break}break;case"wechat.video":dataEditedFlag=!0;for(var d in $rootScope.videoList)if($rootScope.videoList[d].selected){c=createOutputObjectFunc(b,$rootScope.videoList[d].name,"",$rootScope.videoList[d].media_id);break}break;case"wechat.customize":dataEditedFlag=!0;var e=$(".customize-body .active"),f=e.attr("id");if("weixin-customize-image-detail"==f){var g=$("#weixin-customize-image-name").val(),h=$("#weixin-customize-image-url").val();c=createOutputObjectFunc("wechat.image",g,h,"")}else if("weixin-customize-music-detail"==f){var g=$("#weixin-customize-music-name").val(),h=$("#weixin-customize-music-url").val(),i=$("#weixin-customize-music-abstract").val();c=createOutputObjectFunc("wechat.music",g,h,"",i)}else if("weixin-customize-voice-detail"==f){var g=$("#weixin-customize-voice-name").val(),j=$("#weixin-customize-voice-url").val();c=createOutputObjectFunc("wechat.voice",g,"",j)}else if("weixin-customize-video-detail"==f){var g=$("#weixin-customize-video-name").val(),j=$("#weixin-customize-video-url").val();c=createOutputObjectFunc("wechat.video",g,"",j)}else if("weixin-customize-news-detail"==f){for(var k=$("#weixin-customize-news-detail .customize-news-body").children().length,l=new Array,d=0;k>d;d++){l[d]=new Object;var m=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-name").val(),n=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-url").val(),i=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-abstract").val(),h=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-jumpto").val();l[d].title=m,l[d].pic_url=n,l[d].description=i,l[d].url=h}c=createOutputObjectFunc("wechat.news","","","","",l)}}createOrUpdateOutputsWechatFunc(c),$("#mediaResponseModal").modal("hide")},$scope.mediaDeleteFunc=function(a){for(var b in $scope.mediaResponseList)if($scope.mediaResponseList[b].mediaId==a){$scope.mediaResponseList.splice(b,1);break}},$scope.mediaPreviewFunc=function(a){},$rootScope.newsLoadPageId=1,$rootScope.newsLoadMoreBox=!0,$(".news-box").on("scroll",function(a){var b="news",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.newsLoadMoreBox&&($rootScope.newsLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.newsLoadPageId*$scope.newsPageSize,limit:$scope.newsPageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.newsList.push(b[c]);$rootScope.newsLoadPageId++,$rootScope.newsLoadMoreBox=!0,$scope.$apply()}else $rootScope.newsLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$rootScope.imageObjLoadPageId=1,$rootScope.imageObjLoadMoreBox=!0,$(".image-box").on("scroll",function(a){var b="image",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.imageObjLoadMoreBox&&($rootScope.imageObjLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.imageObjLoadPageId*$scope.imagePageSize,limit:$scope.imagePageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.imageObjList.push(b[c]);$rootScope.imageObjLoadPageId++,$rootScope.imageObjLoadMoreBox=!0,$scope.$apply()}else $rootScope.imageObjLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$rootScope.voiceLoadPageId=1,$rootScope.voiceLoadMoreBox=!0,$(".voice-box").on("scroll",function(a){var b="voice",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.voiceLoadMoreBox&&($rootScope.voiceLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.voiceLoadPageId*$scope.voicePageSize,limit:$scope.voicePageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.voiceList.push(b[c]);$rootScope.voiceLoadPageId++,$rootScope.voiceLoadMoreBox=!0,$scope.$apply()}else $rootScope.voiceLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$rootScope.videoLoadPageId=1,$rootScope.videoLoadMoreBox=!0,$(".video-box").on("scroll",function(a){var b="video",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.videoLoadMoreBox&&($rootScope.videoLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.videoLoadPageId*$scope.videoPageSize,limit:$scope.videoPageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.videoList.push(b[c]);$rootScope.videoLoadPageId++,$rootScope.videoLoadMoreBox=!0,$scope.$apply()}else $rootScope.videoLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$("[data-act=change-media]").click(function(){var a=$(this),b=a.attr("href");"#weixin-news"==b?$scope.loadNewsFunc():"#weixin-image"==b?$scope.loadImageFunc():"#weixin-voice"==b?$scope.loadVoiceFunc():"#weixin-video"==b&&$scope.loadVideoFunc()}),$("[data-act=change-customize]").click(function(){var a=$(this),b=a.attr("href");$("#weixin-customize").addClass("in active").siblings().removeClass("in active"),$("#customize").addClass("in active").siblings().removeClass("in active"),$(b).addClass("active").show().siblings().removeClass("active").hide(),$(this).parents(".dropdown-menu-customize").siblings(".customize").text(a.text()),$(".customize").parent().addClass("active").siblings().removeClass("active")}),$('[data-toggle="popover"]').click(function(){var a=$(this),b=$(".popover-content");setTimeout(function(){b.attr("class")||a.popover("show")},200)}),$("body").off("keyup","[data-act=intent-detail-title]").on("keyup","[data-act=intent-detail-title]",function(a){$(this);13==a.keyCode&&$("[data-act=user-sya-add]").focus()}),$("body").off("keyup","[data-act=tab-help]").on("keyup","[data-act=tab-help]",function(a){var b=$(this);13==a.keyCode&&b.parent().next().children().eq(0).focus()}),$("body").off("keyup","[data-act=user-intent-dataType-update]").on("keyup","[data-act=user-intent-dataType-update]",function(a){var b=$(this);13==a.keyCode&&b.parent().next().next().find("input").focus()}),$("body").off("keyup","[data-act=user-intent-defaultValue-update]").on("keyup","[data-act=user-intent-defaultValue-update]",function(a){var b=$(this);13==a.keyCode&&b.parent().parent().next().children().eq(0).find("input").focus()}),$(".user-say-templates").sortable({items:".sortable-li",cancel:".delete,.copy,.user-says-input"}),$(".user-say-templates").sortable({stop:function(a,b){var c=[],d=$(".user-says-input");$.each(d,function(a,b){var d=$(b);d.attr("data-template")&&"undefined"!=d.attr("data-template")&&c.push(d.attr("data-template"))}),$scope.intentDetail.templates=c,$scope.$apply()}}),$("body").off("focus",".user-says-input").on("focus",".user-says-input",function(){var a=$(this);a.parent().find(".drop").css("visibility","hidden"),a.parent().find(".edit").css("visibility","hidden"),a.parent().find(".copy").css("visibility","hidden"),a.parent().find(".delete").css("visibility","hidden"),setTimeout(function(){a.find(".usersay-placeholder").remove()},20)}),$("body").off("blur",".user-says-input").on("blur",".user-says-input",function(){var a=$(this);a.parent().find(".drop").css("visibility","visible"),a.parent().find(".edit").css("visibility","visible"),a.parent().find(".copy").css("visibility","visible"),a.parent().find(".delete").css("visibility","visible")}),$scope.addResListTemp=[],$scope.resType="image";var loadpre="pre",loadnext="next",pageSize=20,initStyle=function(){$(".resource-manager .image-box").css("height",document.documentElement.clientHeight-290);var a=$(".image-box-ul").css("width");if(a){a=a.replace("px",""),a=+a;var b=parseInt(a/186);$("#image .reource-operation").css("width",186*b)}};$(window).resize(function(){initStyle()}),initStyle(),$('a[data-toggle="tab"]').on("shown.bs.tab",function(a){var b=$(a.target).text();"图片"==$.trim(b)?(initStyle(),$scope.resType="image",$scope.resImgList&&0!=$scope.resImgList.length||$scope.loadResourceFunc(0,20,$scope.loadResourceListFunc)):"音频"==$.trim(b)?($scope.resType="voice",$scope.resVoiceList&&0!=$scope.resVoiceList.length||$scope.loadResourceFunc(0,30,$scope.loadResourceListFunc)):"视频"==$.trim(b)?($scope.resType="video",$scope.resVideoList&&0!=$scope.resVideoList.length||$scope.loadResourceFunc(0,30,$scope.loadResourceListFunc)):"自定义"==$.trim(b)&&($scope.resType="customize",$scope.resVideoList&&0!=$scope.resVideoList.length||$scope.loadResourceFunc(0,30,$scope.loadResourceListFunc)),$scope.$apply()}),$scope.loadImage=function(){$.ajax({url:ruyiai_host+"/ruyi-ai/save/"+appId+"/multimedia",data:{mediaType:$scope.resType,liststr:JSON.stringify($scope.addResListTemp)},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0&&$scope.loadResourceListFunc(a.result,loadpre):a&&2==a.code&&goIndex(),$scope.addResListTemp=[],$scope.$apply()}})},$scope.loadResourceListFunc=function(a,b){if(a&&a.length){switch($scope.resType){case"image":if($scope.resImgList)for(var c in a)b==loadpre?$scope.resImgList.unshift(a[c]):b==loadnext&&$scope.resImgList.push(a[c]);else $scope.resImgList=a;break;case"voice":if($scope.resVoiceList)for(var c in a)b==loadpre?$scope.resVoiceList.unshift(a[c]):b==loadnext&&$scope.resVoiceList.push(a[c]);else $scope.resVoiceList=a;break;case"video":if($scope.resVideoList)for(var c in a)b==loadpre?$scope.resVideoList.unshift(a[c]):b==loadnext&&$scope.resVideoList.push(a[c]);else $scope.resVideoList=a}$scope.$apply()}},$scope.loadResourceFunc=function(a,b,c){$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:a,size:b},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&c&&c(a.result,loadpre):a&&2==a.code&&goIndex()}})},$scope.loadResourceFunc(0,20,$scope.loadResourceListFunc);var $imgLoadMoreBox=!0;$("[data-act=image-box]").on("scroll",function(a){var b=$(this),c=b[0].scrollTop,d=b[0].scrollHeight,e=b.height();c>=d-e-45&&1==$imgLoadMoreBox&&($imgLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:$scope.resImgList[$scope.resImgList.length-1].createTime,size:pageSize},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0?($scope.loadResourceListFunc(a.result,loadnext),$imgLoadMoreBox=!0,$scope.$apply()):$imgLoadMoreBox=!1:2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))});var deleteResourceFunc=function(a){var b="";for(var c in a)b+=a[c]+",";$.ajax({url:ruyiai_host+"/ruyi-ai/delete/"+appId+"/multimedia",data:{listid:b},method:"GET",success:function(b){if(b=dataParse(b),0==b.code){for(var c in a)if("image"==$scope.resType)for(var d in $scope.resImgList)a[c]==$scope.resImgList[d].id&&$scope.resImgList.splice(d,1);else if("voice"==$scope.resType)for(var d in $scope.resVoiceList)a[c]==$scope.resVoiceList[d].id&&$scope.resVoiceList.splice(d,1);else if("video"==$scope.resType)for(var d in $scope.resVideoList)a[c]==$scope.resVideoList[d].id&&$scope.resVideoList.splice(d,1);$scope.$apply()}else 2==b.code?goIndex():b.msg&&$.trace(b.msg+"( "+b.detail+" )","error")}})};$("body").off("click",".image-operation .delete").on("click",".image-operation .delete",function(a){var b=$(this),c=b.closest(".image-operation").attr("data-id"),d=b.closest(".image-operation").attr("data-title");$.confirm({text:'你确定要删除"'+d+'"吗？',title:"删除",ensureFn:function(){var a=[c];deleteResourceFunc(a)}})}),$("body").off("click",".image-operation .edit").on("click",".image-operation .edit",function(a){var b=$(this),c=b.closest(".image-operation").attr("data-id"),d=b.closest(".image-operation").attr("data-title");$("#updateResource").modal("show"),$("[data-act=resource-name]").val(d),$("[data-act=resource-id]").val(c)}),$("body").off("keydown","[data-act=resource-name]").on("keydown","[data-act=resource-name]",function(a){$(this);13==a.keyCode&&$("[data-act=submit-rename-resource]").trigger("click")}),$("#updateResource").on("shown.bs.modal",function(){$("[data-act=resource-name]").focus()}),$("body").off("click","[data-act=submit-rename-resource]").on("click","[data-act=submit-rename-resource]",function(a){var b=$("[data-act=resource-name]"),c=$("[data-act=resource-id]");0==$.trim(b.val()).length&&$.trace("资源名称不能为空"),$.ajax({url:ruyiai_host+"/ruyi-ai/update/"+appId+"/multimedia",data:{id:c.val(),name:b.val()},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){if("image"==$scope.resType){for(var b in $scope.resImgList)if(a.result&&$scope.resImgList[b].id==a.result.id){$scope.resImgList[b]=a.result;break}}else if("voice"==$scope.resType){for(var b in $scope.resVoiceList)if(a.result&&$scope.resVoiceList[b].id==a.result.id){$scope.resVoiceList[b]=a.result;break}}else if("video"==$scope.resType)for(var b in $scope.resVideoList)if(a.result&&$scope.resVideoList[b].id==a.result.id){$scope.resVideoList[b]=a.result;break}$scope.$apply(),$.trace("素材名称修改成功","success"),$("#updateResource").modal("hide")}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})}),$("body").off("click","[data-act=img-box-active]").on("click","[data-act=img-box-active]",function(a){var b=$(this),c=b.parent(".image-box-li"),d=c.attr("data-id");for(var e in $scope.resImgList)$scope.resImgList[e].id==d?$scope.resImgList[e].active?$scope.resImgList[e].active=!1:$scope.resImgList[e].active=!0:$scope.resImgList[e].active=!1;$scope.$apply()}),$("body").off("click","[data-act=all-choose]").on("click","[data-act=all-choose]",function(a){var b=$(this),c=b.find("input");if("image"==$scope.resType)if(c.is(":checked"))for(var d in $scope.resImgList)$scope.resImgList[d].active=!0;else for(var d in $scope.resImgList)$scope.resImgList[d].active=!1;else if("voice"==$scope.resType)if(c.is(":checked"))for(var d in $scope.resVoiceList)$scope.resVoiceList[d].active=!0;else for(var d in $scope.resVoiceList)$scope.resVoiceList[d].active=!1;else if("video"==$scope.resType)if(c.is(":checked"))for(var d in $scope.resVideoList)$scope.resVideoList[d].active=!0;else for(var d in $scope.resVideoList)$scope.resVideoList[d].active=!1;$scope.$apply()}),$("body").off("click","[data-act=all-delete]").on("click","[data-act=all-delete]",function(a){$.confirm({text:"你确定要批量删除所选素材吗？",title:"删除",ensureFn:function(){var a=($(this),0),b=[];if("image"==$scope.resType)for(var c in $scope.resImgList)$scope.resImgList[c].active&&(b.push($scope.resImgList[c].id),a++);else if("voice"==$scope.resType)for(var c in $scope.resVoiceList)$scope.resVoiceList[c].active&&(b.push($scope.resVoiceList[c].id),a++);else if("video"==$scope.resType)for(var c in $scope.resVideoList)$scope.resVideoList[c].active&&(b.push($scope.resVideoList[c].id),a++);0==a?$.trace("你未选择要删除的素材"):deleteResourceFunc(b)}})});var $voiceLoadMoreBox=!0;$("[data-act=voice-box]").on("scroll",function(a){var b=$(this),c=b[0].scrollTop,d=b[0].scrollHeight,e=b.height();c>=d-e-45&&1==$voiceLoadMoreBox&&($voiceLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:$scope.resVoiceList[$scope.resVoiceList.length-1].createTime,size:pageSize},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0?($scope.loadResourceListFunc(a.result,loadnext),$voiceLoadMoreBox=!0,$scope.$apply()):$voiceLoadMoreBox=!1:2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))});var $videoLoadMoreBox=!0;$("[data-act=video-box]").on("scroll",function(a){var b=$(this),c=b[0].scrollTop,d=b[0].scrollHeight,e=b.height();c>=d-e-45&&1==$videoLoadMoreBox&&($videoLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:$scope.resVideoList[$scope.resVideoList.length-1].createTime,size:pageSize},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0?($scope.loadResourceListFunc(a.result,loadnext),$imgLoadMoreBox=!0,$scope.$apply()):$imgLoadMoreBox=!1:2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$("body").off("click","#voice .delete,#video .delete").on("click","#voice .delete,#video .delete",function(a){var b=$(this),c=b.closest("tr").attr("data-id"),d=b.closest("tr").attr("data-title");$.confirm({text:'你确定要删除"'+d+'"吗？',title:"删除",ensureFn:function(){var a=[c];deleteResourceFunc(a)}})}),$("body").off("click","#voice .edit,#video .edit").on("click","#voice .edit,#video .edit",function(a){var b=$(this),c=b.closest("tr").attr("data-id"),d=b.closest("tr").attr("data-title");$("#updateResource").modal("show"),$("[data-act=resource-name]").val(d),$("[data-act=resource-id]").val(c)}),$("body").off("click","[name=local-choosed-voice]").on("click","[name=local-choosed-voice]",function(a){}),$scope.localResourceSetFunc=function(a,b){if($scope.currentWechatParentIndex=a,$scope.currentWechatIndex=b,$("#localResourceModal").modal("show"),-1!=a){var c=$scope.localOutouts[a][b];switch(c.type){case"image":$("#customize-image-chosen").trigger("click"),$("#customize-image-name").val(c.property.name),$("#customize-image-url").val(c.property.image_url);break;case"voice":$("#customize-voice-chosen").trigger("click"),$("#customize-voice-name").val(c.property.name),$("#customize-voice-url").val(c.property.voice_url);break;case"video":$("#customize-video-chosen").trigger("click"),$("#customize-video-name").val(c.property.name),$("#customize-video-url").val(c.property.video_url)}}else $("#localResourceModal #myTab-local").children().eq(0).children("a").trigger("click"),resetCustomize();setTimeout(function(){initStyle()},200)};var findResourceObjectById=function(a,b){for(var c in a)if(a[c].id==b)return a[c]},findResourceObjectByActive=function(a){for(var b in a)if(a[b].active)return a[b]},createOrUpdateOutputsWechatFunc=function(a){var b=!1;for(var c in $scope.wechatOutputs)if(!b)for(var d in $scope.wechatOutputs[c])if(c==$scope.currentWechatParentIndex&&d==$scope.currentWechatIndex){b=!0,$scope.wechatOutputs[c]||($scope.wechatOutputs[c]=[]),$scope.wechatOutputs[c][d]=a;break}b||($scope.wechatOutputs[$scope.currentWechatIndex]||($scope.wechatOutputs[$scope.currentWechatIndex]=[]),$scope.wechatOutputs[$scope.currentWechatIndex].push(a)),$scope.$apply()},createOrUpdateOutputsLocalFunc=function(a){var b=!1;for(var c in $scope.localOutouts)if(!b)for(var d in $scope.localOutouts[c])if(c==$scope.currentWechatParentIndex&&d==$scope.currentWechatIndex){b=!0,$scope.localOutouts[c]||($scope.localOutouts[c]=[]),$scope.localOutouts[c][d]=a;break}b||($scope.localOutouts[$scope.currentWechatIndex]||($scope.localOutouts[$scope.currentWechatIndex]=[]),$scope.localOutouts[$scope.currentWechatIndex].push(a)),$scope.$apply()};$scope.localResourceSubFunc=function(){var a=$(".choose-response.active"),b=a.attr("data-type"),c={},d={};if("image"==b)dataEditedFlag=!0,c=findResourceObjectByActive($scope.resImgList),d=createOutputObjectFunc(c.type,c.title,c.url,"");else if("voice"==$scope.resType){dataEditedFlag=!0;var e=$("[name=local-choosed-voice]:checked"),f=e.closest("tr");c=findResourceObjectById($scope.resVoiceList,f.attr("data-id")),d=createOutputObjectFunc(c.type,c.title,c.url,"")}else if("video"==b){dataEditedFlag=!0;var e=$("[name=local-choosed-video]:checked"),f=e.closest("tr");c=findResourceObjectById($scope.resVideoList,f.attr("data-id")),d=createOutputObjectFunc(c.type,c.title,c.url,"")}else if("customize"==b){dataEditedFlag=!0;var g=$("#customize .video-box .customize-body .active"),h=g.attr("id");if("customize-image-detail"==h){var i=$("#customize-image-name").val(),j=$("#customize-image-url").val();d=createOutputObjectFunc("image",i,j,"")}else if("customize-voice-detail"==h){var i=$("#customize-voice-name").val(),j=$("#customize-voice-url").val();d=createOutputObjectFunc("voice",i,j,"")}else if("customize-video-detail"==h){var i=$("#customize-video-name").val(),j=$("#customize-video-url").val();d=createOutputObjectFunc("video",i,j,"")}}createOrUpdateOutputsLocalFunc(d),$("#localResourceModal").modal("hide")},$("body").off("click",".response-action").on("click",".response-action",function(a){a.stopPropagation();var b=$(this),c=b.closest(".response-group").find(".response-box");"0px"==c.css("height")?c.animate({height:"100%"}):c.animate({height:"0"})});var createOutputObjectFunc=function(a,b,c,d,e,f){var g=new Object;switch(g.type=a,g.property=new Object,a){case"dialog":g.property.text=b;break;case"wechat.text":g.property.text=b;break;case"image":g.property.name=b,g.property.image_url=c;break;case"wechat.image":g.property.name=b,g.property.title=b,g.property.media_id=d,g.property.image_url=c;break;case"voice":g.property.name=b,g.property.voice_url=c;break;case"wechat.voice":g.property.name=b,g.property.title=b,g.property.media_id=d;break;case"video":g.property.name=b,g.property.video_url=c;break;case"wechat.video":g.property.name=b,g.property.title=b,g.property.media_id=d;break;case"wechat.news":f&&f.length>0?(g.list=f,g.property.name=f[0].title):(g.property.name=b,g.property.title=b,g.property.media_id=d);break;case"wechat.music":g.property.name=b,g.property.title=b,g.property.music_url=c,g.property.description=e}return g},checkDialogObjectExists=function(a,b,c){var d=!1;if(a)for(var e in a)if(a[e]&&a[e].property.text==b&&a[e].type==c){d=!0;break}return d};$scope.addTextOutputWechatFunc=function(a,b,c,d,e){return checkIsChangeValue!=b&&(dataEditedFlag=!0),!b||$.trim(b).length<=0?!1:void setTimeout(function(){var a=createOutputObjectFunc(e,b,"",""),f=!1;for(var g in $scope.wechatOutputs)if(!f)for(var h in $scope.wechatOutputs[g])if(g==c&&h==d){f=!0,$scope.wechatOutputs[g]||($scope.wechatOutputs[g]=[]),$scope.wechatOutputs[g][h]=a;break}f||($scope.wechatOutputs[d]||($scope.wechatOutputs[d]=[]),checkDialogObjectExists($scope.wechatOutputs[d],b,e)?$("[data-act=outputText]").val()&&$("[data-act=outputText]").val().length>0&&$.trace("此机器人答已经存在，重复的只会保留一条"):($scope.wechatOutputs[d].push(a),$("[data-act=outputText]").val(""))),$scope.$apply(),$('[data-toggle="tooltip"]').tooltip()},200)};var deleteEmptyAssistantAnswerFunc=function(a,b,c,d){for(var e in a)for(var f in a[e])if(e==c&&f==d)return void a[e].splice(e,1)};$scope.addTextOutputLocalFunc=function(a,b,c,d,e){return console.log("parentIndex:"+c),console.log("index:"+d),console.log("outputText:"+b),checkIsChangeValue!=b&&(dataEditedFlag=!0),!b||$.trim(b).length<=0?(deleteEmptyAssistantAnswerFunc($scope.localOutouts,b,c,d),!1):(console.log("错了"),void setTimeout(function(){var a=createOutputObjectFunc(e,b,"",""),f=!1;for(var g in $scope.localOutouts)if(!f)for(var h in $scope.localOutouts[g])if(g==c&&h==d){f=!0,$scope.localOutouts[g]||($scope.localOutouts[g]=[]),$scope.localOutouts[g][h]=a;break}f||($scope.localOutouts[d]||($scope.localOutouts[d]=[]),checkDialogObjectExists($scope.localOutouts[d],b,e)?$("[data-act=outputText-local]").val()&&$("[data-act=outputText-local]").val().length>0&&$.trace("此机器人答已经存在，重复的只会保留一条"):($scope.localOutouts[d].push(a),$("[data-act=outputText-local]").val(""))),$scope.$apply(),$('[data-toggle="tooltip"]').tooltip()},200))},$scope.addTextOutputWechatKeydownFunc=function(a,b,c,d,e){13==a.keyCode&&$scope.addTextOutputWechatFunc(a,b,c,d,e)},$scope.addTextOutputLocalKeydownFunc=function(a,b,c,d,e){13==a.keyCode&&$scope.addTextOutputLocalFunc(a,b,c,d,e)},$scope.deleteOutputWechatFunc=function(a,b){setTimeout(function(){dataEditedFlag=!0;for(var c in $scope.wechatOutputs)for(var d in $scope.wechatOutputs[c])if(c==a&&d==b){$scope.wechatOutputs[c].splice(d,1);break}$scope.$apply()},200)},$scope.deleteOutputLocalFunc=function(a,b){setTimeout(function(){for(var c in $scope.localOutouts)for(var d in $scope.localOutouts[c])if(c==a&&d==b){$scope.localOutouts[c].splice(d,1),dataEditedFlag=!0;break}$scope.$apply()},200)},$scope.copyOutputWechatFunc=function(a,b){for(var c in $scope.wechatOutputs)for(var d in $scope.wechatOutputs[c])if(c==a&&d==b){var e=$scope.wechatOutputs[c][d],f={type:"wechat.text",property:{text:e.property.text+"(副本)"}};$scope.wechatOutputs[c].push(f),dataEditedFlag=!0;break}},$scope.copyOutputLocalFunc=function(a,b){for(var c in $scope.localOutouts)for(var d in $scope.localOutouts[c])if(c==a&&d==b){var e=$scope.localOutouts[c][d],f={type:"wechat.text",property:{text:e.property.text+"(副本)"}};$scope.localOutouts[c].push(f),dataEditedFlag=!0;break}},$scope.editUserSayTextarea=function(a){$("#editUserSayTextarea").modal("show"),$("#userSayTextarea").attr("myIndex",a),$("#userSayTextarea").val($scope.intentDetail.templates[a]),setTimeout(function(){$("#userSayTextarea").focus()},200)},$scope.editUserSayTextareaSubmitFunc=function(){var a=!1,b=$("#userSayTextarea"),c=b.val(),d=b.attr("myIndex");$scope.intentDetail.templates[d]!=b.val()&&(dataEditedFlag=!0),$($scope.intentDetail.templates).each(function(b,e){$.trim(c)===$.trim(e)&&(b!=d&&$.trace("此用户说已经存在，重复的只会保留一条"),$("[data-act=user-sys-update]").eq(d).text(c),a=!0)}),a||($scope.intentDetail.templates[d]=c),$("#editUserSayTextarea").modal("hide")};var assistantEditStatus="isEmpty",checkAssistantEditStatusFunc=function(a){var b="";return $("[data-act="+a+"]").each(function(){$.trim($(this).val()).length>0&&(b=$(this).val())}),assistantEditStatus=b?"notEmpty":"isEmpty",b};$scope.editOutputWechatFunc=function(a,b){var c=checkAssistantEditStatusFunc("outputText");$("#editWeixinTextarea").modal("show");var d=$("#weixinTextarea");if(d.attr("myIndex",b),d.attr("parentIndex",a),-1==b){if($("#editor-iframe-box-wechat").html('<iframe id="editor-iframe-wechat" name="editor-iframe-wechat" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),!c||0==c.length)return!1;d.val(c);var e=setInterval(function(){try{$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val(c),$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(a){}},20)}else{$("#editor-iframe-box-wechat").html('<iframe id="editor-iframe-wechat" name="editor-iframe-wechat" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),d.val($scope.wechatOutputs[a][b].property.text);var e=setInterval(function(){try{$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val($scope.wechatOutputs[a][b].property.text),$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(c){}},20)}},$scope.editOutputLocalFunc=function(a,b){var c=checkAssistantEditStatusFunc("outputText-local");console.log("outputTextLocal:"+c),$("#editLocalTextarea").modal("show");var d=$("#localTextarea");if(d.attr("myIndex",b),d.attr("parentIndex",a),-1==b){if($("#editor-iframe-box-local").html('<iframe id="editor-iframe-local" name="editor-iframe-local" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),
!c||0==c.length)return!1;d.val(c);var e=setInterval(function(){try{$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val(c),$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(a){}},20)}else{$("#editor-iframe-box-local").html('<iframe id="editor-iframe-local" name="editor-iframe-local" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),d.val($scope.localOutouts[a][b].property.text);var e=setInterval(function(){try{$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val($scope.localOutouts[a][b].property.text),$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(c){}},20)}},$scope.wechatTextFilter=function(a){return"wechat.text"==a.type?!0:!1},$scope.wechatMediaFilter=function(a){return a.type.indexOf("wechat.")>-1&&"wechat.text"!=a.type?!0:!1},$scope.addMoreResponseFunc=function(){var a=$("[data-act=response-type].active").find(".add-more-response section").attr("data-type");"wechat"==a?$scope.wechatOutputs?$scope.wechatOutputs.push([]):$scope.wechatOutputs=[[]]:"local"==a&&($scope.localOutouts?$scope.localOutouts.push([]):$scope.localOutouts=[[]]),setTimeout(function(){$("[data-act=response-type].active").find(".response-box:last").css("height","100%")},200)},$("body").off("click","[data-act=delete-response-block]").on("click","[data-act=delete-response-block]",function(a){var b=$(this).attr("data-index"),c=$(this).attr("data-type");b=+b,a.stopPropagation(),$.confirm({text:"你确定要删除吗？",title:"删除",ensureFn:function(){dataEditedFlag=!0,"wechat"==c?$scope.wechatOutputs&&$scope.wechatOutputs.splice(b,1):"local"==c&&$scope.localOutouts&&$scope.localOutouts.splice(b,1),$scope.$apply()}})}),$scope.editWeixinTextareaSubmitFunc=function(){var a=!1,b=$("#weixinTextarea"),c=b.attr("parentIndex"),d=b.attr("myIndex"),e=$(window.frames["editor-iframe-wechat"].document).find("#editor_content_textarea").val();if(-1==d||"-1"==d){var f=createOutputObjectFunc("wechat.text",e,"","");dataEditedFlag=!0,"isEmpty"==assistantEditStatus?e&&$.trim(e).length>0&&($($scope.wechatOutputs[c]).each(function(b,c){$.trim(e)===$.trim(c.property.text)&&($.trace("此机器人答已经存在，重复的只会保留一条"),a=!0)}),a?$(".input-weixin").eq(d).val(e):$scope.wechatOutputs[c].push(f)):"notEmpty"==assistantEditStatus&&(console.log("not"),$scope.wechatOutputs[c][$scope.wechatOutputs[c].length-1]=f)}else b.val(e),$scope.wechatOutputs[c][d].property.text!=b.val()&&(dataEditedFlag=!0),$($scope.wechatOutputs[c]).each(function(a,b){b.property.text===e&&($.trace("此机器人答已经存在，重复的只会保留一条"),$scope.isExits=!0)}),$scope.wechatOutputs[c][d].property.text=e;$("#editWeixinTextarea").modal("hide")},$scope.editLocalTextareaSubmitFunc=function(){var a=$("#localTextarea"),b=a.attr("parentIndex"),c=a.attr("myIndex"),d=$(window.frames["editor-iframe-local"].document).find("#editor_content_textarea").val();if(-1==c||"-1"==c){var e=createOutputObjectFunc("dialog",d,"","");dataEditedFlag=!0,"isEmpty"==assistantEditStatus?d&&d.length>0&&($($scope.localOutouts[b]).each(function(a,b){$.trim(d)===$.trim(b.property.text)&&($.trace("此机器人答已经存在，重复的只会保留一条"),$scope.isExits=!0)}),$scope.isExits?$(".input-local").eq(c).val(d):$scope.localOutouts[b].push(e)):"notEmpty"==assistantEditStatus&&($scope.localOutouts[b][$scope.localOutouts[b].length-1]=e)}else a.val(d),$scope.localOutouts[b][c].property.text!=a.val()&&(dataEditedFlag=!0),$($scope.localOutouts[b]).each(function(a,b){$.trim(b.property.text)===$.trim(d)&&($.trace("此机器人答已经存在，重复的只会保留一条"),$scope.isExits=!0)}),$scope.localOutouts[b][c].property.text=a.val();$("#editLocalTextarea").modal("hide")},$scope.addNewsFunc=function(){var a="<div class='customize-news clearfix' style='margin-top: 20px;'><div class='form-group' style='margin-bottom: 0;'><div class='col-md-10  col-md-offset-1'><label>名称：</label><input autocomplete='off' style='border-radius: 0px; box-shadow: none; border-top: 1px solid rgba(0,0,0,0);border-right: 1px solid rgba(0,0,0,0);' type='text' required='required' class='form-control weixin-customize-news-name' placeholder='名称' /></div></div><div class='form-group' style='margin-bottom: 0;'><div class='col-md-10  col-md-offset-1'><label>摘要：</label><textarea style='border-radius: 0px; box-shadow: none; vertical-align: middle;border-right: 1px solid rgba(0,0,0,0);width:85%;max-width:85%;' required='required' class='form-control weixin-customize-news-abstract' placeholder='摘要'></textarea> </div></div><div class='form-group' style='margin-bottom: 25px;'><div class='col-md-10  col-md-offset-1'><label>封面URL：</label><input autocomplete='off' style='border-radius: 0px; box-shadow: none;border-right: 1px solid rgba(0,0,0,0);' type='text' required='required' class='form-control weixin-customize-news-url' placeholder='封面URL' /></div></div><div class='form-group' style='margin-bottom: 25px;'><div class='col-md-10  col-md-offset-1'><label>跳转链接：</label><input autocomplete='off' style='border-radius: 0px; box-shadow: none;border-right: 1px solid rgba(0,0,0,0);' type='text' required='required' class='form-control weixin-customize-news-jumpto' placeholder='跳转链接' /></div></div><div class='form-group' style='margin-bottom: 25px;'><div class='col-md-10  col-md-offset-1'><div class='delete-customize-news'>&nbsp;</div></div></div></div>";$("#weixin-customize-news-detail .customize-news-body").append(a),setTimeout(function(){$("#weixin-customize .customize-news-body").scrollTop($("#weixin-customize .customize-news-body")[0].scrollHeight)},0)},$("#weixin-customize-news-detail").delegate(".delete-customize-news","click",function(){var a=$(this);$.confirm({text:"你确定要删除此图文消息吗？",title:"删除",ensureFn:function(){a.parents(".customize-news").remove()}})}),$(".speach-response .nav li").click(function(){setCookie("app_response",$(this).attr("class"))}),$("body").off("keyup",".user-says-input").on("keyup",".user-says-input",function(a){if(50==a.which){var b=$(this);setTimeout(function(){checkAt(b)},200)}}),$("body").off("mouseover",".user-box-row").on("mouseover",".user-box-row",function(){$(this).addClass("on").siblings(".user-box-row").removeClass("on")}),$("body").off("click",".user-box-row").on("click",".user-box-row",function(a){var b=$(this),c=b.closest(".user-box").siblings(".writing-bg").find("input"),d=b.closest(".mention-popup").siblings(".user-says-input");return choseFriend(c,d,!1),b.closest(".mention-popup").remove(),a.stopPropagation(),!1}),$("body").off("focusout","#mention-input").on("focusout","#mention-input",function(a){setTimeout(function(){$(".mention-popup").remove()},200)}),$("body").off("keyup","#mention-input").on("keyup","#mention-input",function(a){var b=$(this),c=b.closest(".mention-popup").siblings(".user-says-input");if("27"==a.keyCode)return choseFriend(b,c,!0),$("body").find(".mention-popup").remove(),!1;if("13"==a.keyCode){if(b.closest(".mention-popup").find(".user-box-row.on").length)return choseFriend(b,c,!1),b.closest(".mention-popup").remove(),!1}else{if("38"==a.keyCode&&b.closest(".mention-popup").find(".user-box-row.on").prev(".user-box-row").length){var d=b.closest(".mention-popup").find(".user-box-row.on");return d.prev(".user-box-row").addClass("on").siblings(".user-box-row").removeClass("on"),!1}if("40"==a.keyCode&&b.closest(".mention-popup").find(".user-box-row.on").next(".user-box-row").length){var d=b.closest(".mention-popup").find(".user-box-row.on");return d.next(".user-box-row").addClass("on").siblings(".user-box-row").removeClass("on"),!1}autoGetPrompt(b.val())}}),$("body").off("click",".upload-resource-button").on("click",".upload-resource-button",function(a){$("#localResourceModal").modal("hide"),setTimeout(function(){window.location.href="#/resource"},500)}),$("body").off("click","[data-act=action-list-trigger]").on("click","[data-act=action-list-trigger]",function(){var a=($(this),$(".my-action-name-list"));"block"==a.css("display")?a.css("display","none"):a.css("display","block")}),$scope.getActionListFunc=function(){$.ajax({url:ruyiai_host+"/ruyi-ai/action/query/list",data:{appId:appId,start:0,limit:1e3},method:"get",success:function(a){a=dataParse(a),0==a.code?($scope.actionList=a.result,$scope.$apply()):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})},$("body").off("click",".my-action-name-list li").on("click",".my-action-name-list li",function(){var a=$(this);$scope.response.action=a.text(),$scope.$apply(),$(".my-action-name-list").css("display","none")}),setTimeout(function(){$scope.getActionListFunc()},2e3),$("body").off("click",".intent-detail-more").on("click",".intent-detail-more",function(a){var b=$(this),c=$(".intent-detail-more-box");"block"==c.css("display")?(c.css("display","none"),b.find("i").removeClass("icon-arrow-down").addClass("icon-arrow-right"),supports_html5_storage()&&localStorage.removeItem("intentDetailMore"+$stateParams.intent_id)):(c.css("display","block"),b.find("i").removeClass("icon-arrow-right").addClass("icon-arrow-down"),supports_html5_storage()&&localStorage.setItem("intentDetailMore"+$stateParams.intent_id,"open"))}),supports_html5_storage()&&"open"==localStorage.getItem("intentDetailMore"+$stateParams.intent_id)&&($(".intent-detail-more-box").css("display","block"),$(".intent-detail-more").find("i").removeClass("icon-arrow-right").addClass("icon-arrow-down")),$scope.commonIntentDetailChange=function(){dataEditedFlag=!0}}function intentListCtrl(a,b,c,d){function e(){"isNewUser"==getCookie("app"+appId)&&"true"!=getCookie("isOldUser")&&window.location.href.indexOf("intent_detail")>-1&&($("[data-act=new-user-guide-box]").css("display","block"),$(".action-tips").css({top:$(".left-addScenario").offset().top-$(".scenario-box").height()-26+"px",left:$(".left-addScenario").offset().left-$(".action-tips").width()/2-10+"px"}))}function f(){$(".new-user-box").hide(),$(".new-user-main").hide(),$(".new-user-foot").hide(),$(".action-tips").hide(),h=1,delCookie("app"+appId)}function g(a){var b=new Object;return b.appId=a.appId,b.auto=a.auto,b.contexts=a.contexts,b.errorModels=a.errorModels,b.gmtCreate=a.gmtCreate,b.gmtUpdate=a.gmtUpdate,b.id=a.id,b.intentState=a.intentState,b.intentStatus=a.intentStatus,b.intentType=a.intentType,b.mlLevel=a.mlLevel,b.name=a.name,b.priority=a.priority,b.responses=a.responses,b.scenarioId=a.scenarioId,b.speech=a.speech,b.templates=a.templates,b.errorModelStr=a.errorModelStr,b}$('[data-toggle="toggle"]').bootstrapToggle({size:"mini",on:"",off:""}),$(".list-group-item").removeClass("active"),$("[data-act=nav-scenario]").addClass("active"),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip(),$("[data-act=nav-scenario-"+d.scenes_id+"]").addClass("active")},200),b.pageSize=12,b.searchIntentWords="",b.isCreateSuccess=!0,b.currentScenesId=d.scenes_id;var h=1;$("body").off("click",".new-user-next").on("click",".new-user-next",function(a){switch(5>h&&h++,!0){case 1==h:$(".action-tips p").text("创建场景“打招呼”"),$(".action-tips").css({top:$(".left-addScenario").offset().top-$(".scenario-box").height()-26+"px",left:$(".left-addScenario").offset().left-$(".action-tips").width()/2-6+"px"}),$(".new-user-under-arrow").css("top","45px");break;case 2==h:$(".action-tips p").text("创建意图“寒暄”"),$(".action-tips").css({left:300,top:100}),$(".new-user-under-arrow").css("top","45px");break;case 3==h:var b=$(".user-say-templates").find(".list-group-item");$(".action-tips p").text("填写用户说，例如：“hi”"),$(".action-tips").css({left:b.offset().left+70,top:b.offset().top-b.height()-20}),$(".new-user-under-arrow").css("top","45px");break;case 4==h:var c=$("[data-act=robot-answer-text]");$(".action-tips p").html("在机器人答里填写“hello！”<br>最后别忘了保存哦！"),$(".action-tips").css({left:$(c).offset().left+70,top:$(c).offset().top-$(c).height()}),$(".new-user-under-arrow").css("top","69px");break;case 5==h:$(".action-tips p").html('点这里，试试你刚才写的问答！<br>更多新手教程，<a href="http://docs.ruyi.ai/344948" target="_black" style="text-decoration: underline;">点击这里</a>'),$(".action-tips").css({left:"2%",top:$(".new-user-foot").offset().top-$(".new-user-foot").height()+20}),$(".new-user-under-arrow").css("top","69px"),$(".new-user-prev").hide(),$(".new-user-next").hide(),$(".new-user-complete").show().css("margin-left","12%"),$(".new-user-next").text("完成")}for(var d=1;h>d;d++)$($(".new-user-box").find("li")[d]).css({"background-color":"#191e24",color:"#fff"});$($(".new-user-box").find("li")[h]).children("i").attr("class","cave-arrow")}),$("body").off("click",".new-user-prev").on("click",".new-user-prev",function(a){switch(h>1&&h--,!0){case 1==h:$(".action-tips p").text("创建场景“打招呼”"),$(".action-tips").css({top:$(".left-addScenario").offset().top-$(".scenario-box").height()-22+"px",left:$(".left-addScenario").offset().left-$(".action-tips").width()/2-8+"px"}),$(".new-user-under-arrow").css("top","45px");break;case 2==h:$(".action-tips p").text("创建意图“寒暄”"),$(".action-tips").css({left:300,top:100}),$(".new-user-under-arrow").css("top","45px");break;case 3==h:var b=$(".user-say-templates").find(".list-group-item");$(".action-tips p").text("填写用户说，例如：“hi”"),$(".action-tips").css({left:b.offset().left+70,top:b.offset().top-b.height()-20}),$(".new-user-under-arrow").css("top","45px");break;case 4==h:var c=$("[data-act=robot-answer-text]");$(".action-tips p").html("在机器人答里填写“hello！”<br>最后别忘了保存哦！"),$(".action-tips").css({left:$(c).offset().left+70,top:$(c).offset().top-$(c).height()}),$(".new-user-under-arrow").css("top","69px")}$($(".new-user-box").find("li")[h]).css({"background-color":"#fff",color:"#000"}),$($(".new-user-box").find("li")[h+1]).children("i").attr("class","tips-arrow")}),$("body").off("click",".new-user-skip").on("click",".new-user-skip",function(a){f()}),$("body").off("click",".new-user-complete").on("click",".new-user-complete",function(a){f()});var i=function(){var a=$(window).height();b.pageSize=parseInt((a-190)/40),b.setPagingCountFunc&&b.setPagingCountFunc()};i(),$(window).resize(function(){i()}),b.goIntentDetail=function(a,c,d){if($("[data-act=nav-scenario-"+a+"]").addClass("active"),!(d&&$(d.target).is(".btn-intent")||(dataEditedFlag&&$.confirm_save({text:"你的修改未保存，确定要离开意图详情页面吗？",title:"系统提示",ensureFn:function(){if(dataEditedFlag=!1,!$("[data-act=confirmShow]").css("display"))if(b.scenario&&"SYSTEMACTION"==b.scenario.scenarioType){var e="";switch(d.target.innerText){case"订阅欢迎语":e="/intent_welcome_detail/";break;case"却省回复":e="/intent_lost_detail/";break;case"超时回复":e="/intent_timeout_detail/";break;case"重复多轮回复":e="/intent_repeat_detail/"}window.location.href="#/intent_list/"+a+e+c}else window.location.href="#/intent_list/"+a+"/intent_detail/"+c},saveFn:function(){$(".save-and-apply").trigger("click"),dataEditedFlag=!1,setTimeout(function(){$("[data-act=confirmShow]").css("display")||(window.location.href="#/intent_list/"+a+"/intent_detail/"+c)},200)}}),dataEditedFlag))){if(!$("[data-act=confirmShow]").css("display"))if(b.scenario&&"SYSTEMACTION"==b.scenario.scenarioType){var e="";switch(d.target.innerText){case"订阅欢迎语":e="/intent_welcome_detail/";break;case"缺省回复":e="/intent_lost_detail/";break;case"超时回复":e="/intent_timeout_detail/";break;case"重复多轮回复":e="/intent_repeat_detail/";break;default:e="/intent_welcome_detail/"}console.log(e),window.location.href="#/intent_list/"+a+e+c}else window.location.href="#/intent_list/"+a+"/intent_detail/"+c;b.searchIntentWords=""}},b.createIntentFunc=function(){return-1==d.scenes_id?($.trace("请先创建场景"),!1):(dataEditedFlag&&$.confirm_save({text:"你的修改未保存，确定要离开意图详情页面吗？",title:"系统提示",ensureFn:function(){dataEditedFlag=!1,$("[data-act=confirmShow]").css("display")||(window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/-1")},saveFn:function(){$(".save-and-apply").trigger("click"),dataEditedFlag=!1,setTimeout(function(){$("[data-act=confirmShow]").css("display")||(window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/-1")},200)}}),void(dataEditedFlag||(window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/-1")))},b.getScenarioFunc=function(){var a=angular.element("#api-manager-box").scope().scenarioList;if(a){for(var c in a)if(d.scenes_id==a[c].id){b.scenario=a[c];break}}else setTimeout(function(){b.getScenarioFunc(),b.$apply()},600);var e=localStorage.isAbled;"true"==e||void 0==e?($(".toggle.btn").removeClass("btn-default").removeClass("off").addClass("btn-primary"),$("#sceneBtn").prop("checked",!0)):($(".toggle.btn").removeClass("btn-primary").addClass("btn-default").addClass("off"),$("#sceneBtn").prop("checked",!1))},b.getScenarioFunc(),b.addScenarioFunc=function(a){$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/scenario",data:JSON.stringify({name:a}),traditional:!0,headers:{"Content-Type":"application/json"},method:"POST",success:function(a){if(a=dataParse(a),0==a.code){callAgentReloadTestFunc(),b.scenario=a.result;var c=angular.element("#api-manager-box").scope().scenarioList;c||(c=new Array),c.push(b.scenario),angular.element("#api-manager-box").scope().scenarioList=c,b.$apply(),setTimeout(function(){$(".center-list-title input").select(),$(".center-list-title input").focus()},300),window.location.href="#/intent_list/"+b.scenario.id,$.trace("场景创建成功","success")}else 2==a.code?goIndex():a.msg.indexOf("already exists")>-1?k():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})},b.updateScenarioFunc=function(a){$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/scenario/"+b.scenario.id,data:JSON.stringify({name:a}),traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(a){if(a=dataParse(a),0==a.code){callAgentReloadTestFunc(),b.scenario=a.result;var c=angular.element("#api-manager-box").scope().scenarioList;for(var d in c)c[d].id==b.scenario.id&&(c[d].name=b.scenario.name,console.log(c));angular.element("#api-manager-box").scope().scenarioList=c,b.$apply()}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})},b.editScenarioFunc=function(a){a&&$.trim(a).length>0&&(b.scenario&&b.scenario.id&&b.scenario.id.length>0?b.updateScenarioFunc(a):b.addScenarioFunc(a))},b.editScenarioKeydownFunc=function(a,b){13==a.keyCode&&$("#scenario-name-temp").focus()},b.getIntentListFunc=function(a,c,f,g){var h=getCookie("sortkey");f||(f=""),$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+d.scenes_id+"/intents",data:{start:a,limit:c,keywords:f,sortkey:h},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){b.intentList=a.result,b.intentList&&b.intentList.length>0?-1!=window.location.href.indexOf("intent_list")&&-1==window.location.href.indexOf("intent_detail")&&(b.scenario&&"SYSTEMACTION"==b.scenario.scenarioType?window.location.href="#/intent_list/"+d.scenes_id+"/intent_welcome_detail/"+b.intentList[0].id:window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/"+b.intentList[0].id):($("[data-act=intent-tips]").css("display","block"),$("[data-act=intent-detail-tips]").css("display","block"));for(var c in b.intentList){var f="";if(b.intentList[c].errorModels){var h=1;for(var i in b.intentList[c].errorModels)h=parseInt(i)+1,b.intentList[c].errorModels[i].code&&"0"==b.intentList[c].errorModels[i].code.substring(0,1)?f+="<div style='color:#ee524f;max-height:300px;overflow: hidden;overflow-y:auto;'>"+h+"."+b.intentList[c].errorModels[i].detail+"</div>":b.intentList[c].errorModels[i].code&&"1"==b.intentList[c].errorModels[i].code.substring(0,1)&&(f+="<div style='color:#ffb64c;max-height:300px;overflow: hidden;overflow-y:auto;'>"+h+"."+b.intentList[c].errorModels[i].detail+"</div>");b.intentList[c].errorModelStr=f}}b.$apply(),setTimeout(function(){$('[data-toggle="popover"]').popover()},500),$("[data-act=nav-intent-"+g+"]").siblings().removeClass("active"),$("[data-act=nav-intent-"+g+"]").addClass("active"),e()}else 2==a.code?goIndex():(a.msg&&$.trace(a.msg+"( "+a.detail+" )","error"),1001==a.code&&(window.location.href=static_host+"/console/api_manager.html"))}})};var j=0;angular.element("#api-manager-box").scope().scenarioList&&(j=angular.element("#api-manager-box").scope().scenarioList.length);var k=function(){j+=1,b.intentList=new Array,b.scenes_title="未命名场景"+j,b.addScenarioFunc("未命名场景"+j)};-1==d.scenes_id?k():b.getIntentListFunc(0,b.pageSize),b.intentListFilter=function(a){return b.searchIntentWords&&0!=b.searchIntentWords.length?a.name.indexOf(b.searchIntentWords)>-1?!0:!1:!0},b.addIntentNameFunc=function(a,c){if(a&&$.trim(a).length>0){var d=new Object;d.name=a,b.intentList.push(d)}b.intentName=""},b.addIntentNameKeydownFunc=function(a,c,d){13==a.keyCode&&b.addIntentNameFunc(c,d)},b.deleteIntentNameFunc=function(a,c){var e=window.location.href.split("/"),f=e[e.length-1];$.confirm({text:'意图删除之后所有数据都将无法恢复，你确认要删除 <span class="delete-confirm-tip">"'+c+'"</span> 吗？',title:"删除意图",ensureFn:function(){return $.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+d.scenes_id+"/intent/"+a,method:"DELETE",success:function(c){if(c=dataParse(c),0==c.code){callAgentReloadTestFunc();for(var e in b.intentList)if(b.intentList[e].id==a){b.intentList.splice(e,1),b.$apply(),b.intentList.length<=0?window.location.href="#/intent_list/"+d.scenes_id:a==f?window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/"+b.intentList[0].id:(window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/"+f,$("[data-act=nav-intent-"+f+"]").addClass("active"));break}$.trace("删除成功","success"),b.getIntentCountFunc(function(){b.setPagingCountFunc()})}else 2==c.code?goIndex():c.msg&&$.trace(c.msg+"( "+c.detail+" )","error")}}),!1}})},b.copyIntentDetailFunc=function(a){if(!b.isCreateSuccess)return!1;var c=g(a);c.name=c.name+"(副本)",c.id="",b.isCreateSuccess=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+d.scenes_id+"/intent",data:JSON.stringify(c),traditional:!0,headers:{"Content-Type":"application/json"},method:"POST",success:function(a){if(a=dataParse(a),0==a.code){callAgentReloadTestFunc();var c={},e={};a.result.validateResult?(c=a.result.validateResult,e=a.result.intent):e=a.result,$.trace("意图复制成功","success"),b.intentList&&b.intentList.length>0||(b.intentList=new Array);var f="";if(e.errorModels){var g=1;for(var h in e.errorModels)g=parseInt(h)+1,e.errorModels[h].code&&"0"==e.errorModels[h].code.substring(0,1)?f+="<div style='color:#ee524f;max-height:300px;overflow: hidden;overflow-y:auto;'>"+g+"."+e.errorModels[h].detail+"</div>":e.errorModels[h].code&&"1"==e.errorModels[h].code.substring(0,1)&&(f+="<div style='color:#ffb64c;max-height:300px;overflow: hidden;overflow-y:auto;'>"+g+"."+e.errorModels[h].detail+"</div>");e.errorModelStr=f}b.intentList.unshift(e),b.getIntentCountFunc(function(){b.setPagingCountFunc()}),b.$apply(),window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/"+e.id}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error");b.isCreateSuccess=!0},error:function(){$.trace("意图复制失败")}})},b.moveIntentNameFunc=function(a,c){var e=window.location.href.split("/"),f=e[e.length-1];$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+c+"/intent/"+a+"/move",method:"PUT",success:function(c){if(c=dataParse(c),0==c.code){callAgentReloadTestFunc(),b.getIntentCountFunc(function(){b.setPagingCountFunc()});for(var e in b.intentList)if(b.intentList[e].id==a){b.intentList.splice(e,1),b.$apply(),b.intentList.length<=0?window.location.href="#/intent_list/"+d.scenes_id:a==f?window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/"+b.intentList[0].id:window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/"+f;break}}else 2==c.code?goIndex():$.trace("此意图已在本场景下，无需移动！")}})},$(".intent").delegate(".btn-intent","click",function(a){a.stopPropagation();var b=$(this),c=window.location.href.split("/"),d=c[c.length-1];b.parent().addClass("open"),$("[data-act=nav-intent-"+d+"]").addClass("active");var e=this.getBoundingClientRect().left+document.documentElement.scrollLeft,f=this.getBoundingClientRect().top+document.documentElement.scrollTop;b.next().css({left:e,top:f})}),$(".intent").delegate(".btn-group","mouseleave",function(){$(this).removeClass("open")}),b.copyIntentNameFunc=function(a){for(var c in b.intentList)if(b.intentList[c].id==a){b.copyIntentDetailFunc(b.intentList[c]);break}},b.getIntentCountFunc=function(a){-1!=d.scenes_id&&$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+d.scenes_id+"/intent/count",method:"GET",success:function(c){c=dataParse(c),0==c.code?(b.intentCount=c.result,b.$apply(),a&&a()):2==c.code?goIndex():c.msg&&$.trace(c.msg+"( "+c.detail+" )","error")}})},b.getIntentCountFunc(function(){b.setPagingCountFunc(function(){$(".paging-box li:nth-child(2)").addClass("active").siblings().removeClass("active")})}),b.setPagingCountFunc=function(a){if(b.intentCount){var c=Math.ceil(b.intentCount/b.pageSize);b.pageCount=c,b.intentPageNumList=[];for(var d=1;d<=b.pageCount&&b.intentPageNumList.length<=7;d++)b.intentPageNumList.push(d);var e;b.pageCount>8?(b.intentPageNumList.push("..."),e=b.intentPageNumList[b.intentPageNumList.length-2]):e=b.intentPageNumList[b.intentPageNumList.length-1],b.lastNum=e,b.$apply(),a&&a()}},b.firstNum=1,$("body").off("click",".paging-box li a").on("click",".paging-box li a",function(a){var c=$(this);if(c.parent("li").hasClass("disabled"))return!1;var d=c.text();if("«"==d){var e=b.intentPageNumList[0];if(b.firstNum=e,e>=9){b.intentPageNumList=[];for(var f=e-1;f>=1&&b.intentPageNumList.length<=7;f--)b.intentPageNumList.unshift(f)}var g=0;8==b.intentPageNumList.length&&b.intentPageNumList[b.intentPageNumList.length-1]<b.pageCount?(b.intentPageNumList.push("..."),g=b.intentPageNumList[b.intentPageNumList.length-2]):g=b.intentPageNumList[b.intentPageNumList.length-1],e=b.intentPageNumList[0],b.firstNum=e,b.lastNum=g}else if("»"==d){var g=b.intentPageNumList[b.intentPageNumList.length-2];if(b.lastNum=g,g<b.pageCount){b.intentPageNumList=[];for(var f=g+1;f<=b.pageCount&&b.intentPageNumList.length<=7;f++)b.intentPageNumList.push(f)}8==b.intentPageNumList.length&&b.intentPageNumList[b.intentPageNumList.length-1]<b.pageCount?(b.intentPageNumList.push("..."),g=b.intentPageNumList[b.intentPageNumList.length-2]):g=b.intentPageNumList[b.intentPageNumList.length-1];var e=b.intentPageNumList[0];b.firstNum=e,b.lastNum=g}else"..."==d||(d=parseInt(d),d-=1,b.getIntentListFunc(d*b.pageSize,b.pageSize,b.searchIntentWords),c.parent("li").addClass("active").siblings("li").removeClass("active"));b.$apply()}),$(".sort-key").click(function(){var a=getCookie("sortkey");$(this).find("."+a).addClass("active").siblings().removeClass("active")}),$(".sort-key li").click(function(){var a=$(this),c=a.attr("class").split(" ")[0];setCookie("sortkey",c),b.getIntentListFunc(0,b.pageSize),b.getIntentCountFunc(function(){b.setPagingCountFunc(function(){$(".paging-box li:nth-child(2)").addClass("active").siblings().removeClass("active")})})}),$("#toggleScene").on("click",function(){var a=$(".scenario-object.active"),c=(a.find(".ng-binding").text(),a.find(".colorBtn")),d=!$(this).find("input").prop("checked"),e=1==d?"VALID":"INVALID";$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/scenario/"+b.scenario.id+"/update/status",method:"POST",data:{scenarioStatus:e},success:function(a){var b=a.code;0==b&&(1==d?(c.removeClass("unAbled").addClass("isAbled"),$(c).attr("data-original-title","该场景已打开")):(c.removeClass("isAbled").addClass("unAbled"),$(c).attr("data-original-title","该场景已关闭")))},error:function(a){console.log(a)}})}),$(".form-control.myNewIssue").on("keydown",function(a){if(13==a.keyCode){$(this).val();b.createIntentFunc(),setTimeout(function(){console.log(b.intentList[0])},0)}}),b.scenario&&"SYSTEMACTION"==b.scenario.scenarioType&&(b.isSY=!0,$(".center-list-title input").attr("disabled",!0))}function sysIntentListPage(a,b,c,d){function e(){"isNewUser"==getCookie("app"+appId)&&"true"!=getCookie("isOldUser")&&window.location.href.indexOf("intent_detail")>-1&&($("[data-act=new-user-guide-box]").css("display","block"),$(".action-tips").css({top:$(".left-addScenario").offset().top-$(".scenario-box").height()-26+"px",left:$(".left-addScenario").offset().left-$(".action-tips").width()/2-10+"px"}))}function f(){$(".new-user-box").hide(),$(".new-user-main").hide(),$(".new-user-foot").hide(),$(".action-tips").hide(),h=1,delCookie("app"+appId)}function g(a){var b=new Object;return b.appId=a.appId,b.auto=a.auto,b.contexts=a.contexts,b.errorModels=a.errorModels,b.gmtCreate=a.gmtCreate,b.gmtUpdate=a.gmtUpdate,b.id=a.id,b.intentState=a.intentState,b.intentStatus=a.intentStatus,b.intentType=a.intentType,b.mlLevel=a.mlLevel,b.name=a.name,b.priority=a.priority,b.responses=a.responses,b.scenarioId=a.scenarioId,b.speech=a.speech,b.templates=a.templates,b.errorModelStr=a.errorModelStr,b}$('[data-toggle="toggle"]').bootstrapToggle({size:"mini",on:"",off:""}),$(".list-group-item").removeClass("active"),$("[data-act=nav-scenario]").addClass("active"),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip(),$("[data-act=nav-scenario-"+d.scenes_id+"]").addClass("active")},200),b.pageSize=12,b.searchIntentWords="",b.isCreateSuccess=!0,b.currentScenesId=d.scenes_id;var h=1;$("body").off("click",".new-user-next").on("click",".new-user-next",function(a){switch(5>h&&h++,!0){case 1==h:$(".action-tips p").text("创建场景“打招呼”"),$(".action-tips").css({top:$(".left-addScenario").offset().top-$(".scenario-box").height()-26+"px",left:$(".left-addScenario").offset().left-$(".action-tips").width()/2-6+"px"}),$(".new-user-under-arrow").css("top","45px");break;case 2==h:$(".action-tips p").text("创建意图“寒暄”"),$(".action-tips").css({left:300,top:100}),$(".new-user-under-arrow").css("top","45px");break;case 3==h:var b=$(".user-say-templates").find(".list-group-item");$(".action-tips p").text("填写用户说，例如：“hi”"),$(".action-tips").css({left:b.offset().left+70,top:b.offset().top-b.height()-20}),$(".new-user-under-arrow").css("top","45px");break;case 4==h:var c=$("[data-act=robot-answer-text]");$(".action-tips p").html("在机器人答里填写“hello！”<br>最后别忘了保存哦！"),$(".action-tips").css({left:$(c).offset().left+70,top:$(c).offset().top-$(c).height()}),$(".new-user-under-arrow").css("top","69px");break;case 5==h:$(".action-tips p").html('点这里，试试你刚才写的问答！<br>更多新手教程，<a href="https://docs.ruyi.ai/41_xin_shou_ru_men.html" target="_black" style="text-decoration: underline;">点击这里</a>'),$(".action-tips").css({left:"2%",top:$(".new-user-foot").offset().top-$(".new-user-foot").height()+20}),$(".new-user-under-arrow").css("top","69px"),$(".new-user-prev").hide(),$(".new-user-next").hide(),$(".new-user-complete").show().css("margin-left","12%"),$(".new-user-next").text("完成")}for(var d=1;h>d;d++)$($(".new-user-box").find("li")[d]).css({"background-color":"#191e24",color:"#fff"});$($(".new-user-box").find("li")[h]).children("i").attr("class","cave-arrow")}),$("body").off("click",".new-user-prev").on("click",".new-user-prev",function(a){switch(h>1&&h--,!0){case 1==h:$(".action-tips p").text("创建场景“打招呼”"),$(".action-tips").css({top:$(".left-addScenario").offset().top-$(".scenario-box").height()-22+"px",left:$(".left-addScenario").offset().left-$(".action-tips").width()/2-8+"px"}),$(".new-user-under-arrow").css("top","45px");break;case 2==h:$(".action-tips p").text("创建意图“寒暄”"),$(".action-tips").css({left:300,top:100}),$(".new-user-under-arrow").css("top","45px");break;case 3==h:var b=$(".user-say-templates").find(".list-group-item");$(".action-tips p").text("填写用户说，例如：“hi”"),$(".action-tips").css({left:b.offset().left+70,top:b.offset().top-b.height()-20}),$(".new-user-under-arrow").css("top","45px");break;case 4==h:var c=$("[data-act=robot-answer-text]");$(".action-tips p").html("在机器人答里填写“hello！”<br>最后别忘了保存哦！"),$(".action-tips").css({left:$(c).offset().left+70,top:$(c).offset().top-$(c).height()}),$(".new-user-under-arrow").css("top","69px")}$($(".new-user-box").find("li")[h]).css({"background-color":"#fff",color:"#000"}),$($(".new-user-box").find("li")[h+1]).children("i").attr("class","tips-arrow")}),$("body").off("click",".new-user-skip").on("click",".new-user-skip",function(a){f()}),$("body").off("click",".new-user-complete").on("click",".new-user-complete",function(a){f()});var i=function(){var a=$(window).height();b.pageSize=parseInt((a-190)/40),b.setPagingCountFunc&&b.setPagingCountFunc();
};i(),$(window).resize(function(){i()}),b.goIntentDetail=function(a,c,d){$("[data-act=nav-scenario-"+a+"]").addClass("active"),d&&$(d.target).is(".btn-intent")||(dataEditedFlag&&$.confirm_save({text:"你的修改未保存，确定要离开意图详情页面吗？",title:"系统提示",ensureFn:function(){dataEditedFlag=!1,$("[data-act=confirmShow]").css("display")||("SYSTEMACTION"==b.scenario.scenarioType?window.location.href="#/intent_list/"+a+"/intent_event_detail/"+c:window.location.href="#/intent_list/"+a+"/intent_detail/"+c)},saveFn:function(){$(".save-and-apply").trigger("click"),dataEditedFlag=!1,setTimeout(function(){$("[data-act=confirmShow]").css("display")||(window.location.href="#/intent_list/"+a+"/intent_detail/"+c)},200)}}),dataEditedFlag||($("[data-act=confirmShow]").css("display")||("SYSTEMACTION"==b.scenario.scenarioType?window.location.href="#/intent_list/"+a+"/intent_event_detail/"+c:window.location.href="#/intent_list/"+a+"/intent_detail/"+c),b.searchIntentWords=""))},b.createIntentFunc=function(){return-1==d.scenes_id?($.trace("请先创建场景"),!1):(dataEditedFlag&&$.confirm_save({text:"你的修改未保存，确定要离开意图详情页面吗？",title:"系统提示",ensureFn:function(){dataEditedFlag=!1,$("[data-act=confirmShow]").css("display")||(window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/-1")},saveFn:function(){$(".save-and-apply").trigger("click"),dataEditedFlag=!1,setTimeout(function(){$("[data-act=confirmShow]").css("display")||(window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/-1")},200)}}),void(dataEditedFlag||(window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/-1")))},b.getScenarioFunc=function(){var a=angular.element("#api-manager-box").scope().scenarioList;if(a){for(var c in a)if(d.scenes_id==a[c].id){b.scenario=a[c];break}}else setTimeout(function(){b.getScenarioFunc(),b.$apply()},600);var e=localStorage.isAbled;"true"==e||void 0==e?($(".toggle.btn").removeClass("btn-default").removeClass("off").addClass("btn-primary"),$("#sceneBtn").prop("checked",!0)):($(".toggle.btn").removeClass("btn-primary").addClass("btn-default").addClass("off"),$("#sceneBtn").prop("checked",!1))},b.getScenarioFunc(),b.addScenarioFunc=function(a){$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/scenario",data:JSON.stringify({name:a}),traditional:!0,headers:{"Content-Type":"application/json"},method:"POST",success:function(a){if(a=dataParse(a),0==a.code){callAgentReloadTestFunc(),b.scenario=a.result;var c=angular.element("#api-manager-box").scope().scenarioList;c||(c=new Array),c.push(b.scenario),angular.element("#api-manager-box").scope().scenarioList=c,b.$apply(),setTimeout(function(){$(".center-list-title input").select(),$(".center-list-title input").focus()},300),window.location.href="#/intent_list/"+b.scenario.id,$.trace("场景创建成功","success")}else 2==a.code?goIndex():a.msg.indexOf("already exists")>-1?k():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})},b.updateScenarioFunc=function(a){$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/scenario/"+b.scenario.id,data:JSON.stringify({name:a}),traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(a){if(a=dataParse(a),0==a.code){callAgentReloadTestFunc(),b.scenario=a.result;var c=angular.element("#api-manager-box").scope().scenarioList;for(var d in c)c[d].id==b.scenario.id&&(c[d].name=b.scenario.name,console.log(c));angular.element("#api-manager-box").scope().scenarioList=c,b.$apply()}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})},b.editScenarioFunc=function(a){a&&$.trim(a).length>0&&(b.scenario&&b.scenario.id&&b.scenario.id.length>0?b.updateScenarioFunc(a):b.addScenarioFunc(a))},b.editScenarioKeydownFunc=function(a,b){13==a.keyCode&&$("#scenario-name-temp").focus()},b.getIntentListFunc=function(a,c,f,g){var h=getCookie("sortkey");f||(f=""),$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+d.scenes_id+"/intents",data:{start:a,limit:c,keywords:f,sortkey:h},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){b.intentList=a.result,b.intentList&&b.intentList.length>0?-1!=window.location.href.indexOf("intent_list")&&-1==window.location.href.indexOf("intent_detail")&&(window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/"+b.intentList[0].id):($("[data-act=intent-tips]").css("display","block"),$("[data-act=intent-detail-tips]").css("display","block"));for(var c in b.intentList){var f="";if(b.intentList[c].errorModels){var h=1;for(var i in b.intentList[c].errorModels)h=parseInt(i)+1,b.intentList[c].errorModels[i].code&&"0"==b.intentList[c].errorModels[i].code.substring(0,1)?f+="<div style='color:#ee524f;max-height:300px;overflow: hidden;overflow-y:auto;'>"+h+"."+b.intentList[c].errorModels[i].detail+"</div>":b.intentList[c].errorModels[i].code&&"1"==b.intentList[c].errorModels[i].code.substring(0,1)&&(f+="<div style='color:#ffb64c;max-height:300px;overflow: hidden;overflow-y:auto;'>"+h+"."+b.intentList[c].errorModels[i].detail+"</div>");b.intentList[c].errorModelStr=f}}b.$apply(),setTimeout(function(){$('[data-toggle="popover"]').popover()},500),$("[data-act=nav-intent-"+g+"]").siblings().removeClass("active"),$("[data-act=nav-intent-"+g+"]").addClass("active"),e()}else 2==a.code?goIndex():(a.msg&&$.trace(a.msg+"( "+a.detail+" )","error"),1001==a.code&&(window.location.href=static_host+"/console/api_manager.html"))}})};var j=0;angular.element("#api-manager-box").scope().scenarioList&&(j=angular.element("#api-manager-box").scope().scenarioList.length);var k=function(){j+=1,b.intentList=new Array,b.scenes_title="未命名场景"+j,b.addScenarioFunc("未命名场景"+j)};-1==d.scenes_id?k():b.getIntentListFunc(0,b.pageSize),b.intentListFilter=function(a){return b.searchIntentWords&&0!=b.searchIntentWords.length?a.name.indexOf(b.searchIntentWords)>-1?!0:!1:!0},b.addIntentNameFunc=function(a,c){if(a&&$.trim(a).length>0){var d=new Object;d.name=a,b.intentList.push(d)}b.intentName=""},b.addIntentNameKeydownFunc=function(a,c,d){13==a.keyCode&&b.addIntentNameFunc(c,d)},b.deleteIntentNameFunc=function(a,c){var e=window.location.href.split("/"),f=e[e.length-1];$.confirm({text:'意图删除之后所有数据都将无法恢复，你确认要删除 <span class="delete-confirm-tip">"'+c+'"</span> 吗？',title:"删除意图",ensureFn:function(){return $.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+d.scenes_id+"/intent/"+a,method:"DELETE",success:function(c){if(c=dataParse(c),0==c.code){callAgentReloadTestFunc();for(var e in b.intentList)if(b.intentList[e].id==a){b.intentList.splice(e,1),b.$apply(),b.intentList.length<=0?window.location.href="#/intent_list/"+d.scenes_id:a==f?window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/"+b.intentList[0].id:(window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/"+f,$("[data-act=nav-intent-"+f+"]").addClass("active"));break}$.trace("删除成功","success"),b.getIntentCountFunc(function(){b.setPagingCountFunc()})}else 2==c.code?goIndex():c.msg&&$.trace(c.msg+"( "+c.detail+" )","error")}}),!1}})},b.copyIntentDetailFunc=function(a){if(!b.isCreateSuccess)return!1;var c=g(a);c.name="yes",c.id="",b.isCreateSuccess=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+d.scenes_id+"/intent",data:JSON.stringify(c),traditional:!0,headers:{"Content-Type":"application/json"},method:"POST",success:function(a){if(a=dataParse(a),0==a.code){callAgentReloadTestFunc();var c={},e={};a.result.validateResult?(c=a.result.validateResult,e=a.result.intent):e=a.result,$.trace("意图复制成功","success"),b.intentList&&b.intentList.length>0||(b.intentList=new Array);var f="";if(e.errorModels){var g=1;for(var h in e.errorModels)g=parseInt(h)+1,e.errorModels[h].code&&"0"==e.errorModels[h].code.substring(0,1)?f+="<div style='color:#ee524f;max-height:300px;overflow: hidden;overflow-y:auto;'>"+g+"."+e.errorModels[h].detail+"</div>":e.errorModels[h].code&&"1"==e.errorModels[h].code.substring(0,1)&&(f+="<div style='color:#ffb64c;max-height:300px;overflow: hidden;overflow-y:auto;'>"+g+"."+e.errorModels[h].detail+"</div>");e.errorModelStr=f}b.intentList.unshift(e),b.getIntentCountFunc(function(){b.setPagingCountFunc()}),b.$apply(),window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/"+e.id}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error");b.isCreateSuccess=!0},error:function(){$.trace("意图复制失败")}})},b.moveIntentNameFunc=function(a,c){var e=window.location.href.split("/"),f=e[e.length-1];$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+c+"/intent/"+a+"/move",method:"PUT",success:function(c){if(c=dataParse(c),0==c.code){callAgentReloadTestFunc(),b.getIntentCountFunc(function(){b.setPagingCountFunc()});for(var e in b.intentList)if(b.intentList[e].id==a){b.intentList.splice(e,1),b.$apply(),b.intentList.length<=0?window.location.href="#/intent_list/"+d.scenes_id:a==f?window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/"+b.intentList[0].id:window.location.href="#/intent_list/"+d.scenes_id+"/intent_detail/"+f;break}}else 2==c.code?goIndex():$.trace("此意图已在本场景下，无需移动！")}})},$(".intent").delegate(".btn-intent","click",function(a){a.stopPropagation();var b=$(this),c=window.location.href.split("/"),d=c[c.length-1];b.parent().addClass("open"),$("[data-act=nav-intent-"+d+"]").addClass("active");var e=this.getBoundingClientRect().left+document.documentElement.scrollLeft,f=this.getBoundingClientRect().top+document.documentElement.scrollTop;b.next().css({left:e,top:f})}),$(".intent").delegate(".btn-group","mouseleave",function(){$(this).removeClass("open")}),b.copyIntentNameFunc=function(a){for(var c in b.intentList)if(b.intentList[c].id==a){b.copyIntentDetailFunc(b.intentList[c]);break}},b.getIntentCountFunc=function(a){-1!=d.scenes_id&&$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+d.scenes_id+"/intent/count",method:"GET",success:function(c){c=dataParse(c),0==c.code?(b.intentCount=c.result,b.$apply(),a&&a()):2==c.code?goIndex():c.msg&&$.trace(c.msg+"( "+c.detail+" )","error")}})},b.getIntentCountFunc(function(){b.setPagingCountFunc(function(){$(".paging-box li:nth-child(2)").addClass("active").siblings().removeClass("active")})}),b.setPagingCountFunc=function(a){if(b.intentCount){var c=Math.ceil(b.intentCount/b.pageSize);b.pageCount=c,b.intentPageNumList=[];for(var d=1;d<=b.pageCount&&b.intentPageNumList.length<=7;d++)b.intentPageNumList.push(d);var e;b.pageCount>8?(b.intentPageNumList.push("..."),e=b.intentPageNumList[b.intentPageNumList.length-2]):e=b.intentPageNumList[b.intentPageNumList.length-1],b.lastNum=e,b.$apply(),a&&a()}},b.firstNum=1,$("body").off("click",".paging-box li a").on("click",".paging-box li a",function(a){var c=$(this);if(c.parent("li").hasClass("disabled"))return!1;var d=c.text();if("«"==d){var e=b.intentPageNumList[0];if(b.firstNum=e,e>=9){b.intentPageNumList=[];for(var f=e-1;f>=1&&b.intentPageNumList.length<=7;f--)b.intentPageNumList.unshift(f)}var g=0;8==b.intentPageNumList.length&&b.intentPageNumList[b.intentPageNumList.length-1]<b.pageCount?(b.intentPageNumList.push("..."),g=b.intentPageNumList[b.intentPageNumList.length-2]):g=b.intentPageNumList[b.intentPageNumList.length-1],e=b.intentPageNumList[0],b.firstNum=e,b.lastNum=g}else if("»"==d){var g=b.intentPageNumList[b.intentPageNumList.length-2];if(b.lastNum=g,g<b.pageCount){b.intentPageNumList=[];for(var f=g+1;f<=b.pageCount&&b.intentPageNumList.length<=7;f++)b.intentPageNumList.push(f)}8==b.intentPageNumList.length&&b.intentPageNumList[b.intentPageNumList.length-1]<b.pageCount?(b.intentPageNumList.push("..."),g=b.intentPageNumList[b.intentPageNumList.length-2]):g=b.intentPageNumList[b.intentPageNumList.length-1];var e=b.intentPageNumList[0];b.firstNum=e,b.lastNum=g}else"..."==d||(d=parseInt(d),d-=1,b.getIntentListFunc(d*b.pageSize,b.pageSize,b.searchIntentWords),c.parent("li").addClass("active").siblings("li").removeClass("active"));b.$apply()}),$(".sort-key").click(function(){var a=getCookie("sortkey");$(this).find("."+a).addClass("active").siblings().removeClass("active")}),$(".sort-key li").click(function(){var a=$(this),c=a.attr("class").split(" ")[0];setCookie("sortkey",c),b.getIntentListFunc(0,b.pageSize),b.getIntentCountFunc(function(){b.setPagingCountFunc(function(){$(".paging-box li:nth-child(2)").addClass("active").siblings().removeClass("active")})})}),$("#toggleScene").on("click",function(){var a=$(".scenario-object.active"),c=(a.find(".ng-binding").text(),a.find(".colorBtn")),d=!$(this).find("input").prop("checked"),e=1==d?"VALID":"INVALID";$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/scenario/"+b.scenario.id+"/update/status",method:"POST",data:{scenarioStatus:e},success:function(a){var b=a.code;0==b&&(1==d?(c.removeClass("unAbled").addClass("isAbled"),$(c).attr("data-original-title","该场景已打开")):(c.removeClass("isAbled").addClass("unAbled"),$(c).attr("data-original-title","该场景已关闭")))},error:function(a){console.log(a)}})}),$(".form-control.myNewIssue").on("keydown",function(a){if(13==a.keyCode){$(this).val();b.createIntentFunc(),setTimeout(function(){console.log(b.intentList[0])},0)}})}function intent_repeat_detail($rootScope,$scope,$state,$stateParams,$sce){function lengthCheckFunc(a,b){for(var c=!1,d=0,e=0;e<a.length;e++){var f=a.charCodeAt(e);if(f>=1&&126>=f||f>=65376&&65439>=f?d++:d+=2,d>b){c=!0;break}}return c}function checkAt(a){if(window.getSelection){var b=window.getSelection(),c=b.getRangeAt(0),d=b.focusNode.textContent,e=c.startOffset;"@"==d.substr(e-1,1)&&(insertAt(a),isAtStatus=!0)}}function insertAt(a){$("body").find("span#prompt").remove(),insertnode(),insertMention(a);var b=$(".mention-popup");return b.find("input").focus(),a.addClass("on"),autoGetPrompt(""),!1}function autoGetPrompt(a){$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/entity/list",method:"get",cache:!0,data:{keywords:a},success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.userentity,c=a.result.sysentity,d="";b.length>=10&&(b.length=10),c.length=10-b.length;for(var e in b)d+="<li class='user-box-row'>"+b[e]+"</li>";for(var e in c)d+="<li class='user-box-row'>"+c[e]+"</li>";$("body").find("div.user-box").html("<ul>"+d+"</ul>"),defaultItem()}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})}function insertnode(){var a=window.getSelection(),b=a.getRangeAt(0),c=document.createElement("span");c.id="prompt",b.insertNode(c),b.collapse(!1)}function insertMention(a){var b=$('<div class="mention-popup">                        <div class="writing-bg">                        <input type="text" id="mention-input" placeholder="获取词典(Esc取消)" data-act="atShow"/>                        </div>                        <div class="user-box"></div>                      </div>'),c=$("span#prompt").position().left+2,d=$(".mention-popup").height()+10,e=$("span#prompt").position().top-d+10;b.css({left:c,top:e}),$(".mention-popup").length>0&&($(".mention-popup").remove(),isAtStatus=!1),b.insertAfter(a),setTimeout(function(){defaultItem()},200)}function defaultItem(){$("body").find(".user-box .user-box-row").length&&$("body").find(".user-box .user-box-row").eq(0).addClass("on")}function choseFriend(a,b,c){var d="";if(d=c?a.val():$(".user-box-row.on").text()+":",window.getSelection){b.focus(),b.find("span#prompt").before(d);var e=window.getSelection(),f=document.createRange();if(f.selectNode(b.find("span#prompt").get(0)),e.removeAllRanges(),e.addRange(f),f.collapse(!1),!c){var e=window.getSelection(),f=e.getRangeAt(0),g=e.focusNode.textContent,h=g.lastIndexOf("@");h>-1&&(g=g.substr(h+1,g.length-1));for(var i=g.indexOf(".",0),j=g.substr(i+1,g.length-i-2),k=0;20>=k;k++)if(0==k){if(aliasExitsFunc(b.text(),j))break}else if(aliasExitsFunc(b.text(),j+k)){j=""+j+k;break}j=j.replace(new RegExp(/\./g),"-"),b.find("span#prompt").before(j+"&nbsp;");var e=window.getSelection(),f=document.createRange();f.selectNode(b.find("span#prompt").get(0)),e.removeAllRanges(),e.addRange(f),f.collapse(!1)}b.find("span#prompt").remove(),isAtStatus=!1}return!1}function aliasExitsFunc(text,alias){var userSysReg=eval("/:"+alias+"/g"),paras=text.match(userSysReg);return paras&&0!=paras.length?!1:!0}function supports_html5_storage(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}$(".my_btns").on("click",".btn",function(){$(".my_btns .btn-mine").removeClass("btn-mine"),$(this).addClass("btn-mine")}),$('[data-toggle="tooltip"]').tooltip(),$scope.app_response=getCookie("app_response"),"app-response-weixin"==$scope.app_response?($(".speach-response .app-response-weixin").addClass("active").siblings().removeClass("active"),$("#myTabContent").find("#weixin").addClass("active in").siblings().removeClass("active in")):"app-response-local"==$scope.app_response&&($(".speach-response .app-response-local").addClass("active").siblings().removeClass("active"),$("#myTabContent").find("#local").addClass("active in").siblings().removeClass("active in"));var isAtStatus=!1;$scope.currentUserId=getCookie("userId");var checkIsChangeValue="";$scope.commonIntentDetailFocus=function(a){checkIsChangeValue=a},$scope.commonIntentDetailBlur=function(a){checkIsChangeValue!=a&&(dataEditedFlag=!0)},$scope.userSyaTest="",$('[data-toggle="popover"]').popover(),$scope.testTemplateKeydownFunc=function(){var a=$("#userSyaTest").text(),b=a.replace(/<span[^>]*>/g," ");b=b.replace(/<\/span>/g,"");var c=b.match(/(@[^:]+):([^\s]+)/g);for(var d in c)b=b.replace(c[d],"<span style='background-color:red;'>"+$.trim(c[d])+"</span>");b=$sce.trustAsHtml(b),$scope.userSyaTest=b};var removeDuplicate=function(a){for(var b={},c=[],d=0;d<a.length;d++)b[a[d]]||(b[a[d]]=!0,c.push(a[d]));return c};$("#myreset").click(function(){var a=$("#regTest").text(),b=a.replace(/<span[^>]*>/g," ");b=b.replace(/<\/span>/g,""),$("#regTest").text(b)}),$("#mysubmit").click(function(){var a=$("#regTest").text(),b=a.match(/(@[^:]+):([^\s]+)/g);for(var c in b)a=a.replace(b[c],"<span style='background-color:red;'>"+$.trim(b[c])+"</span>");$("#regTest").html(a)}),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200);var intentDetailDuplicate="";$scope.isSaveSuccess=!0;var addEmptyParametersFunc=function(a){if(a)if($scope.response){var b=$scope.response;if(b.parameters){var c={};b.parameters&&b.parameters.length>0?(c=b.parameters[b.parameters.length-1],($.trim(c.dataType).length>0||$.trim(c.defaultValue).length>0||$.trim(c.name).length>0||$.trim(c.value).length>0||c.prompts.length>0||c.required)&&b.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""})):b.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""})}else b.parameters=[],b.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""})}else $scope.response={action:"",parameters:[],outputs:[[]]},$scope.response.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""});return a},deleteEmptyParametersFunc=function(a){if(a&&a.responses)for(var b in a.responses)if(a.responses[b].parameters)for(var c in a.responses[b].parameters)$.trim(a.responses[b].parameters[c].dataType).length<=0&&$.trim(a.responses[b].parameters[c].defaultValue).length<=0&&$.trim(a.responses[b].parameters[c].name).length<=0&&$.trim(a.responses[b].parameters[c].value).length<=0&&a.responses[b].parameters[c].prompts.length<=0&&!a.responses[b].parameters[c].required&&a.responses[b].parameters.splice(c,1);return a};$scope.newsPageSize=6,$scope.imagePageSize=12,$scope.voicePageSize=20,$scope.videoPageSize=20,$scope.createMediaObjectFunc=function(a){var b=new Object;a.indexOf("@mediaResourceResponse-news")>-1?b.type="news":a.indexOf("@mediaResourceResponse-image")>-1?b.type="image":a.indexOf("@mediaResourceResponse-voice")>-1?b.type="voice":a.indexOf("@mediaResourceResponse-video")>-1&&(b.type="video");var c="#####",d="&&&&&";-1==a.indexOf(c)&&(c="#",d=":");var e=a.split(c);for(var f in e){var g=e[f].split(d);"mediaid"==g[0]?b.mediaId=g[1]:"name"==g[0]&&(b.name=g[1])}return b.text=a,b},$scope.getMediaResponseFunc=function(a){if(a&&($scope.mediaResponseList=new Array),$scope.intentDetail.speech){var b=0;for(var c in $scope.intentDetail.speech)if($scope.intentDetail.speech[c]&&$scope.intentDetail.speech[c].indexOf("@mediaResourceResponse")>-1){var d=$scope.createMediaObjectFunc($scope.intentDetail.speech[c]);a&&$scope.mediaResponseList.push(d),b++}for(var e=0;b>e;e++)for(var c in $scope.intentDetail.speech)if($scope.intentDetail.speech[c].indexOf("@mediaResourceResponse")>-1){$scope.intentDetail.speech.splice(c,1);break}}};var splitOutputsFunc=function(){var a=[],b=[],c=[],d=[],e=[],f=[];for(var g in $scope.response.outputs)for(var h in $scope.response.outputs[g]){$scope.response.outputs[g][h]&&$scope.response.outputs[g][h].type&&($scope.response.outputs[g][h].type.indexOf("wechat.")>-1?(a.push($scope.response.outputs[g]),b.push($scope.response.outputs[g]),c.push($scope.response.outputs[g])):(d.push($scope.response.outputs[g]),e.push($scope.response.outputs[g]),f.push($scope.response.outputs[g])));break}0==a.length&&(a=[[]],b=[[]],c=[[]]),0==d.length&&(d=[[]],e=[[]],f=[[]]),$scope.wechatOutputs=a,$scope.localOutouts=d,$scope.wechatOutputs_one=b,$scope.localOutouts_one=e,$scope.wechatOutputs_two=c,$scope.localOutouts_two=f,$scope.$apply()};$scope.getIntentDetailFunc=function(a){a&&0!=a.length&&$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+$stateParams.scenes_id+"/intent/"+a,method:"GET",success:function(a){a=dataParse(a),0==a.code?($scope.intentDetail=a.result,$scope.getMediaResponseFunc(!0),$scope.intentDetail.responses&&$scope.intentDetail.responses.length>0?$scope.response=$scope.intentDetail.responses[0]:$scope.response=new Object,$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail),$scope.intentDetail.templates=removeDuplicate($scope.intentDetail.templates),intentDetailDuplicate=JSON.stringify($scope.intentDetail),$scope.intentDetail.templates.length>5&&($scope.userSayFlag=!1),splitOutputsFunc(),setLearnLevelFunc(),$scope.$apply(),setTimeout(function(){$("[data-act=nav-intent-"+$stateParams.intent_id+"]").siblings().removeClass("active"),$("[data-act=nav-intent-"+$stateParams.intent_id+"]").addClass("active")},200)):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})};var intentIndex=0;angular.element(".center-list-box").scope().intentCount&&(intentIndex=angular.element(".center-list-box").scope().intentCount);var createIntentCommonFunc=function(){intentIndex+=1,$scope.intentDetail=new Object,$scope.intentDetail.name="",$scope.intentDetail.auto=!0,$scope.intentDetail.priority=0,$scope.intentDetail.mlLevel="MIDDLE",$scope.mlLevel=!0,$scope.response={action:"",parameters:[],outputs:[[]]},$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail),$scope.mediaResponseList=[],$scope.wechatOutputs=[[]],$scope.localOutouts=[[]],$scope.intentDetail.name="未命名意图"+intentIndex,setTimeout(function(){$scope.addIntentDetailFunc()},20)};-1==$stateParams.intent_id?createIntentCommonFunc():$scope.getIntentDetailFunc($stateParams.intent_id);var validateIntentDetailFunc=function(){if($scope.intentDetail&&$scope.intentDetail.errorModels&&$scope.intentDetail.errorModels.length>0){var a="",b=1;for(var c in $scope.intentDetail.errorModels)b=parseInt(c)+1,$scope.intentDetail.errorModels[c].code&&"0"==$scope.intentDetail.errorModels[c].code.substring(0,1)?a+="<div style='color:#ee524f;max-height:300px;overflow:hidden;overflow-y:auto;'>"+b+"."+$scope.intentDetail.errorModels[c].detail+"</div>":$scope.intentDetail.errorModels[c].code&&"1"==$scope.intentDetail.errorModels[c].code.substring(0,1)&&(a+="<div style='color:#ffb64c;max-height:300px;overflow:hidden;overflow-y:auto;'>"+b+"."+$scope.intentDetail.errorModels[c].detail+"</div>");$scope.intentDetail.errorModelStr=a}else $scope.intentDetail.errorModelStr="";setTimeout(function(){$('[data-toggle="popover"]').popover()},500)},deleteBlankParaFunc=function(a){for(var b in a)0==$.trim(a[b]).length&&a.splice(b,1);return a};$scope.addIntentDetailFunc=function(){if(!$scope.isSaveSuccess)return!1;$scope.isSaveSuccess=!1,$scope.response.outputs=$scope.wechatOutputs.concat($scope.localOutouts);var a=$scope.intentDetail;a=deleteEmptyParametersFunc(a),a.speech||(a.speech=[]);for(var b in $scope.mediaResponseList){var c=!1;for(var d in a.speech)a.speech[d]==$scope.mediaResponseList[b].text&&(c=!0);c||a.speech.push($scope.mediaResponseList[b].text)}a.templates=deleteBlankParaFunc(a.templates),$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+$stateParams.scenes_id+"/intent",data:JSON.stringify(a),traditional:!0,headers:{"Content-Type":"application/json"},method:"POST",success:function(a){if(addEmptyParametersFunc($scope.intentDetail),$scope.getMediaResponseFunc(!1),a=dataParse(a),0==a.code){callAgentReloadTestFunc();var b={},c={};a.result.validateResult?(b=a.result.validateResult,c=a.result.intent):c=a.result,$.trace("意图创建成功","success"),$rootScope.$apply(),$scope.intentDetail.id=c.id,$scope.intentDetail.intentStatus=c.intentStatus,$scope.intentDetail.errorModels=c.errorModels,$scope.intentDetail.scenarioId=c.scenarioId;var d=angular.element(".center-list-box").scope().intentList;d&&d.length>0||(d=new Array),validateIntentDetailFunc(),d.unshift($scope.intentDetail),intentDetailDuplicate=JSON.stringify($scope.intentDetail),angular.element(".center-list-box").scope().intentList=d,angular.element(".center-list-box").scope().intentCount=angular.element(".center-list-box").scope().intentCount+1,angular.element(".center-list-box").scope().getIntentCountFunc(function(){angular.element(".center-list-box").scope().setPagingCountFunc()}),$scope.$apply(),setTimeout(function(){dataEditedFlag=!1},1e3),setTimeout(function(){$(".intent-name").focus(),setTimeout(function(){$(".intent-name").select()},200)},200),window.location.href="#/intent_list/"+$stateParams.scenes_id+"/intent_detail/"+$scope.intentDetail.id}else 2==a.code?goIndex():a.msg.indexOf("already exists")>-1?createIntentCommonFunc():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error");$scope.isSaveSuccess=!0},error:function(){addEmptyParametersFunc($scope.intentDetail),$.trace("意图创建失败")}})},$scope.updateIntentDetailFunc=function(){if(!$scope.isSaveSuccess)return!1;$scope.isSaveSuccess=!1,$scope.isExits&&$scope.wechatOutputs[0].length>1&&($scope.wechatOutputs[0].pop(),$scope.isExits=!1),$scope.isExits&&$scope.localOutouts[0].length>1&&($scope.localOutouts[0].pop(),$scope.isExits=!1),$scope.response.outputs=$scope.wechatOutputs.concat($scope.localOutouts);var a=$scope.intentDetail;a.speech||(a.speech=[]);for(var b in $scope.mediaResponseList){var c=!1;for(var d in a.speech)a.speech[d]==$scope.mediaResponseList[b].text&&(c=!0);c||a.speech.push($scope.mediaResponseList[b].text)}a=deleteEmptyParametersFunc(a),a.templates=deleteBlankParaFunc(a.templates),$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+$stateParams.scenes_id+"/intent/"+$scope.intentDetail.id,data:JSON.stringify(a),traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(a){if(addEmptyParametersFunc($scope.intentDetail),$scope.getMediaResponseFunc(!1),a=dataParse(a),0==a.code){callAgentReloadTestFunc();var b={},c={};a.result.validateResult?($(".save-and-apply .saveing").css("display","none"),$(".save-and-apply .saveing").css("width","0"),$(".save-and-apply .saveing").css("display","block"),$(".save-and-apply .save-text").text("保存并应用"),$(".save-and-apply .dim-div").css("display","none"),b=a.result.validateResult,c=a.result.intent,$.trace(b.message+"("+b.detail+")")):(c=a.result,setTimeout(function(){$(".save-and-apply .save-text").text("保存成功","success"),$(".save-and-apply .saveing").css("display","none"),$(".save-and-apply .saveing").css("width","0"),setTimeout(function(){$(".save-and-apply .saveing").css("display","block")},1e3),setTimeout(function(){$(".save-and-apply .save-text").text("保存并应用"),$(".save-and-apply .dim-div").css("display","none")},500)},1e3)),$scope.intentDetail=c;var d=angular.element(".center-list-box").scope().intentList;for(var e in d)if(d[e].id==$scope.intentDetail.id){validateIntentDetailFunc(),d[e]=$scope.intentDetail;break}intentDetailDuplicate=JSON.stringify($scope.intentDetail),angular.element(".center-list-box").scope().intentList=d,$scope.$apply(),angular.element(".center-list-box").scope().$apply(),setTimeout(function(){$("[data-act=nav-intent-"+$stateParams.intent_id+"]").siblings().removeClass("active"),$("[data-act=nav-intent-"+$stateParams.intent_id+"]").addClass("active")},20),dataEditedFlag=!1}else 2==a.code?goIndex():a.msg&&($(".save-and-apply .saveing").css("display","none"),$(".save-and-apply .saveing").css("width","0"),$(".save-and-apply .saveing").css("display","block"),$(".save-and-apply .save-text").text("保存并应用"),$(".save-and-apply .dim-div").css("display","none"),$.trace(a.msg+"( "+a.detail+" )","error"));$scope.isSaveSuccess=!0},error:function(){addEmptyParametersFunc($scope.intentDetail),$.trace("意图保存失败")}})},$scope.checkRequiredParaments=function(a){return $scope.intentDetail.name.length<=0?($.trace("请输入意图名称"),$(".intent-name").focus(),!1):void(a&&a())},$scope.saveIntentDetailFunc=function(){navigator.onLine?setTimeout(function(){"block"!=$(".save-and-apply .dim-div").css("display")&&$scope.checkRequiredParaments(function(){$(".save-and-apply .dim-div").css("display","block"),$(".save-and-apply .save-text").text("保存中..."),$(".save-and-apply .saveing").css("width","90px"),$scope.intentDetail.responses=new Array,($scope.response.action||$scope.response.affectedContexts||$scope.response.parameters)&&$scope.intentDetail.responses.push($scope.response),$scope.intentDetail.appId=appId,$scope.intentDetail.scenarioId=$stateParams.scenes_id,$scope.intentDetail.id&&$scope.intentDetail.id.length>0?$scope.updateIntentDetailFunc():$scope.addIntentDetailFunc()})},200):$.trace("您当前处于离线状态，保存意图失败！")};var createIntentProcessObjectFunc=function(a,b){var c=new Object;return c.dataType=b,c.defaultValue="",c.name=a,c.prompts=[],c.required=!1,c.value="$"+a,c};$(".max-modal").on("click",function(a){$(".user-says-input").each(function(a,b){b===document.activeElement&&("user-sya-add"===$(b).attr("data-act")||"user-sys-update"===$(b).attr("data-act"))&&b.blur()}),$(".input-weixin").each(function(a,b){b===document.activeElement&&b.blur()}),$(".input-local").each(function(a,b){b===document.activeElement&&b.blur()})}),$scope.addTemplateFunc=function(a,b,c,d){$(a.target);setTimeout(function(){if(isAtStatus)return isAtStatus=!1,!1;if(b=$(a.target).text().trim(),!(b&&0!=$.trim(b).length||13==a.keyCode||($(a.target).append('<div class="usersay-placeholder">请输入用户说</div>'),0===c||c)))return!1;setTimeout(function(){$(a.target).html(b)},2);var e,f;if($scope.intentDetail.templates){for(var e in $scope.intentDetail.templates)if(e!=c&&$.trim($scope.intentDetail.templates[e])==$.trim(b))return $.trace("此用户说已经存在，重复的只会保存一条"),!1;var f=!1;for(var e in $scope.intentDetail.templates)e==c&&($scope.intentDetail.templates[e]!==b&&(dataEditedFlag=!0,$scope.intentDetail.templates[e]=b),f=!0);f||($scope.intentDetail.templates.push(b),dataEditedFlag=!0)}else console.log("fal"),$scope.intentDetail.templates=new Array,$scope.intentDetail.templates.push(b);$scope.$apply(),$('[data-toggle="tooltip"]').tooltip(),"add"==d&&setTimeout(function(){$(a.target).html(""),$scope.userSayFlag=!0,$scope.$apply()},20)},20)},$scope.addTemplateKeydownFunc=function(a,b,c,d){var e=$(a.target);return 13==a.keyCode?($scope.addTemplateFunc(a,b,c,d),e.parent().next().children().eq(0).focus(),!1):void 0},$scope.deleteTemplateFunc=function(a){dataEditedFlag=!0;for(var b in $scope.intentDetail.templates)if(b==a){$scope.intentDetail.templates.splice(b,1);break}},$scope.copyTemplateFunc=function(a){console.log("cizhilou"),dataEditedFlag=!0;for(var b in $scope.intentDetail.templates)if($scope.intentDetail.templates[b]==a+"(副本)")return $.trace("此用户说副本已经存在"),!1;$scope.intentDetail.templates.push(a+"(副本)")},$scope.addInputIntentTagFunc=function(a){isContainSpacesFunc(a)||a&&$.trim(a).length>0&&($scope.intentDetail.contexts||($scope.intentDetail.contexts=new Array),$scope.intentDetail.contexts.push(a),$scope.addInputIntentTag="",dataEditedFlag=!0)},$scope.addInputIntentTagKeydownFunc=function(a,b){13==a.keyCode&&$scope.addInputIntentTagFunc(b)},$scope.deleteInputIntentTagFunc=function(a){
for(var b in $scope.intentDetail.contexts)$scope.intentDetail.contexts[b]==a&&($scope.intentDetail.contexts.splice(b,1),dataEditedFlag=!0)},$scope.addAffectedContextFunc=function(a){if(!isContainSpacesFunc(a)&&a&&$.trim(a).length>0){var b=new Object;b.lifespan=1,b.name=a,$scope.response.affectedContexts||($scope.response.affectedContexts=new Array),$scope.response.affectedContexts.push(b),$scope.addAffectedContext="",dataEditedFlag=!0}},$scope.addAffectedContextKeydownFunc=function(a,b){13==a.keyCode&&$scope.addAffectedContextFunc(b)},$scope.deleteAffectedContextFunc=function(a){for(var b in $scope.response.affectedContexts)if($scope.response.affectedContexts[b].name==a){$scope.response.affectedContexts.splice(b,1),dataEditedFlag=!0;break}},$scope.addSpechFunc=function(a,b){if(!a||$.trim(a).length<=0)return!1;if($scope.intentDetail.speech){var c=!1;for(var d in $scope.intentDetail.speech)d==b&&($scope.intentDetail.speech[d]=a,c=!0);c||$scope.intentDetail.speech.push(a)}else $scope.intentDetail.speech=new Array,$scope.intentDetail.speech.push(a);$scope.addSpeech=""},$scope.addSpechKeydownFunc=function(a,b,c){13==a.keyCode&&$scope.addSpechFunc(b,c)},$scope.deleteSpechFunc=function(a){for(var b in $scope.intentDetail.speech)if($scope.intentDetail.speech[b]==a){$scope.intentDetail.speech.splice(b,1);break}},$scope.copySpechFunc=function(a){$scope.intentDetail.speech.push(a)},$scope.addParamentRequiredFunc=function(a,b){if(a&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].required=a;else{var c=new Object;c.required=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.required=a,$scope.response.parameters.push(c)}dataEditedFlag=!0,$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue="")}},$scope.addParamentNameFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].name=a;else{var c=new Object;c.name=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.name=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.addParamentValueFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].value=a;else{var c=new Object;c.value=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.value=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.addParamentDataTypeFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].dataType=a;else{var c=new Object;c.dataType=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.dataType=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.addParamentDefaultValueFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].defaultValue=a;else{var c=new Object;c.defaultValue=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.defaultValue=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.deleteParamentFunc=function(a){for(var b in $scope.response.parameters)if(b==a){$scope.response.parameters.splice(b,1),dataEditedFlag=!0;break}},$scope.copyParamentFunc=function(a){var b={},c={};for(var d in $scope.response.parameters)if(d==a){c=$scope.response.parameters[d];break}b.dataType=c.dataType,b.defaultValue=c.defaultValue,b.name=c.name;var e=[];for(var d in c.prompts)e.push(c.prompts[d]);b.prompts=e,b.required=c.required,b.value=c.value;var f=$scope.response.parameters.length-2;dataEditedFlag=!0,$scope.response.parameters.splice(f,0,b)},$scope.editPromptsList=function(a){$scope.response.parameters[a].prompts?$scope.prompts=$scope.response.parameters[a].prompts:$scope.prompts=new Array,$scope.promptIndex=a},$scope.promptSubmit=function(){$("#addPrompts").modal("hide")},$scope.check=function(a){console.log(1),$(a.target).scroll(function(){$(a.target).css("height",$(this)[0].scrollHeight)})},$scope.addPromptFunc=function(a,b){var c=$(b.target);c.next().css("visibility","visible"),c.nextAll(".copy-prompt").css("visibility","visible");var d=$(b.target).val()||$(b.target).text();setTimeout(function(){if(!d||$.trim(d).length<=0)return!1;if($scope.prompts){var b=!1;for(var c in $scope.prompts)c==a&&($scope.prompts[c]=d,b=!0);b||$scope.prompts.push(d)}else $scope.prompts=new Array,$scope.prompts.push(d);dataEditedFlag=!0,$scope.addPromptValue="",$scope.$apply()},200)},$scope.hideOprationIcon=function(a){var b=$(a.target);b.next().css("visibility","hidden"),b.nextAll(".copy-prompt").css("visibility","hidden")},$scope.calcuteHeight=function(a){var b=$(a.target);setTimeout(function(){var a=b.height();a>=60?(b.next().css("top","30px"),b.nextAll(".copy-prompt").css("top","30px")):a>=40?(b.next().css("top","20px"),b.nextAll(".copy-prompt").css("top","20px")):a>=20&&(b.next().css("top","10px"),b.nextAll(".copy-prompt").css("top","10px"))},100)},$scope.addPromptKeydownFunc=function(a,b,c){13==a.keyCode&&$scope.addPromptFunc(c,a)},$("#addPrompts").on("hidden.bs.modal",function(){$scope.response.parameters&&$scope.response.parameters[$scope.promptIndex]&&($scope.response.parameters[$scope.promptIndex].prompts=$scope.prompts)}),$scope.deletePromptFunc=function(a){for(var b in $scope.prompts)if(b==a){$scope.prompts.splice(b,1);break}},$scope.copyPromptFunc=function(a,b){var c=$(b.target).parent().find(".prompt-item").text()+"(副本)";$scope.prompts.push(c)},$scope.setPriorityFunc=function(a){dataEditedFlag=!0,$scope.intentDetail.priority=a},$("body").off("click","[data-act=showMoreTemplate] label").on("click","[data-act=showMoreTemplate] label",function(a){var b=$(this);"glyphicon glyphicon-triangle-bottom"==b.siblings("i").attr("class")?$scope.userSayFlag=!0:$scope.userSayFlag=!1,$scope.$apply()}),$("body").off("click","[data-act=learnLevel]").on("click","[data-act=learnLevel]",function(){var a=$(this),b=a.attr("class"),c=$("[data-act=learn-level-bar]");b.indexOf("CLOSE")>-1?(c.css("width","0%"),$("ul > .LOW i").removeClass("active"),$("ul > .MIDDLE i").removeClass("active"),$("ul > .HIGH i").removeClass("active"),$scope.intentDetail.mlLevel="CLOSE"):b.indexOf("LOW")>-1?(c.css("width","34%"),$("ul > .CLOSE i").addClass("active"),$("ul > .LOW i").addClass("active"),$("ul > .MIDDLE i").removeClass("active"),$("ul > .HIGH i").removeClass("active"),$scope.intentDetail.mlLevel="LOW"):b.indexOf("MIDDLE")>-1?(c.css("width","68%"),$("ul > .CLOSE i").addClass("active"),$("ul > .LOW i").addClass("active"),$("ul > .MIDDLE i").addClass("active"),$("ul > .HIGH i").removeClass("active"),$scope.intentDetail.mlLevel="MIDDLE"):b.indexOf("HIGH")>-1&&(c.css("width","100%"),$("ul > .CLOSE i").addClass("active"),$("ul > .LOW i").addClass("active"),$("ul > .MIDDLE i").addClass("active"),$("ul > .HIGH i").addClass("active"),$scope.intentDetail.mlLevel="HIGH")}),$scope.learnLevelFunc=function(a){a?$scope.intentDetail.mlLevel="MIDDLE":$scope.intentDetail.mlLevel="CLOSE"};var setLearnLevelFunc=function(){"CLOSE"==$scope.intentDetail.mlLevel?$scope.mlLevel=!1:$scope.mlLevel=!0};$scope.getMediaListFunc=function(a,b,c,d){$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+a,data:{start:b,limit:c},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&d&&d(a.result.item):2==a.code&&goIndex()}})},$rootScope.newsList=null,$rootScope.imageObjList=null,$rootScope.voiceList=null,$rootScope.videoList=null,$scope.loadMaterialFunc=function(a,b){var c=10;"news"==a?$rootScope.newsList||(c=$scope.newsPageSize,$scope.getMediaListFunc(a,0,c,b)):"image"==a?$rootScope.imageObjList||(c=$scope.imagePageSize,$scope.getMediaListFunc(a,0,c,b)):"voice"==a?$rootScope.voiceList||(c=$scope.voicePageSize,$scope.getMediaListFunc(a,0,c,b)):"video"==a&&($rootScope.videoList||(c=$scope.videoPageSize,$scope.getMediaListFunc(a,0,c,b)))},$scope.loadNewsFunc=function(){$scope.loadMaterialFunc("news",function(a){$rootScope.newsList=a,$scope.$apply()})},$scope.loadImageFunc=function(){$scope.loadMaterialFunc("image",function(a){$rootScope.imageObjList=a,$scope.$apply()})},$scope.loadVoiceFunc=function(){$scope.loadMaterialFunc("voice",function(a){$rootScope.voiceList=a;for(var b in $rootScope.voiceList)$rootScope.voiceList[b].selected=!1;$scope.$apply()})},$scope.loadVideoFunc=function(){$scope.loadMaterialFunc("video",function(a){$rootScope.videoList=a;for(var b in $rootScope.videoList)$rootScope.videoList[b].selected=!1;$scope.$apply()})},$scope.wechatMediaSetFunc=function(a,b){if($scope.currentWechatParentIndex=a,$scope.currentWechatIndex=b,$("#mediaResponseModal").modal("show"),-1!=a){var c=$scope.wechatOutputs[a][b];switch(c.type){case"wechat.image":$("#weixin-customize-image-chosen").trigger("click"),$("#weixin-customize-image-name").val(c.property.title),$("#weixin-customize-image-url").val(c.property.image_url);break;case"wechat.music":$("#weixin-customize-music-chosen").trigger("click"),$("#weixin-customize-music-name").val(c.property.title),$("#weixin-customize-music-abstract").val(c.property.description),$("#weixin-customize-music-url").val(c.property.music_url);break;case"wechat.voice":$("#weixin-customize-voice-chosen").trigger("click"),$("#weixin-customize-voice-name").val(c.property.title),$("#weixin-customize-voice-url").val(c.property.media_id);break;case"wechat.video":$("#weixin-customize-video-chosen").trigger("click"),$("#weixin-customize-video-name").val(c.property.title),$("#weixin-customize-video-url").val(c.property.media_id);break;case"wechat.news":$("#weixin-customize-news-chosen").trigger("click");for(var d=0;d<c.list.length;d++)d>$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").length-1&&$(".add-customize-news").trigger("click"),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-name").val(c.list[d].title),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-abstract").val(c.list[d].description),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-url").val(c.list[d].pic_url),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-jumpto").val(c.list[d].url)}}else $("#mediaResponseModal #myTab-media").children().eq(0).children("a").trigger("click"),resetCustomize()};var resetCustomize=function(){if($(".customize-body").find(".customize-news-body"))for(var a=0,b=$(".customize-body").find(".customize-news-body").children().length;b>a;a++)a>0&&$(".customize-body").find(".customize-news-body").children().eq(a).remove();$(".customize-body").find(".form-control").val("")};$scope.newsObjectClickFunc=function(a){for(var b in $rootScope.newsList)$rootScope.newsList[b].media_id==a?$rootScope.newsList[b].selected=!0:$rootScope.newsList[b].selected=!1},$scope.imageObjectClickFunc=function(a){for(var b in $rootScope.imageObjList)$rootScope.imageObjList[b].media_id==a?$rootScope.imageObjList[b].selected=!0:$rootScope.imageObjList[b].selected=!1},$scope.voiceObjectClickFunc=function(a){for(var b in $rootScope.voiceList)$rootScope.voiceList[b].media_id==a?$rootScope.voiceList[b].selected=!0:$rootScope.voiceList[b].selected=!1},$scope.videoObjectClickFunc=function(a){for(var b in $rootScope.videoList)$rootScope.videoList[b].media_id==a?$rootScope.videoList[b].selected=!0:$rootScope.videoList[b].selected=!1},$scope.setMediaSubmitFunc=function(){var a=$(".choose-media-response.active"),b=a.attr("data-type"),c={};switch(b){case"wechat.news":dataEditedFlag=!0;for(var d in $rootScope.newsList)if($rootScope.newsList[d].selected){c=createOutputObjectFunc(b,$rootScope.newsList[d].content.news_item[0].title,"",$rootScope.newsList[d].media_id);break}break;case"wechat.image":dataEditedFlag=!0;for(var d in $rootScope.imageObjList)if($rootScope.imageObjList[d].selected){c=createOutputObjectFunc(b,$rootScope.imageObjList[d].name,"",$rootScope.imageObjList[d].media_id);break}break;case"wechat.voice":dataEditedFlag=!0;for(var d in $rootScope.voiceList)if($rootScope.voiceList[d].selected){c=createOutputObjectFunc(b,$rootScope.voiceList[d].name,"",$rootScope.voiceList[d].media_id);break}break;case"wechat.video":dataEditedFlag=!0;for(var d in $rootScope.videoList)if($rootScope.videoList[d].selected){c=createOutputObjectFunc(b,$rootScope.videoList[d].name,"",$rootScope.videoList[d].media_id);break}break;case"wechat.customize":dataEditedFlag=!0;var e=$(".customize-body .active"),f=e.attr("id");if("weixin-customize-image-detail"==f){var g=$("#weixin-customize-image-name").val(),h=$("#weixin-customize-image-url").val();c=createOutputObjectFunc("wechat.image",g,h,"")}else if("weixin-customize-music-detail"==f){var g=$("#weixin-customize-music-name").val(),h=$("#weixin-customize-music-url").val(),i=$("#weixin-customize-music-abstract").val();c=createOutputObjectFunc("wechat.music",g,h,"",i)}else if("weixin-customize-voice-detail"==f){var g=$("#weixin-customize-voice-name").val(),j=$("#weixin-customize-voice-url").val();c=createOutputObjectFunc("wechat.voice",g,"",j)}else if("weixin-customize-video-detail"==f){var g=$("#weixin-customize-video-name").val(),j=$("#weixin-customize-video-url").val();c=createOutputObjectFunc("wechat.video",g,"",j)}else if("weixin-customize-news-detail"==f){for(var k=$("#weixin-customize-news-detail .customize-news-body").children().length,l=new Array,d=0;k>d;d++){l[d]=new Object;var m=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-name").val(),n=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-url").val(),i=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-abstract").val(),h=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-jumpto").val();l[d].title=m,l[d].pic_url=n,l[d].description=i,l[d].url=h}c=createOutputObjectFunc("wechat.news","","","","",l)}}createOrUpdateOutputsWechatFunc(c),$("#mediaResponseModal").modal("hide")},$scope.mediaDeleteFunc=function(a){for(var b in $scope.mediaResponseList)if($scope.mediaResponseList[b].mediaId==a){$scope.mediaResponseList.splice(b,1);break}},$scope.mediaPreviewFunc=function(a){},$rootScope.newsLoadPageId=1,$rootScope.newsLoadMoreBox=!0,$(".news-box").on("scroll",function(a){var b="news",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.newsLoadMoreBox&&($rootScope.newsLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.newsLoadPageId*$scope.newsPageSize,limit:$scope.newsPageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.newsList.push(b[c]);$rootScope.newsLoadPageId++,$rootScope.newsLoadMoreBox=!0,$scope.$apply()}else $rootScope.newsLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$rootScope.imageObjLoadPageId=1,$rootScope.imageObjLoadMoreBox=!0,$(".image-box").on("scroll",function(a){var b="image",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.imageObjLoadMoreBox&&($rootScope.imageObjLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.imageObjLoadPageId*$scope.imagePageSize,limit:$scope.imagePageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.imageObjList.push(b[c]);$rootScope.imageObjLoadPageId++,$rootScope.imageObjLoadMoreBox=!0,$scope.$apply()}else $rootScope.imageObjLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$rootScope.voiceLoadPageId=1,$rootScope.voiceLoadMoreBox=!0,$(".voice-box").on("scroll",function(a){var b="voice",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.voiceLoadMoreBox&&($rootScope.voiceLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.voiceLoadPageId*$scope.voicePageSize,limit:$scope.voicePageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.voiceList.push(b[c]);$rootScope.voiceLoadPageId++,$rootScope.voiceLoadMoreBox=!0,$scope.$apply()}else $rootScope.voiceLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$rootScope.videoLoadPageId=1,$rootScope.videoLoadMoreBox=!0,$(".video-box").on("scroll",function(a){var b="video",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.videoLoadMoreBox&&($rootScope.videoLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.videoLoadPageId*$scope.videoPageSize,limit:$scope.videoPageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.videoList.push(b[c]);$rootScope.videoLoadPageId++,$rootScope.videoLoadMoreBox=!0,$scope.$apply()}else $rootScope.videoLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$("[data-act=change-media]").click(function(){var a=$(this),b=a.attr("href");"#weixin-news"==b?$scope.loadNewsFunc():"#weixin-image"==b?$scope.loadImageFunc():"#weixin-voice"==b?$scope.loadVoiceFunc():"#weixin-video"==b&&$scope.loadVideoFunc()}),$("[data-act=change-customize]").click(function(){var a=$(this),b=a.attr("href");$("#weixin-customize").addClass("in active").siblings().removeClass("in active"),$("#customize").addClass("in active").siblings().removeClass("in active"),$(b).addClass("active").show().siblings().removeClass("active").hide(),$(this).parents(".dropdown-menu-customize").siblings(".customize").text(a.text()),$(".customize").parent().addClass("active").siblings().removeClass("active")}),$('[data-toggle="popover"]').click(function(){var a=$(this),b=$(".popover-content");setTimeout(function(){b.attr("class")||a.popover("show")},200)}),$("body").off("keyup","[data-act=intent-detail-title]").on("keyup","[data-act=intent-detail-title]",function(a){$(this);13==a.keyCode&&$("[data-act=user-sya-add]").focus()}),$("body").off("keyup","[data-act=tab-help]").on("keyup","[data-act=tab-help]",function(a){var b=$(this);13==a.keyCode&&b.parent().next().children().eq(0).focus()}),$("body").off("keyup","[data-act=user-intent-dataType-update]").on("keyup","[data-act=user-intent-dataType-update]",function(a){var b=$(this);13==a.keyCode&&b.parent().next().next().find("input").focus()}),$("body").off("keyup","[data-act=user-intent-defaultValue-update]").on("keyup","[data-act=user-intent-defaultValue-update]",function(a){var b=$(this);13==a.keyCode&&b.parent().parent().next().children().eq(0).find("input").focus()}),$(".user-say-templates").sortable({items:".sortable-li",cancel:".delete,.copy,.user-says-input"}),$(".user-say-templates").sortable({stop:function(a,b){var c=[],d=$(".user-says-input");$.each(d,function(a,b){var d=$(b);d.attr("data-template")&&"undefined"!=d.attr("data-template")&&c.push(d.attr("data-template"))}),$scope.intentDetail.templates=c,$scope.$apply()}}),$("body").off("focus",".user-says-input").on("focus",".user-says-input",function(){var a=$(this);a.parent().find(".drop").css("visibility","hidden"),a.parent().find(".edit").css("visibility","hidden"),a.parent().find(".copy").css("visibility","hidden"),a.parent().find(".delete").css("visibility","hidden"),setTimeout(function(){a.find(".usersay-placeholder").remove()},20)}),$("body").off("blur",".user-says-input").on("blur",".user-says-input",function(){var a=$(this);a.parent().find(".drop").css("visibility","visible"),a.parent().find(".edit").css("visibility","visible"),a.parent().find(".copy").css("visibility","visible"),a.parent().find(".delete").css("visibility","visible")}),$scope.addResListTemp=[],$scope.resType="image";var loadpre="pre",loadnext="next",pageSize=20,initStyle=function(){$(".resource-manager .image-box").css("height",document.documentElement.clientHeight-290);var a=$(".image-box-ul").css("width");if(a){a=a.replace("px",""),a=+a;var b=parseInt(a/186);$("#image .reource-operation").css("width",186*b)}};$(window).resize(function(){initStyle()}),initStyle(),$('a[data-toggle="tab"]').on("shown.bs.tab",function(a){var b=$(a.target).text();"图片"==$.trim(b)?(initStyle(),$scope.resType="image",$scope.resImgList&&0!=$scope.resImgList.length||$scope.loadResourceFunc(0,20,$scope.loadResourceListFunc)):"音频"==$.trim(b)?($scope.resType="voice",$scope.resVoiceList&&0!=$scope.resVoiceList.length||$scope.loadResourceFunc(0,30,$scope.loadResourceListFunc)):"视频"==$.trim(b)?($scope.resType="video",$scope.resVideoList&&0!=$scope.resVideoList.length||$scope.loadResourceFunc(0,30,$scope.loadResourceListFunc)):"自定义"==$.trim(b)&&($scope.resType="customize",$scope.resVideoList&&0!=$scope.resVideoList.length||$scope.loadResourceFunc(0,30,$scope.loadResourceListFunc)),$scope.$apply()}),$scope.loadImage=function(){$.ajax({url:ruyiai_host+"/ruyi-ai/save/"+appId+"/multimedia",data:{mediaType:$scope.resType,liststr:JSON.stringify($scope.addResListTemp)},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0&&$scope.loadResourceListFunc(a.result,loadpre):a&&2==a.code&&goIndex(),$scope.addResListTemp=[],$scope.$apply()}})},$scope.loadResourceListFunc=function(a,b){if(a&&a.length){switch($scope.resType){case"image":if($scope.resImgList)for(var c in a)b==loadpre?$scope.resImgList.unshift(a[c]):b==loadnext&&$scope.resImgList.push(a[c]);else $scope.resImgList=a;break;case"voice":if($scope.resVoiceList)for(var c in a)b==loadpre?$scope.resVoiceList.unshift(a[c]):b==loadnext&&$scope.resVoiceList.push(a[c]);else $scope.resVoiceList=a;break;case"video":if($scope.resVideoList)for(var c in a)b==loadpre?$scope.resVideoList.unshift(a[c]):b==loadnext&&$scope.resVideoList.push(a[c]);else $scope.resVideoList=a}$scope.$apply()}},$scope.loadResourceFunc=function(a,b,c){$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:a,size:b},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&c&&c(a.result,loadpre):a&&2==a.code&&goIndex()}})},$scope.loadResourceFunc(0,20,$scope.loadResourceListFunc);var $imgLoadMoreBox=!0;$("[data-act=image-box]").on("scroll",function(a){var b=$(this),c=b[0].scrollTop,d=b[0].scrollHeight,e=b.height();c>=d-e-45&&1==$imgLoadMoreBox&&($imgLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:$scope.resImgList[$scope.resImgList.length-1].createTime,size:pageSize},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0?($scope.loadResourceListFunc(a.result,loadnext),$imgLoadMoreBox=!0,$scope.$apply()):$imgLoadMoreBox=!1:2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))});var deleteResourceFunc=function(a){var b="";for(var c in a)b+=a[c]+",";$.ajax({url:ruyiai_host+"/ruyi-ai/delete/"+appId+"/multimedia",data:{listid:b},method:"GET",success:function(b){if(b=dataParse(b),0==b.code){for(var c in a)if("image"==$scope.resType)for(var d in $scope.resImgList)a[c]==$scope.resImgList[d].id&&$scope.resImgList.splice(d,1);else if("voice"==$scope.resType)for(var d in $scope.resVoiceList)a[c]==$scope.resVoiceList[d].id&&$scope.resVoiceList.splice(d,1);else if("video"==$scope.resType)for(var d in $scope.resVideoList)a[c]==$scope.resVideoList[d].id&&$scope.resVideoList.splice(d,1);$scope.$apply()}else 2==b.code?goIndex():b.msg&&$.trace(b.msg+"( "+b.detail+" )","error")}})};$("body").off("click",".image-operation .delete").on("click",".image-operation .delete",function(a){var b=$(this),c=b.closest(".image-operation").attr("data-id"),d=b.closest(".image-operation").attr("data-title");$.confirm({text:'你确定要删除"'+d+'"吗？',title:"删除",ensureFn:function(){var a=[c];deleteResourceFunc(a)}})}),$("body").off("click",".image-operation .edit").on("click",".image-operation .edit",function(a){var b=$(this),c=b.closest(".image-operation").attr("data-id"),d=b.closest(".image-operation").attr("data-title");$("#updateResource").modal("show"),$("[data-act=resource-name]").val(d),$("[data-act=resource-id]").val(c)}),$("body").off("keydown","[data-act=resource-name]").on("keydown","[data-act=resource-name]",function(a){$(this);13==a.keyCode&&$("[data-act=submit-rename-resource]").trigger("click")}),$("#updateResource").on("shown.bs.modal",function(){$("[data-act=resource-name]").focus()}),$("body").off("click","[data-act=submit-rename-resource]").on("click","[data-act=submit-rename-resource]",function(a){var b=$("[data-act=resource-name]"),c=$("[data-act=resource-id]");0==$.trim(b.val()).length&&$.trace("资源名称不能为空"),$.ajax({url:ruyiai_host+"/ruyi-ai/update/"+appId+"/multimedia",data:{id:c.val(),name:b.val()},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){if("image"==$scope.resType){for(var b in $scope.resImgList)if(a.result&&$scope.resImgList[b].id==a.result.id){$scope.resImgList[b]=a.result;break}}else if("voice"==$scope.resType){for(var b in $scope.resVoiceList)if(a.result&&$scope.resVoiceList[b].id==a.result.id){$scope.resVoiceList[b]=a.result;break}}else if("video"==$scope.resType)for(var b in $scope.resVideoList)if(a.result&&$scope.resVideoList[b].id==a.result.id){$scope.resVideoList[b]=a.result;break}$scope.$apply(),$.trace("素材名称修改成功","success"),$("#updateResource").modal("hide")}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})}),$("body").off("click","[data-act=img-box-active]").on("click","[data-act=img-box-active]",function(a){var b=$(this),c=b.parent(".image-box-li"),d=c.attr("data-id");for(var e in $scope.resImgList)$scope.resImgList[e].id==d?$scope.resImgList[e].active?$scope.resImgList[e].active=!1:$scope.resImgList[e].active=!0:$scope.resImgList[e].active=!1;$scope.$apply()}),$("body").off("click","[data-act=all-choose]").on("click","[data-act=all-choose]",function(a){var b=$(this),c=b.find("input");if("image"==$scope.resType)if(c.is(":checked"))for(var d in $scope.resImgList)$scope.resImgList[d].active=!0;else for(var d in $scope.resImgList)$scope.resImgList[d].active=!1;else if("voice"==$scope.resType)if(c.is(":checked"))for(var d in $scope.resVoiceList)$scope.resVoiceList[d].active=!0;else for(var d in $scope.resVoiceList)$scope.resVoiceList[d].active=!1;else if("video"==$scope.resType)if(c.is(":checked"))for(var d in $scope.resVideoList)$scope.resVideoList[d].active=!0;else for(var d in $scope.resVideoList)$scope.resVideoList[d].active=!1;$scope.$apply()}),$("body").off("click","[data-act=all-delete]").on("click","[data-act=all-delete]",function(a){$.confirm({text:"你确定要批量删除所选素材吗？",title:"删除",ensureFn:function(){var a=($(this),0),b=[];if("image"==$scope.resType)for(var c in $scope.resImgList)$scope.resImgList[c].active&&(b.push($scope.resImgList[c].id),a++);else if("voice"==$scope.resType)for(var c in $scope.resVoiceList)$scope.resVoiceList[c].active&&(b.push($scope.resVoiceList[c].id),a++);else if("video"==$scope.resType)for(var c in $scope.resVideoList)$scope.resVideoList[c].active&&(b.push($scope.resVideoList[c].id),a++);0==a?$.trace("你未选择要删除的素材"):deleteResourceFunc(b)}})});var $voiceLoadMoreBox=!0;$("[data-act=voice-box]").on("scroll",function(a){var b=$(this),c=b[0].scrollTop,d=b[0].scrollHeight,e=b.height();c>=d-e-45&&1==$voiceLoadMoreBox&&($voiceLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:$scope.resVoiceList[$scope.resVoiceList.length-1].createTime,size:pageSize},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0?($scope.loadResourceListFunc(a.result,loadnext),$voiceLoadMoreBox=!0,$scope.$apply()):$voiceLoadMoreBox=!1:2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))});var $videoLoadMoreBox=!0;$("[data-act=video-box]").on("scroll",function(a){var b=$(this),c=b[0].scrollTop,d=b[0].scrollHeight,e=b.height();c>=d-e-45&&1==$videoLoadMoreBox&&($videoLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:$scope.resVideoList[$scope.resVideoList.length-1].createTime,size:pageSize},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0?($scope.loadResourceListFunc(a.result,loadnext),$imgLoadMoreBox=!0,$scope.$apply()):$imgLoadMoreBox=!1:2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$("body").off("click","#voice .delete,#video .delete").on("click","#voice .delete,#video .delete",function(a){var b=$(this),c=b.closest("tr").attr("data-id"),d=b.closest("tr").attr("data-title");$.confirm({text:'你确定要删除"'+d+'"吗？',title:"删除",ensureFn:function(){var a=[c];deleteResourceFunc(a)}})}),$("body").off("click","#voice .edit,#video .edit").on("click","#voice .edit,#video .edit",function(a){var b=$(this),c=b.closest("tr").attr("data-id"),d=b.closest("tr").attr("data-title");$("#updateResource").modal("show"),$("[data-act=resource-name]").val(d),$("[data-act=resource-id]").val(c)}),$("body").off("click","[name=local-choosed-voice]").on("click","[name=local-choosed-voice]",function(a){}),$scope.localResourceSetFunc=function(a,b){if($scope.currentWechatParentIndex=a,$scope.currentWechatIndex=b,$("#localResourceModal").modal("show"),-1!=a){var c=$scope.localOutouts[a][b];switch(c.type){case"image":$("#customize-image-chosen").trigger("click"),$("#customize-image-name").val(c.property.name),$("#customize-image-url").val(c.property.image_url);break;case"voice":$("#customize-voice-chosen").trigger("click"),$("#customize-voice-name").val(c.property.name),$("#customize-voice-url").val(c.property.voice_url);break;case"video":$("#customize-video-chosen").trigger("click"),$("#customize-video-name").val(c.property.name),$("#customize-video-url").val(c.property.video_url)}}else $("#localResourceModal #myTab-local").children().eq(0).children("a").trigger("click"),resetCustomize();setTimeout(function(){initStyle()},200)};var findResourceObjectById=function(a,b){
for(var c in a)if(a[c].id==b)return a[c]},findResourceObjectByActive=function(a){for(var b in a)if(a[b].active)return a[b]},createOrUpdateOutputsWechatFunc=function(a){var b=!1;for(var c in $scope.wechatOutputs)if(!b)for(var d in $scope.wechatOutputs[c])if(c==$scope.currentWechatParentIndex&&d==$scope.currentWechatIndex){b=!0,$scope.wechatOutputs[c]||($scope.wechatOutputs[c]=[]),$scope.wechatOutputs[c][d]=a;break}b||($scope.wechatOutputs[$scope.currentWechatIndex]||($scope.wechatOutputs[$scope.currentWechatIndex]=[]),$scope.wechatOutputs[$scope.currentWechatIndex].push(a)),$scope.$apply()},createOrUpdateOutputsLocalFunc=function(a){var b=!1;for(var c in $scope.localOutouts)if(!b)for(var d in $scope.localOutouts[c])if(c==$scope.currentWechatParentIndex&&d==$scope.currentWechatIndex){b=!0,$scope.localOutouts[c]||($scope.localOutouts[c]=[]),$scope.localOutouts[c][d]=a;break}b||($scope.localOutouts[$scope.currentWechatIndex]||($scope.localOutouts[$scope.currentWechatIndex]=[]),$scope.localOutouts[$scope.currentWechatIndex].push(a)),$scope.$apply()};$scope.localResourceSubFunc=function(){var a=$(".choose-response.active"),b=a.attr("data-type"),c={},d={};if("image"==b)dataEditedFlag=!0,c=findResourceObjectByActive($scope.resImgList),d=createOutputObjectFunc(c.type,c.title,c.url,"");else if("voice"==$scope.resType){dataEditedFlag=!0;var e=$("[name=local-choosed-voice]:checked"),f=e.closest("tr");c=findResourceObjectById($scope.resVoiceList,f.attr("data-id")),d=createOutputObjectFunc(c.type,c.title,c.url,"")}else if("video"==b){dataEditedFlag=!0;var e=$("[name=local-choosed-video]:checked"),f=e.closest("tr");c=findResourceObjectById($scope.resVideoList,f.attr("data-id")),d=createOutputObjectFunc(c.type,c.title,c.url,"")}else if("customize"==b){dataEditedFlag=!0;var g=$("#customize .video-box .customize-body .active"),h=g.attr("id");if("customize-image-detail"==h){var i=$("#customize-image-name").val(),j=$("#customize-image-url").val();d=createOutputObjectFunc("image",i,j,"")}else if("customize-voice-detail"==h){var i=$("#customize-voice-name").val(),j=$("#customize-voice-url").val();d=createOutputObjectFunc("voice",i,j,"")}else if("customize-video-detail"==h){var i=$("#customize-video-name").val(),j=$("#customize-video-url").val();d=createOutputObjectFunc("video",i,j,"")}}createOrUpdateOutputsLocalFunc(d),$("#localResourceModal").modal("hide")},$("body").off("click",".response-action").on("click",".response-action",function(a){a.stopPropagation();var b=$(this),c=b.closest(".response-group").find(".response-box");"0px"==c.css("height")?c.animate({height:"100%"}):c.animate({height:"0"})});var createOutputObjectFunc=function(a,b,c,d,e,f){var g=new Object;switch(g.type=a,g.property=new Object,a){case"dialog":g.property.text=b;break;case"wechat.text":g.property.text=b;break;case"image":g.property.name=b,g.property.image_url=c;break;case"wechat.image":g.property.name=b,g.property.title=b,g.property.media_id=d,g.property.image_url=c;break;case"voice":g.property.name=b,g.property.voice_url=c;break;case"wechat.voice":g.property.name=b,g.property.title=b,g.property.media_id=d;break;case"video":g.property.name=b,g.property.video_url=c;break;case"wechat.video":g.property.name=b,g.property.title=b,g.property.media_id=d;break;case"wechat.news":f&&f.length>0?(g.list=f,g.property.name=f[0].title):(g.property.name=b,g.property.title=b,g.property.media_id=d);break;case"wechat.music":g.property.name=b,g.property.title=b,g.property.music_url=c,g.property.description=e}return g},checkDialogObjectExists=function(a,b,c){var d=!1;if(a)for(var e in a)if(a[e]&&a[e].property.text==b&&a[e].type==c){d=!0;break}return d};$scope.addTextOutputWechatFunc=function(a,b,c,d,e){return checkIsChangeValue!=b&&(dataEditedFlag=!0),!b||$.trim(b).length<=0?!1:void setTimeout(function(){var a=createOutputObjectFunc(e,b,"",""),f=!1;for(var g in $scope.wechatOutputs)if(!f)for(var h in $scope.wechatOutputs[g])if(g==c&&h==d){f=!0,$scope.wechatOutputs[g]||($scope.wechatOutputs[g]=[]),$scope.wechatOutputs[g][h]=a;break}f||($scope.wechatOutputs[d]||($scope.wechatOutputs[d]=[]),checkDialogObjectExists($scope.wechatOutputs[d],b,e)?$("[data-act=outputText]").val()&&$("[data-act=outputText]").val().length>0&&$.trace("此机器人答已经存在，重复的只会保留一条"):($scope.wechatOutputs[d].push(a),$("[data-act=outputText]").val(""))),$scope.$apply(),$('[data-toggle="tooltip"]').tooltip()},200)};var deleteEmptyAssistantAnswerFunc=function(a,b,c,d){for(var e in a)for(var f in a[e])if(e==c&&f==d)return void a[e].splice(e,1)};$scope.addTextOutputLocalFunc=function(a,b,c,d,e){return console.log("parentIndex:"+c),console.log("index:"+d),console.log("outputText:"+b),checkIsChangeValue!=b&&(dataEditedFlag=!0),!b||$.trim(b).length<=0?(deleteEmptyAssistantAnswerFunc($scope.localOutouts,b,c,d),!1):(console.log("错了"),void setTimeout(function(){var a=createOutputObjectFunc(e,b,"",""),f=!1;for(var g in $scope.localOutouts)if(!f)for(var h in $scope.localOutouts[g])if(g==c&&h==d){f=!0,$scope.localOutouts[g]||($scope.localOutouts[g]=[]),$scope.localOutouts[g][h]=a;break}f||($scope.localOutouts[d]||($scope.localOutouts[d]=[]),checkDialogObjectExists($scope.localOutouts[d],b,e)?$("[data-act=outputText-local]").val()&&$("[data-act=outputText-local]").val().length>0&&$.trace("此机器人答已经存在，重复的只会保留一条"):($scope.localOutouts[d].push(a),$("[data-act=outputText-local]").val(""))),$scope.$apply(),$('[data-toggle="tooltip"]').tooltip()},200))},$scope.addTextOutputWechatKeydownFunc=function(a,b,c,d,e){13==a.keyCode&&$scope.addTextOutputWechatFunc(a,b,c,d,e)},$scope.addTextOutputLocalKeydownFunc=function(a,b,c,d,e){13==a.keyCode&&$scope.addTextOutputLocalFunc(a,b,c,d,e)},$scope.deleteOutputWechatFunc=function(a,b){setTimeout(function(){dataEditedFlag=!0;for(var c in $scope.wechatOutputs)for(var d in $scope.wechatOutputs[c])if(c==a&&d==b){$scope.wechatOutputs[c].splice(d,1);break}$scope.$apply()},200)},$scope.deleteOutputLocalFunc=function(a,b){setTimeout(function(){for(var c in $scope.localOutouts)for(var d in $scope.localOutouts[c])if(c==a&&d==b){$scope.localOutouts[c].splice(d,1),dataEditedFlag=!0;break}$scope.$apply()},200)},$scope.copyOutputWechatFunc=function(a,b){for(var c in $scope.wechatOutputs)for(var d in $scope.wechatOutputs[c])if(c==a&&d==b){var e=$scope.wechatOutputs[c][d],f={type:"wechat.text",property:{text:e.property.text+"(副本)"}};$scope.wechatOutputs[c].push(f),dataEditedFlag=!0;break}},$scope.copyOutputLocalFunc=function(a,b){for(var c in $scope.localOutouts)for(var d in $scope.localOutouts[c])if(c==a&&d==b){var e=$scope.localOutouts[c][d],f={type:"wechat.text",property:{text:e.property.text+"(副本)"}};$scope.localOutouts[c].push(f),dataEditedFlag=!0;break}},$scope.editUserSayTextarea=function(a){$("#editUserSayTextarea").modal("show"),$("#userSayTextarea").attr("myIndex",a),$("#userSayTextarea").val($scope.intentDetail.templates[a]),setTimeout(function(){$("#userSayTextarea").focus()},200)},$scope.editUserSayTextareaSubmitFunc=function(){var a=!1,b=$("#userSayTextarea"),c=b.val(),d=b.attr("myIndex");$scope.intentDetail.templates[d]!=b.val()&&(dataEditedFlag=!0),$($scope.intentDetail.templates).each(function(b,e){$.trim(c)===$.trim(e)&&(b!=d&&$.trace("此用户说已经存在，重复的只会保留一条"),$("[data-act=user-sys-update]").eq(d).text(c),a=!0)}),a||($scope.intentDetail.templates[d]=c),$("#editUserSayTextarea").modal("hide")};var assistantEditStatus="isEmpty",checkAssistantEditStatusFunc=function(a){var b="";return $("[data-act="+a+"]").each(function(){$.trim($(this).val()).length>0&&(b=$(this).val())}),assistantEditStatus=b?"notEmpty":"isEmpty",b};$scope.editOutputWechatFunc=function(a,b){var c=checkAssistantEditStatusFunc("outputText");$("#editWeixinTextarea").modal("show");var d=$("#weixinTextarea");if(d.attr("myIndex",b),d.attr("parentIndex",a),-1==b){if($("#editor-iframe-box-wechat").html('<iframe id="editor-iframe-wechat" name="editor-iframe-wechat" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),!c||0==c.length)return!1;d.val(c);var e=setInterval(function(){try{$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val(c),$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(a){}},20)}else{$("#editor-iframe-box-wechat").html('<iframe id="editor-iframe-wechat" name="editor-iframe-wechat" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),d.val($scope.wechatOutputs[a][b].property.text);var e=setInterval(function(){try{$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val($scope.wechatOutputs[a][b].property.text),$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(c){}},20)}},$scope.editOutputLocalFunc=function(a,b){var c=checkAssistantEditStatusFunc("outputText-local");console.log("outputTextLocal:"+c),$("#editLocalTextarea").modal("show");var d=$("#localTextarea");if(d.attr("myIndex",b),d.attr("parentIndex",a),-1==b){if($("#editor-iframe-box-local").html('<iframe id="editor-iframe-local" name="editor-iframe-local" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),!c||0==c.length)return!1;d.val(c);var e=setInterval(function(){try{$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val(c),$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(a){}},20)}else{$("#editor-iframe-box-local").html('<iframe id="editor-iframe-local" name="editor-iframe-local" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),d.val($scope.localOutouts[a][b].property.text);var e=setInterval(function(){try{$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val($scope.localOutouts[a][b].property.text),$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(c){}},20)}},$scope.wechatTextFilter=function(a){return"wechat.text"==a.type?!0:!1},$scope.wechatMediaFilter=function(a){return a.type.indexOf("wechat.")>-1&&"wechat.text"!=a.type?!0:!1},$scope.addMoreResponseFunc=function(a,b){var c=b.target.parentNode.getAttribute("data-type"),a=a||0,d="wechatOutputs",e="localOutouts";0!=a&&(d=d+"_"+a,e=e+"_"+a),console.log(d),console.log(e),"wechat"==c?$scope[d]?$scope[d].push([]):$scope[d]=[[]]:"local"==c&&($scope[e]?$scope[e].push([]):$scope[e]=[[]]),setTimeout(function(){$("[data-act=response-type].active").find(".response-box:last").css("height","100%")},200)},$("body").off("click","[data-act=delete-response-block]").on("click","[data-act=delete-response-block]",function(a){var b=$(this).attr("data-index"),c=$(this).attr("data-type");b=+b,a.stopPropagation(),$.confirm({text:"你确定要删除吗？",title:"删除",ensureFn:function(){dataEditedFlag=!0,"wechat"==c?$scope.wechatOutputs&&$scope.wechatOutputs.splice(b,1):"local"==c&&$scope.localOutouts&&$scope.localOutouts.splice(b,1),$scope.$apply()}})}),$scope.editWeixinTextareaSubmitFunc=function(){var a=!1,b=$("#weixinTextarea"),c=b.attr("parentIndex"),d=b.attr("myIndex"),e=$(window.frames["editor-iframe-wechat"].document).find("#editor_content_textarea").val();if(-1==d||"-1"==d){var f=createOutputObjectFunc("wechat.text",e,"","");dataEditedFlag=!0,"isEmpty"==assistantEditStatus?e&&$.trim(e).length>0&&($($scope.wechatOutputs[c]).each(function(b,c){$.trim(e)===$.trim(c.property.text)&&($.trace("此机器人答已经存在，重复的只会保留一条"),a=!0)}),a?$(".input-weixin").eq(d).val(e):$scope.wechatOutputs[c].push(f)):"notEmpty"==assistantEditStatus&&(console.log("not"),$scope.wechatOutputs[c][$scope.wechatOutputs[c].length-1]=f)}else b.val(e),$scope.wechatOutputs[c][d].property.text!=b.val()&&(dataEditedFlag=!0),$($scope.wechatOutputs[c]).each(function(a,b){b.property.text===e&&($.trace("此机器人答已经存在，重复的只会保留一条"),$scope.isExits=!0)}),$scope.wechatOutputs[c][d].property.text=e;$("#editWeixinTextarea").modal("hide")},$scope.editLocalTextareaSubmitFunc=function(){var a=$("#localTextarea"),b=a.attr("parentIndex"),c=a.attr("myIndex"),d=$(window.frames["editor-iframe-local"].document).find("#editor_content_textarea").val();if(-1==c||"-1"==c){var e=createOutputObjectFunc("dialog",d,"","");dataEditedFlag=!0,"isEmpty"==assistantEditStatus?d&&d.length>0&&($($scope.localOutouts[b]).each(function(a,b){$.trim(d)===$.trim(b.property.text)&&($.trace("此机器人答已经存在，重复的只会保留一条"),$scope.isExits=!0)}),$scope.isExits?$(".input-local").eq(c).val(d):$scope.localOutouts[b].push(e)):"notEmpty"==assistantEditStatus&&($scope.localOutouts[b][$scope.localOutouts[b].length-1]=e)}else a.val(d),$scope.localOutouts[b][c].property.text!=a.val()&&(dataEditedFlag=!0),$($scope.localOutouts[b]).each(function(a,b){$.trim(b.property.text)===$.trim(d)&&($.trace("此机器人答已经存在，重复的只会保留一条"),$scope.isExits=!0)}),$scope.localOutouts[b][c].property.text=a.val();$("#editLocalTextarea").modal("hide")},$scope.addNewsFunc=function(){var a="<div class='customize-news clearfix' style='margin-top: 20px;'><div class='form-group' style='margin-bottom: 0;'><div class='col-md-10  col-md-offset-1'><label>名称：</label><input autocomplete='off' style='border-radius: 0px; box-shadow: none; border-top: 1px solid rgba(0,0,0,0);border-right: 1px solid rgba(0,0,0,0);' type='text' required='required' class='form-control weixin-customize-news-name' placeholder='名称' /></div></div><div class='form-group' style='margin-bottom: 0;'><div class='col-md-10  col-md-offset-1'><label>摘要：</label><textarea style='border-radius: 0px; box-shadow: none; vertical-align: middle;border-right: 1px solid rgba(0,0,0,0);width:85%;max-width:85%;' required='required' class='form-control weixin-customize-news-abstract' placeholder='摘要'></textarea> </div></div><div class='form-group' style='margin-bottom: 25px;'><div class='col-md-10  col-md-offset-1'><label>封面URL：</label><input autocomplete='off' style='border-radius: 0px; box-shadow: none;border-right: 1px solid rgba(0,0,0,0);' type='text' required='required' class='form-control weixin-customize-news-url' placeholder='封面URL' /></div></div><div class='form-group' style='margin-bottom: 25px;'><div class='col-md-10  col-md-offset-1'><label>跳转链接：</label><input autocomplete='off' style='border-radius: 0px; box-shadow: none;border-right: 1px solid rgba(0,0,0,0);' type='text' required='required' class='form-control weixin-customize-news-jumpto' placeholder='跳转链接' /></div></div><div class='form-group' style='margin-bottom: 25px;'><div class='col-md-10  col-md-offset-1'><div class='delete-customize-news'>&nbsp;</div></div></div></div>";$("#weixin-customize-news-detail .customize-news-body").append(a),setTimeout(function(){$("#weixin-customize .customize-news-body").scrollTop($("#weixin-customize .customize-news-body")[0].scrollHeight)},0)},$("#weixin-customize-news-detail").delegate(".delete-customize-news","click",function(){var a=$(this);$.confirm({text:"你确定要删除此图文消息吗？",title:"删除",ensureFn:function(){a.parents(".customize-news").remove()}})}),$(".speach-response .nav li").click(function(){setCookie("app_response",$(this).attr("class"))}),$("body").off("keyup",".user-says-input").on("keyup",".user-says-input",function(a){if(50==a.which){var b=$(this);setTimeout(function(){checkAt(b)},200)}}),$("body").off("mouseover",".user-box-row").on("mouseover",".user-box-row",function(){$(this).addClass("on").siblings(".user-box-row").removeClass("on")}),$("body").off("click",".user-box-row").on("click",".user-box-row",function(a){var b=$(this),c=b.closest(".user-box").siblings(".writing-bg").find("input"),d=b.closest(".mention-popup").siblings(".user-says-input");return choseFriend(c,d,!1),b.closest(".mention-popup").remove(),a.stopPropagation(),!1}),$("body").off("focusout","#mention-input").on("focusout","#mention-input",function(a){setTimeout(function(){$(".mention-popup").remove()},200)}),$("body").off("keyup","#mention-input").on("keyup","#mention-input",function(a){var b=$(this),c=b.closest(".mention-popup").siblings(".user-says-input");if("27"==a.keyCode)return choseFriend(b,c,!0),$("body").find(".mention-popup").remove(),!1;if("13"==a.keyCode){if(b.closest(".mention-popup").find(".user-box-row.on").length)return choseFriend(b,c,!1),b.closest(".mention-popup").remove(),!1}else{if("38"==a.keyCode&&b.closest(".mention-popup").find(".user-box-row.on").prev(".user-box-row").length){var d=b.closest(".mention-popup").find(".user-box-row.on");return d.prev(".user-box-row").addClass("on").siblings(".user-box-row").removeClass("on"),!1}if("40"==a.keyCode&&b.closest(".mention-popup").find(".user-box-row.on").next(".user-box-row").length){var d=b.closest(".mention-popup").find(".user-box-row.on");return d.next(".user-box-row").addClass("on").siblings(".user-box-row").removeClass("on"),!1}autoGetPrompt(b.val())}}),$("body").off("click",".upload-resource-button").on("click",".upload-resource-button",function(a){$("#localResourceModal").modal("hide"),setTimeout(function(){window.location.href="#/resource"},500)}),$("body").off("click","[data-act=action-list-trigger]").on("click","[data-act=action-list-trigger]",function(){var a=($(this),$(".my-action-name-list"));"block"==a.css("display")?a.css("display","none"):a.css("display","block")}),$scope.getActionListFunc=function(){$.ajax({url:ruyiai_host+"/ruyi-ai/action/query/list",data:{appId:appId,start:0,limit:1e3},method:"get",success:function(a){a=dataParse(a),0==a.code?($scope.actionList=a.result,$scope.$apply()):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})},$("body").off("click",".my-action-name-list li").on("click",".my-action-name-list li",function(){var a=$(this);$scope.response.action=a.text(),$scope.$apply(),$(".my-action-name-list").css("display","none")}),setTimeout(function(){$scope.getActionListFunc()},2e3),$("body").off("click",".intent-detail-more").on("click",".intent-detail-more",function(a){var b=$(this),c=$(".intent-detail-more-box");"block"==c.css("display")?(c.css("display","none"),b.find("i").removeClass("icon-arrow-down").addClass("icon-arrow-right"),supports_html5_storage()&&localStorage.removeItem("intentDetailMore"+$stateParams.intent_id)):(c.css("display","block"),b.find("i").removeClass("icon-arrow-right").addClass("icon-arrow-down"),supports_html5_storage()&&localStorage.setItem("intentDetailMore"+$stateParams.intent_id,"open"))}),supports_html5_storage()&&"open"==localStorage.getItem("intentDetailMore"+$stateParams.intent_id)&&($(".intent-detail-more-box").css("display","block"),$(".intent-detail-more").find("i").removeClass("icon-arrow-right").addClass("icon-arrow-down")),$scope.commonIntentDetailChange=function(){dataEditedFlag=!0}}function intentSearchCtrl(a,b,c,d){$(".list-group-item").removeClass("active"),$("[data-act=nav-scenario]").addClass("active"),$("[data-act=nav-scenario-"+d.scenes_id+"]").addClass("active"),b.pageSize=12,b.searchIntentWords="",b.isCreateSuccess=!0;var e=function(){var a=$(window).height();b.pageSize=parseInt(a/56)};e(),$(window).resize(function(){e()}),b.goIntentDetail=function(a,b,c){c&&($(c.target).is(".btn-intent")||$(c.target).is(".copy-intent-target")||$(c.target).is(".delete-intent-target")||$(c.target).is(".copy-intent")||$(c.target).is("[data-act=move-scenario]")||$(c.target).is("[data-click=scenario-name]"))||(dataEditedFlag&&$.confirm_save({text:"你的修改未保存，确定要离开意图详情页面吗？",title:"系统提示",ensureFn:function(){dataEditedFlag=!1,$("[data-act=confirmShow]").css("display")||(window.location.href="#/intent_search/"+a+"/intent_detail/"+b)},saveFn:function(){$(".save-and-apply").trigger("click"),dataEditedFlag=!1,$("[data-act=confirmShow]").css("display")||(window.location.href="#/intent_search/"+a+"/intent_detail/"+b)}}),dataEditedFlag||($("[data-act=confirmShow]").css("display")||(window.location.href="#/intent_search/"+a+"/intent_detail/"+b),$("[data-act=nav-scenario-"+a+"]").addClass("active").siblings().removeClass("active")))},b.getScenarioFunc=function(){var a=angular.element("#api-manager-box").scope().scenarioList;for(var c in a)if(d.scenes_id==a[c].id){b.scenario=a[c],b.$apply();break}},setTimeout(function(){b.getScenarioFunc()},10),b.searchIntentWordsNameKeydownFunc=function(a,c){13==a.keyCode&&b.searchIntentWordsNameFunc(c)},b.searchIntentWordsNameFunc=function(a){$(".popover").remove();var c=getCookie("sortkey");""!=a?$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/intents",data:{start:0,limit:"800",keywords:a,sortkey:c},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){b.intentList=a.result;for(var c in b.intentList){var d="";if(b.intentList[c].errorModels){var e=1;for(var f in b.intentList[c].errorModels)e=parseInt(f)+1,b.intentList[c].errorModels[f].code&&"0"==b.intentList[c].errorModels[f].code.substring(0,1)?d+="<div style='color:#ee524f;'>"+e+"."+b.intentList[c].errorModels[f].detail+"</div>":b.intentList[c].errorModels[f].code&&"1"==b.intentList[c].errorModels[f].code.substring(0,1)&&(d+="<div style='color:#ffb64c;'>"+e+"."+b.intentList[c].errorModels[f].detail+"</div>");b.intentList[c].errorModelStr=d}}b.$apply(),b.intentList.length<=0?$.trace("未搜索到意图"):(window.location.href="#/intent_search/"+b.intentList[0].scenarioId+"/intent_detail/"+b.intentList[0].id,setTimeout(function(){$("[data-act=nav-scenario-"+b.intentList[0].scenarioId+"]").addClass("active").siblings().removeClass("active"),$("[data-act=nav-intent-"+b.intentList[0].id+"]").addClass("active")},100))}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}):$.trace("请填写关键词"),$(".list-group-item").removeClass("active")},b.deleteIntentNameFunc=function(a,c){var e=window.location.href.split("/"),f=e[e.length-1],g=e[e.length-3];return $.confirm({text:"意图删除之后所有数据都将无法恢复，你确认要删除此意图吗？",title:"删除意图",ensureFn:function(){return $.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+d.scenes_id+"/intent/"+a,method:"DELETE",success:function(c){if(c=dataParse(c),0==c.code){callAgentReloadTestFunc();for(var d in b.intentList)if(b.intentList[d].id==a){b.intentList.splice(d,1),b.$apply(),b.intentList.length<=0?(window.location.href="#/intent_search/",$(".list-group-item").removeClass("active")):a==f?(window.location.href="#/intent_search/"+b.intentList[0].scenarioId+"/intent_detail/"+b.intentList[0].id,setTimeout(function(){$("[data-act=nav-scenario-"+b.intentList[0].scenarioId+"]").addClass("active").siblings().removeClass("active")},100)):(window.location.href="#/intent_search/"+g+"/intent_detail/"+f,setTimeout(function(){$("[data-act=nav-scenario-"+g+"]").addClass("active").siblings().removeClass("active")},0));break}}else 2==c.code?goIndex():c.msg&&$.trace(c.msg+"( "+c.detail+" )","error");return!1}}),!1}}),!1},b.copyIntentDetailFunc=function(a,c){return b.isCreateSuccess?(b.isCreateSuccess=!1,void $.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+c+"/intent",data:JSON.stringify(a),traditional:!0,headers:{"Content-Type":"application/json"},method:"POST",success:function(a){if(a=dataParse(a),0==a.code){callAgentReloadTestFunc();var d={},e={};a.result.validateResult?(d=a.result.validateResult,e=a.result.intent):e=a.result,$.trace("意图复制成功","success"),b.intentList&&b.intentList.length>0||(b.intentList=new Array),b.intentList.push(e),b.$apply(),window.location.href="#/intent_search/"+c+"/intent_detail/"+e.id}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error");b.isCreateSuccess=!0},error:function(){$.trace("意图复制失败")}})):!1},b.moveIntentNameFunc=function(a,b){var c=window.location.href.split("/");c[c.length-1],c[c.length-3];$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+b+"/intent/"+a+"/move",method:"PUT",success:function(a){a=dataParse(a),0==a.code?$.trace("移动成功","success"):2==a.code?goIndex():$.trace("此意图已在本场景下，无需移动！")}})},b.copyIntentNameFunc=function(a,c){for(var d in b.intentList)if(b.intentList[d].id==a){b.copyIntentDetailFunc(b.intentList[d],c);break}},$(".intent").delegate(".btn-intent","click",function(a){a.stopPropagation();var b=$(this),c=window.location.href.split("/"),d=c[c.length-1];b.parent().addClass("open"),$("[data-act=nav-intent-"+d+"]").addClass("active");var e=this.getBoundingClientRect().left+document.documentElement.scrollLeft,f=this.getBoundingClientRect().top+document.documentElement.scrollTop;b.next().css({left:e,top:f})}),$(".intent").delegate(".btn-group","mouseleave",function(){$(this).removeClass("open")}),setTimeout(function(){$(".search-intent-list").focus()},200)}function intent_timeout_detail($rootScope,$scope,$state,$stateParams,$sce){function lengthCheckFunc(a,b){for(var c=!1,d=0,e=0;e<a.length;e++){var f=a.charCodeAt(e);if(f>=1&&126>=f||f>=65376&&65439>=f?d++:d+=2,d>b){c=!0;break}}return c}function checkAt(a){if(window.getSelection){var b=window.getSelection(),c=b.getRangeAt(0),d=b.focusNode.textContent,e=c.startOffset;"@"==d.substr(e-1,1)&&(insertAt(a),isAtStatus=!0)}}function insertAt(a){$("body").find("span#prompt").remove(),insertnode(),insertMention(a);var b=$(".mention-popup");return b.find("input").focus(),a.addClass("on"),autoGetPrompt(""),!1}function autoGetPrompt(a){$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/entity/list",method:"get",cache:!0,data:{keywords:a},success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.userentity,c=a.result.sysentity,d="";b.length>=10&&(b.length=10),c.length=10-b.length;for(var e in b)d+="<li class='user-box-row'>"+b[e]+"</li>";for(var e in c)d+="<li class='user-box-row'>"+c[e]+"</li>";$("body").find("div.user-box").html("<ul>"+d+"</ul>"),defaultItem()}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})}function insertnode(){var a=window.getSelection(),b=a.getRangeAt(0),c=document.createElement("span");c.id="prompt",b.insertNode(c),b.collapse(!1)}function insertMention(a){var b=$('<div class="mention-popup">                        <div class="writing-bg">                        <input type="text" id="mention-input" placeholder="获取词典(Esc取消)" data-act="atShow"/>                        </div>                        <div class="user-box"></div>                      </div>'),c=$("span#prompt").position().left+2,d=$(".mention-popup").height()+10,e=$("span#prompt").position().top-d+10;b.css({left:c,top:e}),$(".mention-popup").length>0&&($(".mention-popup").remove(),isAtStatus=!1),b.insertAfter(a),setTimeout(function(){defaultItem()},200)}function defaultItem(){$("body").find(".user-box .user-box-row").length&&$("body").find(".user-box .user-box-row").eq(0).addClass("on")}function choseFriend(a,b,c){var d="";if(d=c?a.val():$(".user-box-row.on").text()+":",window.getSelection){b.focus(),b.find("span#prompt").before(d);var e=window.getSelection(),f=document.createRange();if(f.selectNode(b.find("span#prompt").get(0)),e.removeAllRanges(),e.addRange(f),f.collapse(!1),!c){var e=window.getSelection(),f=e.getRangeAt(0),g=e.focusNode.textContent,h=g.lastIndexOf("@");h>-1&&(g=g.substr(h+1,g.length-1));for(var i=g.indexOf(".",0),j=g.substr(i+1,g.length-i-2),k=0;20>=k;k++)if(0==k){if(aliasExitsFunc(b.text(),j))break}else if(aliasExitsFunc(b.text(),j+k)){j=""+j+k;break}j=j.replace(new RegExp(/\./g),"-"),b.find("span#prompt").before(j+"&nbsp;");var e=window.getSelection(),f=document.createRange();f.selectNode(b.find("span#prompt").get(0)),e.removeAllRanges(),e.addRange(f),f.collapse(!1)}b.find("span#prompt").remove(),isAtStatus=!1}return!1}function aliasExitsFunc(text,alias){var userSysReg=eval("/:"+alias+"/g"),paras=text.match(userSysReg);return paras&&0!=paras.length?!1:!0}function supports_html5_storage(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}$('[data-toggle="tooltip"]').tooltip(),$scope.app_response=getCookie("app_response"),"app-response-weixin"==$scope.app_response?($(".speach-response .app-response-weixin").addClass("active").siblings().removeClass("active"),$("#myTabContent").find("#weixin").addClass("active in").siblings().removeClass("active in")):"app-response-local"==$scope.app_response&&($(".speach-response .app-response-local").addClass("active").siblings().removeClass("active"),$("#myTabContent").find("#local").addClass("active in").siblings().removeClass("active in"));var isAtStatus=!1;$scope.currentUserId=getCookie("userId");var checkIsChangeValue="";$scope.commonIntentDetailFocus=function(a){checkIsChangeValue=a},$scope.commonIntentDetailBlur=function(a){checkIsChangeValue!=a&&(dataEditedFlag=!0)},$scope.userSyaTest="",$('[data-toggle="popover"]').popover(),$scope.testTemplateKeydownFunc=function(){var a=$("#userSyaTest").text(),b=a.replace(/<span[^>]*>/g," ");b=b.replace(/<\/span>/g,"");var c=b.match(/(@[^:]+):([^\s]+)/g);for(var d in c)b=b.replace(c[d],"<span style='background-color:red;'>"+$.trim(c[d])+"</span>");b=$sce.trustAsHtml(b),$scope.userSyaTest=b};var removeDuplicate=function(a){for(var b={},c=[],d=0;d<a.length;d++)b[a[d]]||(b[a[d]]=!0,c.push(a[d]));return c};$("#myreset").click(function(){var a=$("#regTest").text(),b=a.replace(/<span[^>]*>/g," ");b=b.replace(/<\/span>/g,""),$("#regTest").text(b)}),$("#mysubmit").click(function(){var a=$("#regTest").text(),b=a.match(/(@[^:]+):([^\s]+)/g);for(var c in b)a=a.replace(b[c],"<span style='background-color:red;'>"+$.trim(b[c])+"</span>");$("#regTest").html(a)}),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200);var intentDetailDuplicate="";$scope.isSaveSuccess=!0;var addEmptyParametersFunc=function(a){if(a)if($scope.response){var b=$scope.response;if(b.parameters){var c={};b.parameters&&b.parameters.length>0?(c=b.parameters[b.parameters.length-1],($.trim(c.dataType).length>0||$.trim(c.defaultValue).length>0||$.trim(c.name).length>0||$.trim(c.value).length>0||c.prompts.length>0||c.required)&&b.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""})):b.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""})}else b.parameters=[],b.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""})}else $scope.response={action:"",parameters:[],outputs:[[]]},$scope.response.parameters.push({dataType:"",defaultValue:"",name:"",prompts:[],required:!1,value:""});return a},deleteEmptyParametersFunc=function(a){if(a&&a.responses)for(var b in a.responses)if(a.responses[b].parameters)for(var c in a.responses[b].parameters)$.trim(a.responses[b].parameters[c].dataType).length<=0&&$.trim(a.responses[b].parameters[c].defaultValue).length<=0&&$.trim(a.responses[b].parameters[c].name).length<=0&&$.trim(a.responses[b].parameters[c].value).length<=0&&a.responses[b].parameters[c].prompts.length<=0&&!a.responses[b].parameters[c].required&&a.responses[b].parameters.splice(c,1);return a};$scope.newsPageSize=6,$scope.imagePageSize=12,$scope.voicePageSize=20,$scope.videoPageSize=20,$scope.createMediaObjectFunc=function(a){var b=new Object;a.indexOf("@mediaResourceResponse-news")>-1?b.type="news":a.indexOf("@mediaResourceResponse-image")>-1?b.type="image":a.indexOf("@mediaResourceResponse-voice")>-1?b.type="voice":a.indexOf("@mediaResourceResponse-video")>-1&&(b.type="video");var c="#####",d="&&&&&";-1==a.indexOf(c)&&(c="#",d=":");var e=a.split(c);for(var f in e){var g=e[f].split(d);"mediaid"==g[0]?b.mediaId=g[1]:"name"==g[0]&&(b.name=g[1])}return b.text=a,b},$scope.getMediaResponseFunc=function(a){if(a&&($scope.mediaResponseList=new Array),$scope.intentDetail.speech){var b=0;for(var c in $scope.intentDetail.speech)if($scope.intentDetail.speech[c]&&$scope.intentDetail.speech[c].indexOf("@mediaResourceResponse")>-1){var d=$scope.createMediaObjectFunc($scope.intentDetail.speech[c]);a&&$scope.mediaResponseList.push(d),b++}for(var e=0;b>e;e++)for(var c in $scope.intentDetail.speech)if($scope.intentDetail.speech[c].indexOf("@mediaResourceResponse")>-1){$scope.intentDetail.speech.splice(c,1);break}}};var splitOutputsFunc=function(){var a=[],b=[];for(var c in $scope.response.outputs)for(var d in $scope.response.outputs[c]){$scope.response.outputs[c][d]&&$scope.response.outputs[c][d].type&&($scope.response.outputs[c][d].type.indexOf("wechat.")>-1?a.push($scope.response.outputs[c]):b.push($scope.response.outputs[c]));
break}0==a.length&&(a=[[]]),0==b.length&&(b=[[]]),$scope.wechatOutputs=a,$scope.localOutouts=b,$scope.$apply()};$scope.getIntentDetailFunc=function(a){a&&0!=a.length&&$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+$stateParams.scenes_id+"/intent/"+a,method:"GET",success:function(a){a=dataParse(a),0==a.code?($scope.intentDetail=a.result,$scope.getMediaResponseFunc(!0),$scope.intentDetail.responses&&$scope.intentDetail.responses.length>0?$scope.response=$scope.intentDetail.responses[0]:$scope.response=new Object,$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail),$scope.intentDetail.templates=removeDuplicate($scope.intentDetail.templates),intentDetailDuplicate=JSON.stringify($scope.intentDetail),$scope.intentDetail.templates.length>5&&($scope.userSayFlag=!1),splitOutputsFunc(),setLearnLevelFunc(),$scope.$apply(),setTimeout(function(){$("[data-act=nav-intent-"+$stateParams.intent_id+"]").siblings().removeClass("active"),$("[data-act=nav-intent-"+$stateParams.intent_id+"]").addClass("active")},200)):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})};var intentIndex=0;angular.element(".center-list-box").scope().intentCount&&(intentIndex=angular.element(".center-list-box").scope().intentCount);var createIntentCommonFunc=function(){intentIndex+=1,$scope.intentDetail=new Object,$scope.intentDetail.name="",$scope.intentDetail.auto=!0,$scope.intentDetail.priority=0,$scope.intentDetail.mlLevel="MIDDLE",$scope.mlLevel=!0,$scope.response={action:"",parameters:[],outputs:[[]]},$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail),$scope.mediaResponseList=[],$scope.wechatOutputs=[[]],$scope.localOutouts=[[]],$scope.intentDetail.name="未命名意图"+intentIndex,setTimeout(function(){$scope.addIntentDetailFunc()},20)};-1==$stateParams.intent_id?createIntentCommonFunc():$scope.getIntentDetailFunc($stateParams.intent_id);var validateIntentDetailFunc=function(){if($scope.intentDetail&&$scope.intentDetail.errorModels&&$scope.intentDetail.errorModels.length>0){var a="",b=1;for(var c in $scope.intentDetail.errorModels)b=parseInt(c)+1,$scope.intentDetail.errorModels[c].code&&"0"==$scope.intentDetail.errorModels[c].code.substring(0,1)?a+="<div style='color:#ee524f;max-height:300px;overflow:hidden;overflow-y:auto;'>"+b+"."+$scope.intentDetail.errorModels[c].detail+"</div>":$scope.intentDetail.errorModels[c].code&&"1"==$scope.intentDetail.errorModels[c].code.substring(0,1)&&(a+="<div style='color:#ffb64c;max-height:300px;overflow:hidden;overflow-y:auto;'>"+b+"."+$scope.intentDetail.errorModels[c].detail+"</div>");$scope.intentDetail.errorModelStr=a}else $scope.intentDetail.errorModelStr="";setTimeout(function(){$('[data-toggle="popover"]').popover()},500)},deleteBlankParaFunc=function(a){for(var b in a)0==$.trim(a[b]).length&&a.splice(b,1);return a};$scope.addIntentDetailFunc=function(){if(!$scope.isSaveSuccess)return!1;$scope.isSaveSuccess=!1,$scope.response.outputs=$scope.wechatOutputs.concat($scope.localOutouts);var a=$scope.intentDetail;a=deleteEmptyParametersFunc(a),a.speech||(a.speech=[]);for(var b in $scope.mediaResponseList){var c=!1;for(var d in a.speech)a.speech[d]==$scope.mediaResponseList[b].text&&(c=!0);c||a.speech.push($scope.mediaResponseList[b].text)}a.templates=deleteBlankParaFunc(a.templates),$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+$stateParams.scenes_id+"/intent",data:JSON.stringify(a),traditional:!0,headers:{"Content-Type":"application/json"},method:"POST",success:function(a){if(addEmptyParametersFunc($scope.intentDetail),$scope.getMediaResponseFunc(!1),a=dataParse(a),0==a.code){callAgentReloadTestFunc();var b={},c={};a.result.validateResult?(b=a.result.validateResult,c=a.result.intent):c=a.result,$.trace("意图创建成功","success"),$rootScope.$apply(),$scope.intentDetail.id=c.id,$scope.intentDetail.intentStatus=c.intentStatus,$scope.intentDetail.errorModels=c.errorModels,$scope.intentDetail.scenarioId=c.scenarioId;var d=angular.element(".center-list-box").scope().intentList;d&&d.length>0||(d=new Array),validateIntentDetailFunc(),d.unshift($scope.intentDetail),intentDetailDuplicate=JSON.stringify($scope.intentDetail),angular.element(".center-list-box").scope().intentList=d,angular.element(".center-list-box").scope().intentCount=angular.element(".center-list-box").scope().intentCount+1,angular.element(".center-list-box").scope().getIntentCountFunc(function(){angular.element(".center-list-box").scope().setPagingCountFunc()}),$scope.$apply(),setTimeout(function(){dataEditedFlag=!1},1e3),setTimeout(function(){$(".intent-name").focus(),setTimeout(function(){$(".intent-name").select()},200)},200),window.location.href="#/intent_list/"+$stateParams.scenes_id+"/intent_detail/"+$scope.intentDetail.id}else 2==a.code?goIndex():a.msg.indexOf("already exists")>-1?createIntentCommonFunc():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error");$scope.isSaveSuccess=!0},error:function(){addEmptyParametersFunc($scope.intentDetail),$.trace("意图创建失败")}})},$scope.updateIntentDetailFunc=function(){if(!$scope.isSaveSuccess)return!1;$scope.isSaveSuccess=!1,$scope.isExits&&$scope.wechatOutputs[0].length>1&&($scope.wechatOutputs[0].pop(),$scope.isExits=!1),$scope.isExits&&$scope.localOutouts[0].length>1&&($scope.localOutouts[0].pop(),$scope.isExits=!1),$scope.response.outputs=$scope.wechatOutputs.concat($scope.localOutouts);var a=$scope.intentDetail;a.speech||(a.speech=[]);for(var b in $scope.mediaResponseList){var c=!1;for(var d in a.speech)a.speech[d]==$scope.mediaResponseList[b].text&&(c=!0);c||a.speech.push($scope.mediaResponseList[b].text)}a=deleteEmptyParametersFunc(a),a.templates=deleteBlankParaFunc(a.templates),$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+$stateParams.scenes_id+"/intent/"+$scope.intentDetail.id,data:JSON.stringify(a),traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(a){if(addEmptyParametersFunc($scope.intentDetail),$scope.getMediaResponseFunc(!1),a=dataParse(a),0==a.code){callAgentReloadTestFunc();var b={},c={};a.result.validateResult?($(".save-and-apply .saveing").css("display","none"),$(".save-and-apply .saveing").css("width","0"),$(".save-and-apply .saveing").css("display","block"),$(".save-and-apply .save-text").text("保存并应用"),$(".save-and-apply .dim-div").css("display","none"),b=a.result.validateResult,c=a.result.intent,$.trace(b.message+"("+b.detail+")")):(c=a.result,setTimeout(function(){$(".save-and-apply .save-text").text("保存成功","success"),$(".save-and-apply .saveing").css("display","none"),$(".save-and-apply .saveing").css("width","0"),setTimeout(function(){$(".save-and-apply .saveing").css("display","block")},1e3),setTimeout(function(){$(".save-and-apply .save-text").text("保存并应用"),$(".save-and-apply .dim-div").css("display","none")},500)},1e3)),$scope.intentDetail=c;var d=angular.element(".center-list-box").scope().intentList;for(var e in d)if(d[e].id==$scope.intentDetail.id){validateIntentDetailFunc(),d[e]=$scope.intentDetail;break}intentDetailDuplicate=JSON.stringify($scope.intentDetail),angular.element(".center-list-box").scope().intentList=d,$scope.$apply(),angular.element(".center-list-box").scope().$apply(),setTimeout(function(){$("[data-act=nav-intent-"+$stateParams.intent_id+"]").siblings().removeClass("active"),$("[data-act=nav-intent-"+$stateParams.intent_id+"]").addClass("active")},20),dataEditedFlag=!1}else 2==a.code?goIndex():a.msg&&($(".save-and-apply .saveing").css("display","none"),$(".save-and-apply .saveing").css("width","0"),$(".save-and-apply .saveing").css("display","block"),$(".save-and-apply .save-text").text("保存并应用"),$(".save-and-apply .dim-div").css("display","none"),$.trace(a.msg+"( "+a.detail+" )","error"));$scope.isSaveSuccess=!0},error:function(){addEmptyParametersFunc($scope.intentDetail),$.trace("意图保存失败")}})},$scope.checkRequiredParaments=function(a){return $scope.intentDetail.name.length<=0?($.trace("请输入意图名称"),$(".intent-name").focus(),!1):void(a&&a())},$scope.saveIntentDetailFunc=function(){navigator.onLine?setTimeout(function(){"block"!=$(".save-and-apply .dim-div").css("display")&&$scope.checkRequiredParaments(function(){$(".save-and-apply .dim-div").css("display","block"),$(".save-and-apply .save-text").text("保存中..."),$(".save-and-apply .saveing").css("width","90px"),$scope.intentDetail.responses=new Array,($scope.response.action||$scope.response.affectedContexts||$scope.response.parameters)&&$scope.intentDetail.responses.push($scope.response),$scope.intentDetail.appId=appId,$scope.intentDetail.scenarioId=$stateParams.scenes_id,$scope.intentDetail.id&&$scope.intentDetail.id.length>0?$scope.updateIntentDetailFunc():$scope.addIntentDetailFunc()})},200):$.trace("您当前处于离线状态，保存意图失败！")};var createIntentProcessObjectFunc=function(a,b){var c=new Object;return c.dataType=b,c.defaultValue="",c.name=a,c.prompts=[],c.required=!1,c.value="$"+a,c};$(".max-modal").on("click",function(a){$(".user-says-input").each(function(a,b){b===document.activeElement&&("user-sya-add"===$(b).attr("data-act")||"user-sys-update"===$(b).attr("data-act"))&&b.blur()}),$(".input-weixin").each(function(a,b){b===document.activeElement&&b.blur()}),$(".input-local").each(function(a,b){b===document.activeElement&&b.blur()})}),$scope.addTemplateFunc=function(a,b,c,d){$(a.target);setTimeout(function(){if(isAtStatus)return isAtStatus=!1,!1;if(b=$(a.target).text().trim(),!(b&&0!=$.trim(b).length||13==a.keyCode||($(a.target).append('<div class="usersay-placeholder">请输入用户说</div>'),0===c||c)))return!1;setTimeout(function(){$(a.target).html(b)},2);var e,f;if($scope.intentDetail.templates){for(var e in $scope.intentDetail.templates)if(e!=c&&$.trim($scope.intentDetail.templates[e])==$.trim(b))return $.trace("此用户说已经存在，重复的只会保存一条"),!1;var f=!1;for(var e in $scope.intentDetail.templates)e==c&&($scope.intentDetail.templates[e]!==b&&(dataEditedFlag=!0,$scope.intentDetail.templates[e]=b),f=!0);f||($scope.intentDetail.templates.push(b),dataEditedFlag=!0)}else console.log("fal"),$scope.intentDetail.templates=new Array,$scope.intentDetail.templates.push(b);$scope.$apply(),$('[data-toggle="tooltip"]').tooltip(),"add"==d&&setTimeout(function(){$(a.target).html(""),$scope.userSayFlag=!0,$scope.$apply()},20)},20)},$scope.addTemplateKeydownFunc=function(a,b,c,d){var e=$(a.target);return 13==a.keyCode?($scope.addTemplateFunc(a,b,c,d),e.parent().next().children().eq(0).focus(),!1):void 0},$scope.deleteTemplateFunc=function(a){dataEditedFlag=!0;for(var b in $scope.intentDetail.templates)if(b==a){$scope.intentDetail.templates.splice(b,1);break}},$scope.copyTemplateFunc=function(a){console.log("cizhilou"),dataEditedFlag=!0;for(var b in $scope.intentDetail.templates)if($scope.intentDetail.templates[b]==a+"(副本)")return $.trace("此用户说副本已经存在"),!1;$scope.intentDetail.templates.push(a+"(副本)")},$scope.addInputIntentTagFunc=function(a){isContainSpacesFunc(a)||a&&$.trim(a).length>0&&($scope.intentDetail.contexts||($scope.intentDetail.contexts=new Array),$scope.intentDetail.contexts.push(a),$scope.addInputIntentTag="",dataEditedFlag=!0)},$scope.addInputIntentTagKeydownFunc=function(a,b){13==a.keyCode&&$scope.addInputIntentTagFunc(b)},$scope.deleteInputIntentTagFunc=function(a){for(var b in $scope.intentDetail.contexts)$scope.intentDetail.contexts[b]==a&&($scope.intentDetail.contexts.splice(b,1),dataEditedFlag=!0)},$scope.addAffectedContextFunc=function(a){if(!isContainSpacesFunc(a)&&a&&$.trim(a).length>0){var b=new Object;b.lifespan=1,b.name=a,$scope.response.affectedContexts||($scope.response.affectedContexts=new Array),$scope.response.affectedContexts.push(b),$scope.addAffectedContext="",dataEditedFlag=!0}},$scope.addAffectedContextKeydownFunc=function(a,b){13==a.keyCode&&$scope.addAffectedContextFunc(b)},$scope.deleteAffectedContextFunc=function(a){for(var b in $scope.response.affectedContexts)if($scope.response.affectedContexts[b].name==a){$scope.response.affectedContexts.splice(b,1),dataEditedFlag=!0;break}},$scope.addSpechFunc=function(a,b){if(!a||$.trim(a).length<=0)return!1;if($scope.intentDetail.speech){var c=!1;for(var d in $scope.intentDetail.speech)d==b&&($scope.intentDetail.speech[d]=a,c=!0);c||$scope.intentDetail.speech.push(a)}else $scope.intentDetail.speech=new Array,$scope.intentDetail.speech.push(a);$scope.addSpeech=""},$scope.addSpechKeydownFunc=function(a,b,c){13==a.keyCode&&$scope.addSpechFunc(b,c)},$scope.deleteSpechFunc=function(a){for(var b in $scope.intentDetail.speech)if($scope.intentDetail.speech[b]==a){$scope.intentDetail.speech.splice(b,1);break}},$scope.copySpechFunc=function(a){$scope.intentDetail.speech.push(a)},$scope.addParamentRequiredFunc=function(a,b){if(a&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].required=a;else{var c=new Object;c.required=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.required=a,$scope.response.parameters.push(c)}dataEditedFlag=!0,$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue="")}},$scope.addParamentNameFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].name=a;else{var c=new Object;c.name=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.name=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.addParamentValueFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].value=a;else{var c=new Object;c.value=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.value=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.addParamentDataTypeFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].dataType=a;else{var c=new Object;c.dataType=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.dataType=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.addParamentDefaultValueFunc=function(a,b){if(checkIsChangeValue!=a&&(dataEditedFlag=!0),a&&a.length>0&&$scope.response){if($scope.response.parameters)if($scope.response.parameters[b])$scope.response.parameters[b].defaultValue=a;else{var c=new Object;c.defaultValue=a,$scope.response.parameters.push(c)}else{$scope.response.parameters=new Array;var c=new Object;c.defaultValue=a,$scope.response.parameters.push(c)}$scope.paramentObject&&($scope.paramentObject.required=!1,$scope.paramentObject.name="",$scope.paramentObject.value="",$scope.paramentObject.dataType="",$scope.paramentObject.required=!1,$scope.paramentObject.defaultValue=""),$scope.intentDetail=addEmptyParametersFunc($scope.intentDetail)}$('[data-toggle="tooltip"]').tooltip()},$scope.deleteParamentFunc=function(a){for(var b in $scope.response.parameters)if(b==a){$scope.response.parameters.splice(b,1),dataEditedFlag=!0;break}},$scope.copyParamentFunc=function(a){var b={},c={};for(var d in $scope.response.parameters)if(d==a){c=$scope.response.parameters[d];break}b.dataType=c.dataType,b.defaultValue=c.defaultValue,b.name=c.name;var e=[];for(var d in c.prompts)e.push(c.prompts[d]);b.prompts=e,b.required=c.required,b.value=c.value;var f=$scope.response.parameters.length-2;dataEditedFlag=!0,$scope.response.parameters.splice(f,0,b)},$scope.editPromptsList=function(a){$scope.response.parameters[a].prompts?$scope.prompts=$scope.response.parameters[a].prompts:$scope.prompts=new Array,$scope.promptIndex=a},$scope.promptSubmit=function(){$("#addPrompts").modal("hide")},$scope.check=function(a){console.log(1),$(a.target).scroll(function(){$(a.target).css("height",$(this)[0].scrollHeight)})},$scope.addPromptFunc=function(a,b){var c=$(b.target);c.next().css("visibility","visible"),c.nextAll(".copy-prompt").css("visibility","visible");var d=$(b.target).val()||$(b.target).text();setTimeout(function(){if(!d||$.trim(d).length<=0)return!1;if($scope.prompts){var b=!1;for(var c in $scope.prompts)c==a&&($scope.prompts[c]=d,b=!0);b||$scope.prompts.push(d)}else $scope.prompts=new Array,$scope.prompts.push(d);dataEditedFlag=!0,$scope.addPromptValue="",$scope.$apply()},200)},$scope.hideOprationIcon=function(a){var b=$(a.target);b.next().css("visibility","hidden"),b.nextAll(".copy-prompt").css("visibility","hidden")},$scope.calcuteHeight=function(a){var b=$(a.target);setTimeout(function(){var a=b.height();a>=60?(b.next().css("top","30px"),b.nextAll(".copy-prompt").css("top","30px")):a>=40?(b.next().css("top","20px"),b.nextAll(".copy-prompt").css("top","20px")):a>=20&&(b.next().css("top","10px"),b.nextAll(".copy-prompt").css("top","10px"))},100)},$scope.addPromptKeydownFunc=function(a,b,c){13==a.keyCode&&$scope.addPromptFunc(c,a)},$("#addPrompts").on("hidden.bs.modal",function(){$scope.response.parameters&&$scope.response.parameters[$scope.promptIndex]&&($scope.response.parameters[$scope.promptIndex].prompts=$scope.prompts)}),$scope.deletePromptFunc=function(a){for(var b in $scope.prompts)if(b==a){$scope.prompts.splice(b,1);break}},$scope.copyPromptFunc=function(a,b){var c=$(b.target).parent().find(".prompt-item").text()+"(副本)";$scope.prompts.push(c)},$scope.setPriorityFunc=function(a){dataEditedFlag=!0,$scope.intentDetail.priority=a},$("body").off("click","[data-act=showMoreTemplate] label").on("click","[data-act=showMoreTemplate] label",function(a){var b=$(this);"glyphicon glyphicon-triangle-bottom"==b.siblings("i").attr("class")?$scope.userSayFlag=!0:$scope.userSayFlag=!1,$scope.$apply()}),$("body").off("click","[data-act=learnLevel]").on("click","[data-act=learnLevel]",function(){var a=$(this),b=a.attr("class"),c=$("[data-act=learn-level-bar]");b.indexOf("CLOSE")>-1?(c.css("width","0%"),$("ul > .LOW i").removeClass("active"),$("ul > .MIDDLE i").removeClass("active"),$("ul > .HIGH i").removeClass("active"),$scope.intentDetail.mlLevel="CLOSE"):b.indexOf("LOW")>-1?(c.css("width","34%"),$("ul > .CLOSE i").addClass("active"),$("ul > .LOW i").addClass("active"),$("ul > .MIDDLE i").removeClass("active"),$("ul > .HIGH i").removeClass("active"),$scope.intentDetail.mlLevel="LOW"):b.indexOf("MIDDLE")>-1?(c.css("width","68%"),$("ul > .CLOSE i").addClass("active"),$("ul > .LOW i").addClass("active"),$("ul > .MIDDLE i").addClass("active"),$("ul > .HIGH i").removeClass("active"),$scope.intentDetail.mlLevel="MIDDLE"):b.indexOf("HIGH")>-1&&(c.css("width","100%"),$("ul > .CLOSE i").addClass("active"),$("ul > .LOW i").addClass("active"),$("ul > .MIDDLE i").addClass("active"),$("ul > .HIGH i").addClass("active"),$scope.intentDetail.mlLevel="HIGH")}),$scope.learnLevelFunc=function(a){a?$scope.intentDetail.mlLevel="MIDDLE":$scope.intentDetail.mlLevel="CLOSE"};var setLearnLevelFunc=function(){"CLOSE"==$scope.intentDetail.mlLevel?$scope.mlLevel=!1:$scope.mlLevel=!0};$scope.getMediaListFunc=function(a,b,c,d){$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+a,data:{start:b,limit:c},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&d&&d(a.result.item):2==a.code&&goIndex()}})},$rootScope.newsList=null,$rootScope.imageObjList=null,$rootScope.voiceList=null,$rootScope.videoList=null,$scope.loadMaterialFunc=function(a,b){var c=10;"news"==a?$rootScope.newsList||(c=$scope.newsPageSize,$scope.getMediaListFunc(a,0,c,b)):"image"==a?$rootScope.imageObjList||(c=$scope.imagePageSize,$scope.getMediaListFunc(a,0,c,b)):"voice"==a?$rootScope.voiceList||(c=$scope.voicePageSize,$scope.getMediaListFunc(a,0,c,b)):"video"==a&&($rootScope.videoList||(c=$scope.videoPageSize,$scope.getMediaListFunc(a,0,c,b)))},$scope.loadNewsFunc=function(){$scope.loadMaterialFunc("news",function(a){$rootScope.newsList=a,$scope.$apply()})},$scope.loadImageFunc=function(){$scope.loadMaterialFunc("image",function(a){$rootScope.imageObjList=a,$scope.$apply()})},$scope.loadVoiceFunc=function(){$scope.loadMaterialFunc("voice",function(a){$rootScope.voiceList=a;for(var b in $rootScope.voiceList)$rootScope.voiceList[b].selected=!1;$scope.$apply()})},$scope.loadVideoFunc=function(){$scope.loadMaterialFunc("video",function(a){$rootScope.videoList=a;for(var b in $rootScope.videoList)$rootScope.videoList[b].selected=!1;$scope.$apply()})},$scope.wechatMediaSetFunc=function(a,b){if($scope.currentWechatParentIndex=a,$scope.currentWechatIndex=b,$("#mediaResponseModal").modal("show"),-1!=a){var c=$scope.wechatOutputs[a][b];switch(c.type){case"wechat.image":$("#weixin-customize-image-chosen").trigger("click"),$("#weixin-customize-image-name").val(c.property.title),$("#weixin-customize-image-url").val(c.property.image_url);break;case"wechat.music":$("#weixin-customize-music-chosen").trigger("click"),$("#weixin-customize-music-name").val(c.property.title),$("#weixin-customize-music-abstract").val(c.property.description),$("#weixin-customize-music-url").val(c.property.music_url);break;case"wechat.voice":$("#weixin-customize-voice-chosen").trigger("click"),$("#weixin-customize-voice-name").val(c.property.title),$("#weixin-customize-voice-url").val(c.property.media_id);break;case"wechat.video":$("#weixin-customize-video-chosen").trigger("click"),$("#weixin-customize-video-name").val(c.property.title),$("#weixin-customize-video-url").val(c.property.media_id);break;case"wechat.news":$("#weixin-customize-news-chosen").trigger("click");for(var d=0;d<c.list.length;d++)d>$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").length-1&&$(".add-customize-news").trigger("click"),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-name").val(c.list[d].title),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-abstract").val(c.list[d].description),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-url").val(c.list[d].pic_url),$("#weixin-customize-news-detail .customize-news-body").find(".customize-news").eq(d).find(".weixin-customize-news-jumpto").val(c.list[d].url)}}else $("#mediaResponseModal #myTab-media").children().eq(0).children("a").trigger("click"),resetCustomize()};var resetCustomize=function(){if($(".customize-body").find(".customize-news-body"))for(var a=0,b=$(".customize-body").find(".customize-news-body").children().length;b>a;a++)a>0&&$(".customize-body").find(".customize-news-body").children().eq(a).remove();$(".customize-body").find(".form-control").val("")};$scope.newsObjectClickFunc=function(a){for(var b in $rootScope.newsList)$rootScope.newsList[b].media_id==a?$rootScope.newsList[b].selected=!0:$rootScope.newsList[b].selected=!1},$scope.imageObjectClickFunc=function(a){for(var b in $rootScope.imageObjList)$rootScope.imageObjList[b].media_id==a?$rootScope.imageObjList[b].selected=!0:$rootScope.imageObjList[b].selected=!1},$scope.voiceObjectClickFunc=function(a){for(var b in $rootScope.voiceList)$rootScope.voiceList[b].media_id==a?$rootScope.voiceList[b].selected=!0:$rootScope.voiceList[b].selected=!1},$scope.videoObjectClickFunc=function(a){for(var b in $rootScope.videoList)$rootScope.videoList[b].media_id==a?$rootScope.videoList[b].selected=!0:$rootScope.videoList[b].selected=!1},$scope.setMediaSubmitFunc=function(){var a=$(".choose-media-response.active"),b=a.attr("data-type"),c={};switch(b){case"wechat.news":dataEditedFlag=!0;for(var d in $rootScope.newsList)if($rootScope.newsList[d].selected){c=createOutputObjectFunc(b,$rootScope.newsList[d].content.news_item[0].title,"",$rootScope.newsList[d].media_id);break}break;case"wechat.image":dataEditedFlag=!0;for(var d in $rootScope.imageObjList)if($rootScope.imageObjList[d].selected){c=createOutputObjectFunc(b,$rootScope.imageObjList[d].name,"",$rootScope.imageObjList[d].media_id);break}break;case"wechat.voice":dataEditedFlag=!0;for(var d in $rootScope.voiceList)if($rootScope.voiceList[d].selected){c=createOutputObjectFunc(b,$rootScope.voiceList[d].name,"",$rootScope.voiceList[d].media_id);break}break;case"wechat.video":dataEditedFlag=!0;for(var d in $rootScope.videoList)if($rootScope.videoList[d].selected){c=createOutputObjectFunc(b,$rootScope.videoList[d].name,"",$rootScope.videoList[d].media_id);break}break;case"wechat.customize":dataEditedFlag=!0;var e=$(".customize-body .active"),f=e.attr("id");if("weixin-customize-image-detail"==f){var g=$("#weixin-customize-image-name").val(),h=$("#weixin-customize-image-url").val();c=createOutputObjectFunc("wechat.image",g,h,"")}else if("weixin-customize-music-detail"==f){var g=$("#weixin-customize-music-name").val(),h=$("#weixin-customize-music-url").val(),i=$("#weixin-customize-music-abstract").val();c=createOutputObjectFunc("wechat.music",g,h,"",i)}else if("weixin-customize-voice-detail"==f){var g=$("#weixin-customize-voice-name").val(),j=$("#weixin-customize-voice-url").val();c=createOutputObjectFunc("wechat.voice",g,"",j)}else if("weixin-customize-video-detail"==f){var g=$("#weixin-customize-video-name").val(),j=$("#weixin-customize-video-url").val();c=createOutputObjectFunc("wechat.video",g,"",j)}else if("weixin-customize-news-detail"==f){for(var k=$("#weixin-customize-news-detail .customize-news-body").children().length,l=new Array,d=0;k>d;d++){l[d]=new Object;var m=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-name").val(),n=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-url").val(),i=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-abstract").val(),h=$("#weixin-customize-news-detail .customize-news-body").children().eq(d).find(".weixin-customize-news-jumpto").val();l[d].title=m,l[d].pic_url=n,l[d].description=i,l[d].url=h}c=createOutputObjectFunc("wechat.news","","","","",l)}}createOrUpdateOutputsWechatFunc(c),$("#mediaResponseModal").modal("hide")},$scope.mediaDeleteFunc=function(a){for(var b in $scope.mediaResponseList)if($scope.mediaResponseList[b].mediaId==a){$scope.mediaResponseList.splice(b,1);break}},$scope.mediaPreviewFunc=function(a){},$rootScope.newsLoadPageId=1,$rootScope.newsLoadMoreBox=!0,$(".news-box").on("scroll",function(a){var b="news",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.newsLoadMoreBox&&($rootScope.newsLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.newsLoadPageId*$scope.newsPageSize,limit:$scope.newsPageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.newsList.push(b[c]);$rootScope.newsLoadPageId++,$rootScope.newsLoadMoreBox=!0,$scope.$apply()}else $rootScope.newsLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$rootScope.imageObjLoadPageId=1,$rootScope.imageObjLoadMoreBox=!0,$(".image-box").on("scroll",function(a){var b="image",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.imageObjLoadMoreBox&&($rootScope.imageObjLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.imageObjLoadPageId*$scope.imagePageSize,limit:$scope.imagePageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.imageObjList.push(b[c]);$rootScope.imageObjLoadPageId++,$rootScope.imageObjLoadMoreBox=!0,$scope.$apply()}else $rootScope.imageObjLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$rootScope.voiceLoadPageId=1,$rootScope.voiceLoadMoreBox=!0,$(".voice-box").on("scroll",function(a){var b="voice",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.voiceLoadMoreBox&&($rootScope.voiceLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.voiceLoadPageId*$scope.voicePageSize,limit:$scope.voicePageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.voiceList.push(b[c]);$rootScope.voiceLoadPageId++,$rootScope.voiceLoadMoreBox=!0,$scope.$apply()}else $rootScope.voiceLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$rootScope.videoLoadPageId=1,$rootScope.videoLoadMoreBox=!0,$(".video-box").on("scroll",function(a){var b="video",c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,f=c.height();d>=e-f-45&&1==$rootScope.videoLoadMoreBox&&($rootScope.videoLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/"+$rootScope.appId+"/material/"+b,data:{start:$rootScope.videoLoadPageId*$scope.videoPageSize,limit:$scope.videoPageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var b=a.result.item;if(b.length>0){for(var c in b)$rootScope.videoList.push(b[c]);$rootScope.videoLoadPageId++,$rootScope.videoLoadMoreBox=!0,$scope.$apply()}else $rootScope.videoLoadMoreBox=!1}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$("[data-act=change-media]").click(function(){var a=$(this),b=a.attr("href");"#weixin-news"==b?$scope.loadNewsFunc():"#weixin-image"==b?$scope.loadImageFunc():"#weixin-voice"==b?$scope.loadVoiceFunc():"#weixin-video"==b&&$scope.loadVideoFunc()}),$("[data-act=change-customize]").click(function(){var a=$(this),b=a.attr("href");$("#weixin-customize").addClass("in active").siblings().removeClass("in active"),$("#customize").addClass("in active").siblings().removeClass("in active"),$(b).addClass("active").show().siblings().removeClass("active").hide(),$(this).parents(".dropdown-menu-customize").siblings(".customize").text(a.text()),$(".customize").parent().addClass("active").siblings().removeClass("active")}),$('[data-toggle="popover"]').click(function(){var a=$(this),b=$(".popover-content");setTimeout(function(){b.attr("class")||a.popover("show")},200)}),$("body").off("keyup","[data-act=intent-detail-title]").on("keyup","[data-act=intent-detail-title]",function(a){$(this);13==a.keyCode&&$("[data-act=user-sya-add]").focus()}),$("body").off("keyup","[data-act=tab-help]").on("keyup","[data-act=tab-help]",function(a){var b=$(this);13==a.keyCode&&b.parent().next().children().eq(0).focus()}),$("body").off("keyup","[data-act=user-intent-dataType-update]").on("keyup","[data-act=user-intent-dataType-update]",function(a){var b=$(this);13==a.keyCode&&b.parent().next().next().find("input").focus()}),$("body").off("keyup","[data-act=user-intent-defaultValue-update]").on("keyup","[data-act=user-intent-defaultValue-update]",function(a){var b=$(this);13==a.keyCode&&b.parent().parent().next().children().eq(0).find("input").focus()}),$(".user-say-templates").sortable({items:".sortable-li",cancel:".delete,.copy,.user-says-input"
}),$(".user-say-templates").sortable({stop:function(a,b){var c=[],d=$(".user-says-input");$.each(d,function(a,b){var d=$(b);d.attr("data-template")&&"undefined"!=d.attr("data-template")&&c.push(d.attr("data-template"))}),$scope.intentDetail.templates=c,$scope.$apply()}}),$("body").off("focus",".user-says-input").on("focus",".user-says-input",function(){var a=$(this);a.parent().find(".drop").css("visibility","hidden"),a.parent().find(".edit").css("visibility","hidden"),a.parent().find(".copy").css("visibility","hidden"),a.parent().find(".delete").css("visibility","hidden"),setTimeout(function(){a.find(".usersay-placeholder").remove()},20)}),$("body").off("blur",".user-says-input").on("blur",".user-says-input",function(){var a=$(this);a.parent().find(".drop").css("visibility","visible"),a.parent().find(".edit").css("visibility","visible"),a.parent().find(".copy").css("visibility","visible"),a.parent().find(".delete").css("visibility","visible")}),$scope.addResListTemp=[],$scope.resType="image";var loadpre="pre",loadnext="next",pageSize=20,initStyle=function(){$(".resource-manager .image-box").css("height",document.documentElement.clientHeight-290);var a=$(".image-box-ul").css("width");if(a){a=a.replace("px",""),a=+a;var b=parseInt(a/186);$("#image .reource-operation").css("width",186*b)}};$(window).resize(function(){initStyle()}),initStyle(),$('a[data-toggle="tab"]').on("shown.bs.tab",function(a){var b=$(a.target).text();"图片"==$.trim(b)?(initStyle(),$scope.resType="image",$scope.resImgList&&0!=$scope.resImgList.length||$scope.loadResourceFunc(0,20,$scope.loadResourceListFunc)):"音频"==$.trim(b)?($scope.resType="voice",$scope.resVoiceList&&0!=$scope.resVoiceList.length||$scope.loadResourceFunc(0,30,$scope.loadResourceListFunc)):"视频"==$.trim(b)?($scope.resType="video",$scope.resVideoList&&0!=$scope.resVideoList.length||$scope.loadResourceFunc(0,30,$scope.loadResourceListFunc)):"自定义"==$.trim(b)&&($scope.resType="customize",$scope.resVideoList&&0!=$scope.resVideoList.length||$scope.loadResourceFunc(0,30,$scope.loadResourceListFunc)),$scope.$apply()}),$scope.loadImage=function(){$.ajax({url:ruyiai_host+"/ruyi-ai/save/"+appId+"/multimedia",data:{mediaType:$scope.resType,liststr:JSON.stringify($scope.addResListTemp)},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0&&$scope.loadResourceListFunc(a.result,loadpre):a&&2==a.code&&goIndex(),$scope.addResListTemp=[],$scope.$apply()}})},$scope.loadResourceListFunc=function(a,b){if(a&&a.length){switch($scope.resType){case"image":if($scope.resImgList)for(var c in a)b==loadpre?$scope.resImgList.unshift(a[c]):b==loadnext&&$scope.resImgList.push(a[c]);else $scope.resImgList=a;break;case"voice":if($scope.resVoiceList)for(var c in a)b==loadpre?$scope.resVoiceList.unshift(a[c]):b==loadnext&&$scope.resVoiceList.push(a[c]);else $scope.resVoiceList=a;break;case"video":if($scope.resVideoList)for(var c in a)b==loadpre?$scope.resVideoList.unshift(a[c]):b==loadnext&&$scope.resVideoList.push(a[c]);else $scope.resVideoList=a}$scope.$apply()}},$scope.loadResourceFunc=function(a,b,c){$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:a,size:b},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&c&&c(a.result,loadpre):a&&2==a.code&&goIndex()}})},$scope.loadResourceFunc(0,20,$scope.loadResourceListFunc);var $imgLoadMoreBox=!0;$("[data-act=image-box]").on("scroll",function(a){var b=$(this),c=b[0].scrollTop,d=b[0].scrollHeight,e=b.height();c>=d-e-45&&1==$imgLoadMoreBox&&($imgLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:$scope.resImgList[$scope.resImgList.length-1].createTime,size:pageSize},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0?($scope.loadResourceListFunc(a.result,loadnext),$imgLoadMoreBox=!0,$scope.$apply()):$imgLoadMoreBox=!1:2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))});var deleteResourceFunc=function(a){var b="";for(var c in a)b+=a[c]+",";$.ajax({url:ruyiai_host+"/ruyi-ai/delete/"+appId+"/multimedia",data:{listid:b},method:"GET",success:function(b){if(b=dataParse(b),0==b.code){for(var c in a)if("image"==$scope.resType)for(var d in $scope.resImgList)a[c]==$scope.resImgList[d].id&&$scope.resImgList.splice(d,1);else if("voice"==$scope.resType)for(var d in $scope.resVoiceList)a[c]==$scope.resVoiceList[d].id&&$scope.resVoiceList.splice(d,1);else if("video"==$scope.resType)for(var d in $scope.resVideoList)a[c]==$scope.resVideoList[d].id&&$scope.resVideoList.splice(d,1);$scope.$apply()}else 2==b.code?goIndex():b.msg&&$.trace(b.msg+"( "+b.detail+" )","error")}})};$("body").off("click",".image-operation .delete").on("click",".image-operation .delete",function(a){var b=$(this),c=b.closest(".image-operation").attr("data-id"),d=b.closest(".image-operation").attr("data-title");$.confirm({text:'你确定要删除"'+d+'"吗？',title:"删除",ensureFn:function(){var a=[c];deleteResourceFunc(a)}})}),$("body").off("click",".image-operation .edit").on("click",".image-operation .edit",function(a){var b=$(this),c=b.closest(".image-operation").attr("data-id"),d=b.closest(".image-operation").attr("data-title");$("#updateResource").modal("show"),$("[data-act=resource-name]").val(d),$("[data-act=resource-id]").val(c)}),$("body").off("keydown","[data-act=resource-name]").on("keydown","[data-act=resource-name]",function(a){$(this);13==a.keyCode&&$("[data-act=submit-rename-resource]").trigger("click")}),$("#updateResource").on("shown.bs.modal",function(){$("[data-act=resource-name]").focus()}),$("body").off("click","[data-act=submit-rename-resource]").on("click","[data-act=submit-rename-resource]",function(a){var b=$("[data-act=resource-name]"),c=$("[data-act=resource-id]");0==$.trim(b.val()).length&&$.trace("资源名称不能为空"),$.ajax({url:ruyiai_host+"/ruyi-ai/update/"+appId+"/multimedia",data:{id:c.val(),name:b.val()},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){if("image"==$scope.resType){for(var b in $scope.resImgList)if(a.result&&$scope.resImgList[b].id==a.result.id){$scope.resImgList[b]=a.result;break}}else if("voice"==$scope.resType){for(var b in $scope.resVoiceList)if(a.result&&$scope.resVoiceList[b].id==a.result.id){$scope.resVoiceList[b]=a.result;break}}else if("video"==$scope.resType)for(var b in $scope.resVideoList)if(a.result&&$scope.resVideoList[b].id==a.result.id){$scope.resVideoList[b]=a.result;break}$scope.$apply(),$.trace("素材名称修改成功","success"),$("#updateResource").modal("hide")}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})}),$("body").off("click","[data-act=img-box-active]").on("click","[data-act=img-box-active]",function(a){var b=$(this),c=b.parent(".image-box-li"),d=c.attr("data-id");for(var e in $scope.resImgList)$scope.resImgList[e].id==d?$scope.resImgList[e].active?$scope.resImgList[e].active=!1:$scope.resImgList[e].active=!0:$scope.resImgList[e].active=!1;$scope.$apply()}),$("body").off("click","[data-act=all-choose]").on("click","[data-act=all-choose]",function(a){var b=$(this),c=b.find("input");if("image"==$scope.resType)if(c.is(":checked"))for(var d in $scope.resImgList)$scope.resImgList[d].active=!0;else for(var d in $scope.resImgList)$scope.resImgList[d].active=!1;else if("voice"==$scope.resType)if(c.is(":checked"))for(var d in $scope.resVoiceList)$scope.resVoiceList[d].active=!0;else for(var d in $scope.resVoiceList)$scope.resVoiceList[d].active=!1;else if("video"==$scope.resType)if(c.is(":checked"))for(var d in $scope.resVideoList)$scope.resVideoList[d].active=!0;else for(var d in $scope.resVideoList)$scope.resVideoList[d].active=!1;$scope.$apply()}),$("body").off("click","[data-act=all-delete]").on("click","[data-act=all-delete]",function(a){$.confirm({text:"你确定要批量删除所选素材吗？",title:"删除",ensureFn:function(){var a=($(this),0),b=[];if("image"==$scope.resType)for(var c in $scope.resImgList)$scope.resImgList[c].active&&(b.push($scope.resImgList[c].id),a++);else if("voice"==$scope.resType)for(var c in $scope.resVoiceList)$scope.resVoiceList[c].active&&(b.push($scope.resVoiceList[c].id),a++);else if("video"==$scope.resType)for(var c in $scope.resVideoList)$scope.resVideoList[c].active&&(b.push($scope.resVideoList[c].id),a++);0==a?$.trace("你未选择要删除的素材"):deleteResourceFunc(b)}})});var $voiceLoadMoreBox=!0;$("[data-act=voice-box]").on("scroll",function(a){var b=$(this),c=b[0].scrollTop,d=b[0].scrollHeight,e=b.height();c>=d-e-45&&1==$voiceLoadMoreBox&&($voiceLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:$scope.resVoiceList[$scope.resVoiceList.length-1].createTime,size:pageSize},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0?($scope.loadResourceListFunc(a.result,loadnext),$voiceLoadMoreBox=!0,$scope.$apply()):$voiceLoadMoreBox=!1:2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))});var $videoLoadMoreBox=!0;$("[data-act=video-box]").on("scroll",function(a){var b=$(this),c=b[0].scrollTop,d=b[0].scrollHeight,e=b.height();c>=d-e-45&&1==$videoLoadMoreBox&&($videoLoadMoreBox=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:$scope.resType,beforeTime:$scope.resVideoList[$scope.resVideoList.length-1].createTime,size:pageSize},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0?($scope.loadResourceListFunc(a.result,loadnext),$imgLoadMoreBox=!0,$scope.$apply()):$imgLoadMoreBox=!1:2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$("body").off("click","#voice .delete,#video .delete").on("click","#voice .delete,#video .delete",function(a){var b=$(this),c=b.closest("tr").attr("data-id"),d=b.closest("tr").attr("data-title");$.confirm({text:'你确定要删除"'+d+'"吗？',title:"删除",ensureFn:function(){var a=[c];deleteResourceFunc(a)}})}),$("body").off("click","#voice .edit,#video .edit").on("click","#voice .edit,#video .edit",function(a){var b=$(this),c=b.closest("tr").attr("data-id"),d=b.closest("tr").attr("data-title");$("#updateResource").modal("show"),$("[data-act=resource-name]").val(d),$("[data-act=resource-id]").val(c)}),$("body").off("click","[name=local-choosed-voice]").on("click","[name=local-choosed-voice]",function(a){}),$scope.localResourceSetFunc=function(a,b){if($scope.currentWechatParentIndex=a,$scope.currentWechatIndex=b,$("#localResourceModal").modal("show"),-1!=a){var c=$scope.localOutouts[a][b];switch(c.type){case"image":$("#customize-image-chosen").trigger("click"),$("#customize-image-name").val(c.property.name),$("#customize-image-url").val(c.property.image_url);break;case"voice":$("#customize-voice-chosen").trigger("click"),$("#customize-voice-name").val(c.property.name),$("#customize-voice-url").val(c.property.voice_url);break;case"video":$("#customize-video-chosen").trigger("click"),$("#customize-video-name").val(c.property.name),$("#customize-video-url").val(c.property.video_url)}}else $("#localResourceModal #myTab-local").children().eq(0).children("a").trigger("click"),resetCustomize();setTimeout(function(){initStyle()},200)};var findResourceObjectById=function(a,b){for(var c in a)if(a[c].id==b)return a[c]},findResourceObjectByActive=function(a){for(var b in a)if(a[b].active)return a[b]},createOrUpdateOutputsWechatFunc=function(a){var b=!1;for(var c in $scope.wechatOutputs)if(!b)for(var d in $scope.wechatOutputs[c])if(c==$scope.currentWechatParentIndex&&d==$scope.currentWechatIndex){b=!0,$scope.wechatOutputs[c]||($scope.wechatOutputs[c]=[]),$scope.wechatOutputs[c][d]=a;break}b||($scope.wechatOutputs[$scope.currentWechatIndex]||($scope.wechatOutputs[$scope.currentWechatIndex]=[]),$scope.wechatOutputs[$scope.currentWechatIndex].push(a)),$scope.$apply()},createOrUpdateOutputsLocalFunc=function(a){var b=!1;for(var c in $scope.localOutouts)if(!b)for(var d in $scope.localOutouts[c])if(c==$scope.currentWechatParentIndex&&d==$scope.currentWechatIndex){b=!0,$scope.localOutouts[c]||($scope.localOutouts[c]=[]),$scope.localOutouts[c][d]=a;break}b||($scope.localOutouts[$scope.currentWechatIndex]||($scope.localOutouts[$scope.currentWechatIndex]=[]),$scope.localOutouts[$scope.currentWechatIndex].push(a)),$scope.$apply()};$scope.localResourceSubFunc=function(){var a=$(".choose-response.active"),b=a.attr("data-type"),c={},d={};if("image"==b)dataEditedFlag=!0,c=findResourceObjectByActive($scope.resImgList),d=createOutputObjectFunc(c.type,c.title,c.url,"");else if("voice"==$scope.resType){dataEditedFlag=!0;var e=$("[name=local-choosed-voice]:checked"),f=e.closest("tr");c=findResourceObjectById($scope.resVoiceList,f.attr("data-id")),d=createOutputObjectFunc(c.type,c.title,c.url,"")}else if("video"==b){dataEditedFlag=!0;var e=$("[name=local-choosed-video]:checked"),f=e.closest("tr");c=findResourceObjectById($scope.resVideoList,f.attr("data-id")),d=createOutputObjectFunc(c.type,c.title,c.url,"")}else if("customize"==b){dataEditedFlag=!0;var g=$("#customize .video-box .customize-body .active"),h=g.attr("id");if("customize-image-detail"==h){var i=$("#customize-image-name").val(),j=$("#customize-image-url").val();d=createOutputObjectFunc("image",i,j,"")}else if("customize-voice-detail"==h){var i=$("#customize-voice-name").val(),j=$("#customize-voice-url").val();d=createOutputObjectFunc("voice",i,j,"")}else if("customize-video-detail"==h){var i=$("#customize-video-name").val(),j=$("#customize-video-url").val();d=createOutputObjectFunc("video",i,j,"")}}createOrUpdateOutputsLocalFunc(d),$("#localResourceModal").modal("hide")},$("body").off("click",".response-action").on("click",".response-action",function(a){a.stopPropagation();var b=$(this),c=b.closest(".response-group").find(".response-box");"0px"==c.css("height")?c.animate({height:"100%"}):c.animate({height:"0"})});var createOutputObjectFunc=function(a,b,c,d,e,f){var g=new Object;switch(g.type=a,g.property=new Object,a){case"dialog":g.property.text=b;break;case"wechat.text":g.property.text=b;break;case"image":g.property.name=b,g.property.image_url=c;break;case"wechat.image":g.property.name=b,g.property.title=b,g.property.media_id=d,g.property.image_url=c;break;case"voice":g.property.name=b,g.property.voice_url=c;break;case"wechat.voice":g.property.name=b,g.property.title=b,g.property.media_id=d;break;case"video":g.property.name=b,g.property.video_url=c;break;case"wechat.video":g.property.name=b,g.property.title=b,g.property.media_id=d;break;case"wechat.news":f&&f.length>0?(g.list=f,g.property.name=f[0].title):(g.property.name=b,g.property.title=b,g.property.media_id=d);break;case"wechat.music":g.property.name=b,g.property.title=b,g.property.music_url=c,g.property.description=e}return g},checkDialogObjectExists=function(a,b,c){var d=!1;if(a)for(var e in a)if(a[e]&&a[e].property.text==b&&a[e].type==c){d=!0;break}return d};$scope.addTextOutputWechatFunc=function(a,b,c,d,e){return checkIsChangeValue!=b&&(dataEditedFlag=!0),!b||$.trim(b).length<=0?!1:void setTimeout(function(){var a=createOutputObjectFunc(e,b,"",""),f=!1;for(var g in $scope.wechatOutputs)if(!f)for(var h in $scope.wechatOutputs[g])if(g==c&&h==d){f=!0,$scope.wechatOutputs[g]||($scope.wechatOutputs[g]=[]),$scope.wechatOutputs[g][h]=a;break}f||($scope.wechatOutputs[d]||($scope.wechatOutputs[d]=[]),checkDialogObjectExists($scope.wechatOutputs[d],b,e)?$("[data-act=outputText]").val()&&$("[data-act=outputText]").val().length>0&&$.trace("此机器人答已经存在，重复的只会保留一条"):($scope.wechatOutputs[d].push(a),$("[data-act=outputText]").val(""))),$scope.$apply(),$('[data-toggle="tooltip"]').tooltip()},200)};var deleteEmptyAssistantAnswerFunc=function(a,b,c,d){for(var e in a)for(var f in a[e])if(e==c&&f==d)return void a[e].splice(e,1)};$scope.addTextOutputLocalFunc=function(a,b,c,d,e){return console.log("parentIndex:"+c),console.log("index:"+d),console.log("outputText:"+b),checkIsChangeValue!=b&&(dataEditedFlag=!0),!b||$.trim(b).length<=0?(deleteEmptyAssistantAnswerFunc($scope.localOutouts,b,c,d),!1):(console.log("错了"),void setTimeout(function(){var a=createOutputObjectFunc(e,b,"",""),f=!1;for(var g in $scope.localOutouts)if(!f)for(var h in $scope.localOutouts[g])if(g==c&&h==d){f=!0,$scope.localOutouts[g]||($scope.localOutouts[g]=[]),$scope.localOutouts[g][h]=a;break}f||($scope.localOutouts[d]||($scope.localOutouts[d]=[]),checkDialogObjectExists($scope.localOutouts[d],b,e)?$("[data-act=outputText-local]").val()&&$("[data-act=outputText-local]").val().length>0&&$.trace("此机器人答已经存在，重复的只会保留一条"):($scope.localOutouts[d].push(a),$("[data-act=outputText-local]").val(""))),$scope.$apply(),$('[data-toggle="tooltip"]').tooltip()},200))},$scope.addTextOutputWechatKeydownFunc=function(a,b,c,d,e){13==a.keyCode&&$scope.addTextOutputWechatFunc(a,b,c,d,e)},$scope.addTextOutputLocalKeydownFunc=function(a,b,c,d,e){13==a.keyCode&&$scope.addTextOutputLocalFunc(a,b,c,d,e)},$scope.deleteOutputWechatFunc=function(a,b){setTimeout(function(){dataEditedFlag=!0;for(var c in $scope.wechatOutputs)for(var d in $scope.wechatOutputs[c])if(c==a&&d==b){$scope.wechatOutputs[c].splice(d,1);break}$scope.$apply()},200)},$scope.deleteOutputLocalFunc=function(a,b){setTimeout(function(){for(var c in $scope.localOutouts)for(var d in $scope.localOutouts[c])if(c==a&&d==b){$scope.localOutouts[c].splice(d,1),dataEditedFlag=!0;break}$scope.$apply()},200)},$scope.copyOutputWechatFunc=function(a,b){for(var c in $scope.wechatOutputs)for(var d in $scope.wechatOutputs[c])if(c==a&&d==b){var e=$scope.wechatOutputs[c][d],f={type:"wechat.text",property:{text:e.property.text+"(副本)"}};$scope.wechatOutputs[c].push(f),dataEditedFlag=!0;break}},$scope.copyOutputLocalFunc=function(a,b){for(var c in $scope.localOutouts)for(var d in $scope.localOutouts[c])if(c==a&&d==b){var e=$scope.localOutouts[c][d],f={type:"wechat.text",property:{text:e.property.text+"(副本)"}};$scope.localOutouts[c].push(f),dataEditedFlag=!0;break}},$scope.editUserSayTextarea=function(a){$("#editUserSayTextarea").modal("show"),$("#userSayTextarea").attr("myIndex",a),$("#userSayTextarea").val($scope.intentDetail.templates[a]),setTimeout(function(){$("#userSayTextarea").focus()},200)},$scope.editUserSayTextareaSubmitFunc=function(){var a=!1,b=$("#userSayTextarea"),c=b.val(),d=b.attr("myIndex");$scope.intentDetail.templates[d]!=b.val()&&(dataEditedFlag=!0),$($scope.intentDetail.templates).each(function(b,e){$.trim(c)===$.trim(e)&&(b!=d&&$.trace("此用户说已经存在，重复的只会保留一条"),$("[data-act=user-sys-update]").eq(d).text(c),a=!0)}),a||($scope.intentDetail.templates[d]=c),$("#editUserSayTextarea").modal("hide")};var assistantEditStatus="isEmpty",checkAssistantEditStatusFunc=function(a){var b="";return $("[data-act="+a+"]").each(function(){$.trim($(this).val()).length>0&&(b=$(this).val())}),assistantEditStatus=b?"notEmpty":"isEmpty",b};$scope.editOutputWechatFunc=function(a,b){var c=checkAssistantEditStatusFunc("outputText");$("#editWeixinTextarea").modal("show");var d=$("#weixinTextarea");if(d.attr("myIndex",b),d.attr("parentIndex",a),-1==b){if($("#editor-iframe-box-wechat").html('<iframe id="editor-iframe-wechat" name="editor-iframe-wechat" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),!c||0==c.length)return!1;d.val(c);var e=setInterval(function(){try{$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val(c),$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(a){}},20)}else{$("#editor-iframe-box-wechat").html('<iframe id="editor-iframe-wechat" name="editor-iframe-wechat" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),d.val($scope.wechatOutputs[a][b].property.text);var e=setInterval(function(){try{$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val($scope.wechatOutputs[a][b].property.text),$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(c){}},20)}},$scope.editOutputLocalFunc=function(a,b){var c=checkAssistantEditStatusFunc("outputText-local");console.log("outputTextLocal:"+c),$("#editLocalTextarea").modal("show");var d=$("#localTextarea");if(d.attr("myIndex",b),d.attr("parentIndex",a),-1==b){if($("#editor-iframe-box-local").html('<iframe id="editor-iframe-local" name="editor-iframe-local" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),!c||0==c.length)return!1;d.val(c);var e=setInterval(function(){try{$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val(c),$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(a){}},20)}else{$("#editor-iframe-box-local").html('<iframe id="editor-iframe-local" name="editor-iframe-local" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),d.val($scope.localOutouts[a][b].property.text);var e=setInterval(function(){try{$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val($scope.localOutouts[a][b].property.text),$(window.frames["editor-iframe-local"].document).find("#editor_content_temp").val().length>0&&clearInterval(e)}catch(c){}},20)}},$scope.wechatTextFilter=function(a){return"wechat.text"==a.type?!0:!1},$scope.wechatMediaFilter=function(a){return a.type.indexOf("wechat.")>-1&&"wechat.text"!=a.type?!0:!1},$scope.addMoreResponseFunc=function(){var a=$("[data-act=response-type].active").find(".add-more-response section").attr("data-type");"wechat"==a?$scope.wechatOutputs?$scope.wechatOutputs.push([]):$scope.wechatOutputs=[[]]:"local"==a&&($scope.localOutouts?$scope.localOutouts.push([]):$scope.localOutouts=[[]]),setTimeout(function(){$("[data-act=response-type].active").find(".response-box:last").css("height","100%")},200)},$("body").off("click","[data-act=delete-response-block]").on("click","[data-act=delete-response-block]",function(a){var b=$(this).attr("data-index"),c=$(this).attr("data-type");b=+b,a.stopPropagation(),$.confirm({text:"你确定要删除吗？",title:"删除",ensureFn:function(){dataEditedFlag=!0,"wechat"==c?$scope.wechatOutputs&&$scope.wechatOutputs.splice(b,1):"local"==c&&$scope.localOutouts&&$scope.localOutouts.splice(b,1),$scope.$apply()}})}),$scope.editWeixinTextareaSubmitFunc=function(){var a=!1,b=$("#weixinTextarea"),c=b.attr("parentIndex"),d=b.attr("myIndex"),e=$(window.frames["editor-iframe-wechat"].document).find("#editor_content_textarea").val();if(-1==d||"-1"==d){var f=createOutputObjectFunc("wechat.text",e,"","");dataEditedFlag=!0,"isEmpty"==assistantEditStatus?e&&$.trim(e).length>0&&($($scope.wechatOutputs[c]).each(function(b,c){$.trim(e)===$.trim(c.property.text)&&($.trace("此机器人答已经存在，重复的只会保留一条"),a=!0)}),a?$(".input-weixin").eq(d).val(e):$scope.wechatOutputs[c].push(f)):"notEmpty"==assistantEditStatus&&(console.log("not"),$scope.wechatOutputs[c][$scope.wechatOutputs[c].length-1]=f)}else b.val(e),$scope.wechatOutputs[c][d].property.text!=b.val()&&(dataEditedFlag=!0),$($scope.wechatOutputs[c]).each(function(a,b){b.property.text===e&&($.trace("此机器人答已经存在，重复的只会保留一条"),$scope.isExits=!0)}),$scope.wechatOutputs[c][d].property.text=e;$("#editWeixinTextarea").modal("hide")},$scope.editLocalTextareaSubmitFunc=function(){var a=$("#localTextarea"),b=a.attr("parentIndex"),c=a.attr("myIndex"),d=$(window.frames["editor-iframe-local"].document).find("#editor_content_textarea").val();if(-1==c||"-1"==c){var e=createOutputObjectFunc("dialog",d,"","");dataEditedFlag=!0,"isEmpty"==assistantEditStatus?d&&d.length>0&&($($scope.localOutouts[b]).each(function(a,b){$.trim(d)===$.trim(b.property.text)&&($.trace("此机器人答已经存在，重复的只会保留一条"),$scope.isExits=!0)}),$scope.isExits?$(".input-local").eq(c).val(d):$scope.localOutouts[b].push(e)):"notEmpty"==assistantEditStatus&&($scope.localOutouts[b][$scope.localOutouts[b].length-1]=e)}else a.val(d),$scope.localOutouts[b][c].property.text!=a.val()&&(dataEditedFlag=!0),$($scope.localOutouts[b]).each(function(a,b){$.trim(b.property.text)===$.trim(d)&&($.trace("此机器人答已经存在，重复的只会保留一条"),$scope.isExits=!0)}),$scope.localOutouts[b][c].property.text=a.val();$("#editLocalTextarea").modal("hide")},$scope.addNewsFunc=function(){var a="<div class='customize-news clearfix' style='margin-top: 20px;'><div class='form-group' style='margin-bottom: 0;'><div class='col-md-10  col-md-offset-1'><label>名称：</label><input autocomplete='off' style='border-radius: 0px; box-shadow: none; border-top: 1px solid rgba(0,0,0,0);border-right: 1px solid rgba(0,0,0,0);' type='text' required='required' class='form-control weixin-customize-news-name' placeholder='名称' /></div></div><div class='form-group' style='margin-bottom: 0;'><div class='col-md-10  col-md-offset-1'><label>摘要：</label><textarea style='border-radius: 0px; box-shadow: none; vertical-align: middle;border-right: 1px solid rgba(0,0,0,0);width:85%;max-width:85%;' required='required' class='form-control weixin-customize-news-abstract' placeholder='摘要'></textarea> </div></div><div class='form-group' style='margin-bottom: 25px;'><div class='col-md-10  col-md-offset-1'><label>封面URL：</label><input autocomplete='off' style='border-radius: 0px; box-shadow: none;border-right: 1px solid rgba(0,0,0,0);' type='text' required='required' class='form-control weixin-customize-news-url' placeholder='封面URL' /></div></div><div class='form-group' style='margin-bottom: 25px;'><div class='col-md-10  col-md-offset-1'><label>跳转链接：</label><input autocomplete='off' style='border-radius: 0px; box-shadow: none;border-right: 1px solid rgba(0,0,0,0);' type='text' required='required' class='form-control weixin-customize-news-jumpto' placeholder='跳转链接' /></div></div><div class='form-group' style='margin-bottom: 25px;'><div class='col-md-10  col-md-offset-1'><div class='delete-customize-news'>&nbsp;</div></div></div></div>";$("#weixin-customize-news-detail .customize-news-body").append(a),setTimeout(function(){$("#weixin-customize .customize-news-body").scrollTop($("#weixin-customize .customize-news-body")[0].scrollHeight)},0)},$("#weixin-customize-news-detail").delegate(".delete-customize-news","click",function(){var a=$(this);$.confirm({text:"你确定要删除此图文消息吗？",title:"删除",ensureFn:function(){a.parents(".customize-news").remove()}})}),$(".speach-response .nav li").click(function(){setCookie("app_response",$(this).attr("class"))}),$("body").off("keyup",".user-says-input").on("keyup",".user-says-input",function(a){if(50==a.which){var b=$(this);setTimeout(function(){checkAt(b)},200)}}),$("body").off("mouseover",".user-box-row").on("mouseover",".user-box-row",function(){$(this).addClass("on").siblings(".user-box-row").removeClass("on")}),$("body").off("click",".user-box-row").on("click",".user-box-row",function(a){var b=$(this),c=b.closest(".user-box").siblings(".writing-bg").find("input"),d=b.closest(".mention-popup").siblings(".user-says-input");return choseFriend(c,d,!1),b.closest(".mention-popup").remove(),a.stopPropagation(),!1}),$("body").off("focusout","#mention-input").on("focusout","#mention-input",function(a){setTimeout(function(){$(".mention-popup").remove()},200)}),$("body").off("keyup","#mention-input").on("keyup","#mention-input",function(a){var b=$(this),c=b.closest(".mention-popup").siblings(".user-says-input");if("27"==a.keyCode)return choseFriend(b,c,!0),$("body").find(".mention-popup").remove(),!1;if("13"==a.keyCode){if(b.closest(".mention-popup").find(".user-box-row.on").length)return choseFriend(b,c,!1),b.closest(".mention-popup").remove(),!1}else{if("38"==a.keyCode&&b.closest(".mention-popup").find(".user-box-row.on").prev(".user-box-row").length){var d=b.closest(".mention-popup").find(".user-box-row.on");return d.prev(".user-box-row").addClass("on").siblings(".user-box-row").removeClass("on"),!1}if("40"==a.keyCode&&b.closest(".mention-popup").find(".user-box-row.on").next(".user-box-row").length){var d=b.closest(".mention-popup").find(".user-box-row.on");return d.next(".user-box-row").addClass("on").siblings(".user-box-row").removeClass("on"),!1}autoGetPrompt(b.val())}}),$("body").off("click",".upload-resource-button").on("click",".upload-resource-button",function(a){$("#localResourceModal").modal("hide"),setTimeout(function(){window.location.href="#/resource"},500)}),$("body").off("click","[data-act=action-list-trigger]").on("click","[data-act=action-list-trigger]",function(){var a=($(this),$(".my-action-name-list"));"block"==a.css("display")?a.css("display","none"):a.css("display","block")}),$scope.getActionListFunc=function(){$.ajax({url:ruyiai_host+"/ruyi-ai/action/query/list",data:{appId:appId,start:0,limit:1e3},method:"get",success:function(a){a=dataParse(a),0==a.code?($scope.actionList=a.result,$scope.$apply()):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})},$("body").off("click",".my-action-name-list li").on("click",".my-action-name-list li",function(){var a=$(this);$scope.response.action=a.text(),$scope.$apply(),$(".my-action-name-list").css("display","none")}),setTimeout(function(){$scope.getActionListFunc()},2e3),$("body").off("click",".intent-detail-more").on("click",".intent-detail-more",function(a){var b=$(this),c=$(".intent-detail-more-box");"block"==c.css("display")?(c.css("display","none"),b.find("i").removeClass("icon-arrow-down").addClass("icon-arrow-right"),supports_html5_storage()&&localStorage.removeItem("intentDetailMore"+$stateParams.intent_id)):(c.css("display","block"),b.find("i").removeClass("icon-arrow-right").addClass("icon-arrow-down"),supports_html5_storage()&&localStorage.setItem("intentDetailMore"+$stateParams.intent_id,"open"))}),supports_html5_storage()&&"open"==localStorage.getItem("intentDetailMore"+$stateParams.intent_id)&&($(".intent-detail-more-box").css("display","block"),$(".intent-detail-more").find("i").removeClass("icon-arrow-right").addClass("icon-arrow-down")),$scope.commonIntentDetailChange=function(){dataEditedFlag=!0},setTimeout(function(){$("#timeoutSt").tooltip({container:"body"})},0);var scale=function(a,b,c,d){this.input=document.getElementById(a),this.yuan=document.getElementById(b),this.jindu=document.getElementById(c),this.tiao=document.getElementById(d),this.tiaoW=this.tiao.offsetWidth,this.init()};scale.prototype={init:function(){var a=!1,b=this,c=Math,d=document.body,e=1,f=5e3;b.yuan.onmousedown=function(e){a=!0;var f=e.clientX,g=this.offsetLeft,h=b.tiao.offsetWidth-this.offsetWidth;d.onmousemove=function(d){if(0!=a){var e=d.clientX,i=c.min(h,c.max(-2,g+(e-f)));b.input.value=parseInt(5e3*c.max(0,i/h))+" ms",b.yuan.style.marginLeft=parseInt(b.input.value)/5e3*b.tiaoW+"px",b.jindu.style.width=parseInt(b.input.value)/5e3*b.tiaoW+"px",$("#yuan").attr("data-original-title",b.input.value)}}},d.onmouseup=function(){a=!1,b.input.value=parseInt(b.input.value),b.input.value=b.input.value<e?e:b.input.value,b.input.value=b.input.value>f?f:b.input.value,b.input.value=parseInt(b.input.value)+" ms"},b.input.onblur=function(){var a=parseInt(b.input.value),c=1*a;if(c>f||e>c)return void(b.input.value=parseInt(b.input.value)+" ms");"NaN"==c.toString()&&(c=1,b.input.value="1 ms");var d=c/5e3*b.tiaoW;b.yuan.style.marginLeft=d+"px",b.jindu.style.width=d+"px",$("#yuan").attr("data-original-title",b.input.value)},b.input.onkeypress=function(a){var c=a.keyCode;13==c&&(b.input.blur(),b.input.focus(),b.input.value=parseInt(b.input.value)+" ms")},b.input.onkeydown=function(a){a.keyCode<48||a.keyCode>57}}},new scale("timeoutSt","yuan","jindu","tiao"),$(".numberBtn").on("click",".plusNumber",function(){var a=parseInt($("#timeoutSt").val())+1;a=a>5e3?5e3:a,$("#timeoutSt").val(a+" ms"),$("#timeoutSt").blur(),$(this).hasClass("active")||($(".numberBtn .active").removeClass("active"),$(this).addClass("active"))}),$(".numberBtn").on("click",".reduceNumber",function(){var a=parseInt($("#timeoutSt").val())-1;a=0>=a?1:a,$("#timeoutSt").val(a+" ms"),$("#timeoutSt").blur(),$(this).hasClass("active")||($(".numberBtn .active").removeClass("active"),$(this).addClass("active"))})}function userLogsStatisticsCtrl(a,b,c,d){function e(){$(window).width()>=990?($("#call-rate").css("width",$(window).width()/2-160+"px"),
$("#tendency-chart").css("width",$(window).width()/2-160+"px")):($("#call-rate").css("width","90%"),$("#tendency-chart").css("width","90%")),$("#tendency-chart").css("height",$(window).height()-540+"px"),$("#call-rate").css("height",$(window).height()-520+"px")}$(".list-group-item").removeClass("active"),$("[data-act=nav-log-statistics]").addClass("active"),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200);var f=function(a){var b=[];for(var c in a){var d=[a[c].name+"("+a[c].count+")",parseInt(a[c].count)];b.push(d)}return b},g=function(a){var b=f(a);$("#call-rate").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:""},tooltip:{pointFormat:"{point.value}{series.count}{series.name}<b>-{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>-{point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"调用比例",data:b}]})},h=function(a){$("#tendency-chart").highcharts({title:{text:"",x:-20},subtitle:{text:"",x:-20},xAxis:{categories:a.dataList},yAxis:{title:{text:""},plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{valueSuffix:""},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},series:[{name:"活跃用户",data:a.activeUserList,color:"#F7A35C"},{name:"新增用户",data:a.newAddUserCountList,color:"#90ED7D"},{name:"新增交互",data:a.msgCountList,color:"#7DB6EC"}]})},i=function(a){$.ajax({url:ruyiai_host+"/ruyi-ai/app/tendency/chart",data:{appId:appId,type:a},method:"GET",success:function(a){h(a.result)}})};i("week"),e(),$(window).resize(function(){e()});b.getStatisticsDataFunc=function(c){$.ajax({url:ruyiai_host+"/ruyi-ai/app/stat2/"+appId,data:{type:c},timeout:2e3,method:"GET",success:function(c){c&&(c=dataParse(c),0==c.code?(c=c.result,b.statistics=c,$("[data-act=tips-text]").css("display","none"),$("[data-act=statistics-all-box]").css("display","block"),b.$apply(),a.$apply()):2==c.code?goIndex():c.msg&&$.trace(c.msg+"( "+c.detail+" )","error"))},complete:function(a,b){"timeout"==b&&($("[data-act=tips-text]").css("display","none"),$("[data-act=empty-tips]").css("display","block"))}})},b.getStatisticsDataFunc("today");$("body").off("click","[data-act=copy-link]").on("click","[data-act=copy-link]",function(a){a.stopPropagation();var b=($(this),navigator.userAgent);if(b.indexOf("Firefox")>-1||b.indexOf("Chrome")>-1){var c=document.getElementById("html5-link");c.value=encodeURI($("#html5-link").val()),c.select(),document.execCommand("Copy"),$.trace("已复制，可直接贴粘。","success")}}),b.exportHtml5LinkFunc=function(a,c){b.htmlLink=static_host+"/h5-wechat/wechat.html?appName="+a+"&appKey="+c,$("#export-html5-link").modal("show")},$("#export-html5-link").on("shown.bs.modal",function(){setTimeout(function(){$("#html5-link-extend").focus(),$("#html5-link-extend").select()},200)}),$("body").off("click","[data-act=nav-tabs-statistics] li").on("click","[data-act=nav-tabs-statistics] li",function(a){var c=$(this),d=c.attr("data-act");c.hasClass("active")||c.addClass("active").siblings("li").removeClass("active"),b.getStatisticsDataFunc(d)}),$("body").off("click","[data-act=nav-tabs-trend] li").on("click","[data-act=nav-tabs-trend] li",function(a){var b=$(this),c=b.attr("data-act");b.hasClass("active")||b.addClass("active").siblings("li").removeClass("active"),i(c)});var j=function(a){$.ajax({url:ruyiai_host+"/ruyi-ai/app/skill/request/spread",data:{appId:appId,type:a},method:"GET",success:function(a){g(a.result)}})};j(),$("body").off("click","[data-act=nav-tabs-sys-robot] li").on("click","[data-act=nav-tabs-sys-robot] li",function(a){var b=$(this),c=b.attr("data-act");b.hasClass("active")||b.addClass("active").siblings("li").removeClass("active"),console.log("绘制扇形图："+c),j(c)})}function referenceAppCtrl(a,b,c,d){$(".list-group-item").removeClass("active"),$("[data-act=nav-reference]").addClass("active"),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200),$('[data-toggle="popover"]').popover(),$(".edit-service").click(function(){$(".selected-service-box").css("display","none"),$(".all-service-box").css("display","block"),setTimeout(function(){e()},10)}),b.referencedAppIds=[],$(window).resize(function(){e()});var e=function(){var a=$(".choosed-service-box").css("height");a&&(a=a.replace("px",""),a=parseInt(a));var b=$(document).height();620>=b?$(".confirm-service").css("bottom","50px"):b>620&&720>=b?$(".confirm-service").css("bottom","40px"):$(".confirm-service").css("bottom","20px"),$("[data-act=service-table-set]").css("height",$(document).height()-a-155-80),$("[data-act=service-table-set]").css("height",$(document).height()-a-155-80)};e(),b.getAppDetailFunc=function(a){$.ajax({url:ruyiai_host+"/ruyi-ai/app/"+appId,method:"GET",success:function(a){a=dataParse(a),0==a.code?(b.appDetail=a.result,b.referencedAppIds=b.appDetail.referencedApp,b.$apply(),b.referencedAppIds&&b.referencedAppIds.length>0?($(".selected-service-box").css("display","block"),b.fetchReferenceFunc(b.referencedAppIds)):($(".all-service-box").css("display","block"),b.fetchReferenceFunc())):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})},b.getAppDetailFunc();var f=[];b.referencedAppList=[],b.fetchReferenceFunc=function(a){$.ajax({url:ruyiai_host+"/ruyi-ai/app/public/list",data:{limit:100},method:"GET",success:function(c){if(c=dataParse(c),0==c.code){if(c.result&&c.result.length>0){if(b.publicAppList=c.result,a&&a.length>0){for(var d in a)for(var e in b.publicAppList)if(a[d]==b.publicAppList[e].id){f.push(b.publicAppList[e]),b.publicAppList.splice(e,1);break}b.referencedAppList=f}b.$apply()}}else 2==c.code?goIndex():c.msg&&$.trace(c.msg+"( "+c.detail+" )","error")}})},b.selectAppServiceFunc=function(a){var c={};for(var d in b.publicAppList)b.publicAppList[d].id==a&&(c=b.publicAppList[d],b.publicAppList.splice(d,1));b.referencedAppList.push(c);var f=$(".choosed-service-box").height(),g=534-f;$(".chose-line .service-table").css("height",g+"px"),e()},b.removeAppServiceFunc=function(a){var c={};for(var d in b.referencedAppList)b.referencedAppList[d].id==a&&(c=b.referencedAppList[d],b.referencedAppList.splice(d,1));b.publicAppList.push(c)},b.updateAppInfoFucn=function(){$.ajax({url:ruyiai_host+"/ruyi-ai/app/"+appId,data:JSON.stringify(b.appDetail),traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(a){a=dataParse(a),0==a.code?($(".selected-service-box").css("display","block"),$(".all-service-box").css("display","none"),callAgentReloadTestFunc()):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})},b.submitServiceApp=function(){var a=[];for(var c in b.referencedAppList)a.push(b.referencedAppList[c].id);b.appDetail.referencedApp=a,b.updateAppInfoFucn(),$(".selected-service-box").css("display","block"),$(".all-service-box").css("display","none")},$('[data-toggle="popover"]').click(function(){var a=$(this),b=$(".popover-content");setTimeout(function(){b.attr("class")||a.popover("show")},200)}),$(".sortable").sortable(),$(".sortable").disableSelection(),$(".sortable").sortable({stop:function(a,c){var d=[],e=[],f=$("[data-act=selected-tr]");$.each(f,function(a,b){var c=$(b);d.push(c.attr("data-id"))});for(var g in d)for(var h in b.referencedAppList)if(d[g]==b.referencedAppList[h].id){e.push(b.referencedAppList[h]);break}b.referencedAppList=e,b.$apply(),b.appDetail.referencedApp=d,b.updateAppInfoFucn()}})}function resourceCtrl(a,b,c,d){$(".list-group-item").removeClass("active"),$("[data-act=nav-resource]").addClass("active"),$('[data-toggle="popover"]').popover(),$('[data-toggle="popover"]').click(function(){var a=$(this),b=$(".popover-content");setTimeout(function(){b.attr("class")||a.popover("show")},200)}),b.addResListTemp=[],b.resType="image";var e="pre",f="next",g=20,h=function(){$(".resource-manager .image-box").css("height",document.documentElement.clientHeight-228);var a=$(".image-box-ul").css("width");a=a.replace("px",""),a=+a;var b=parseInt(a/186);$("#image .reource-operation").css("width",186*b)};$(window).resize(function(){h()}),h(),$('a[data-toggle="tab"]').on("shown.bs.tab",function(a){var c=$(a.target).text();"图片"==$.trim(c)?(h(),b.resType="image",b.resImgList&&0!=b.resImgList.length||b.loadResourceFunc(0,20,b.loadResourceListFunc)):"音频"==$.trim(c)?(b.resType="voice",b.resVoiceList&&0!=b.resVoiceList.length||b.loadResourceFunc(0,30,b.loadResourceListFunc)):"视频"==$.trim(c)&&(b.resType="video",b.resVideoList&&0!=b.resVideoList.length||b.loadResourceFunc(0,30,b.loadResourceListFunc)),b.$apply()});var i={runtimes:"html5,flash,html4",browse_button:"pickfilesImg",container:"container",drop_element:"container",max_file_size:"1000mb",flash_swf_url:"bower_components/plupload/js/Moxie.swf",dragdrop:!0,chunk_size:"4mb",multi_selection:!("ios"===mOxie.Env.OS.toLowerCase()),uptoken_url:ruyiai_host+"/ruyi-ai/getuptoken",domain:$("#domain").val(),get_new_uptoken:!1,save_key:!0,filters:{mime_types:[{title:"Image files",extensions:"BMP,DIB,EMF,GIF,ICB,ICO,JPG,JPEG,PBM,PGM,PNG,PPM,PSD,PSP,RLE,SGI,TGA,TIF"}]},auto_start:!0,log_level:5,init:{FilesAdded:function(a,b){$("#addresource").modal("show"),$("table").show(),$("#success").hide(),plupload.each(b,function(b){var c=new FileProgress(b,"fsUploadProgress");c.setStatus("等待..."),c.bindUploadCancel(a)})},BeforeUpload:function(a,b){var c=new FileProgress(b,"fsUploadProgress"),d=plupload.parseSize(this.getOption("chunk_size"));"html5"===a.runtime&&d&&c.setChunkProgess(d)},UploadProgress:function(a,b){var c=new FileProgress(b,"fsUploadProgress"),d=plupload.parseSize(this.getOption("chunk_size"));c.setProgress(b.percent+"%",b.speed,d)},UploadComplete:function(){$("#addresource").modal("hide"),$("#fsUploadProgress").html("")},FileUploaded:function(a,c,d){var e=new FileProgress(c,"fsUploadProgress");e.setComplete(a,d);var f=new Object;switch(f.url=$("#domain").val()+JSON.parse(d).hash+"/"+c.name,f.title=c.name,f.size=c.size,b.resType){case"image":f.type="image";break;case"voice":f.type="voice";break;case"video":f.type="video"}b.addResListTemp.push(f),b.loadImage(),b.addResListTemp=[],b.$apply()},Error:function(a,b,c){$("table").show();var d=new FileProgress(b.file,"fsUploadProgress");d.setError(),d.setStatus(c)}}},j=Qiniu.uploader(i);j.bind("FileUploaded",function(){}),$("#container").on("dragenter",function(a){a.preventDefault(),$("#container").addClass("draging"),a.stopPropagation()}).on("drop",function(a){a.preventDefault(),$("#container").removeClass("draging"),a.stopPropagation()}).on("dragleave",function(a){a.preventDefault(),$("#container").removeClass("draging"),a.stopPropagation()}).on("dragover",function(a){a.preventDefault(),$("#container").addClass("draging"),a.stopPropagation()}),$("#show_code").on("click",function(){$("#myModal-code").modal(),$("pre code").each(function(a,b){hljs.highlightBlock(b)})}),$("body").on("click","table button.btn",function(){$(this).parents("tr").next().toggle()});var k=function(a){if(!a)return 0;for(var b=a.split("/"),c=0,d=b.length;d>c;c++)if("rotate"===b[c])return parseInt(b[c+1],10);return 0};$("#myModal-img .modal-body-footer").find("a").on("click",function(){var a=$("#myModal-img").find(".modal-body img"),b=a.data("key"),c=a.attr("src"),d=parseInt(a.data("h"),10),e=[],f=k(c);if($(this).hasClass("no-disable-click")){$(this).siblings().removeClass("disabled");var g=$(this).data("imagemogr");"left"===g?f=0>f-90?f+270:f-90:"right"===g&&(f=f+90>360?f-270:f+90),e.push({fop:"imageMogr2","auto-orient":!0,strip:!0,rotate:f,format:"png"})}else $(this).addClass("disabled").siblings().removeClass("disabled"),"no-rotate"!==$(this).data("imagemogr")&&e.push({fop:"imageMogr2","auto-orient":!0,strip:!0,rotate:f,format:"png"});$("#myModal-img .modal-body-footer").find("a.disabled").each(function(){var a=$(this).data("watermark"),b=$(this).data("imageview"),c=$(this).data("imagemogr");if(a&&e.push({fop:"watermark",mode:1,image:"http://www.b1.qiniudn.com/images/logo-2.png",dissolve:100,gravity:a,dx:100,dy:100}),b){var f;switch(b){case"large":f=d;break;case"middle":f=.5*d;break;case"small":f=.1*d;break;default:f=d}e.push({fop:"imageView2",mode:3,h:parseInt(f,10),q:100,format:"png"})}"no-rotate"===c&&e.push({fop:"imageMogr2","auto-orient":!0,strip:!0,rotate:0,format:"png"})});var h=Qiniu.pipeline(e,b),i=new Image;return a.attr("src","images/loading.gif"),i.onload=function(){a.attr("src",h),a.parent("a").attr("href",h)},i.src=h,!1}),b.loadImage=function(){$.ajax({url:ruyiai_host+"/ruyi-ai/save/"+appId+"/multimedia",data:{mediaType:b.resType,liststr:JSON.stringify(b.addResListTemp)},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0&&b.loadResourceListFunc(a.result,e):a&&2==a.code&&goIndex(),b.$apply()}})},b.loadResourceListFunc=function(a,c){if(a&&a.length){switch(b.resType){case"image":if(b.resImgList)for(var d in a)c==e?b.resImgList.unshift(a[d]):c==f&&b.resImgList.push(a[d]);else b.resImgList=a;break;case"voice":if(b.resVoiceList)for(var d in a)c==e?b.resVoiceList.unshift(a[d]):c==f&&b.resVoiceList.push(a[d]);else b.resVoiceList=a;break;case"video":if(b.resVideoList)for(var d in a)c==e?b.resVideoList.unshift(a[d]):c==f&&b.resVideoList.push(a[d]);else b.resVideoList=a}b.$apply()}},b.loadResourceFunc=function(a,c,d){$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:b.resType,beforeTime:a,size:c},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&d&&d(a.result,e):a&&2==a.code&&goIndex()}})},b.loadResourceFunc(0,20,b.loadResourceListFunc);var l=!0;$("[data-act=image-box]").on("scroll",function(a){var c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,h=c.height();d>=e-h-45&&1==l&&(l=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:b.resType,beforeTime:b.resImgList[b.resImgList.length-1].createTime,size:g},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0?(b.loadResourceListFunc(a.result,f),l=!0,b.$apply()):l=!1:2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))});var m=function(a){var c="";for(var d in a)c+=a[d]+",";$.ajax({url:ruyiai_host+"/ruyi-ai/delete/"+appId+"/multimedia",data:{listid:c},method:"GET",success:function(c){if(c=dataParse(c),0==c.code){for(var d in a)if("image"==b.resType)for(var e in b.resImgList)a[d]==b.resImgList[e].id&&b.resImgList.splice(e,1);else if("voice"==b.resType)for(var e in b.resVoiceList)a[d]==b.resVoiceList[e].id&&b.resVoiceList.splice(e,1);else if("video"==b.resType)for(var e in b.resVideoList)a[d]==b.resVideoList[e].id&&b.resVideoList.splice(e,1);b.$apply()}else 2==c.code?goIndex():c.msg&&$.trace(c.msg+"( "+c.detail+" )","error")}})};$("body").off("click",".image-operation .delete").on("click",".image-operation .delete",function(a){var b=$(this),c=b.closest(".image-operation").attr("data-id"),d=b.closest(".image-operation").attr("data-title");$.confirm({text:'你确定要删除"'+d+'"吗？',title:"删除",ensureFn:function(){var a=[c];m(a)}})}),$("body").off("click",".image-operation .edit").on("click",".image-operation .edit",function(a){var b=$(this),c=b.closest(".image-operation").attr("data-id"),d=b.closest(".image-operation").attr("data-title");$("#updateResource").modal("show"),$("[data-act=resource-name]").val(d),$("[data-act=resource-id]").val(c)}),$("body").off("keydown","[data-act=resource-name]").on("keydown","[data-act=resource-name]",function(a){$(this);13==a.keyCode&&$("[data-act=submit-rename-resource]").trigger("click")}),$("#updateResource").on("shown.bs.modal",function(){$("[data-act=resource-name]").focus()}),$("body").off("click","[data-act=submit-rename-resource]").on("click","[data-act=submit-rename-resource]",function(a){var c=$("[data-act=resource-name]"),d=$("[data-act=resource-id]");0==$.trim(c.val()).length&&$.trace("资源名称不能为空"),$.ajax({url:ruyiai_host+"/ruyi-ai/update/"+appId+"/multimedia",data:{id:d.val(),name:c.val()},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){if("image"==b.resType){for(var c in b.resImgList)if(a.result&&b.resImgList[c].id==a.result.id){b.resImgList[c]=a.result;break}}else if("voice"==b.resType){for(var c in b.resVoiceList)if(a.result&&b.resVoiceList[c].id==a.result.id){b.resVoiceList[c]=a.result;break}}else if("video"==b.resType)for(var c in b.resVideoList)if(a.result&&b.resVideoList[c].id==a.result.id){b.resVideoList[c]=a.result;break}b.$apply(),$.trace("素材名称修改成功","success"),$("#updateResource").modal("hide")}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})}),$("body").off("click","[data-act=img-box-active]").on("click","[data-act=img-box-active]",function(a){var c=$(this),d=c.parent(".image-box-li"),e=d.attr("data-id");for(var f in b.resImgList)if(b.resImgList[f].id==e){b.resImgList[f].active?b.resImgList[f].active=!1:b.resImgList[f].active=!0;break}b.$apply()}),$("body").off("click","[data-act=all-choose]").on("click","[data-act=all-choose]",function(a){var c=$(this),d=c.find("input");if("image"==b.resType)if(d.is(":checked"))for(var e in b.resImgList)b.resImgList[e].active=!0;else for(var e in b.resImgList)b.resImgList[e].active=!1;else if("voice"==b.resType)if(d.is(":checked"))for(var e in b.resVoiceList)b.resVoiceList[e].active=!0;else for(var e in b.resVoiceList)b.resVoiceList[e].active=!1;else if("video"==b.resType)if(d.is(":checked"))for(var e in b.resVideoList)b.resVideoList[e].active=!0;else for(var e in b.resVideoList)b.resVideoList[e].active=!1;b.$apply()}),$("body").off("click","[data-act=all-delete]").on("click","[data-act=all-delete]",function(a){$.confirm({text:"你确定要批量删除所选素材吗？",title:"删除",ensureFn:function(){var a=($(this),0),c=[];if("image"==b.resType)for(var d in b.resImgList)b.resImgList[d].active&&(c.push(b.resImgList[d].id),a++);else if("voice"==b.resType)for(var d in b.resVoiceList)b.resVoiceList[d].active&&(c.push(b.resVoiceList[d].id),a++);else if("video"==b.resType)for(var d in b.resVideoList)b.resVideoList[d].active&&(c.push(b.resVideoList[d].id),a++);0==a?$.trace("你未选择要删除的素材"):m(c)}})});var n=new QiniuJsSDK,o={runtimes:"html5,flash,html4",browse_button:"pickfilesVoice",container:"container",drop_element:"container",max_file_size:"1000mb",flash_swf_url:"bower_components/plupload/js/Moxie.swf",dragdrop:!0,chunk_size:"4mb",multi_selection:!("ios"===mOxie.Env.OS.toLowerCase()),uptoken_url:ruyiai_host+"/ruyi-ai/getuptoken",domain:$("#domain").val(),get_new_uptoken:!1,save_key:!0,filters:{mime_types:[{title:"Voice files",extensions:"MP3,AAC,WAV,WMA,CDA,FLAC,M4A,MID,MKA,MP2,MPA,MPC,APE,OFR,OGG,RA,WV,TTA,AC3,DTS"}]},auto_start:!0,log_level:5,init:{FilesAdded:function(a,b){$("#addresource").modal("show"),$("table").show(),$("#success").hide(),plupload.each(b,function(b){var c=new FileProgress(b,"fsUploadProgress");c.setStatus("等待..."),c.bindUploadCancel(a)})},BeforeUpload:function(a,b){var c=new FileProgress(b,"fsUploadProgress"),d=plupload.parseSize(this.getOption("chunk_size"));"html5"===a.runtime&&d&&c.setChunkProgess(d)},UploadProgress:function(a,b){var c=new FileProgress(b,"fsUploadProgress"),d=plupload.parseSize(this.getOption("chunk_size"));c.setProgress(b.percent+"%",b.speed,d)},UploadComplete:function(){$("#addresource").modal("hide"),$("#fsUploadProgress").html("")},FileUploaded:function(a,c,d){var e=new FileProgress(c,"fsUploadProgress");e.setComplete(a,d);var f=new Object;switch(f.url=$("#domain").val()+JSON.parse(d).hash+"/"+c.name,f.title=c.name,f.size=c.size,b.resType){case"image":f.type="image";break;case"voice":f.type="voice";break;case"video":f.type="video"}b.addResListTemp.push(f),b.loadImage(),b.addResListTemp=[],b.$apply()},Error:function(a,b,c){$("table").show();var d=new FileProgress(b.file,"fsUploadProgress");d.setError(),d.setStatus(c)}}},p=(n.uploader(o),new QiniuJsSDK),q={runtimes:"html5,flash,html4",browse_button:"pickfilesVideo",container:"container",drop_element:"container",max_file_size:"1000mb",flash_swf_url:"bower_components/plupload/js/Moxie.swf",dragdrop:!0,chunk_size:"4mb",multi_selection:!("ios"===mOxie.Env.OS.toLowerCase()),uptoken_url:ruyiai_host+"/ruyi-ai/getuptoken",domain:$("#domain").val(),get_new_uptoken:!1,save_key:!0,filters:{mime_types:[{title:"video files",extensions:"avi,rmvb,rm,asf,divx,mpg,mpeg,mpe,wmv,mp4,mkv,vob,flv,mov"}]},auto_start:!0,log_level:5,init:{FilesAdded:function(a,b){$("#addresource").modal("show"),$("table").show(),$("#success").hide(),plupload.each(b,function(b){var c=new FileProgress(b,"fsUploadProgress");c.setStatus("等待..."),c.bindUploadCancel(a)})},BeforeUpload:function(a,b){var c=new FileProgress(b,"fsUploadProgress"),d=plupload.parseSize(this.getOption("chunk_size"));"html5"===a.runtime&&d&&c.setChunkProgess(d)},UploadProgress:function(a,b){var c=new FileProgress(b,"fsUploadProgress"),d=plupload.parseSize(this.getOption("chunk_size"));c.setProgress(b.percent+"%",b.speed,d)},UploadComplete:function(){$("#addresource").modal("hide"),$("#fsUploadProgress").html("")},FileUploaded:function(a,c,d){var e=new FileProgress(c,"fsUploadProgress");e.setComplete(a,d);var f=new Object;switch(f.url=$("#domain").val()+JSON.parse(d).hash+"/"+c.name,f.title=c.name,f.size=c.size,b.resType){case"image":f.type="image";break;case"voice":f.type="voice";break;case"video":f.type="video"}b.addResListTemp.push(f),b.loadImage(),b.addResListTemp=[],b.$apply()},Error:function(a,b,c){$("table").show();var d=new FileProgress(b.file,"fsUploadProgress");d.setError(),d.setStatus(c)}}},r=(p.uploader(q),!0);$("[data-act=voice-box]").on("scroll",function(a){var c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,h=c.height();console.log(r),d>=e-h-45&&1==r&&(r=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:b.resType,beforeTime:b.resVoiceList[b.resVoiceList.length-1].createTime,size:g},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0?(b.loadResourceListFunc(a.result,f),r=!0,b.$apply()):l=!1:2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))});var s=!0;$("[data-act=video-box]").on("scroll",function(a){var c=$(this),d=c[0].scrollTop,e=c[0].scrollHeight,h=c.height();d>=e-h-45&&1==s&&(s=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/query/"+appId+"/list",data:{type:b.resType,beforeTime:b.resVideoList[b.resVideoList.length-1].createTime,size:g},method:"GET",success:function(a){a=dataParse(a),0==a.code?a.result&&a.result.length>0?(b.loadResourceListFunc(a.result,f),l=!0,b.$apply()):l=!1:2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}}))}),$("body").off("click","#voice .delete,#video .delete").on("click","#voice .delete,#video .delete",function(a){var b=$(this),c=b.closest("tr").attr("data-id"),d=b.closest("tr").attr("data-title");$.confirm({text:'你确定要删除"'+d+'"吗？',title:"删除",ensureFn:function(){var a=[c];m(a)}})}),$("body").off("click","#voice .edit,#video .edit").on("click","#voice .edit,#video .edit",function(a){var b=$(this),c=b.closest("tr").attr("data-id"),d=b.closest("tr").attr("data-title");$("#updateResource").modal("show"),$("[data-act=resource-name]").val(d),$("[data-act=resource-id]").val(c)}),$("body").off("click","[name=choosed-voice]").on("click","[name=choosed-voice]",function(a){var c=$(this),d=c.closest("tr").attr("data-id");for(var e in b.resVoiceList)b.resVoiceList[e].id==d&&(b.resVoiceList[e].active?b.resVoiceList[e].active=!0:b.resVoiceList[e].active=!1);b.$apply()})}function assistantParaCtrl(a,b,c,d){function e(a){$("#tar").Jcrop({boxWidth:400,boxHeight:400,bgOpacity:.5,aspectRatio:1,bgColor:"black",addClass:"jcrop-light",onChange:f,onDblClick:g},function(){l=this,l.setSelect([130,65,480,350]),l.setOptions({bgFade:!0}),l.ui.selection.addClass("jcrop-selection")})}function f(a){}function g(a){var c=l.getScaleFactor()[0],d=l.getScaleFactor()[1];l.tellSelect()[0],l.tellSelect()[1];$.ajax({url:ruyiai_host+"/ruyi-ai/app/cutImage/"+appId,method:"get",data:{imageUrl:$("#tar").attr("src"),x:parseInt(a.x*c),y:parseInt(a.y*d),w:parseInt(a.w*c),h:parseInt(a.h*d)},success:function(a){try{0==a.code?($("#cut-header").modal("hide"),$("[data-act=edit-the-status]").find(".robot-head").attr("src",a.result)):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error"),b.$apply()}catch(c){$.trace("请确保是.jpg格式图片(未修改过后缀)，并且小于120M")}}})}function h(a,b){var c="魔羯水瓶双鱼牡羊金牛双子巨蟹狮子处女天秤天蝎射手魔羯",d=[20,19,21,21,21,22,23,23,23,23,22,22];return c.substr(2*a-(b<d[a-1]?2:0),2)+"座"}function i(a){var b=a%12,c=new Array("鼠","牛","虎","兔","龙","蛇","马","羊","猴","鸡","狗","猪");return c[b]}$(".list-group-item").removeClass("active"),$("[data-act=nav-robot-para]").addClass("active"),$("[data-act=nav-robot-role]").addClass("active"),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200),$('[data-toggle="popover"]').popover(),b.currentUserId=getCookie("userId");var j=function(a){var b=[];return a&&a.length>0&&(b=a.split(";")),b},k=function(a){var b="";for(var c in a)c<a.length-1?b=b+a[c]+";":b+=a[c];return b};b.actionAddAttrFunc=function(a,c,d,e,f,g){function h(){var h=!1,i=0,j=-1,k=!1;for(var l in a)l==f&&(h=!0,j=l),c==a[l]&&(i++,f==l&&(k=!0));h?k?i>1?($.trace("此属性已存在"),a[j]=""):a[j]=c:i>=1?($.trace("此属性已存在"),a[j]=""):a[j]=c:c.length>0&&(a&&a.length>=e?$.trace("最多只能添加"+e+"条"):i>=1?$.trace("此属性已存在"):(a||(a=[]),a.push(c))),c="",b[d]="",g&&13==g.keyCode&&$(g.target).closest("[data-act=tail-box]").find("[data-act=addParaText]").focus()}g&&13!=g.keyCode||("petPhraseStr"==d?setTimeout(function(){h(),$("[data-act=petPhrasePara]").val(""),b.petPhrasePara="",b.$apply()},200):"timeoutResponse"==d?setTimeout(function(){h(),$("[data-act=timeoutResponsePara]").val(""),b.timeoutResponsePara="",b.$apply()},200):h())},b.valueDeleteFunc=function(a,b){for(var c in a)if(c==b){a.splice(c,1);break}},b.settingAppFunc=function(){setTimeout(function(){b.agent&&$.ajax({url:ruyiai_host+"/ruyi-ai/app/"+appId,data:JSON.stringify({id:appId,attribute:b.agent,defaultResponses:b.defaultResponses}),traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(a){0==a.code?$.trace("保存成功","success"):2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})},0)};var l,m="https://qiniu.ruyi.ai/",n={runtimes:"html5,flash,html4",browse_button:"pickRobotImg",container:"container",drop_element:"container",max_file_size:"1000mb",flash_swf_url:"bower_components/plupload/js/Moxie.swf",dragdrop:!0,chunk_size:"4mb",multi_selection:!("ios"===mOxie.Env.OS.toLowerCase()),uptoken_url:ruyiai_host+"/ruyi-ai/getuptoken",domain:m,get_new_uptoken:!1,save_key:!0,filters:{mime_types:[{title:"Image files",extensions:"JPG"}]},auto_start:!0,log_level:5,init:{FilesAdded:function(a,b){$("#addresource").modal("show"),$("table").show(),$("#success").hide(),plupload.each(b,function(b){var c=new FileProgress(b,"fsUploadProgress");c.setStatus("等待..."),c.bindUploadCancel(a)})},BeforeUpload:function(a,b){var c=new FileProgress(b,"fsUploadProgress"),d=plupload.parseSize(this.getOption("chunk_size"));"html5"===a.runtime&&d&&c.setChunkProgess(d)},UploadProgress:function(a,b){var c=new FileProgress(b,"fsUploadProgress"),d=plupload.parseSize(this.getOption("chunk_size"));c.setProgress(b.percent+"%",b.speed,d)},UploadComplete:function(){$("#addresource").modal("hide"),$("#fsUploadProgress").html("")},FileUploaded:function(a,b,c){var d=new FileProgress(b,"fsUploadProgress");d.setComplete(a,c);var f=m+JSON.parse(c).hash+"/"+b.name;$("#cut-header").modal("show");$(".container").html("<img src='"+f+"' id='tar'/>");e()},Error:function(a,b,c){$("table").show();var d=new FileProgress(b.file,"fsUploadProgress");d.setError(),d.setStatus(c)}}};Qiniu.uploader(n);b.saveAgentFunc=function(a){setTimeout(function(){$.ajax({url:ruyiai_host+"/ruyi-ai/app/"+appId,data:JSON.stringify(a),traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(a){0==a.code||(2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error"))}})},0)},$("body").off("dblclick","[data-act=ass-para-box]").on("dblclick","[data-act=ass-para-box]",function(a){var b=$(this);"block"==b.find("[data-act=check-the-status]").css("display")&&b.find("[data-act=edit-para]").trigger("click")}),$("body").off("click","[data-act=edit-para],.common-blank-button,[data-act=header-submit]").on("click","[data-act=edit-para],.common-blank-button,[data-act=header-submit]",function(a){var b=$(this),c=b.closest("[data-act=ass-para-box]").find("[data-act=check-the-status]"),d=b.closest("[data-act=ass-para-box]").find("[data-act=edit-the-status]");if("block"==c.css("display"))c.css("display","none"),d.css("display","block"),b.css("display","none");else{if(d.find("input[type='checkbox']").is(":checked")&&d.find("[data-act=tail-box] li").length<=1)return void $.trace("你勾选了机器人小尾巴，请至少填写一条小尾巴");c.css("display","block"),d.css("display","none"),$("[data-act=edit-para]").css("display","block")}}),b.submitHeaderFunc=function(){var c=$("[data-act=robot-name-input]").val(),d=$("[data-act=service-name]").val();return c&&0!=$.trim(c).length?(d&&(a.currentRobot.serviceName=d),a.currentRobot.appName=c,a.currentRobot.appDesc=$(".robot-desc-textarea").val(),a.currentRobot.headUrl=$("[data-act=edit-the-status]").find(".robot-head").attr("src"),void b.saveAgentFunc(a.currentRobot)):($.trace("请填写机器人名称"),!1)};var o=function(a){for(var b in a)0==$.trim(a[b]).length&&a.splice(b,1);return a};b.editNameFunc=function(){a.currentRobot.attribute.name=j(a.currentRobot.attribute.name),a.currentRobot.attribute.name.length>0&&(b.namesTemp=a.currentRobot.attribute.name[0]),"true"==a.currentRobot.attribute.nameTailsFlag||1==a.currentRobot.attribute.nameTailsFlag?b.nameTailsFlagTemp=!0:b.nameTailsFlagTemp=!1,b.nameTailsTemp=j(a.currentRobot.attribute.nameTails)},b.editNameSubmitFunc=function(){return b.namesTemp&&0!=$.trim(b.namesTemp).length?(a.currentRobot.attribute.name[0]=b.namesTemp,a.currentRobot.attribute.name=k(a.currentRobot.attribute.name),a.currentRobot.appName=b.namesTemp,a.currentRobot.attribute.nameTailsFlag=b.nameTailsFlagTemp,a.currentRobot.attribute.nameTails=k(o(b.nameTailsTemp)),void b.saveAgentFunc(a.currentRobot)):void $.trace("机器人名字不能为空")},b.addAliasToName=function(b,c){var d=j(a.currentRobot.appName),e=[],f=null;d&&d.length>0&&(f=d[0],e.push(f));for(var g in b)e.push(b[g]);for(var g in c)e.push(c[g]);a.currentRobot.attribute.name=k(e)},b.editAliasFunc=function(){b.aliassTemp=j(a.currentRobot.attribute.alias),1==a.currentRobot.attribute.aliasTailsFlag||"true"==a.currentRobot.attribute.aliasTailsFlag?b.aliasTailsFlagTemp=!0:b.aliasTailsFlagTemp=!1,b.aliasTailsTemp=j(a.currentRobot.attribute.aliasTails)},b.editAliasSubmitFunc=function(){a.currentRobot.attribute.alias=k(b.aliassTemp),b.addAliasToName(b.aliassTemp,j(b.currentRobot.attribute.voiceToCorrect)),a.currentRobot.attribute.aliasTailsFlag=b.aliasTailsFlagTemp,a.currentRobot.attribute.aliasTails=k(o(b.aliasTailsTemp)),b.saveAgentFunc(a.currentRobot)},b.editvoiceToCorrect=function(){b.voiceToCorrectTemp=j(a.currentRobot.attribute.voiceToCorrect)},b.editvoiceToCorrectSubmit=function(){a.currentRobot.attribute.voiceToCorrect=k(o(b.voiceToCorrectTemp)),b.addAliasToName(j(b.currentRobot.attribute.alias),o(b.voiceToCorrectTemp)),b.saveAgentFunc(a.currentRobot)},b.editSexFunc=function(){b.sexTemp=a.currentRobot.attribute.sex,1==a.currentRobot.attribute.sexTailsFlag||"true"==a.currentRobot.attribute.sexTailsFlag?b.sexTailsFlagTemp=!0:b.sexTailsFlagTemp=!1,b.sexTailsTemp=j(a.currentRobot.attribute.sexTails)},b.editSexSubmitFunc=function(){a.currentRobot.attribute.sex=b.sexTemp,a.currentRobot.attribute.sexTailsFlag=b.sexTailsFlagTemp,a.currentRobot.attribute.sexTails=k(o(b.sexTailsTemp)),b.saveAgentFunc(a.currentRobot)},$("#assistantParaModal [name=birthday]").datepicker({changeMonth:!0,changeYear:!0}),b.editBirthdayFunc=function(){1==a.currentRobot.attribute.birthdayTailsFlag||"true"==a.currentRobot.attribute.birthdayTailsFlag?b.birthdayTailsFlagTemp=!0:b.birthdayTailsFlagTemp=!1,b.birthdayTailsTemp=j(a.currentRobot.attribute.birthdayTails),b.birthdayTemp=a.currentRobot.attribute.birthdayDate,b.zodiacTemp=a.currentRobot.attribute.zodiac,b.constellationTemp=a.currentRobot.attribute.constellation,
b.agedayTemp=a.currentRobot.attribute.ageday,b.agemonthTemp=a.currentRobot.attribute.agemonth,b.ageyearTemp=a.currentRobot.attribute.ageyear},b.editBirthdaySubmitFunc=function(){a.currentRobot.attribute.birthdayTailsFlag=b.birthdayTailsFlagTemp,a.currentRobot.attribute.birthdayTails=k(o(b.birthdayTailsTemp)),a.currentRobot.attribute.birthdayDate=b.birthdayTemp,a.currentRobot.attribute.birthday=new Date(b.birthdayTemp).getTime(),a.currentRobot.attribute.zodiac=b.zodiacTemp,a.currentRobot.attribute.constellation=b.constellationTemp,a.currentRobot.attribute.ageday=b.agedayTemp,a.currentRobot.attribute.agemonth=b.agemonthTemp,a.currentRobot.attribute.ageyear=b.ageyearTemp,b.saveAgentFunc(a.currentRobot)},$("[name=birthday]").focus(function(){var a=parseInt($(".ui-datepicker-year [selected=selected]").attr("value")),c=parseInt($(".ui-datepicker-month [selected=selected]").attr("value")),d=new Date(b.birthdayTemp);d.setFullYear(a,c),b.birthdayTemp=$.timeFormat(d,"MM/dd/yyyy"),b.setBirthdayFunc(b.birthdayTemp),b.$apply()}),b.setBirthdayFunc=function(a){a=new Date(a),setTimeout(function(){var c=a.getYear(),d=a.getMonth()+1,e=a.getDate(),f=h(d,e),g=i(c);b.constellationTemp=f,b.zodiacTemp=g;var j=1,k=0,l=0,m=(new Date).getTime(),n=m-a.getTime();n=Math.abs(n);var o=n/31536e6;o=parseInt(o),o>0?(j=o,n-=31536e6*o):j=0;var p=n/2592e6;p=parseInt(p),p>0?(k=p,n-=2592e6*p):k=0;var q=n/864e5;q=parseInt(q),l=q>0?q:0,a>m&&(j=-j,k=-k,l=-l),b.ageyearTemp=j,b.agemonthTemp=k,b.agedayTemp=l,b.$apply()},100)},b.editHobbyFunc=function(){b.hobbysTemp=j(a.currentRobot.attribute.hobby),1==a.currentRobot.attribute.hobbyTailsFlag||"true"==a.currentRobot.attribute.hobbyTailsFlag?b.hobbyTailsFlagTemp=!0:b.hobbyTailsFlagTemp=!1,b.hobbyTailsTemp=j(a.currentRobot.attribute.hobbyTails)},b.editHobbySubmitFunc=function(){a.currentRobot.attribute.hobby=k(b.hobbysTemp),a.currentRobot.attribute.hobbyTailsFlag=b.hobbyTailsFlagTemp,a.currentRobot.attribute.hobbyTails=k(o(b.hobbyTailsTemp)),b.saveAgentFunc(a.currentRobot)},b.editFatherFunc=function(){b.fathersTemp=a.currentRobot.attribute.father,1==a.currentRobot.attribute.fatherTailsFlag||"true"==a.currentRobot.attribute.fatherTailsFlag?b.fatherTailsFlagTemp=!0:b.fatherTailsFlagTemp=!1,b.fatherTailsTemp=j(a.currentRobot.attribute.fatherTails)},b.editFatherSubmitFunc=function(){a.currentRobot.attribute.father=b.fathersTemp,a.currentRobot.attribute.fatherTailsFlag=b.fatherTailsFlagTemp,a.currentRobot.attribute.fatherTails=k(o(b.fatherTailsTemp)),b.saveAgentFunc(a.currentRobot)},b.editPetPhraseFunc=function(){a.currentRobot.defaultResponses||(a.currentRobot.defaultResponses=[]),b.petPhraseTemp=[];for(var c in a.currentRobot.defaultResponses)b.petPhraseTemp.push(a.currentRobot.defaultResponses[c])},b.editPetPhraseSubmitFunc=function(){setTimeout(function(){a.currentRobot.defaultResponses=b.petPhraseTemp,b.saveAgentFunc(a.currentRobot)},500)},b.editTimeoutResponseFunc=function(){a.currentRobot.defaultResponses||(a.currentRobot.defaultResponses=[]),b.timeoutResponseTemp=[];for(var c in a.currentRobot.defaultResponses)b.timeoutResponseTemp.push(a.currentRobot.defaultResponses[c])},b.editPetPhraseSubmitFunc=function(){setTimeout(function(){a.currentRobot.defaultResponses=b.petPhraseTemp,b.saveAgentFunc(a.currentRobot)},500)};var p="isEmpty",q=function(){var a=$("[data-act=petPhrasePara]").val();return p=a&&$.trim(a).length>0?"notEmpty":"isEmpty",a};b.editPetPhraseTextFunc=function(a,b){q();$("#editPetPhraseTextarea").modal("show");var c=$("#editPetPhraseText");if(c.attr("myIndex",b),-1==b){if($("#editor-iframe-box-wechat").html('<iframe id="editor-iframe-wechat" name="editor-iframe-wechat" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),!a||0==a.length)return!1;c.val(a);var d=setInterval(function(){try{$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val(a),$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val().length>0&&clearInterval(d)}catch(b){}},20)}else{$("#editor-iframe-box-wechat").html('<iframe id="editor-iframe-wechat" name="editor-iframe-wechat" width="718" height="570" frameborder="0" scrolling="yes" src="../console/editor.html"></iframe>'),c.val(a);var d=setInterval(function(){try{$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val(a),$(window.frames["editor-iframe-wechat"].document).find("#editor_content_temp").val().length>0&&clearInterval(d)}catch(b){}},20)}},b.editPetPhraseTextSubmitFunc=function(){var a=$(window.frames["editor-iframe-wechat"].document).find("#editor_content_textarea").val(),c=$("#editPetPhraseText");c.val(a);var d=c.attr("myIndex");-1==d||"-1"==d?"isEmpty"==p?b.petPhraseTemp.push(c.val()):"notEmpty"==p&&(b.petPhraseTemp[b.petPhraseTemp.length-1]=c.val()):b.petPhraseTemp[d]=c.val(),$("#editPetPhraseTextarea").modal("hide")},b.timeoutChange=function(a){$("[name=timeout-input]").val(a)},setTimeout(function(){$("[name=timeout-input]").val(1500)},500)}function referenceAppCtrl(a,b,c,d){function e(){$("#skillSortModal .select-sort-list").css("max-height",window.innerHeight-184+"px"),$("#skillSortModal .recommend-sort-list").css("max-height",window.innerHeight-184+"px")}$(".list-group-item").removeClass("active"),$("[data-act=nav-robot-skill]").addClass("active"),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200),$('[data-toggle="popover"]').popover(),$(".nav-tabs li").on("click",function(){var a=$(this),b=a.find("span");1==b.length&&b.text("")});var f=function(){$(".s-skill-box-nav").css("height",$(window).height()-192+"px")};$(window).resize(function(){f()}),f(),setTimeout(function(){$("#myCarousel").carousel({interval:5e3,pause:!0})},200),b.alert=function(a){$("#alert_msg").fadeOut(0),$("#alert_msg").fadeIn().find(".text").text(a),setTimeout(function(){$("#alert_msg").fadeOut()},2e3)},b.hasBeenChanged=function(){$(".entry-sort").trigger("click",["false"]),b.recoverySort();for(var a=0,c=b.originSkills.length;c>a;a++)if(b.originSkills[a].id!=b.currentSort[a].id)return!0;return!1},b.handleRobotStatusFunc=function(c,d,e){$("body").on("fnCanBeUsed",function(){e&&e(),$("body").off("fnCanBeUsed")});var f=!1,h=0;for(var i in a.currentRobot.referencedApp)if(c==a.currentRobot.referencedApp[i]){h=i,f=!0;break}if(f){if(a.currentRobot.referencedApp.splice(h,1),a.currentRobot.appSkillConfig=b.appSkillConfig,console.log(a.currentRobot),console.log(1.1111111111111112e32),g(a.currentRobot),"音乐知识图谱"==d){var j={};j.appId=c,j.appSkillConfig=b.appSkillConfig,setTimeout(function(){$.ajax({url:ruyiai_host+"/ruyi-ai/app/"+appId,data:JSON.stringify(j),traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(a){},error:function(a){console.log(a)}})},0)}b.$apply(),b.alert("成功删除该技能"),$("body").trigger("fnCanBeUsed")}else b.hasBeenChanged()?(a.currentRobot.referencedApp.push(c),g(a.currentRobot)):(a.currentRobot.referencedApp.push(c),g(a.currentRobot),$(".entry-sort").trigger("click",["false"]),b.recoverySort(),b.changeSort()),b.alert("成功添加到我的技能里！"),"音乐知识图谱"==d&&($("a.skillSettings").css("display","inline-block"),b.getMusicSettings(c),setTimeout(function(){var a=document.createElement("a");a.innerHTML="",a.classList.add("skillSettings"),a.classList.add("specialSettings"),$("#robot-sortable li").each(function(b,c){"音乐知识图谱"==$(this).find("h4").text()&&$(this).append(a)})},100)),$("body").trigger("fnCanBeUsed")};var g=function(a){var c;console.log(a),c=JSON.stringify(a),b.getCurrentReferencedAppFunc(),$.ajax({url:ruyiai_host+"/ruyi-ai/app/"+a.id,data:c,traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(a){}})},h=function(a){console.log("enter");for(var c in b.robotList)for(var d in a)a[d]==b.robotList[c].id&&(b.robotList.splice(c,1),console.log("delete"))},i=function(){var a=[];for(var c in b.robotList)b.robotList[c].status&&"noactive"==b.robotList[c].status||a.push(b.robotList[c]);b.robotList=a},j=function(){var c,d=a.currentRobot.robotType+"";c="INTEL_STORY_ROBOT"==d?"js/INTEL_STORY_ROBOT-skill-store.json":"js/COMMON-skill-store.json",$.getJSON(c,function(a){switch(b.robotList=a,d){case"COMMON":break;case"CHILD":break;case"INTEL_STORY_ROBOT":h(["c0c96f7e-5fad-4d83-afc7-ff544bbad97d"]),h(["0f5eb8c1-553b-44b3-92da-81120dc196d5"]),h(["be077037-0529-437b-bd1c-5e48807a21bd"]),h(["1cfc16c8-bf40-4aef-88d4-adb9da5c9a2c"]),h(["d5c80071-1c19-4db9-814f-648c14b91e8e"]),h(["567428a5-9f0e-4d99-88a1-28a04f6e75ee"]),h(["30d93921-198b-45ac-bff4-bdad32992829"]),h(["401427f2-7299-4225-98e9-b9515181c649"]);break;case"INTEL_CUSTOM_SERVICE":h(["b6c86e82-852f-4e45-b2c0-6a40994f1a75"]),h(["37b2f61f-8cff-4b63-a355-0c8287d5f1f2"]),h(["3b1cfe4d-dc78-4b66-9d9b-a5c065ca5e50"]);break;case"INTEL_REFRIGERATOR":h(["abd3e668-f984-4c38-ba75-73af7c5fbb9a"]);break;case"INTEL_ROBOT":break;case"INTEL_SPEAKER":h(["b6c86e82-852f-4e45-b2c0-6a40994f1a75"]),h(["37b2f61f-8cff-4b63-a355-0c8287d5f1f2"]),h(["c0c96f7e-5fad-4d83-afc7-ff544bbad97d"]);break;case"SMART_HOME":h(["abd3e668-f984-4c38-ba75-73af7c5fbb9a"]);break;case"SMART_TV":h(["abd3e668-f984-4c38-ba75-73af7c5fbb9a"])}console.log(d),console.log(c),"3a59359b-b40b-4581-be62-8112dbf5fb90"!=appId&&h(["00a602f9-a813-4102-80bb-0231d3da4ccf"]),"f64dba56-66c2-46fe-ad44-08da7d2689f3"!=appId&&i(),"0dda44ee-cab8-49b7-bc02-b9e90d32c20e"!=appId&&h(["cd1fab85-dc0a-430a-8a5c-a1516e9ea51e"]),b.$apply(),b.getCurrentReferencedAppFunc()})};setTimeout(function(){j()},500),$("body").off("click","[data-act=data-my-skill]").on("click","[data-act=data-my-skill]",function(a){var c=$(this),d=c.attr("data-id");b.goRobotDetail(d)}),b.allCheckedNum=0,$('[data-act="skill-store"]').on("click",function(){b.allCheckedNum=b.referencedAppObj.length}),b.ensureSettings=function(){var c=$("#settingSize").val(),d=$("#xiami:checked").val(),e=$("#cloudMusic:checked").val(),f="";if(void 0==d&&void 0!==e?f=e:void 0!==d&&void 0==e?f=d:void 0!==d&&void 0!==e&&(f=d+";"+e),c>20||0>=c)return void $.trace("请输入1-20之间的数值");var g={size:c,dataSource:f},h=b.musicID+"",i={};i[h]=g,a.currentRobot.appSkillConfig=i;var j={};j.appId=h,j.appSkillConfig=i,$.ajax({url:ruyiai_host+"/ruyi-ai/app/"+appId,data:JSON.stringify(j),traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(a){a=dataParse(a),0==a.code&&($("#mySettingsModal").modal("hide"),b.appSkillConfig=i)},error:function(a){console.log(a)}})},b.getMusicSettings=function(a){b.musicID=a,$.ajax({url:ruyiai_host+"/ruyi-ai/app/"+appId,method:"GET",success:function(c){var c=c.result,d=20,e="www.xiami.com";if(console.log(c.appSkillConfig[a]),c.appSkillConfig[a])d=c.appSkillConfig[a].size,e=c.appSkillConfig[a].dataSource,b.appSkillConfig=c.appSkillConfig;else{var f={size:d,dataSource:e},g={};g[a]=f;var h={};h.appId=a,h.appSkillConfig=g,$.ajax({url:ruyiai_host+"/ruyi-ai/app/"+appId,data:JSON.stringify(h),traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(a){},error:function(a){console.log(a)}})}-1!=e.indexOf("www.xiami.com")?$("#xiami").prop("checked",!0):$("#xiami").prop("checked",!1),-1!=e.indexOf("music.163.com")?$("#cloudMusic").prop("checked",!0):$("#cloudMusic").prop("checked",!1),$("#settingSize").val(d)},error:function(a){console.log(a)}}),$("#mySettingsModal").modal({keyboard:!0,backdrop:!0})},b.getMusicSettings=function(a){b.musicID=a,$.ajax({url:ruyiai_host+"/ruyi-ai/app/"+appId,method:"GET",success:function(c){var c=c.result,d=20,e="www.xiami.com";if(console.log(c.appSkillConfig[a]),c.appSkillConfig[a])d=c.appSkillConfig[a].size,e=c.appSkillConfig[a].dataSource,b.appSkillConfig=c.appSkillConfig;else{var f={size:d,dataSource:e},g={};g[a]=f;var h={};h.appId=a,h.appSkillConfig=g,$.ajax({url:ruyiai_host+"/ruyi-ai/app/"+appId,data:JSON.stringify(h),traditional:!0,headers:{"Content-Type":"application/json"},method:"PUT",success:function(a){},error:function(a){console.log(a)}})}-1!=e.indexOf("www.xiami.com")?$("#xiami").prop("checked",!0):$("#xiami").prop("checked",!1),-1!=e.indexOf("music.163.com")?$("#cloudMusic").prop("checked",!0):$("#cloudMusic").prop("checked",!1),$("#settingSize").val(d)},error:function(a){console.log(a)}}),$("#mySettingsModal").modal({keyboard:!0,backdrop:!0})},b.modal={name:"",size:"20",robotId:""},b.goRobotDetail=function(a,c){b.musicID=a;var d=c.target;if(-1!=d.className.indexOf("skillSettings"))return b.modal.robotId=a,void b.getMusicSettings(a);if(-1!=d.className.indexOf("s-skill")&&"P"==c.target.tagName){b.allCheckedNum=b.referencedAppObj.length;var e=$(d).parent().find(".s-skill-item-title").text();return void b.handleRobotStatusFunc(a,e,function(){$(d).hasClass("s-skill-checked")?(b.allCheckedNum-=1,$(d).css("display:none"),$(d).find("p").css("display:block"),"音乐知识图谱"==e&&$("a.skillSettings").css("display","none")):(b.allCheckedNum+=1,$(d).css("display:none"),$(d).find("p").css("display:block"));var a=$(d).parents("li");"data-my-skill"!=$(a).attr("data-act")&&$(".nav-tabs .badge").text(b.allCheckedNum)})}var f={};for(var g in b.robotList)if(b.robotList[g].id==a){f=b.robotList[g];break}$("[data-act=skill-store]").removeClass("active"),$("[data-act=my-skill]").removeClass("active"),$("#skill-store").removeClass("active in"),$("#my-skill").removeClass("active in"),$("[data-act=skill-detail]").css("display","block"),$("[data-act=skill-detail]").addClass("active"),$("#skill-detail").addClass("active in"),$(".para-action-tips").css("display","none"),b.robotDetail=f,b.$apply()},$("body").off("click","[data-act=my-skill],[data-act=skill-store]").on("click","[data-act=my-skill],[data-act=skill-store]",function(a){$(".change-option").find("li").each(function(a,b){});$(this);$("[data-act=skill-detail]").css("display","none")}),b.getCurrentReferencedAppFunc=function(){b.referencedAppObj=[];for(var c in a.currentRobot.referencedApp)for(var d in b.robotList)if(a.currentRobot.referencedApp[c]==b.robotList[d].id){b.referencedAppObj.push(b.robotList[d]);break}b.$apply()},b.recoverySort=function(){var a=b.recommendSkills.length;b.currentSort=[];for(var c=0;a>c;c++)$.inArray(b.recommendSkillName[c],b.mySkillName)>-1&&b.currentSort.push(b.recommendSkills[c]);b.currentSort.length>0&&(b.mySkills=[],$(b.currentSort).each(function(a,c){b.mySkills.push(c)}))},$(window).resize(function(){e()}),b.originSkills=[],$(".entry-sort").on("click",function(a,c){var c=(window.event,c||!0);"false"!=c&&$("#skillSortModal").modal("show"),e(),b.mySkills=[],b.recommendSkills=[],b.mySkillName=[],b.recommendSkillName=[],$(b.referencedAppObj).each(function(a,c){b.mySkills.push(c),b.mySkillName.push(c.appName)}),$(b.robotList).each(function(a,c){b.recommendSkills.push(c),b.recommendSkillName.push(c.appName)}),b.originSkills=b.mySkills,b.$apply(),c||b.changeSort(!1)}),b.changeSort=function(c){var c=c||!0;b.referencedAppObj=[];var d=[];$(b.mySkills).each(function(a,c){b.referencedAppObj.push(c),d.push(c.id)}),$("#skillSortModal").modal("hide"),a.currentRobot.referencedApp=d,g(a.currentRobot),c||b.alert("您的更改已保存")},$("body").off("click",".skill-create-submit").on("click",".skill-create-submit",function(a){var b=($(this),$("#plugin-name")),c=$("#hope-feature"),d=$("#data-resource"),e=$("#target-user"),f=$("#user-name"),g=$("#user-telephone"),h=$("#user-company");if(0==$.trim(b.val()).length)return $.trace("请填写插件名称"),b.focus(),!1;if(0==$.trim(c.val()).length)return $.trace("请填写您期望的功能"),c.focus(),!1;if(0==$.trim(d.val()).length)return $.trace("请填写数据资源"),d.focus(),!1;if(0==$.trim(e.val()).length)return $.trace("请填写目标用户"),e.focus(),!1;if(0==$.trim(f.val()).length)return $.trace("请填写姓名"),f.focus(),!1;if(0==$.trim(g.val()).length)return $.trace("请填写联系电话"),g.focus(),!1;if(0==$.trim(h.val()).length)return $.trace("请填写单位名称"),h.focus(),!1;var i=ruyiai_host+"/ruyi-ai/item/insert/";$.ajax({url:i,method:"post",data:JSON.stringify({appId:"SYSTEM_USER_ID",ownerAppId:appId,userId:getCookie("userId"),type:"createSkillPlugin",pluginName:b.val(),hopeFeature:c.val(),dataResource:d.val(),targetUser:e.val(),userName:f.val(),userTelephone:g.val(),userCompany:h.val()}),success:function(a){a=dataParse(a),0==a.code&&($(".skill-create-detail-form").css("display","none"),$(".skill-create-detail.contact").css("display","none"),$(".skill-create-apply-success").css("display","block"))}})});var k=getCookie("checked-skill-type");"my-skill"==k?($(".change-option [data-act=my-skill]").addClass("active").siblings("li").removeClass("active"),$("#myTabContent #my-skill").addClass("active in").siblings().removeClass("active in")):"skill-store"!=k&&"skill-detail"!=k&&k?"skill-create"==k&&($(".change-option [data-act=skill-create]").addClass("active").siblings("li").removeClass("active"),$("#myTabContent #skill-create").addClass("active in").siblings().removeClass("active in")):($(".change-option [data-act=skill-store]").addClass("active").siblings("li").removeClass("active"),$("#myTabContent #skill-store").addClass("active in").siblings().removeClass("active in")),$("body").off("click",".change-option li").on("click",".change-option li",function(a){var b=$(this),c=b.attr("data-act");setCookie("checked-skill-type",c)});var l=function(){var a=setInterval(function(){if(1==$(".skillSettings").length)clearInterval(a);else{var b=[],c=0;$("li.s-skill-item").each(function(a,d){var e=$(this).find(".s-skill-item-title").text(),f=$(this).find("p.s-skill-checked").hasClass("ng-hide")?!1:!0;"音乐知识图谱"==e&&(b[c]=document.createElement("a"),b[c].innerHTML="",b[c].classList.add("skillSettings"),$(this).append(b[c]),c++,f||$(this).find(".skillSettings").css("display","none"),"robot-sortable"==$(this).parent("ul").attr("id")&&$(this).find(".skillSettings").addClass("specialSettings"),(2==c||1==c)&&$(this).remove(b[c-1])),c>=3})}},500)};setTimeout(l,0)}function userLogListFunc(a,b,c,d){getCookie("currentCheckedAppId")&&"yes"==RequestTwo.implantInfoManagement&&(appId=getCookie("currentCheckedAppId")),$(".list-group-item").removeClass("active"),$("[data-act=nav-log]").addClass("active"),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200),a.logStatLoadedFlag=!1,b.pageSize=15,b.appName=getCookie("appName");var e=function(){var a=$(".center-list-box").css("width").replace("px","");a=parseInt(a),$(".user-log-box li .user-intent p").css("width",a-104+"px")};b.goUserLogsFunc=function(a){window.location.href="#/user_log_list/user_logs/"+a,$(".statistics-box").siblings("hr").hide()},b.getUserListFunc=function(){$.ajax({url:ruyiai_host+"/ruyi-ai/v2/"+appId+"/user",data:{size:b.pageSize},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){b.userList=a.result;for(var c in b.userList)b.userList[c].id=b.userList[c].id.replace(/:/g,"爨");b.$apply(),setTimeout(function(){e()},200);var d=1,f=!0;$(".center-list-main").on("scroll",function(a){var c=$(this),g=c[0].scrollTop,h=c[0].scrollHeight,i=c.height();if(g>=h-i-30&&1==f){var j=b.userList[b.userList.length-1].gmtUpdate;f=!1,$.ajax({url:ruyiai_host+"/ruyi-ai/v2/"+appId+"/user",data:{size:b.pageSize,beforeTime:j},method:"GET",success:function(a){if(a=dataParse(a),0==a.code){var c=a.result;if(c.length>0){for(var g in c)c[g].id=c[g].id.replace(/:/g,"爨"),b.userList.push(c[g]);d++,f=!0,b.$apply(),setTimeout(function(){e()},200)}else f=!1}else a&&2==a.code&&goIndex()}})}}),-1==window.location.href.indexOf("user_logs")&&b.userList[0]&&b.goUserLogsFunc(b.userList[0].id)}else 2==a.code?goIndex():a.msg&&$.trace(a.msg+"( "+a.detail+" )","error")}})},b.getUserListFunc(),$(window).resize(function(){e()})}function userLogsCtrl(a,b,c,d){function e(){$(".personal-info .user-info div").css("width",$(document.body).width()/7+"px")}function f(){$("#lookLogJson .modal-content").css("height",$(document).height()-100+"px"),"yes"==RequestTwo.implantInfoManagement&&getCookie("currentCheckedAppId")?($("#lookLogJson .modal-content").css("width",$(document).width()-475+"px"),$("#lookLogJson .modal-content").css("margin-left",-($(document).width()-1100)/2+"px")):($("#lookLogJson .modal-content").css("width",$(document).width()-300+"px"),$("#lookLogJson .modal-content").css("margin-left",-($(document).width()-700)/2+"px"))}$(".list-group-item").removeClass("active"),$("[data-act=user_log_list]").addClass("active"),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200),a.logStatLoadedFlag=!0,b.pageSize=10,setTimeout(function(){var a=$("[data-act=nav-log-"+d.user_id+"]");a.siblings().removeClass("active"),a.addClass("active");var c=0,e=a.attr("data-confidence-count");if(e){e=JSON.parse(e);for(var f in e)c+=e[f]}var g=new Object;g.nickName=a.attr("data-nickname"),g.headimg=a.attr("data-headimg"),g.sex=a.attr("data-sex"),g.city=a.attr("data-city"),g.confidenceCount=c,b.userObject=g,b.$apply()},10),b.getUserLogsFunc=function(){var a=d.user_id;a=a.replace(/爨/g,":"),$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+a+"/log",data:{minTime:-1,maxTime:145944e7,size:b.pageSize},method:"GET",success:function(a){if(0==a.code){b.userLogs=a.result;for(var c in b.userLogs)b.userLogs[c].resultJsonParse=JSON.stringify(b.userLogs[c],null,4);b.$apply(),setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},200),setTimeout(function(){$("[data-act=evaluate]").rating()},10),"yes"==RequestTwo.implantInfoManagement&&getCookie("currentCheckedAppId")&&($("[data-act=evaluate-box-li]").css("display","none"),$(".edit-icon").css("display","none")),setTimeout(function(){$('[data-toggle="popover"]').popover()},1e3)}else 2==a.code?goIndex():$.trace(a.msg+"( "+a.detail+" )")}})},b.getUserLogsFunc(),$("body").off("click",".star-rating").on("click",".star-rating",function(a){var c=$(this);setTimeout(function(){var a=c.find(".caption span"),d=a.attr("class"),e=5;d.indexOf("danger")>-1?e=1:d.indexOf("warning")>-1?e=2:d.indexOf("info")>-1?e=3:d.indexOf("primary")>-1?e=4:d.indexOf("success")>-1&&(e=5);var f=c.find("[data-act=evaluate]");if(b.ratingObj=new Object,b.ratingObj.diffError=f.attr("rating-diffError"),"true"==b.ratingObj.diffError?b.ratingObj.diffError=!0:b.ratingObj.diffError=!1,b.ratingObj.semanticError=f.attr("rating-semanticError"),"true"==b.ratingObj.semanticError?b.ratingObj.semanticError=!0:b.ratingObj.semanticError=!1,b.ratingObj.text=f.attr("rating-text"),b.ratingObj.logId=f.attr("data-log-id"),b.ratingObj.score=e,b.ratingObj.createTime=f.attr("data-time"),b.$apply(),3>=e){$("#evaluateModal").modal("show"),b.ratingObj.diffError?$("[data-act=diffError]").addClass("active").siblings("li").removeClass("active"):b.ratingObj.semanticError?$("[data-act=semanticError]").addClass("active").siblings("li").removeClass("active"):($("[data-act=semanticError]").removeClass("active"),$("[data-act=diffError]").removeClass("active"));var g=c.offset().left-442,h=c.offset().top+6;$("#evaluateModal").css({left:g+"px",top:h+"px"})}b.evaluateIntentFunc()},200)}),$("body").off("click",".choose-reason li").on("click",".choose-reason li",function(a){var b=$(this);b.addClass("active").siblings("li").removeClass("active")}),$("body").off("click",".rating-submit").on("click",".rating-submit",function(a){$(".choose-reason [data-act=diffError]").hasClass("active")?(b.ratingObj.diffError=!0,b.ratingObj.semanticError=!1):$(".choose-reason [data-act=semanticError]").hasClass("active")&&(b.ratingObj.diffError=!1,b.ratingObj.semanticError=!0),b.$apply(),b.evaluateIntentFunc();for(var c in b.userLogs)if(b.ratingObj.logId==b.userLogs[c].response.logId){b.userLogs[c].response.rating=b.ratingObj,b.$apply(),$("#evaluateModal").modal("hide");break}}),b.evaluateIntentFunc=function(){$.ajax({url:ruyiai_host+"/ruyi-ai/"+b.ratingObj.logId+"/rating",data:JSON.stringify(b.ratingObj),traditional:!0,headers:{"Content-Type":"application/json"},method:"POST",success:function(a){}})};var g=1,h=!0;$(".user-logs-box .logs").on("scroll",function(a){var c,e=$(this),f=e[0].scrollTop,i=e[0].scrollHeight,j=e.height(),k=(new Date).getTime();if(b.userLogs&&b.userLogs.length>0&&(c=b.userLogs[b.userLogs.length-1],k=c.request.gmt_create),f>=i-j-30&&1==h){h=!1;var l=d.user_id;l=l.replace(/爨/g,":"),$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/"+l+"/log",data:{minTime:k,maxTime:145944e7,size:b.pageSize},method:"GET",success:function(a){if(0==a.code){var c=a.result;if(c.length>0){for(var d in c)c[d].resultJsonParse=JSON.stringify(c[d],null,4),b.userLogs.push(c[d]);g++,h=!0,b.$apply(),setTimeout(function(){$("[data-act=evaluate]").rating()},10)}else h=!1;"yes"==RequestTwo.implantInfoManagement&&getCookie("currentCheckedAppId")&&($("[data-act=evaluate-box-li]").css("display","none"),$(".edit-icon").css("display","none")),$('[data-toggle="tooltip"]').tooltip()}else a&&2==a.code&&goIndex()}})}}),b.getIntentObjFunc=function(a){$.ajax({url:ruyiai_host+"/ruyi-ai/"+appId+"/test/intent/"+a,method:"GET",success:function(b){if(0==b.code){var c=b.result;window.location.href="#/intent_list/"+c.scenarioId+"/intent_detail/"+a}else 2==b.code?goIndex():$.trace("系统意图，不能进行编辑")}})},b.operationIntentFunc=function(a){a&&a.intents&&a.intents.length>0?0==a.intents[0].score?window.location.href="":b.getIntentObjFunc(a.intents[0].id):window.location.href=""},b.initListFunc=function(c){b.news_list=[];var d=ruyiai_host+"/ruyi-ai/"+a.app_key+"/transfor/news/"+c;$.ajax({url:d,method:"get",success:function(c){if(c=dataParse(c),0==c.code){for(var d in c.result.news_item){var e=new Object;e.description=c.result.news_item[d].digest,e.title=c.result.news_item[d].title,e.pic_url=ruyi_wechat+"/ruyi-wechat/"+a.app_key+"/content/"+c.result.news_item[d].thumb_media_id,e.url=c.result.news_item[d].url,b.news_list.push(e)}b.$apply()}}})},$(".logs").delegate(".wechat-image","click",function(){var b=$(this).attr("videoURL"),c=ruyiai_host+"/ruyi-ai/"+a.app_key+"/transfor/video/"+b;$.ajax({url:c,method:"get",success:function(a){a=dataParse(a),0==a.code&&window.open(a.result.down_url)}})}),$(".logs").delegate(".wechat-news-single","click",function(){var a=$(this).attr("go_url");window.open(a)}),$(".nav-count li").click(function(){var a=$(this).attr("class").split(" ")[0];$(this).addClass("active").siblings().removeClass("active"),$("#"+a).addClass("active in").siblings().removeClass("active in")}),e(),$(window).resize(function(){e(),f()}),$("body").off("click","[data-act=look-log-json]").on("click","[data-act=look-log-json]",function(a){var b=$(this),c=b.attr("data-json");$("#lookLogJson").modal("show"),$("[data-act=log-json-box]").text(c),f()}),$("#lookLogJson").on("shown.bs.modal",function(){$("#lookLogJson .modal-content").scrollTop("0px")})}$(function(){var a=Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",container:"container",drop_element:"container",max_file_size:"1000mb",flash_swf_url:"bower_components/plupload/js/Moxie.swf",dragdrop:!0,chunk_size:"4mb",multi_selection:!("ios"===mOxie.Env.OS.toLowerCase()),uptoken:$("#uptoken_url").val(),domain:$("#domain").val(),get_new_uptoken:!1,save_key:!0,auto_start:!0,log_level:5,init:{FilesAdded:function(a,b){$("table").show(),$("#success").hide(),plupload.each(b,function(b){var c=new FileProgress(b,"fsUploadProgress");c.setStatus("等待..."),c.bindUploadCancel(a)})},BeforeUpload:function(a,b){var c=new FileProgress(b,"fsUploadProgress"),d=plupload.parseSize(this.getOption("chunk_size"));"html5"===a.runtime&&d&&c.setChunkProgess(d)},UploadProgress:function(a,b){var c=new FileProgress(b,"fsUploadProgress"),d=plupload.parseSize(this.getOption("chunk_size"));c.setProgress(b.percent+"%",b.speed,d)},UploadComplete:function(){alert("所有文件上传完成。。。"),$("#success").show()},FileUploaded:function(a,b,c){var d=new FileProgress(b,"fsUploadProgress");d.setComplete(a,c),console.log("file:"+JSON.stringify(b))},Error:function(a,b,c){$("table").show();var d=new FileProgress(b.file,"fsUploadProgress");d.setError(),d.setStatus(c)}}});a.bind("FileUploaded",function(){console.log("hello man,a file is uploaded")}),$("#container").on("dragenter",function(a){a.preventDefault(),$("#container").addClass("draging"),a.stopPropagation()}).on("drop",function(a){a.preventDefault(),$("#container").removeClass("draging"),a.stopPropagation()}).on("dragleave",function(a){a.preventDefault(),$("#container").removeClass("draging"),a.stopPropagation()}).on("dragover",function(a){a.preventDefault(),$("#container").addClass("draging"),a.stopPropagation()}),$("#show_code").on("click",function(){$("#myModal-code").modal(),$("pre code").each(function(a,b){hljs.highlightBlock(b)})}),$("body").on("click","table button.btn",function(){$(this).parents("tr").next().toggle()});var b=function(a){if(!a)return 0;for(var b=a.split("/"),c=0,d=b.length;d>c;c++)if("rotate"===b[c])return parseInt(b[c+1],10);return 0};$("#myModal-img .modal-body-footer").find("a").on("click",function(){var a=$("#myModal-img").find(".modal-body img"),c=a.data("key"),d=a.attr("src"),e=parseInt(a.data("h"),10),f=[],g=b(d);if($(this).hasClass("no-disable-click")){$(this).siblings().removeClass("disabled");var h=$(this).data("imagemogr");"left"===h?g=0>g-90?g+270:g-90:"right"===h&&(g=g+90>360?g-270:g+90),f.push({fop:"imageMogr2","auto-orient":!0,strip:!0,rotate:g,format:"png"})}else $(this).addClass("disabled").siblings().removeClass("disabled"),"no-rotate"!==$(this).data("imagemogr")&&f.push({fop:"imageMogr2","auto-orient":!0,strip:!0,rotate:g,format:"png"});$("#myModal-img .modal-body-footer").find("a.disabled").each(function(){var a=$(this).data("watermark"),b=$(this).data("imageview"),c=$(this).data("imagemogr");if(a&&f.push({fop:"watermark",mode:1,image:"http://www.b1.qiniudn.com/images/logo-2.png",dissolve:100,gravity:a,dx:100,dy:100}),b){var d;switch(b){case"large":d=e;break;case"middle":d=.5*e;break;case"small":d=.1*e;break;default:d=e}f.push({fop:"imageView2",mode:3,h:parseInt(d,10),q:100,format:"png"})}"no-rotate"===c&&f.push({fop:"imageMogr2","auto-orient":!0,strip:!0,rotate:0,format:"png"})});var i=Qiniu.pipeline(f,c),j=new Image;return a.attr("src","images/loading.gif"),j.onload=function(){a.attr("src",i),a.parent("a").attr("href",i)},j.src=i,!1})}),!function(){"use strict";var a,b=function(c,d){function e(a){return Math.floor(a)}function f(){var a=u.params.autoplay,b=u.slides.eq(u.activeIndex);b.attr("data-swiper-autoplay")&&(a=b.attr("data-swiper-autoplay")||u.params.autoplay),u.autoplayTimeoutId=setTimeout(function(){u.params.loop?(u.fixLoop(),u._slideNext(),u.emit("onAutoplay",u)):u.isEnd?d.autoplayStopOnLast?u.stopAutoplay():(u._slideTo(0),u.emit("onAutoplay",u)):(u._slideNext(),u.emit("onAutoplay",u))},a)}function g(b,c){var d=a(b.target);if(!d.is(c))if("string"==typeof c)d=d.parents(c);else if(c.nodeType){var e;return d.parents().each(function(a,b){b===c&&(e=c)}),e?c:void 0}return 0!==d.length?d[0]:void 0}function h(a,b){b=b||{};var c=window.MutationObserver||window.WebkitMutationObserver,d=new c(function(a){a.forEach(function(a){u.onResize(!0),u.emit("onObserverUpdate",u,a)})});d.observe(a,{attributes:void 0===b.attributes||b.attributes,childList:void 0===b.childList||b.childList,characterData:void 0===b.characterData||b.characterData}),u.observers.push(d)}function i(a){a.originalEvent&&(a=a.originalEvent);var b=a.keyCode||a.charCode;if(!u.params.allowSwipeToNext&&(u.isHorizontal()&&39===b||!u.isHorizontal()&&40===b))return!1;if(!u.params.allowSwipeToPrev&&(u.isHorizontal()&&37===b||!u.isHorizontal()&&38===b))return!1;if(!(a.shiftKey||a.altKey||a.ctrlKey||a.metaKey||document.activeElement&&document.activeElement.nodeName&&("input"===document.activeElement.nodeName.toLowerCase()||"textarea"===document.activeElement.nodeName.toLowerCase()))){if(37===b||39===b||38===b||40===b){var c=!1;if(u.container.parents("."+u.params.slideClass).length>0&&0===u.container.parents("."+u.params.slideActiveClass).length)return;var d={left:window.pageXOffset,top:window.pageYOffset},e=window.innerWidth,f=window.innerHeight,g=u.container.offset();u.rtl&&(g.left=g.left-u.container[0].scrollLeft);for(var h=[[g.left,g.top],[g.left+u.width,g.top],[g.left,g.top+u.height],[g.left+u.width,g.top+u.height]],i=0;i<h.length;i++){var j=h[i];j[0]>=d.left&&j[0]<=d.left+e&&j[1]>=d.top&&j[1]<=d.top+f&&(c=!0)}if(!c)return}u.isHorizontal()?(37!==b&&39!==b||(a.preventDefault?a.preventDefault():a.returnValue=!1),
(39===b&&!u.rtl||37===b&&u.rtl)&&u.slideNext(),(37===b&&!u.rtl||39===b&&u.rtl)&&u.slidePrev()):(38!==b&&40!==b||(a.preventDefault?a.preventDefault():a.returnValue=!1),40===b&&u.slideNext(),38===b&&u.slidePrev()),u.emit("onKeyPress",u,b)}}function j(a){var b=0,c=0,d=0,e=0;return"detail"in a&&(c=a.detail),"wheelDelta"in a&&(c=-a.wheelDelta/120),"wheelDeltaY"in a&&(c=-a.wheelDeltaY/120),"wheelDeltaX"in a&&(b=-a.wheelDeltaX/120),"axis"in a&&a.axis===a.HORIZONTAL_AXIS&&(b=c,c=0),d=10*b,e=10*c,"deltaY"in a&&(e=a.deltaY),"deltaX"in a&&(d=a.deltaX),(d||e)&&a.deltaMode&&(1===a.deltaMode?(d*=40,e*=40):(d*=800,e*=800)),d&&!b&&(b=1>d?-1:1),e&&!c&&(c=1>e?-1:1),{spinX:b,spinY:c,pixelX:d,pixelY:e}}function k(a){a.originalEvent&&(a=a.originalEvent);var b=0,c=u.rtl?-1:1,d=j(a);if(u.params.mousewheelForceToAxis)if(u.isHorizontal()){if(!(Math.abs(d.pixelX)>Math.abs(d.pixelY)))return;b=d.pixelX*c}else{if(!(Math.abs(d.pixelY)>Math.abs(d.pixelX)))return;b=d.pixelY}else b=Math.abs(d.pixelX)>Math.abs(d.pixelY)?-d.pixelX*c:-d.pixelY;if(0!==b){if(u.params.mousewheelInvert&&(b=-b),u.params.freeMode){var e=u.getWrapperTranslate()+b*u.params.mousewheelSensitivity,f=u.isBeginning,g=u.isEnd;if(e>=u.minTranslate()&&(e=u.minTranslate()),e<=u.maxTranslate()&&(e=u.maxTranslate()),u.setWrapperTransition(0),u.setWrapperTranslate(e),u.updateProgress(),u.updateActiveIndex(),(!f&&u.isBeginning||!g&&u.isEnd)&&u.updateClasses(),u.params.freeModeSticky?(clearTimeout(u.mousewheel.timeout),u.mousewheel.timeout=setTimeout(function(){u.slideReset()},300)):u.params.lazyLoading&&u.lazy&&u.lazy.load(),u.emit("onScroll",u,a),u.params.autoplay&&u.params.autoplayDisableOnInteraction&&u.stopAutoplay(),0===e||e===u.maxTranslate())return}else{if((new window.Date).getTime()-u.mousewheel.lastScrollTime>60)if(0>b)if(u.isEnd&&!u.params.loop||u.animating){if(u.params.mousewheelReleaseOnEdges)return!0}else u.slideNext(),u.emit("onScroll",u,a);else if(u.isBeginning&&!u.params.loop||u.animating){if(u.params.mousewheelReleaseOnEdges)return!0}else u.slidePrev(),u.emit("onScroll",u,a);u.mousewheel.lastScrollTime=(new window.Date).getTime()}return a.preventDefault?a.preventDefault():a.returnValue=!1,!1}}function l(b,c){b=a(b);var d,e,f,g=u.rtl?-1:1;d=b.attr("data-swiper-parallax")||"0",e=b.attr("data-swiper-parallax-x"),f=b.attr("data-swiper-parallax-y"),e||f?(e=e||"0",f=f||"0"):u.isHorizontal()?(e=d,f="0"):(f=d,e="0"),e=e.indexOf("%")>=0?parseInt(e,10)*c*g+"%":e*c*g+"px",f=f.indexOf("%")>=0?parseInt(f,10)*c+"%":f*c+"px",b.transform("translate3d("+e+", "+f+",0px)")}function m(a){return 0!==a.indexOf("on")&&(a=a[0]!==a[0].toUpperCase()?"on"+a[0].toUpperCase()+a.substring(1):"on"+a),a}if(!(this instanceof b))return new b(c,d);var n={direction:"horizontal",touchEventsTarget:"container",initialSlide:0,speed:300,autoplay:!1,autoplayDisableOnInteraction:!0,autoplayStopOnLast:!1,iOSEdgeSwipeDetection:!1,iOSEdgeSwipeThreshold:20,freeMode:!1,freeModeMomentum:!0,freeModeMomentumRatio:1,freeModeMomentumBounce:!0,freeModeMomentumBounceRatio:1,freeModeMomentumVelocityRatio:1,freeModeSticky:!1,freeModeMinimumVelocity:.02,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",coverflow:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},flip:{slideShadows:!0,limitRotation:!0},cube:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94},fade:{crossFade:!1},parallax:!1,zoom:!1,zoomMax:3,zoomMin:1,zoomToggle:!0,scrollbar:null,scrollbarHide:!0,scrollbarDraggable:!1,scrollbarSnapOnRelease:!1,keyboardControl:!1,mousewheelControl:!1,mousewheelReleaseOnEdges:!1,mousewheelInvert:!1,mousewheelForceToAxis:!1,mousewheelSensitivity:1,mousewheelEventsTarged:"container",hashnav:!1,hashnavWatchState:!1,history:!1,replaceState:!1,breakpoints:void 0,spaceBetween:0,slidesPerView:1,slidesPerColumn:1,slidesPerColumnFill:"column",slidesPerGroup:1,centeredSlides:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,onlyExternal:!1,threshold:0,touchMoveStopPropagation:!0,touchReleaseOnEdges:!1,uniqueNavElements:!0,pagination:null,paginationElement:"span",paginationClickable:!1,paginationHide:!1,paginationBulletRender:null,paginationProgressRender:null,paginationFractionRender:null,paginationCustomRender:null,paginationType:"bullets",resistance:!0,resistanceRatio:.85,nextButton:null,prevButton:null,watchSlidesProgress:!1,watchSlidesVisibility:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,lazyLoading:!1,lazyLoadingInPrevNext:!1,lazyLoadingInPrevNextAmount:1,lazyLoadingOnTransitionStart:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,control:void 0,controlInverse:!1,controlBy:"slide",normalizeSlideIndex:!0,allowSwipeToPrev:!0,allowSwipeToNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",passiveListeners:!0,containerModifierClass:"swiper-container-",slideClass:"swiper-slide",slideActiveClass:"swiper-slide-active",slideDuplicateActiveClass:"swiper-slide-duplicate-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slideDuplicateNextClass:"swiper-slide-duplicate-next",slidePrevClass:"swiper-slide-prev",slideDuplicatePrevClass:"swiper-slide-duplicate-prev",wrapperClass:"swiper-wrapper",bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active",buttonDisabledClass:"swiper-button-disabled",paginationCurrentClass:"swiper-pagination-current",paginationTotalClass:"swiper-pagination-total",paginationHiddenClass:"swiper-pagination-hidden",paginationProgressbarClass:"swiper-pagination-progressbar",paginationClickableClass:"swiper-pagination-clickable",paginationModifierClass:"swiper-pagination-",lazyLoadingClass:"swiper-lazy",lazyStatusLoadingClass:"swiper-lazy-loading",lazyStatusLoadedClass:"swiper-lazy-loaded",lazyPreloaderClass:"swiper-lazy-preloader",notificationClass:"swiper-notification",preloaderClass:"preloader",zoomContainerClass:"swiper-zoom-container",observer:!1,observeParents:!1,a11y:!1,prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}",runCallbacksOnInit:!0},o=d&&d.virtualTranslate;d=d||{};var p={};for(var q in d)if("object"!=typeof d[q]||null===d[q]||d[q].nodeType||d[q]===window||d[q]===document||"undefined"!=typeof Dom7&&d[q]instanceof Dom7||"undefined"!=typeof jQuery&&d[q]instanceof jQuery)p[q]=d[q];else{p[q]={};for(var r in d[q])p[q][r]=d[q][r]}for(var s in n)if(void 0===d[s])d[s]=n[s];else if("object"==typeof d[s])for(var t in n[s])void 0===d[s][t]&&(d[s][t]=n[s][t]);var u=this;if(u.params=d,u.originalParams=p,u.classNames=[],void 0!==a&&"undefined"!=typeof Dom7&&(a=Dom7),(void 0!==a||(a="undefined"==typeof Dom7?window.Dom7||window.Zepto||window.jQuery:Dom7))&&(u.$=a,u.currentBreakpoint=void 0,u.getActiveBreakpoint=function(){if(!u.params.breakpoints)return!1;var a,b=!1,c=[];for(a in u.params.breakpoints)u.params.breakpoints.hasOwnProperty(a)&&c.push(a);c.sort(function(a,b){return parseInt(a,10)>parseInt(b,10)});for(var d=0;d<c.length;d++)(a=c[d])>=window.innerWidth&&!b&&(b=a);return b||"max"},u.setBreakpoint=function(){var a=u.getActiveBreakpoint();if(a&&u.currentBreakpoint!==a){var b=a in u.params.breakpoints?u.params.breakpoints[a]:u.originalParams,c=u.params.loop&&b.slidesPerView!==u.params.slidesPerView;for(var d in b)u.params[d]=b[d];u.currentBreakpoint=a,c&&u.destroyLoop&&u.reLoop(!0)}},u.params.breakpoints&&u.setBreakpoint(),u.container=a(c),0!==u.container.length)){if(u.container.length>1){var v=[];return u.container.each(function(){v.push(new b(this,d))}),v}u.container[0].swiper=u,u.container.data("swiper",u),u.classNames.push(u.params.containerModifierClass+u.params.direction),u.params.freeMode&&u.classNames.push(u.params.containerModifierClass+"free-mode"),u.support.flexbox||(u.classNames.push(u.params.containerModifierClass+"no-flexbox"),u.params.slidesPerColumn=1),u.params.autoHeight&&u.classNames.push(u.params.containerModifierClass+"autoheight"),(u.params.parallax||u.params.watchSlidesVisibility)&&(u.params.watchSlidesProgress=!0),u.params.touchReleaseOnEdges&&(u.params.resistanceRatio=0),["cube","coverflow","flip"].indexOf(u.params.effect)>=0&&(u.support.transforms3d?(u.params.watchSlidesProgress=!0,u.classNames.push(u.params.containerModifierClass+"3d")):u.params.effect="slide"),"slide"!==u.params.effect&&u.classNames.push(u.params.containerModifierClass+u.params.effect),"cube"===u.params.effect&&(u.params.resistanceRatio=0,u.params.slidesPerView=1,u.params.slidesPerColumn=1,u.params.slidesPerGroup=1,u.params.centeredSlides=!1,u.params.spaceBetween=0,u.params.virtualTranslate=!0),"fade"!==u.params.effect&&"flip"!==u.params.effect||(u.params.slidesPerView=1,u.params.slidesPerColumn=1,u.params.slidesPerGroup=1,u.params.watchSlidesProgress=!0,u.params.spaceBetween=0,void 0===o&&(u.params.virtualTranslate=!0)),u.params.grabCursor&&u.support.touch&&(u.params.grabCursor=!1),u.wrapper=u.container.children("."+u.params.wrapperClass),u.params.pagination&&(u.paginationContainer=a(u.params.pagination),u.params.uniqueNavElements&&"string"==typeof u.params.pagination&&u.paginationContainer.length>1&&1===u.container.find(u.params.pagination).length&&(u.paginationContainer=u.container.find(u.params.pagination)),"bullets"===u.params.paginationType&&u.params.paginationClickable?u.paginationContainer.addClass(u.params.paginationModifierClass+"clickable"):u.params.paginationClickable=!1,u.paginationContainer.addClass(u.params.paginationModifierClass+u.params.paginationType)),(u.params.nextButton||u.params.prevButton)&&(u.params.nextButton&&(u.nextButton=a(u.params.nextButton),u.params.uniqueNavElements&&"string"==typeof u.params.nextButton&&u.nextButton.length>1&&1===u.container.find(u.params.nextButton).length&&(u.nextButton=u.container.find(u.params.nextButton))),u.params.prevButton&&(u.prevButton=a(u.params.prevButton),u.params.uniqueNavElements&&"string"==typeof u.params.prevButton&&u.prevButton.length>1&&1===u.container.find(u.params.prevButton).length&&(u.prevButton=u.container.find(u.params.prevButton)))),u.isHorizontal=function(){return"horizontal"===u.params.direction},u.rtl=u.isHorizontal()&&("rtl"===u.container[0].dir.toLowerCase()||"rtl"===u.container.css("direction")),u.rtl&&u.classNames.push(u.params.containerModifierClass+"rtl"),u.rtl&&(u.wrongRTL="-webkit-box"===u.wrapper.css("display")),u.params.slidesPerColumn>1&&u.classNames.push(u.params.containerModifierClass+"multirow"),u.device.android&&u.classNames.push(u.params.containerModifierClass+"android"),u.container.addClass(u.classNames.join(" ")),u.translate=0,u.progress=0,u.velocity=0,u.lockSwipeToNext=function(){u.params.allowSwipeToNext=!1,u.params.allowSwipeToPrev===!1&&u.params.grabCursor&&u.unsetGrabCursor()},u.lockSwipeToPrev=function(){u.params.allowSwipeToPrev=!1,u.params.allowSwipeToNext===!1&&u.params.grabCursor&&u.unsetGrabCursor()},u.lockSwipes=function(){u.params.allowSwipeToNext=u.params.allowSwipeToPrev=!1,u.params.grabCursor&&u.unsetGrabCursor()},u.unlockSwipeToNext=function(){u.params.allowSwipeToNext=!0,u.params.allowSwipeToPrev===!0&&u.params.grabCursor&&u.setGrabCursor()},u.unlockSwipeToPrev=function(){u.params.allowSwipeToPrev=!0,u.params.allowSwipeToNext===!0&&u.params.grabCursor&&u.setGrabCursor()},u.unlockSwipes=function(){u.params.allowSwipeToNext=u.params.allowSwipeToPrev=!0,u.params.grabCursor&&u.setGrabCursor()},u.setGrabCursor=function(a){u.container[0].style.cursor="move",u.container[0].style.cursor=a?"-webkit-grabbing":"-webkit-grab",u.container[0].style.cursor=a?"-moz-grabbin":"-moz-grab",u.container[0].style.cursor=a?"grabbing":"grab"},u.unsetGrabCursor=function(){u.container[0].style.cursor=""},u.params.grabCursor&&u.setGrabCursor(),u.imagesToLoad=[],u.imagesLoaded=0,u.loadImage=function(a,b,c,d,e,f){function g(){f&&f()}var h;a.complete&&e?g():b?(h=new window.Image,h.onload=g,h.onerror=g,d&&(h.sizes=d),c&&(h.srcset=c),b&&(h.src=b)):g()},u.preloadImages=function(){function a(){void 0!==u&&null!==u&&u&&(void 0!==u.imagesLoaded&&u.imagesLoaded++,u.imagesLoaded===u.imagesToLoad.length&&(u.params.updateOnImagesReady&&u.update(),u.emit("onImagesReady",u)))}u.imagesToLoad=u.container.find("img");for(var b=0;b<u.imagesToLoad.length;b++)u.loadImage(u.imagesToLoad[b],u.imagesToLoad[b].currentSrc||u.imagesToLoad[b].getAttribute("src"),u.imagesToLoad[b].srcset||u.imagesToLoad[b].getAttribute("srcset"),u.imagesToLoad[b].sizes||u.imagesToLoad[b].getAttribute("sizes"),!0,a)},u.autoplayTimeoutId=void 0,u.autoplaying=!1,u.autoplayPaused=!1,u.startAutoplay=function(){return void 0===u.autoplayTimeoutId&&!!u.params.autoplay&&!u.autoplaying&&(u.autoplaying=!0,u.emit("onAutoplayStart",u),void f())},u.stopAutoplay=function(a){u.autoplayTimeoutId&&(u.autoplayTimeoutId&&clearTimeout(u.autoplayTimeoutId),u.autoplaying=!1,u.autoplayTimeoutId=void 0,u.emit("onAutoplayStop",u))},u.pauseAutoplay=function(a){u.autoplayPaused||(u.autoplayTimeoutId&&clearTimeout(u.autoplayTimeoutId),u.autoplayPaused=!0,0===a?(u.autoplayPaused=!1,f()):u.wrapper.transitionEnd(function(){u&&(u.autoplayPaused=!1,u.autoplaying?f():u.stopAutoplay())}))},u.minTranslate=function(){return-u.snapGrid[0]},u.maxTranslate=function(){return-u.snapGrid[u.snapGrid.length-1]},u.updateAutoHeight=function(){var a,b=[],c=0;if("auto"!==u.params.slidesPerView&&u.params.slidesPerView>1)for(a=0;a<Math.ceil(u.params.slidesPerView);a++){var d=u.activeIndex+a;if(d>u.slides.length)break;b.push(u.slides.eq(d)[0])}else b.push(u.slides.eq(u.activeIndex)[0]);for(a=0;a<b.length;a++)if(void 0!==b[a]){var e=b[a].offsetHeight;c=e>c?e:c}c&&u.wrapper.css("height",c+"px")},u.updateContainerSize=function(){var a,b;a=void 0!==u.params.width?u.params.width:u.container[0].clientWidth,b=void 0!==u.params.height?u.params.height:u.container[0].clientHeight,0===a&&u.isHorizontal()||0===b&&!u.isHorizontal()||(a=a-parseInt(u.container.css("padding-left"),10)-parseInt(u.container.css("padding-right"),10),b=b-parseInt(u.container.css("padding-top"),10)-parseInt(u.container.css("padding-bottom"),10),u.width=a,u.height=b,u.size=u.isHorizontal()?u.width:u.height)},u.updateSlidesSize=function(){u.slides=u.wrapper.children("."+u.params.slideClass),u.snapGrid=[],u.slidesGrid=[],u.slidesSizesGrid=[];var a,b=u.params.spaceBetween,c=-u.params.slidesOffsetBefore,d=0,f=0;if(void 0!==u.size){"string"==typeof b&&b.indexOf("%")>=0&&(b=parseFloat(b.replace("%",""))/100*u.size),u.virtualSize=-b,u.rtl?u.slides.css({marginLeft:"",marginTop:""}):u.slides.css({marginRight:"",marginBottom:""});var g;u.params.slidesPerColumn>1&&(g=Math.floor(u.slides.length/u.params.slidesPerColumn)===u.slides.length/u.params.slidesPerColumn?u.slides.length:Math.ceil(u.slides.length/u.params.slidesPerColumn)*u.params.slidesPerColumn,"auto"!==u.params.slidesPerView&&"row"===u.params.slidesPerColumnFill&&(g=Math.max(g,u.params.slidesPerView*u.params.slidesPerColumn)));var h,i=u.params.slidesPerColumn,j=g/i,k=j-(u.params.slidesPerColumn*j-u.slides.length);for(a=0;a<u.slides.length;a++){h=0;var l=u.slides.eq(a);if(u.params.slidesPerColumn>1){var m,n,o;"column"===u.params.slidesPerColumnFill?(n=Math.floor(a/i),o=a-n*i,(n>k||n===k&&o===i-1)&&++o>=i&&(o=0,n++),m=n+o*g/i,l.css({"-webkit-box-ordinal-group":m,"-moz-box-ordinal-group":m,"-ms-flex-order":m,"-webkit-order":m,order:m})):(o=Math.floor(a/j),n=a-o*j),l.css("margin-"+(u.isHorizontal()?"top":"left"),0!==o&&u.params.spaceBetween&&u.params.spaceBetween+"px").attr("data-swiper-column",n).attr("data-swiper-row",o)}"none"!==l.css("display")&&("auto"===u.params.slidesPerView?(h=u.isHorizontal()?l.outerWidth(!0):l.outerHeight(!0),u.params.roundLengths&&(h=e(h))):(h=(u.size-(u.params.slidesPerView-1)*b)/u.params.slidesPerView,u.params.roundLengths&&(h=e(h)),u.isHorizontal()?u.slides[a].style.width=h+"px":u.slides[a].style.height=h+"px"),u.slides[a].swiperSlideSize=h,u.slidesSizesGrid.push(h),u.params.centeredSlides?(c=c+h/2+d/2+b,0===d&&0!==a&&(c=c-u.size/2-b),0===a&&(c=c-u.size/2-b),Math.abs(c)<.001&&(c=0),f%u.params.slidesPerGroup==0&&u.snapGrid.push(c),u.slidesGrid.push(c)):(f%u.params.slidesPerGroup==0&&u.snapGrid.push(c),u.slidesGrid.push(c),c=c+h+b),u.virtualSize+=h+b,d=h,f++)}u.virtualSize=Math.max(u.virtualSize,u.size)+u.params.slidesOffsetAfter;var p;if(u.rtl&&u.wrongRTL&&("slide"===u.params.effect||"coverflow"===u.params.effect)&&u.wrapper.css({width:u.virtualSize+u.params.spaceBetween+"px"}),u.support.flexbox&&!u.params.setWrapperSize||(u.isHorizontal()?u.wrapper.css({width:u.virtualSize+u.params.spaceBetween+"px"}):u.wrapper.css({height:u.virtualSize+u.params.spaceBetween+"px"})),u.params.slidesPerColumn>1&&(u.virtualSize=(h+u.params.spaceBetween)*g,u.virtualSize=Math.ceil(u.virtualSize/u.params.slidesPerColumn)-u.params.spaceBetween,u.isHorizontal()?u.wrapper.css({width:u.virtualSize+u.params.spaceBetween+"px"}):u.wrapper.css({height:u.virtualSize+u.params.spaceBetween+"px"}),u.params.centeredSlides)){for(p=[],a=0;a<u.snapGrid.length;a++)u.snapGrid[a]<u.virtualSize+u.snapGrid[0]&&p.push(u.snapGrid[a]);u.snapGrid=p}if(!u.params.centeredSlides){for(p=[],a=0;a<u.snapGrid.length;a++)u.snapGrid[a]<=u.virtualSize-u.size&&p.push(u.snapGrid[a]);u.snapGrid=p,Math.floor(u.virtualSize-u.size)-Math.floor(u.snapGrid[u.snapGrid.length-1])>1&&u.snapGrid.push(u.virtualSize-u.size)}0===u.snapGrid.length&&(u.snapGrid=[0]),0!==u.params.spaceBetween&&(u.isHorizontal()?u.rtl?u.slides.css({marginLeft:b+"px"}):u.slides.css({marginRight:b+"px"}):u.slides.css({marginBottom:b+"px"})),u.params.watchSlidesProgress&&u.updateSlidesOffset()}},u.updateSlidesOffset=function(){for(var a=0;a<u.slides.length;a++)u.slides[a].swiperSlideOffset=u.isHorizontal()?u.slides[a].offsetLeft:u.slides[a].offsetTop},u.currentSlidesPerView=function(){var a,b,c=1;if(u.params.centeredSlides){var d,e=u.slides[u.activeIndex].swiperSlideSize;for(a=u.activeIndex+1;a<u.slides.length;a++)u.slides[a]&&!d&&(e+=u.slides[a].swiperSlideSize,c++,e>u.size&&(d=!0));for(b=u.activeIndex-1;b>=0;b--)u.slides[b]&&!d&&(e+=u.slides[b].swiperSlideSize,c++,e>u.size&&(d=!0))}else for(a=u.activeIndex+1;a<u.slides.length;a++)u.slidesGrid[a]-u.slidesGrid[u.activeIndex]<u.size&&c++;return c},u.updateSlidesProgress=function(a){if(void 0===a&&(a=u.translate||0),0!==u.slides.length){void 0===u.slides[0].swiperSlideOffset&&u.updateSlidesOffset();var b=-a;u.rtl&&(b=a),u.slides.removeClass(u.params.slideVisibleClass);for(var c=0;c<u.slides.length;c++){var d=u.slides[c],e=(b+(u.params.centeredSlides?u.minTranslate():0)-d.swiperSlideOffset)/(d.swiperSlideSize+u.params.spaceBetween);if(u.params.watchSlidesVisibility){var f=-(b-d.swiperSlideOffset),g=f+u.slidesSizesGrid[c];(f>=0&&f<u.size||g>0&&g<=u.size||0>=f&&g>=u.size)&&u.slides.eq(c).addClass(u.params.slideVisibleClass)}d.progress=u.rtl?-e:e}}},u.updateProgress=function(a){void 0===a&&(a=u.translate||0);var b=u.maxTranslate()-u.minTranslate(),c=u.isBeginning,d=u.isEnd;0===b?(u.progress=0,u.isBeginning=u.isEnd=!0):(u.progress=(a-u.minTranslate())/b,u.isBeginning=u.progress<=0,u.isEnd=u.progress>=1),u.isBeginning&&!c&&u.emit("onReachBeginning",u),u.isEnd&&!d&&u.emit("onReachEnd",u),u.params.watchSlidesProgress&&u.updateSlidesProgress(a),u.emit("onProgress",u,u.progress)},u.updateActiveIndex=function(){var a,b,c,d=u.rtl?u.translate:-u.translate;for(b=0;b<u.slidesGrid.length;b++)void 0!==u.slidesGrid[b+1]?d>=u.slidesGrid[b]&&d<u.slidesGrid[b+1]-(u.slidesGrid[b+1]-u.slidesGrid[b])/2?a=b:d>=u.slidesGrid[b]&&d<u.slidesGrid[b+1]&&(a=b+1):d>=u.slidesGrid[b]&&(a=b);u.params.normalizeSlideIndex&&(0>a||void 0===a)&&(a=0),c=Math.floor(a/u.params.slidesPerGroup),c>=u.snapGrid.length&&(c=u.snapGrid.length-1),a!==u.activeIndex&&(u.snapIndex=c,u.previousIndex=u.activeIndex,u.activeIndex=a,u.updateClasses(),u.updateRealIndex())},u.updateRealIndex=function(){u.realIndex=parseInt(u.slides.eq(u.activeIndex).attr("data-swiper-slide-index")||u.activeIndex,10)},u.updateClasses=function(){u.slides.removeClass(u.params.slideActiveClass+" "+u.params.slideNextClass+" "+u.params.slidePrevClass+" "+u.params.slideDuplicateActiveClass+" "+u.params.slideDuplicateNextClass+" "+u.params.slideDuplicatePrevClass);var b=u.slides.eq(u.activeIndex);b.addClass(u.params.slideActiveClass),d.loop&&(b.hasClass(u.params.slideDuplicateClass)?u.wrapper.children("."+u.params.slideClass+":not(."+u.params.slideDuplicateClass+')[data-swiper-slide-index="'+u.realIndex+'"]').addClass(u.params.slideDuplicateActiveClass):u.wrapper.children("."+u.params.slideClass+"."+u.params.slideDuplicateClass+'[data-swiper-slide-index="'+u.realIndex+'"]').addClass(u.params.slideDuplicateActiveClass));var c=b.next("."+u.params.slideClass).addClass(u.params.slideNextClass);u.params.loop&&0===c.length&&(c=u.slides.eq(0),c.addClass(u.params.slideNextClass));var e=b.prev("."+u.params.slideClass).addClass(u.params.slidePrevClass);if(u.params.loop&&0===e.length&&(e=u.slides.eq(-1),e.addClass(u.params.slidePrevClass)),d.loop&&(c.hasClass(u.params.slideDuplicateClass)?u.wrapper.children("."+u.params.slideClass+":not(."+u.params.slideDuplicateClass+')[data-swiper-slide-index="'+c.attr("data-swiper-slide-index")+'"]').addClass(u.params.slideDuplicateNextClass):u.wrapper.children("."+u.params.slideClass+"."+u.params.slideDuplicateClass+'[data-swiper-slide-index="'+c.attr("data-swiper-slide-index")+'"]').addClass(u.params.slideDuplicateNextClass),e.hasClass(u.params.slideDuplicateClass)?u.wrapper.children("."+u.params.slideClass+":not(."+u.params.slideDuplicateClass+')[data-swiper-slide-index="'+e.attr("data-swiper-slide-index")+'"]').addClass(u.params.slideDuplicatePrevClass):u.wrapper.children("."+u.params.slideClass+"."+u.params.slideDuplicateClass+'[data-swiper-slide-index="'+e.attr("data-swiper-slide-index")+'"]').addClass(u.params.slideDuplicatePrevClass)),u.paginationContainer&&u.paginationContainer.length>0){var f,g=u.params.loop?Math.ceil((u.slides.length-2*u.loopedSlides)/u.params.slidesPerGroup):u.snapGrid.length;if(u.params.loop?(f=Math.ceil((u.activeIndex-u.loopedSlides)/u.params.slidesPerGroup),f>u.slides.length-1-2*u.loopedSlides&&(f-=u.slides.length-2*u.loopedSlides),f>g-1&&(f-=g),0>f&&"bullets"!==u.params.paginationType&&(f=g+f)):f=void 0!==u.snapIndex?u.snapIndex:u.activeIndex||0,"bullets"===u.params.paginationType&&u.bullets&&u.bullets.length>0&&(u.bullets.removeClass(u.params.bulletActiveClass),u.paginationContainer.length>1?u.bullets.each(function(){a(this).index()===f&&a(this).addClass(u.params.bulletActiveClass)}):u.bullets.eq(f).addClass(u.params.bulletActiveClass)),"fraction"===u.params.paginationType&&(u.paginationContainer.find("."+u.params.paginationCurrentClass).text(f+1),u.paginationContainer.find("."+u.params.paginationTotalClass).text(g)),"progress"===u.params.paginationType){var h=(f+1)/g,i=h,j=1;u.isHorizontal()||(j=h,i=1),u.paginationContainer.find("."+u.params.paginationProgressbarClass).transform("translate3d(0,0,0) scaleX("+i+") scaleY("+j+")").transition(u.params.speed)}"custom"===u.params.paginationType&&u.params.paginationCustomRender&&(u.paginationContainer.html(u.params.paginationCustomRender(u,f+1,g)),u.emit("onPaginationRendered",u,u.paginationContainer[0]))}u.params.loop||(u.params.prevButton&&u.prevButton&&u.prevButton.length>0&&(u.isBeginning?(u.prevButton.addClass(u.params.buttonDisabledClass),u.params.a11y&&u.a11y&&u.a11y.disable(u.prevButton)):(u.prevButton.removeClass(u.params.buttonDisabledClass),u.params.a11y&&u.a11y&&u.a11y.enable(u.prevButton))),u.params.nextButton&&u.nextButton&&u.nextButton.length>0&&(u.isEnd?(u.nextButton.addClass(u.params.buttonDisabledClass),u.params.a11y&&u.a11y&&u.a11y.disable(u.nextButton)):(u.nextButton.removeClass(u.params.buttonDisabledClass),u.params.a11y&&u.a11y&&u.a11y.enable(u.nextButton))))},u.updatePagination=function(){if(u.params.pagination&&u.paginationContainer&&u.paginationContainer.length>0){var a="";if("bullets"===u.params.paginationType){for(var b=u.params.loop?Math.ceil((u.slides.length-2*u.loopedSlides)/u.params.slidesPerGroup):u.snapGrid.length,c=0;b>c;c++)a+=u.params.paginationBulletRender?u.params.paginationBulletRender(u,c,u.params.bulletClass):"<"+u.params.paginationElement+' class="'+u.params.bulletClass+'"></'+u.params.paginationElement+">";u.paginationContainer.html(a),u.bullets=u.paginationContainer.find("."+u.params.bulletClass),u.params.paginationClickable&&u.params.a11y&&u.a11y&&u.a11y.initPagination()}"fraction"===u.params.paginationType&&(a=u.params.paginationFractionRender?u.params.paginationFractionRender(u,u.params.paginationCurrentClass,u.params.paginationTotalClass):'<span class="'+u.params.paginationCurrentClass+'"></span> / <span class="'+u.params.paginationTotalClass+'"></span>',u.paginationContainer.html(a)),"progress"===u.params.paginationType&&(a=u.params.paginationProgressRender?u.params.paginationProgressRender(u,u.params.paginationProgressbarClass):'<span class="'+u.params.paginationProgressbarClass+'"></span>',u.paginationContainer.html(a)),"custom"!==u.params.paginationType&&u.emit("onPaginationRendered",u,u.paginationContainer[0])}},u.update=function(a){function b(){u.rtl,u.translate,c=Math.min(Math.max(u.translate,u.maxTranslate()),u.minTranslate()),u.setWrapperTranslate(c),u.updateActiveIndex(),u.updateClasses()}if(u){u.updateContainerSize(),u.updateSlidesSize(),u.updateProgress(),u.updatePagination(),u.updateClasses(),u.params.scrollbar&&u.scrollbar&&u.scrollbar.set();var c;a?(u.controller&&u.controller.spline&&(u.controller.spline=void 0),u.params.freeMode?(b(),u.params.autoHeight&&u.updateAutoHeight()):(("auto"===u.params.slidesPerView||u.params.slidesPerView>1)&&u.isEnd&&!u.params.centeredSlides?u.slideTo(u.slides.length-1,0,!1,!0):u.slideTo(u.activeIndex,0,!1,!0))||b()):u.params.autoHeight&&u.updateAutoHeight()}},u.onResize=function(a){u.params.onBeforeResize&&u.params.onBeforeResize(u),u.params.breakpoints&&u.setBreakpoint();var b=u.params.allowSwipeToPrev,c=u.params.allowSwipeToNext;u.params.allowSwipeToPrev=u.params.allowSwipeToNext=!0,u.updateContainerSize(),u.updateSlidesSize(),("auto"===u.params.slidesPerView||u.params.freeMode||a)&&u.updatePagination(),u.params.scrollbar&&u.scrollbar&&u.scrollbar.set(),u.controller&&u.controller.spline&&(u.controller.spline=void 0);var d=!1;if(u.params.freeMode){var e=Math.min(Math.max(u.translate,u.maxTranslate()),u.minTranslate());u.setWrapperTranslate(e),u.updateActiveIndex(),u.updateClasses(),u.params.autoHeight&&u.updateAutoHeight()}else u.updateClasses(),d=("auto"===u.params.slidesPerView||u.params.slidesPerView>1)&&u.isEnd&&!u.params.centeredSlides?u.slideTo(u.slides.length-1,0,!1,!0):u.slideTo(u.activeIndex,0,!1,!0);u.params.lazyLoading&&!d&&u.lazy&&u.lazy.load(),u.params.allowSwipeToPrev=b,u.params.allowSwipeToNext=c,u.params.onAfterResize&&u.params.onAfterResize(u)},u.touchEventsDesktop={start:"mousedown",move:"mousemove",end:"mouseup"},window.navigator.pointerEnabled?u.touchEventsDesktop={start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled&&(u.touchEventsDesktop={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}),u.touchEvents={start:u.support.touch||!u.params.simulateTouch?"touchstart":u.touchEventsDesktop.start,move:u.support.touch||!u.params.simulateTouch?"touchmove":u.touchEventsDesktop.move,end:u.support.touch||!u.params.simulateTouch?"touchend":u.touchEventsDesktop.end},(window.navigator.pointerEnabled||window.navigator.msPointerEnabled)&&("container"===u.params.touchEventsTarget?u.container:u.wrapper).addClass("swiper-wp8-"+u.params.direction),u.initEvents=function(a){var b=a?"off":"on",c=a?"removeEventListener":"addEventListener",e="container"===u.params.touchEventsTarget?u.container[0]:u.wrapper[0],f=u.support.touch?e:document,g=!!u.params.nested;if(u.browser.ie)e[c](u.touchEvents.start,u.onTouchStart,!1),f[c](u.touchEvents.move,u.onTouchMove,g),f[c](u.touchEvents.end,u.onTouchEnd,!1);else{if(u.support.touch){var h=!("touchstart"!==u.touchEvents.start||!u.support.passiveListener||!u.params.passiveListeners)&&{passive:!0,capture:!1};e[c](u.touchEvents.start,u.onTouchStart,h),e[c](u.touchEvents.move,u.onTouchMove,g),e[c](u.touchEvents.end,u.onTouchEnd,h)}(d.simulateTouch&&!u.device.ios&&!u.device.android||d.simulateTouch&&!u.support.touch&&u.device.ios)&&(e[c]("mousedown",u.onTouchStart,!1),document[c]("mousemove",u.onTouchMove,g),document[c]("mouseup",u.onTouchEnd,!1))}window[c]("resize",u.onResize),u.params.nextButton&&u.nextButton&&u.nextButton.length>0&&(u.nextButton[b]("click",u.onClickNext),u.params.a11y&&u.a11y&&u.nextButton[b]("keydown",u.a11y.onEnterKey)),u.params.prevButton&&u.prevButton&&u.prevButton.length>0&&(u.prevButton[b]("click",u.onClickPrev),u.params.a11y&&u.a11y&&u.prevButton[b]("keydown",u.a11y.onEnterKey)),u.params.pagination&&u.params.paginationClickable&&(u.paginationContainer[b]("click","."+u.params.bulletClass,u.onClickIndex),u.params.a11y&&u.a11y&&u.paginationContainer[b]("keydown","."+u.params.bulletClass,u.a11y.onEnterKey)),(u.params.preventClicks||u.params.preventClicksPropagation)&&e[c]("click",u.preventClicks,!0)},u.attachEvents=function(){u.initEvents()},u.detachEvents=function(){u.initEvents(!0)},u.allowClick=!0,u.preventClicks=function(a){u.allowClick||(u.params.preventClicks&&a.preventDefault(),u.params.preventClicksPropagation&&u.animating&&(a.stopPropagation(),a.stopImmediatePropagation()))},u.onClickNext=function(a){a.preventDefault(),u.isEnd&&!u.params.loop||u.slideNext()},u.onClickPrev=function(a){a.preventDefault(),u.isBeginning&&!u.params.loop||u.slidePrev()},u.onClickIndex=function(b){b.preventDefault();var c=a(this).index()*u.params.slidesPerGroup;u.params.loop&&(c+=u.loopedSlides),u.slideTo(c)},u.updateClickedSlide=function(b){var c=g(b,"."+u.params.slideClass),d=!1;if(c)for(var e=0;e<u.slides.length;e++)u.slides[e]===c&&(d=!0);if(!c||!d)return u.clickedSlide=void 0,void(u.clickedIndex=void 0);if(u.clickedSlide=c,u.clickedIndex=a(c).index(),u.params.slideToClickedSlide&&void 0!==u.clickedIndex&&u.clickedIndex!==u.activeIndex){var f,h=u.clickedIndex,i="auto"===u.params.slidesPerView?u.currentSlidesPerView():u.params.slidesPerView;if(u.params.loop){if(u.animating)return;f=parseInt(a(u.clickedSlide).attr("data-swiper-slide-index"),10),u.params.centeredSlides?h<u.loopedSlides-i/2||h>u.slides.length-u.loopedSlides+i/2?(u.fixLoop(),h=u.wrapper.children("."+u.params.slideClass+'[data-swiper-slide-index="'+f+'"]:not(.'+u.params.slideDuplicateClass+")").eq(0).index(),setTimeout(function(){u.slideTo(h)},0)):u.slideTo(h):h>u.slides.length-i?(u.fixLoop(),h=u.wrapper.children("."+u.params.slideClass+'[data-swiper-slide-index="'+f+'"]:not(.'+u.params.slideDuplicateClass+")").eq(0).index(),setTimeout(function(){u.slideTo(h)},0)):u.slideTo(h)}else u.slideTo(h)}};var w,x,y,z,A,B,C,D,E,F,G="input, select, textarea, button, video",H=Date.now(),I=[];u.animating=!1,u.touches={startX:0,startY:0,currentX:0,currentY:0,diff:0};var J,K;u.onTouchStart=function(b){if(b.originalEvent&&(b=b.originalEvent),(J="touchstart"===b.type)||!("which"in b)||3!==b.which){if(u.params.noSwiping&&g(b,"."+u.params.noSwipingClass))return void(u.allowClick=!0);if(!u.params.swipeHandler||g(b,u.params.swipeHandler)){var c=u.touches.currentX="touchstart"===b.type?b.targetTouches[0].pageX:b.pageX,d=u.touches.currentY="touchstart"===b.type?b.targetTouches[0].pageY:b.pageY;if(!(u.device.ios&&u.params.iOSEdgeSwipeDetection&&c<=u.params.iOSEdgeSwipeThreshold)){if(w=!0,x=!1,y=!0,A=void 0,K=void 0,u.touches.startX=c,u.touches.startY=d,z=Date.now(),u.allowClick=!0,u.updateContainerSize(),u.swipeDirection=void 0,u.params.threshold>0&&(D=!1),"touchstart"!==b.type){var e=!0;a(b.target).is(G)&&(e=!1),document.activeElement&&a(document.activeElement).is(G)&&document.activeElement.blur(),e&&b.preventDefault()}u.emit("onTouchStart",u,b)}}}},u.onTouchMove=function(b){
if(b.originalEvent&&(b=b.originalEvent),!J||"mousemove"!==b.type){if(b.preventedByNestedSwiper)return u.touches.startX="touchmove"===b.type?b.targetTouches[0].pageX:b.pageX,void(u.touches.startY="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY);if(u.params.onlyExternal)return u.allowClick=!1,void(w&&(u.touches.startX=u.touches.currentX="touchmove"===b.type?b.targetTouches[0].pageX:b.pageX,u.touches.startY=u.touches.currentY="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY,z=Date.now()));if(J&&u.params.touchReleaseOnEdges&&!u.params.loop)if(u.isHorizontal()){if(u.touches.currentX<u.touches.startX&&u.translate<=u.maxTranslate()||u.touches.currentX>u.touches.startX&&u.translate>=u.minTranslate())return}else if(u.touches.currentY<u.touches.startY&&u.translate<=u.maxTranslate()||u.touches.currentY>u.touches.startY&&u.translate>=u.minTranslate())return;if(J&&document.activeElement&&b.target===document.activeElement&&a(b.target).is(G))return x=!0,void(u.allowClick=!1);if(y&&u.emit("onTouchMove",u,b),!(b.targetTouches&&b.targetTouches.length>1)){if(u.touches.currentX="touchmove"===b.type?b.targetTouches[0].pageX:b.pageX,u.touches.currentY="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY,void 0===A){var c;u.isHorizontal()&&u.touches.currentY===u.touches.startY||!u.isHorizontal()&&u.touches.currentX===u.touches.startX?A=!1:(c=180*Math.atan2(Math.abs(u.touches.currentY-u.touches.startY),Math.abs(u.touches.currentX-u.touches.startX))/Math.PI,A=u.isHorizontal()?c>u.params.touchAngle:90-c>u.params.touchAngle)}if(A&&u.emit("onTouchMoveOpposite",u,b),void 0===K&&(u.touches.currentX===u.touches.startX&&u.touches.currentY===u.touches.startY||(K=!0)),w){if(A)return void(w=!1);if(K){u.allowClick=!1,u.emit("onSliderMove",u,b),b.preventDefault(),u.params.touchMoveStopPropagation&&!u.params.nested&&b.stopPropagation(),x||(d.loop&&u.fixLoop(),C=u.getWrapperTranslate(),u.setWrapperTransition(0),u.animating&&u.wrapper.trigger("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd msTransitionEnd"),u.params.autoplay&&u.autoplaying&&(u.params.autoplayDisableOnInteraction?u.stopAutoplay():u.pauseAutoplay()),F=!1,!u.params.grabCursor||u.params.allowSwipeToNext!==!0&&u.params.allowSwipeToPrev!==!0||u.setGrabCursor(!0)),x=!0;var e=u.touches.diff=u.isHorizontal()?u.touches.currentX-u.touches.startX:u.touches.currentY-u.touches.startY;e*=u.params.touchRatio,u.rtl&&(e=-e),u.swipeDirection=e>0?"prev":"next",B=e+C;var f=!0;if(e>0&&B>u.minTranslate()?(f=!1,u.params.resistance&&(B=u.minTranslate()-1+Math.pow(-u.minTranslate()+C+e,u.params.resistanceRatio))):0>e&&B<u.maxTranslate()&&(f=!1,u.params.resistance&&(B=u.maxTranslate()+1-Math.pow(u.maxTranslate()-C-e,u.params.resistanceRatio))),f&&(b.preventedByNestedSwiper=!0),!u.params.allowSwipeToNext&&"next"===u.swipeDirection&&C>B&&(B=C),!u.params.allowSwipeToPrev&&"prev"===u.swipeDirection&&B>C&&(B=C),u.params.threshold>0){if(!(Math.abs(e)>u.params.threshold||D))return void(B=C);if(!D)return D=!0,u.touches.startX=u.touches.currentX,u.touches.startY=u.touches.currentY,B=C,void(u.touches.diff=u.isHorizontal()?u.touches.currentX-u.touches.startX:u.touches.currentY-u.touches.startY)}u.params.followFinger&&((u.params.freeMode||u.params.watchSlidesProgress)&&u.updateActiveIndex(),u.params.freeMode&&(0===I.length&&I.push({position:u.touches[u.isHorizontal()?"startX":"startY"],time:z}),I.push({position:u.touches[u.isHorizontal()?"currentX":"currentY"],time:(new window.Date).getTime()})),u.updateProgress(B),u.setWrapperTranslate(B))}}}}},u.onTouchEnd=function(b){if(b.originalEvent&&(b=b.originalEvent),y&&u.emit("onTouchEnd",u,b),y=!1,w){u.params.grabCursor&&x&&w&&(u.params.allowSwipeToNext===!0||u.params.allowSwipeToPrev===!0)&&u.setGrabCursor(!1);var c=Date.now(),d=c-z;if(u.allowClick&&(u.updateClickedSlide(b),u.emit("onTap",u,b),300>d&&c-H>300&&(E&&clearTimeout(E),E=setTimeout(function(){u&&(u.params.paginationHide&&u.paginationContainer.length>0&&!a(b.target).hasClass(u.params.bulletClass)&&u.paginationContainer.toggleClass(u.params.paginationHiddenClass),u.emit("onClick",u,b))},300)),300>d&&300>c-H&&(E&&clearTimeout(E),u.emit("onDoubleTap",u,b))),H=Date.now(),setTimeout(function(){u&&(u.allowClick=!0)},0),!w||!x||!u.swipeDirection||0===u.touches.diff||B===C)return void(w=x=!1);w=x=!1;var e;if(e=u.params.followFinger?u.rtl?u.translate:-u.translate:-B,u.params.freeMode){if(e<-u.minTranslate())return void u.slideTo(u.activeIndex);if(e>-u.maxTranslate())return void(u.slides.length<u.snapGrid.length?u.slideTo(u.snapGrid.length-1):u.slideTo(u.slides.length-1));if(u.params.freeModeMomentum){if(I.length>1){var f=I.pop(),g=I.pop(),h=f.position-g.position,i=f.time-g.time;u.velocity=h/i,u.velocity=u.velocity/2,Math.abs(u.velocity)<u.params.freeModeMinimumVelocity&&(u.velocity=0),(i>150||(new window.Date).getTime()-f.time>300)&&(u.velocity=0)}else u.velocity=0;u.velocity=u.velocity*u.params.freeModeMomentumVelocityRatio,I.length=0;var j=1e3*u.params.freeModeMomentumRatio,k=u.velocity*j,l=u.translate+k;u.rtl&&(l=-l);var m,n=!1,o=20*Math.abs(u.velocity)*u.params.freeModeMomentumBounceRatio;if(l<u.maxTranslate())u.params.freeModeMomentumBounce?(l+u.maxTranslate()<-o&&(l=u.maxTranslate()-o),m=u.maxTranslate(),n=!0,F=!0):l=u.maxTranslate();else if(l>u.minTranslate())u.params.freeModeMomentumBounce?(l-u.minTranslate()>o&&(l=u.minTranslate()+o),m=u.minTranslate(),n=!0,F=!0):l=u.minTranslate();else if(u.params.freeModeSticky){var p,q=0;for(q=0;q<u.snapGrid.length;q+=1)if(u.snapGrid[q]>-l){p=q;break}l=Math.abs(u.snapGrid[p]-l)<Math.abs(u.snapGrid[p-1]-l)||"next"===u.swipeDirection?u.snapGrid[p]:u.snapGrid[p-1],u.rtl||(l=-l)}if(0!==u.velocity)j=u.rtl?Math.abs((-l-u.translate)/u.velocity):Math.abs((l-u.translate)/u.velocity);else if(u.params.freeModeSticky)return void u.slideReset();u.params.freeModeMomentumBounce&&n?(u.updateProgress(m),u.setWrapperTransition(j),u.setWrapperTranslate(l),u.onTransitionStart(),u.animating=!0,u.wrapper.transitionEnd(function(){u&&F&&(u.emit("onMomentumBounce",u),u.setWrapperTransition(u.params.speed),u.setWrapperTranslate(m),u.wrapper.transitionEnd(function(){u&&u.onTransitionEnd()}))})):u.velocity?(u.updateProgress(l),u.setWrapperTransition(j),u.setWrapperTranslate(l),u.onTransitionStart(),u.animating||(u.animating=!0,u.wrapper.transitionEnd(function(){u&&u.onTransitionEnd()}))):u.updateProgress(l),u.updateActiveIndex()}return void((!u.params.freeModeMomentum||d>=u.params.longSwipesMs)&&(u.updateProgress(),u.updateActiveIndex()))}var r,s=0,t=u.slidesSizesGrid[0];for(r=0;r<u.slidesGrid.length;r+=u.params.slidesPerGroup)void 0!==u.slidesGrid[r+u.params.slidesPerGroup]?e>=u.slidesGrid[r]&&e<u.slidesGrid[r+u.params.slidesPerGroup]&&(s=r,t=u.slidesGrid[r+u.params.slidesPerGroup]-u.slidesGrid[r]):e>=u.slidesGrid[r]&&(s=r,t=u.slidesGrid[u.slidesGrid.length-1]-u.slidesGrid[u.slidesGrid.length-2]);var v=(e-u.slidesGrid[s])/t;if(d>u.params.longSwipesMs){if(!u.params.longSwipes)return void u.slideTo(u.activeIndex);"next"===u.swipeDirection&&(v>=u.params.longSwipesRatio?u.slideTo(s+u.params.slidesPerGroup):u.slideTo(s)),"prev"===u.swipeDirection&&(v>1-u.params.longSwipesRatio?u.slideTo(s+u.params.slidesPerGroup):u.slideTo(s))}else{if(!u.params.shortSwipes)return void u.slideTo(u.activeIndex);"next"===u.swipeDirection&&u.slideTo(s+u.params.slidesPerGroup),"prev"===u.swipeDirection&&u.slideTo(s)}}},u._slideTo=function(a,b){return u.slideTo(a,b,!0,!0)},u.slideTo=function(a,b,c,d){void 0===c&&(c=!0),void 0===a&&(a=0),0>a&&(a=0),u.snapIndex=Math.floor(a/u.params.slidesPerGroup),u.snapIndex>=u.snapGrid.length&&(u.snapIndex=u.snapGrid.length-1);var e=-u.snapGrid[u.snapIndex];if(u.params.autoplay&&u.autoplaying&&(d||!u.params.autoplayDisableOnInteraction?u.pauseAutoplay(b):u.stopAutoplay()),u.updateProgress(e),u.params.normalizeSlideIndex)for(var f=0;f<u.slidesGrid.length;f++)-Math.floor(100*e)>=Math.floor(100*u.slidesGrid[f])&&(a=f);return!(!u.params.allowSwipeToNext&&e<u.translate&&e<u.minTranslate()||!u.params.allowSwipeToPrev&&e>u.translate&&e>u.maxTranslate()&&(u.activeIndex||0)!==a||(void 0===b&&(b=u.params.speed),u.previousIndex=u.activeIndex||0,u.activeIndex=a,u.updateRealIndex(),u.rtl&&-e===u.translate||!u.rtl&&e===u.translate?(u.params.autoHeight&&u.updateAutoHeight(),u.updateClasses(),"slide"!==u.params.effect&&u.setWrapperTranslate(e),1):(u.updateClasses(),u.onTransitionStart(c),0===b||u.browser.lteIE9?(u.setWrapperTranslate(e),u.setWrapperTransition(0),u.onTransitionEnd(c)):(u.setWrapperTranslate(e),u.setWrapperTransition(b),u.animating||(u.animating=!0,u.wrapper.transitionEnd(function(){u&&u.onTransitionEnd(c)}))),0)))},u.onTransitionStart=function(a){void 0===a&&(a=!0),u.params.autoHeight&&u.updateAutoHeight(),u.lazy&&u.lazy.onTransitionStart(),a&&(u.emit("onTransitionStart",u),u.activeIndex!==u.previousIndex&&(u.emit("onSlideChangeStart",u),u.activeIndex>u.previousIndex?u.emit("onSlideNextStart",u):u.emit("onSlidePrevStart",u)))},u.onTransitionEnd=function(a){u.animating=!1,u.setWrapperTransition(0),void 0===a&&(a=!0),u.lazy&&u.lazy.onTransitionEnd(),a&&(u.emit("onTransitionEnd",u),u.activeIndex!==u.previousIndex&&(u.emit("onSlideChangeEnd",u),u.activeIndex>u.previousIndex?u.emit("onSlideNextEnd",u):u.emit("onSlidePrevEnd",u))),u.params.history&&u.history&&u.history.setHistory(u.params.history,u.activeIndex),u.params.hashnav&&u.hashnav&&u.hashnav.setHash()},u.slideNext=function(a,b,c){return u.params.loop?u.animating?!1:(u.fixLoop(),u.container[0].clientLeft,u.slideTo(u.activeIndex+u.params.slidesPerGroup,b,a,c)):u.slideTo(u.activeIndex+u.params.slidesPerGroup,b,a,c)},u._slideNext=function(a){return u.slideNext(!0,a,!0)},u.slidePrev=function(a,b,c){return u.params.loop?u.animating?!1:(u.fixLoop(),u.container[0].clientLeft,u.slideTo(u.activeIndex-1,b,a,c)):u.slideTo(u.activeIndex-1,b,a,c)},u._slidePrev=function(a){return u.slidePrev(!0,a,!0)},u.slideReset=function(a,b,c){return u.slideTo(u.activeIndex,b,a)},u.disableTouchControl=function(){return u.params.onlyExternal=!0,!0},u.enableTouchControl=function(){return u.params.onlyExternal=!1,!0},u.setWrapperTransition=function(a,b){u.wrapper.transition(a),"slide"!==u.params.effect&&u.effects[u.params.effect]&&u.effects[u.params.effect].setTransition(a),u.params.parallax&&u.parallax&&u.parallax.setTransition(a),u.params.scrollbar&&u.scrollbar&&u.scrollbar.setTransition(a),u.params.control&&u.controller&&u.controller.setTransition(a,b),u.emit("onSetTransition",u,a)},u.setWrapperTranslate=function(a,b,c){var d=0,f=0;u.isHorizontal()?d=u.rtl?-a:a:f=a,u.params.roundLengths&&(d=e(d),f=e(f)),u.params.virtualTranslate||(u.support.transforms3d?u.wrapper.transform("translate3d("+d+"px, "+f+"px, 0px)"):u.wrapper.transform("translate("+d+"px, "+f+"px)")),u.translate=u.isHorizontal()?d:f;var g,h=u.maxTranslate()-u.minTranslate();g=0===h?0:(a-u.minTranslate())/h,g!==u.progress&&u.updateProgress(a),b&&u.updateActiveIndex(),"slide"!==u.params.effect&&u.effects[u.params.effect]&&u.effects[u.params.effect].setTranslate(u.translate),u.params.parallax&&u.parallax&&u.parallax.setTranslate(u.translate),u.params.scrollbar&&u.scrollbar&&u.scrollbar.setTranslate(u.translate),u.params.control&&u.controller&&u.controller.setTranslate(u.translate,c),u.emit("onSetTranslate",u,u.translate)},u.getTranslate=function(a,b){var c,d,e,f;return void 0===b&&(b="x"),u.params.virtualTranslate?u.rtl?-u.translate:u.translate:(e=window.getComputedStyle(a,null),window.WebKitCSSMatrix?(d=e.transform||e.webkitTransform,d.split(",").length>6&&(d=d.split(", ").map(function(a){return a.replace(",",".")}).join(", ")),f=new window.WebKitCSSMatrix("none"===d?"":d)):(f=e.MozTransform||e.OTransform||e.MsTransform||e.msTransform||e.transform||e.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),c=f.toString().split(",")),"x"===b&&(d=window.WebKitCSSMatrix?f.m41:16===c.length?parseFloat(c[12]):parseFloat(c[4])),"y"===b&&(d=window.WebKitCSSMatrix?f.m42:16===c.length?parseFloat(c[13]):parseFloat(c[5])),u.rtl&&d&&(d=-d),d||0)},u.getWrapperTranslate=function(a){return void 0===a&&(a=u.isHorizontal()?"x":"y"),u.getTranslate(u.wrapper[0],a)},u.observers=[],u.initObservers=function(){if(u.params.observeParents)for(var a=u.container.parents(),b=0;b<a.length;b++)h(a[b]);h(u.container[0],{childList:!1}),h(u.wrapper[0],{attributes:!1})},u.disconnectObservers=function(){for(var a=0;a<u.observers.length;a++)u.observers[a].disconnect();u.observers=[]},u.createLoop=function(){u.wrapper.children("."+u.params.slideClass+"."+u.params.slideDuplicateClass).remove();var b=u.wrapper.children("."+u.params.slideClass);"auto"!==u.params.slidesPerView||u.params.loopedSlides||(u.params.loopedSlides=b.length),u.loopedSlides=parseInt(u.params.loopedSlides||u.params.slidesPerView,10),u.loopedSlides=u.loopedSlides+u.params.loopAdditionalSlides,u.loopedSlides>b.length&&(u.loopedSlides=b.length);var c,d=[],e=[];for(b.each(function(c,f){var g=a(this);c<u.loopedSlides&&e.push(f),c<b.length&&c>=b.length-u.loopedSlides&&d.push(f),g.attr("data-swiper-slide-index",c)}),c=0;c<e.length;c++)u.wrapper.append(a(e[c].cloneNode(!0)).addClass(u.params.slideDuplicateClass));for(c=d.length-1;c>=0;c--)u.wrapper.prepend(a(d[c].cloneNode(!0)).addClass(u.params.slideDuplicateClass))},u.destroyLoop=function(){u.wrapper.children("."+u.params.slideClass+"."+u.params.slideDuplicateClass).remove(),u.slides.removeAttr("data-swiper-slide-index")},u.reLoop=function(a){var b=u.activeIndex-u.loopedSlides;u.destroyLoop(),u.createLoop(),u.updateSlidesSize(),a&&u.slideTo(b+u.loopedSlides,0,!1)},u.fixLoop=function(){var a;u.activeIndex<u.loopedSlides?(a=u.slides.length-3*u.loopedSlides+u.activeIndex,a+=u.loopedSlides,u.slideTo(a,0,!1,!0)):("auto"===u.params.slidesPerView&&u.activeIndex>=2*u.loopedSlides||u.activeIndex>u.slides.length-2*u.params.slidesPerView)&&(a=-u.slides.length+u.activeIndex+u.loopedSlides,a+=u.loopedSlides,u.slideTo(a,0,!1,!0))},u.appendSlide=function(a){if(u.params.loop&&u.destroyLoop(),"object"==typeof a&&a.length)for(var b=0;b<a.length;b++)a[b]&&u.wrapper.append(a[b]);else u.wrapper.append(a);u.params.loop&&u.createLoop(),u.params.observer&&u.support.observer||u.update(!0)},u.prependSlide=function(a){u.params.loop&&u.destroyLoop();var b=u.activeIndex+1;if("object"==typeof a&&a.length){for(var c=0;c<a.length;c++)a[c]&&u.wrapper.prepend(a[c]);b=u.activeIndex+a.length}else u.wrapper.prepend(a);u.params.loop&&u.createLoop(),u.params.observer&&u.support.observer||u.update(!0),u.slideTo(b,0,!1)},u.removeSlide=function(a){u.params.loop&&(u.destroyLoop(),u.slides=u.wrapper.children("."+u.params.slideClass));var b,c=u.activeIndex;if("object"==typeof a&&a.length){for(var d=0;d<a.length;d++)b=a[d],u.slides[b]&&u.slides.eq(b).remove(),c>b&&c--;c=Math.max(c,0)}else b=a,u.slides[b]&&u.slides.eq(b).remove(),c>b&&c--,c=Math.max(c,0);u.params.loop&&u.createLoop(),u.params.observer&&u.support.observer||u.update(!0),u.params.loop?u.slideTo(c+u.loopedSlides,0,!1):u.slideTo(c,0,!1)},u.removeAllSlides=function(){for(var a=[],b=0;b<u.slides.length;b++)a.push(b);u.removeSlide(a)},u.effects={fade:{setTranslate:function(){for(var a=0;a<u.slides.length;a++){var b=u.slides.eq(a),c=b[0].swiperSlideOffset,d=-c;u.params.virtualTranslate||(d-=u.translate);var e=0;u.isHorizontal()||(e=d,d=0);var f=u.params.fade.crossFade?Math.max(1-Math.abs(b[0].progress),0):1+Math.min(Math.max(b[0].progress,-1),0);b.css({opacity:f}).transform("translate3d("+d+"px, "+e+"px, 0px)")}},setTransition:function(a){if(u.slides.transition(a),u.params.virtualTranslate&&0!==a){var b=!1;u.slides.transitionEnd(function(){if(!b&&u){b=!0,u.animating=!1;for(var a=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],c=0;c<a.length;c++)u.wrapper.trigger(a[c])}})}}},flip:{setTranslate:function(){for(var b=0;b<u.slides.length;b++){var c=u.slides.eq(b),d=c[0].progress;u.params.flip.limitRotation&&(d=Math.max(Math.min(c[0].progress,1),-1));var e=c[0].swiperSlideOffset,f=-180*d,g=f,h=0,i=-e,j=0;if(u.isHorizontal()?u.rtl&&(g=-g):(j=i,i=0,h=-g,g=0),c[0].style.zIndex=-Math.abs(Math.round(d))+u.slides.length,u.params.flip.slideShadows){var k=u.isHorizontal()?c.find(".swiper-slide-shadow-left"):c.find(".swiper-slide-shadow-top"),l=u.isHorizontal()?c.find(".swiper-slide-shadow-right"):c.find(".swiper-slide-shadow-bottom");0===k.length&&(k=a('<div class="swiper-slide-shadow-'+(u.isHorizontal()?"left":"top")+'"></div>'),c.append(k)),0===l.length&&(l=a('<div class="swiper-slide-shadow-'+(u.isHorizontal()?"right":"bottom")+'"></div>'),c.append(l)),k.length&&(k[0].style.opacity=Math.max(-d,0)),l.length&&(l[0].style.opacity=Math.max(d,0))}c.transform("translate3d("+i+"px, "+j+"px, 0px) rotateX("+h+"deg) rotateY("+g+"deg)")}},setTransition:function(b){if(u.slides.transition(b).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(b),u.params.virtualTranslate&&0!==b){var c=!1;u.slides.eq(u.activeIndex).transitionEnd(function(){if(!c&&u&&a(this).hasClass(u.params.slideActiveClass)){c=!0,u.animating=!1;for(var b=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],d=0;d<b.length;d++)u.wrapper.trigger(b[d])}})}}},cube:{setTranslate:function(){var b,c=0;u.params.cube.shadow&&(u.isHorizontal()?(b=u.wrapper.find(".swiper-cube-shadow"),0===b.length&&(b=a('<div class="swiper-cube-shadow"></div>'),u.wrapper.append(b)),b.css({height:u.width+"px"})):(b=u.container.find(".swiper-cube-shadow"),0===b.length&&(b=a('<div class="swiper-cube-shadow"></div>'),u.container.append(b))));for(var d=0;d<u.slides.length;d++){var e=u.slides.eq(d),f=90*d,g=Math.floor(f/360);u.rtl&&(f=-f,g=Math.floor(-f/360));var h=Math.max(Math.min(e[0].progress,1),-1),i=0,j=0,k=0;d%4==0?(i=4*-g*u.size,k=0):(d-1)%4==0?(i=0,k=4*-g*u.size):(d-2)%4==0?(i=u.size+4*g*u.size,k=u.size):(d-3)%4==0&&(i=-u.size,k=3*u.size+4*u.size*g),u.rtl&&(i=-i),u.isHorizontal()||(j=i,i=0);var l="rotateX("+(u.isHorizontal()?0:-f)+"deg) rotateY("+(u.isHorizontal()?f:0)+"deg) translate3d("+i+"px, "+j+"px, "+k+"px)";if(1>=h&&h>-1&&(c=90*d+90*h,u.rtl&&(c=90*-d-90*h)),e.transform(l),u.params.cube.slideShadows){var m=u.isHorizontal()?e.find(".swiper-slide-shadow-left"):e.find(".swiper-slide-shadow-top"),n=u.isHorizontal()?e.find(".swiper-slide-shadow-right"):e.find(".swiper-slide-shadow-bottom");0===m.length&&(m=a('<div class="swiper-slide-shadow-'+(u.isHorizontal()?"left":"top")+'"></div>'),e.append(m)),0===n.length&&(n=a('<div class="swiper-slide-shadow-'+(u.isHorizontal()?"right":"bottom")+'"></div>'),e.append(n)),m.length&&(m[0].style.opacity=Math.max(-h,0)),n.length&&(n[0].style.opacity=Math.max(h,0))}}if(u.wrapper.css({"-webkit-transform-origin":"50% 50% -"+u.size/2+"px","-moz-transform-origin":"50% 50% -"+u.size/2+"px","-ms-transform-origin":"50% 50% -"+u.size/2+"px","transform-origin":"50% 50% -"+u.size/2+"px"}),u.params.cube.shadow)if(u.isHorizontal())b.transform("translate3d(0px, "+(u.width/2+u.params.cube.shadowOffset)+"px, "+-u.width/2+"px) rotateX(90deg) rotateZ(0deg) scale("+u.params.cube.shadowScale+")");else{var o=Math.abs(c)-90*Math.floor(Math.abs(c)/90),p=1.5-(Math.sin(2*o*Math.PI/360)/2+Math.cos(2*o*Math.PI/360)/2),q=u.params.cube.shadowScale,r=u.params.cube.shadowScale/p,s=u.params.cube.shadowOffset;b.transform("scale3d("+q+", 1, "+r+") translate3d(0px, "+(u.height/2+s)+"px, "+-u.height/2/r+"px) rotateX(-90deg)")}var t=u.isSafari||u.isUiWebView?-u.size/2:0;u.wrapper.transform("translate3d(0px,0,"+t+"px) rotateX("+(u.isHorizontal()?0:c)+"deg) rotateY("+(u.isHorizontal()?-c:0)+"deg)")},setTransition:function(a){u.slides.transition(a).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(a),u.params.cube.shadow&&!u.isHorizontal()&&u.container.find(".swiper-cube-shadow").transition(a)}},coverflow:{setTranslate:function(){for(var b=u.translate,c=u.isHorizontal()?-b+u.width/2:-b+u.height/2,d=u.isHorizontal()?u.params.coverflow.rotate:-u.params.coverflow.rotate,e=u.params.coverflow.depth,f=0,g=u.slides.length;g>f;f++){var h=u.slides.eq(f),i=u.slidesSizesGrid[f],j=h[0].swiperSlideOffset,k=(c-j-i/2)/i*u.params.coverflow.modifier,l=u.isHorizontal()?d*k:0,m=u.isHorizontal()?0:d*k,n=-e*Math.abs(k),o=u.isHorizontal()?0:u.params.coverflow.stretch*k,p=u.isHorizontal()?u.params.coverflow.stretch*k:0;Math.abs(p)<.001&&(p=0),Math.abs(o)<.001&&(o=0),Math.abs(n)<.001&&(n=0),Math.abs(l)<.001&&(l=0),Math.abs(m)<.001&&(m=0);var q="translate3d("+p+"px,"+o+"px,"+n+"px)  rotateX("+m+"deg) rotateY("+l+"deg)";if(h.transform(q),h[0].style.zIndex=1-Math.abs(Math.round(k)),u.params.coverflow.slideShadows){var r=u.isHorizontal()?h.find(".swiper-slide-shadow-left"):h.find(".swiper-slide-shadow-top"),s=u.isHorizontal()?h.find(".swiper-slide-shadow-right"):h.find(".swiper-slide-shadow-bottom");0===r.length&&(r=a('<div class="swiper-slide-shadow-'+(u.isHorizontal()?"left":"top")+'"></div>'),h.append(r)),0===s.length&&(s=a('<div class="swiper-slide-shadow-'+(u.isHorizontal()?"right":"bottom")+'"></div>'),h.append(s)),r.length&&(r[0].style.opacity=k>0?k:0),s.length&&(s[0].style.opacity=-k>0?-k:0)}}u.browser.ie&&(u.wrapper[0].style.perspectiveOrigin=c+"px 50%")},setTransition:function(a){u.slides.transition(a).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(a)}}},u.lazy={initialImageLoaded:!1,loadImageInSlide:function(b,c){if(void 0!==b&&(void 0===c&&(c=!0),0!==u.slides.length)){var d=u.slides.eq(b),e=d.find("."+u.params.lazyLoadingClass+":not(."+u.params.lazyStatusLoadedClass+"):not(."+u.params.lazyStatusLoadingClass+")");!d.hasClass(u.params.lazyLoadingClass)||d.hasClass(u.params.lazyStatusLoadedClass)||d.hasClass(u.params.lazyStatusLoadingClass)||(e=e.add(d[0])),0!==e.length&&e.each(function(){var b=a(this);b.addClass(u.params.lazyStatusLoadingClass);var e=b.attr("data-background"),f=b.attr("data-src"),g=b.attr("data-srcset"),h=b.attr("data-sizes");u.loadImage(b[0],f||e,g,h,!1,function(){if(void 0!==u&&null!==u&&u){if(e?(b.css("background-image",'url("'+e+'")'),b.removeAttr("data-background")):(g&&(b.attr("srcset",g),b.removeAttr("data-srcset")),h&&(b.attr("sizes",h),b.removeAttr("data-sizes")),f&&(b.attr("src",f),b.removeAttr("data-src"))),b.addClass(u.params.lazyStatusLoadedClass).removeClass(u.params.lazyStatusLoadingClass),d.find("."+u.params.lazyPreloaderClass+", ."+u.params.preloaderClass).remove(),u.params.loop&&c){var a=d.attr("data-swiper-slide-index");if(d.hasClass(u.params.slideDuplicateClass)){var i=u.wrapper.children('[data-swiper-slide-index="'+a+'"]:not(.'+u.params.slideDuplicateClass+")");u.lazy.loadImageInSlide(i.index(),!1)}else{var j=u.wrapper.children("."+u.params.slideDuplicateClass+'[data-swiper-slide-index="'+a+'"]');u.lazy.loadImageInSlide(j.index(),!1)}}u.emit("onLazyImageReady",u,d[0],b[0])}}),u.emit("onLazyImageLoad",u,d[0],b[0])})}},load:function(){var b,c=u.params.slidesPerView;if("auto"===c&&(c=0),u.lazy.initialImageLoaded||(u.lazy.initialImageLoaded=!0),u.params.watchSlidesVisibility)u.wrapper.children("."+u.params.slideVisibleClass).each(function(){u.lazy.loadImageInSlide(a(this).index())});else if(c>1)for(b=u.activeIndex;b<u.activeIndex+c;b++)u.slides[b]&&u.lazy.loadImageInSlide(b);else u.lazy.loadImageInSlide(u.activeIndex);if(u.params.lazyLoadingInPrevNext)if(c>1||u.params.lazyLoadingInPrevNextAmount&&u.params.lazyLoadingInPrevNextAmount>1){var d=u.params.lazyLoadingInPrevNextAmount,e=c,f=Math.min(u.activeIndex+e+Math.max(d,e),u.slides.length),g=Math.max(u.activeIndex-Math.max(e,d),0);for(b=u.activeIndex+c;f>b;b++)u.slides[b]&&u.lazy.loadImageInSlide(b);for(b=g;b<u.activeIndex;b++)u.slides[b]&&u.lazy.loadImageInSlide(b)}else{var h=u.wrapper.children("."+u.params.slideNextClass);h.length>0&&u.lazy.loadImageInSlide(h.index());var i=u.wrapper.children("."+u.params.slidePrevClass);i.length>0&&u.lazy.loadImageInSlide(i.index())}},onTransitionStart:function(){u.params.lazyLoading&&(u.params.lazyLoadingOnTransitionStart||!u.params.lazyLoadingOnTransitionStart&&!u.lazy.initialImageLoaded)&&u.lazy.load()},onTransitionEnd:function(){u.params.lazyLoading&&!u.params.lazyLoadingOnTransitionStart&&u.lazy.load()}},u.scrollbar={isTouched:!1,setDragPosition:function(a){var b=u.scrollbar,c=u.isHorizontal()?"touchstart"===a.type||"touchmove"===a.type?a.targetTouches[0].pageX:a.pageX||a.clientX:"touchstart"===a.type||"touchmove"===a.type?a.targetTouches[0].pageY:a.pageY||a.clientY,d=c-b.track.offset()[u.isHorizontal()?"left":"top"]-b.dragSize/2,e=-u.minTranslate()*b.moveDivider,f=-u.maxTranslate()*b.moveDivider;e>d?d=e:d>f&&(d=f),d=-d/b.moveDivider,u.updateProgress(d),u.setWrapperTranslate(d,!0)},dragStart:function(a){var b=u.scrollbar;b.isTouched=!0,a.preventDefault(),a.stopPropagation(),b.setDragPosition(a),clearTimeout(b.dragTimeout),b.track.transition(0),u.params.scrollbarHide&&b.track.css("opacity",1),u.wrapper.transition(100),b.drag.transition(100),u.emit("onScrollbarDragStart",u)},dragMove:function(a){var b=u.scrollbar;b.isTouched&&(a.preventDefault?a.preventDefault():a.returnValue=!1,b.setDragPosition(a),u.wrapper.transition(0),b.track.transition(0),b.drag.transition(0),u.emit("onScrollbarDragMove",u))},dragEnd:function(a){var b=u.scrollbar;b.isTouched&&(b.isTouched=!1,u.params.scrollbarHide&&(clearTimeout(b.dragTimeout),b.dragTimeout=setTimeout(function(){b.track.css("opacity",0),b.track.transition(400)},1e3)),u.emit("onScrollbarDragEnd",u),u.params.scrollbarSnapOnRelease&&u.slideReset())},draggableEvents:function(){return u.params.simulateTouch!==!1||u.support.touch?u.touchEvents:u.touchEventsDesktop}(),enableDraggable:function(){var b=u.scrollbar,c=u.support.touch?b.track:document;a(b.track).on(b.draggableEvents.start,b.dragStart),a(c).on(b.draggableEvents.move,b.dragMove),a(c).on(b.draggableEvents.end,b.dragEnd)},disableDraggable:function(){var b=u.scrollbar,c=u.support.touch?b.track:document;a(b.track).off(b.draggableEvents.start,b.dragStart),a(c).off(b.draggableEvents.move,b.dragMove),a(c).off(b.draggableEvents.end,b.dragEnd)},set:function(){if(u.params.scrollbar){var b=u.scrollbar;b.track=a(u.params.scrollbar),u.params.uniqueNavElements&&"string"==typeof u.params.scrollbar&&b.track.length>1&&1===u.container.find(u.params.scrollbar).length&&(b.track=u.container.find(u.params.scrollbar)),b.drag=b.track.find(".swiper-scrollbar-drag"),0===b.drag.length&&(b.drag=a('<div class="swiper-scrollbar-drag"></div>'),b.track.append(b.drag)),b.drag[0].style.width="",b.drag[0].style.height="",b.trackSize=u.isHorizontal()?b.track[0].offsetWidth:b.track[0].offsetHeight,b.divider=u.size/u.virtualSize,b.moveDivider=b.divider*(b.trackSize/u.size),b.dragSize=b.trackSize*b.divider,u.isHorizontal()?b.drag[0].style.width=b.dragSize+"px":b.drag[0].style.height=b.dragSize+"px",b.divider>=1?b.track[0].style.display="none":b.track[0].style.display="",u.params.scrollbarHide&&(b.track[0].style.opacity=0)}},setTranslate:function(){if(u.params.scrollbar){var a,b=u.scrollbar,c=(u.translate,b.dragSize);a=(b.trackSize-b.dragSize)*u.progress,u.rtl&&u.isHorizontal()?(a=-a,a>0?(c=b.dragSize-a,a=0):-a+b.dragSize>b.trackSize&&(c=b.trackSize+a)):0>a?(c=b.dragSize+a,a=0):a+b.dragSize>b.trackSize&&(c=b.trackSize-a),u.isHorizontal()?(u.support.transforms3d?b.drag.transform("translate3d("+a+"px, 0, 0)"):b.drag.transform("translateX("+a+"px)"),b.drag[0].style.width=c+"px"):(u.support.transforms3d?b.drag.transform("translate3d(0px, "+a+"px, 0)"):b.drag.transform("translateY("+a+"px)"),b.drag[0].style.height=c+"px"),u.params.scrollbarHide&&(clearTimeout(b.timeout),b.track[0].style.opacity=1,b.timeout=setTimeout(function(){b.track[0].style.opacity=0,b.track.transition(400)},1e3))}},setTransition:function(a){u.params.scrollbar&&u.scrollbar.drag.transition(a)}},u.controller={LinearSpline:function(a,b){var c=function(){var a,b,c;return function(d,e){for(b=-1,a=d.length;a-b>1;)d[c=a+b>>1]<=e?b=c:a=c;return a}}();this.x=a,this.y=b,this.lastIndex=a.length-1;var d,e;this.x.length,this.interpolate=function(a){return a?(e=c(this.x,a),d=e-1,(a-this.x[d])*(this.y[e]-this.y[d])/(this.x[e]-this.x[d])+this.y[d]):0}},getInterpolateFunction:function(a){u.controller.spline||(u.controller.spline=u.params.loop?new u.controller.LinearSpline(u.slidesGrid,a.slidesGrid):new u.controller.LinearSpline(u.snapGrid,a.snapGrid))},setTranslate:function(a,c){function d(b){a=b.rtl&&"horizontal"===b.params.direction?-u.translate:u.translate,"slide"===u.params.controlBy&&(u.controller.getInterpolateFunction(b),f=-u.controller.spline.interpolate(-a)),f&&"container"!==u.params.controlBy||(e=(b.maxTranslate()-b.minTranslate())/(u.maxTranslate()-u.minTranslate()),f=(a-u.minTranslate())*e+b.minTranslate()),u.params.controlInverse&&(f=b.maxTranslate()-f),b.updateProgress(f),b.setWrapperTranslate(f,!1,u),b.updateActiveIndex()}var e,f,g=u.params.control;if(Array.isArray(g))for(var h=0;h<g.length;h++)g[h]!==c&&g[h]instanceof b&&d(g[h]);else g instanceof b&&c!==g&&d(g)},setTransition:function(a,c){function d(b){b.setWrapperTransition(a,u),0!==a&&(b.onTransitionStart(),b.wrapper.transitionEnd(function(){f&&(b.params.loop&&"slide"===u.params.controlBy&&b.fixLoop(),b.onTransitionEnd())}))}var e,f=u.params.control;if(Array.isArray(f))for(e=0;e<f.length;e++)f[e]!==c&&f[e]instanceof b&&d(f[e]);else f instanceof b&&c!==f&&d(f)}},u.hashnav={onHashCange:function(a,b){var c=document.location.hash.replace("#","");c!==u.slides.eq(u.activeIndex).attr("data-hash")&&u.slideTo(u.wrapper.children("."+u.params.slideClass+'[data-hash="'+c+'"]').index())},attachEvents:function(b){var c=b?"off":"on";a(window)[c]("hashchange",u.hashnav.onHashCange)},setHash:function(){if(u.hashnav.initialized&&u.params.hashnav)if(u.params.replaceState&&window.history&&window.history.replaceState)window.history.replaceState(null,null,"#"+u.slides.eq(u.activeIndex).attr("data-hash")||"");else{var a=u.slides.eq(u.activeIndex),b=a.attr("data-hash")||a.attr("data-history");document.location.hash=b||""}},init:function(){if(u.params.hashnav&&!u.params.history){u.hashnav.initialized=!0;var a=document.location.hash.replace("#","");if(a)for(var b=0,c=u.slides.length;c>b;b++){var d=u.slides.eq(b),e=d.attr("data-hash")||d.attr("data-history");if(e===a&&!d.hasClass(u.params.slideDuplicateClass)){var f=d.index();u.slideTo(f,0,u.params.runCallbacksOnInit,!0)}}u.params.hashnavWatchState&&u.hashnav.attachEvents()}},destroy:function(){u.params.hashnavWatchState&&u.hashnav.attachEvents(!0)}},u.history={init:function(){if(u.params.history){if(!window.history||!window.history.pushState)return u.params.history=!1,void(u.params.hashnav=!0);u.history.initialized=!0,this.paths=this.getPathValues(),(this.paths.key||this.paths.value)&&(this.scrollToSlide(0,this.paths.value,u.params.runCallbacksOnInit),u.params.replaceState||window.addEventListener("popstate",this.setHistoryPopState))}},setHistoryPopState:function(){u.history.paths=u.history.getPathValues(),u.history.scrollToSlide(u.params.speed,u.history.paths.value,!1)},getPathValues:function(){var a=window.location.pathname.slice(1).split("/"),b=a.length;return{key:a[b-2],value:a[b-1]}},setHistory:function(a,b){if(u.history.initialized&&u.params.history){var c=u.slides.eq(b),d=this.slugify(c.attr("data-history"));window.location.pathname.includes(a)||(d=a+"/"+d),u.params.replaceState?window.history.replaceState(null,null,d):window.history.pushState(null,null,d)}},slugify:function(a){return a.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},scrollToSlide:function(a,b,c){if(b)for(var d=0,e=u.slides.length;e>d;d++){var f=u.slides.eq(d),g=this.slugify(f.attr("data-history"));if(g===b&&!f.hasClass(u.params.slideDuplicateClass)){var h=f.index();u.slideTo(h,a,c)}}else u.slideTo(0,a,c)}},u.disableKeyboardControl=function(){u.params.keyboardControl=!1,a(document).off("keydown",i)},u.enableKeyboardControl=function(){u.params.keyboardControl=!0,a(document).on("keydown",i);
},u.mousewheel={event:!1,lastScrollTime:(new window.Date).getTime()},u.params.mousewheelControl&&(u.mousewheel.event=navigator.userAgent.indexOf("firefox")>-1?"DOMMouseScroll":function(){var a="onwheel"in document;if(!a){var b=document.createElement("div");b.setAttribute("onwheel","return;"),a="function"==typeof b.onwheel}return!a&&document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0&&(a=document.implementation.hasFeature("Events.wheel","3.0")),a}()?"wheel":"mousewheel"),u.disableMousewheelControl=function(){if(!u.mousewheel.event)return!1;var b=u.container;return"container"!==u.params.mousewheelEventsTarged&&(b=a(u.params.mousewheelEventsTarged)),b.off(u.mousewheel.event,k),u.params.mousewheelControl=!1,!0},u.enableMousewheelControl=function(){if(!u.mousewheel.event)return!1;var b=u.container;return"container"!==u.params.mousewheelEventsTarged&&(b=a(u.params.mousewheelEventsTarged)),b.on(u.mousewheel.event,k),u.params.mousewheelControl=!0,!0},u.parallax={setTranslate:function(){u.container.children("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){l(this,u.progress)}),u.slides.each(function(){var b=a(this);b.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){l(this,Math.min(Math.max(b[0].progress,-1),1))})})},setTransition:function(b){void 0===b&&(b=u.params.speed),u.container.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var c=a(this),d=parseInt(c.attr("data-swiper-parallax-duration"),10)||b;0===b&&(d=0),c.transition(d)})}},u.zoom={scale:1,currentScale:1,isScaling:!1,gesture:{slide:void 0,slideWidth:void 0,slideHeight:void 0,image:void 0,imageWrap:void 0,zoomMax:u.params.zoomMax},image:{isTouched:void 0,isMoved:void 0,currentX:void 0,currentY:void 0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0,width:void 0,height:void 0,startX:void 0,startY:void 0,touchesStart:{},touchesCurrent:{}},velocity:{x:void 0,y:void 0,prevPositionX:void 0,prevPositionY:void 0,prevTime:void 0},getDistanceBetweenTouches:function(a){if(a.targetTouches.length<2)return 1;var b=a.targetTouches[0].pageX,c=a.targetTouches[0].pageY,d=a.targetTouches[1].pageX,e=a.targetTouches[1].pageY;return Math.sqrt(Math.pow(d-b,2)+Math.pow(e-c,2))},onGestureStart:function(b){var c=u.zoom;if(!u.support.gestures){if("touchstart"!==b.type||"touchstart"===b.type&&b.targetTouches.length<2)return;c.gesture.scaleStart=c.getDistanceBetweenTouches(b)}return c.gesture.slide&&c.gesture.slide.length||(c.gesture.slide=a(this),0===c.gesture.slide.length&&(c.gesture.slide=u.slides.eq(u.activeIndex)),c.gesture.image=c.gesture.slide.find("img, svg, canvas"),c.gesture.imageWrap=c.gesture.image.parent("."+u.params.zoomContainerClass),c.gesture.zoomMax=c.gesture.imageWrap.attr("data-swiper-zoom")||u.params.zoomMax,0!==c.gesture.imageWrap.length)?(c.gesture.image.transition(0),void(c.isScaling=!0)):void(c.gesture.image=void 0)},onGestureChange:function(a){var b=u.zoom;if(!u.support.gestures){if("touchmove"!==a.type||"touchmove"===a.type&&a.targetTouches.length<2)return;b.gesture.scaleMove=b.getDistanceBetweenTouches(a)}b.gesture.image&&0!==b.gesture.image.length&&(u.support.gestures?b.scale=a.scale*b.currentScale:b.scale=b.gesture.scaleMove/b.gesture.scaleStart*b.currentScale,b.scale>b.gesture.zoomMax&&(b.scale=b.gesture.zoomMax-1+Math.pow(b.scale-b.gesture.zoomMax+1,.5)),b.scale<u.params.zoomMin&&(b.scale=u.params.zoomMin+1-Math.pow(u.params.zoomMin-b.scale+1,.5)),b.gesture.image.transform("translate3d(0,0,0) scale("+b.scale+")"))},onGestureEnd:function(a){var b=u.zoom;!u.support.gestures&&("touchend"!==a.type||"touchend"===a.type&&a.changedTouches.length<2)||b.gesture.image&&0!==b.gesture.image.length&&(b.scale=Math.max(Math.min(b.scale,b.gesture.zoomMax),u.params.zoomMin),b.gesture.image.transition(u.params.speed).transform("translate3d(0,0,0) scale("+b.scale+")"),b.currentScale=b.scale,b.isScaling=!1,1===b.scale&&(b.gesture.slide=void 0))},onTouchStart:function(a,b){var c=a.zoom;c.gesture.image&&0!==c.gesture.image.length&&(c.image.isTouched||("android"===a.device.os&&b.preventDefault(),c.image.isTouched=!0,c.image.touchesStart.x="touchstart"===b.type?b.targetTouches[0].pageX:b.pageX,c.image.touchesStart.y="touchstart"===b.type?b.targetTouches[0].pageY:b.pageY))},onTouchMove:function(a){var b=u.zoom;if(b.gesture.image&&0!==b.gesture.image.length&&(u.allowClick=!1,b.image.isTouched&&b.gesture.slide)){b.image.isMoved||(b.image.width=b.gesture.image[0].offsetWidth,b.image.height=b.gesture.image[0].offsetHeight,b.image.startX=u.getTranslate(b.gesture.imageWrap[0],"x")||0,b.image.startY=u.getTranslate(b.gesture.imageWrap[0],"y")||0,b.gesture.slideWidth=b.gesture.slide[0].offsetWidth,b.gesture.slideHeight=b.gesture.slide[0].offsetHeight,b.gesture.imageWrap.transition(0),u.rtl&&(b.image.startX=-b.image.startX),u.rtl&&(b.image.startY=-b.image.startY));var c=b.image.width*b.scale,d=b.image.height*b.scale;if(!(c<b.gesture.slideWidth&&d<b.gesture.slideHeight)){if(b.image.minX=Math.min(b.gesture.slideWidth/2-c/2,0),b.image.maxX=-b.image.minX,b.image.minY=Math.min(b.gesture.slideHeight/2-d/2,0),b.image.maxY=-b.image.minY,b.image.touchesCurrent.x="touchmove"===a.type?a.targetTouches[0].pageX:a.pageX,b.image.touchesCurrent.y="touchmove"===a.type?a.targetTouches[0].pageY:a.pageY,!b.image.isMoved&&!b.isScaling){if(u.isHorizontal()&&Math.floor(b.image.minX)===Math.floor(b.image.startX)&&b.image.touchesCurrent.x<b.image.touchesStart.x||Math.floor(b.image.maxX)===Math.floor(b.image.startX)&&b.image.touchesCurrent.x>b.image.touchesStart.x)return void(b.image.isTouched=!1);if(!u.isHorizontal()&&Math.floor(b.image.minY)===Math.floor(b.image.startY)&&b.image.touchesCurrent.y<b.image.touchesStart.y||Math.floor(b.image.maxY)===Math.floor(b.image.startY)&&b.image.touchesCurrent.y>b.image.touchesStart.y)return void(b.image.isTouched=!1)}a.preventDefault(),a.stopPropagation(),b.image.isMoved=!0,b.image.currentX=b.image.touchesCurrent.x-b.image.touchesStart.x+b.image.startX,b.image.currentY=b.image.touchesCurrent.y-b.image.touchesStart.y+b.image.startY,b.image.currentX<b.image.minX&&(b.image.currentX=b.image.minX+1-Math.pow(b.image.minX-b.image.currentX+1,.8)),b.image.currentX>b.image.maxX&&(b.image.currentX=b.image.maxX-1+Math.pow(b.image.currentX-b.image.maxX+1,.8)),b.image.currentY<b.image.minY&&(b.image.currentY=b.image.minY+1-Math.pow(b.image.minY-b.image.currentY+1,.8)),b.image.currentY>b.image.maxY&&(b.image.currentY=b.image.maxY-1+Math.pow(b.image.currentY-b.image.maxY+1,.8)),b.velocity.prevPositionX||(b.velocity.prevPositionX=b.image.touchesCurrent.x),b.velocity.prevPositionY||(b.velocity.prevPositionY=b.image.touchesCurrent.y),b.velocity.prevTime||(b.velocity.prevTime=Date.now()),b.velocity.x=(b.image.touchesCurrent.x-b.velocity.prevPositionX)/(Date.now()-b.velocity.prevTime)/2,b.velocity.y=(b.image.touchesCurrent.y-b.velocity.prevPositionY)/(Date.now()-b.velocity.prevTime)/2,Math.abs(b.image.touchesCurrent.x-b.velocity.prevPositionX)<2&&(b.velocity.x=0),Math.abs(b.image.touchesCurrent.y-b.velocity.prevPositionY)<2&&(b.velocity.y=0),b.velocity.prevPositionX=b.image.touchesCurrent.x,b.velocity.prevPositionY=b.image.touchesCurrent.y,b.velocity.prevTime=Date.now(),b.gesture.imageWrap.transform("translate3d("+b.image.currentX+"px, "+b.image.currentY+"px,0)")}}},onTouchEnd:function(a,b){var c=a.zoom;if(c.gesture.image&&0!==c.gesture.image.length){if(!c.image.isTouched||!c.image.isMoved)return c.image.isTouched=!1,void(c.image.isMoved=!1);c.image.isTouched=!1,c.image.isMoved=!1;var d=300,e=300,f=c.velocity.x*d,g=c.image.currentX+f,h=c.velocity.y*e,i=c.image.currentY+h;0!==c.velocity.x&&(d=Math.abs((g-c.image.currentX)/c.velocity.x)),0!==c.velocity.y&&(e=Math.abs((i-c.image.currentY)/c.velocity.y));var j=Math.max(d,e);c.image.currentX=g,c.image.currentY=i;var k=c.image.width*c.scale,l=c.image.height*c.scale;c.image.minX=Math.min(c.gesture.slideWidth/2-k/2,0),c.image.maxX=-c.image.minX,c.image.minY=Math.min(c.gesture.slideHeight/2-l/2,0),c.image.maxY=-c.image.minY,c.image.currentX=Math.max(Math.min(c.image.currentX,c.image.maxX),c.image.minX),c.image.currentY=Math.max(Math.min(c.image.currentY,c.image.maxY),c.image.minY),c.gesture.imageWrap.transition(j).transform("translate3d("+c.image.currentX+"px, "+c.image.currentY+"px,0)")}},onTransitionEnd:function(a){var b=a.zoom;b.gesture.slide&&a.previousIndex!==a.activeIndex&&(b.gesture.image.transform("translate3d(0,0,0) scale(1)"),b.gesture.imageWrap.transform("translate3d(0,0,0)"),b.gesture.slide=b.gesture.image=b.gesture.imageWrap=void 0,b.scale=b.currentScale=1)},toggleZoom:function(b,c){var d=b.zoom;if(d.gesture.slide||(d.gesture.slide=b.clickedSlide?a(b.clickedSlide):b.slides.eq(b.activeIndex),d.gesture.image=d.gesture.slide.find("img, svg, canvas"),d.gesture.imageWrap=d.gesture.image.parent("."+b.params.zoomContainerClass)),d.gesture.image&&0!==d.gesture.image.length){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;void 0===d.image.touchesStart.x&&c?(e="touchend"===c.type?c.changedTouches[0].pageX:c.pageX,f="touchend"===c.type?c.changedTouches[0].pageY:c.pageY):(e=d.image.touchesStart.x,f=d.image.touchesStart.y),d.scale&&1!==d.scale?(d.scale=d.currentScale=1,d.gesture.imageWrap.transition(300).transform("translate3d(0,0,0)"),d.gesture.image.transition(300).transform("translate3d(0,0,0) scale(1)"),d.gesture.slide=void 0):(d.scale=d.currentScale=d.gesture.imageWrap.attr("data-swiper-zoom")||b.params.zoomMax,c?(u=d.gesture.slide[0].offsetWidth,v=d.gesture.slide[0].offsetHeight,g=d.gesture.slide.offset().left,h=d.gesture.slide.offset().top,i=g+u/2-e,j=h+v/2-f,m=d.gesture.image[0].offsetWidth,n=d.gesture.image[0].offsetHeight,o=m*d.scale,p=n*d.scale,q=Math.min(u/2-o/2,0),r=Math.min(v/2-p/2,0),s=-q,t=-r,k=i*d.scale,l=j*d.scale,q>k&&(k=q),k>s&&(k=s),r>l&&(l=r),l>t&&(l=t)):(k=0,l=0),d.gesture.imageWrap.transition(300).transform("translate3d("+k+"px, "+l+"px,0)"),d.gesture.image.transition(300).transform("translate3d(0,0,0) scale("+d.scale+")"))}},attachEvents:function(b){var c=b?"off":"on";if(u.params.zoom){var d=(u.slides,!("touchstart"!==u.touchEvents.start||!u.support.passiveListener||!u.params.passiveListeners)&&{passive:!0,capture:!1});u.support.gestures?(u.slides[c]("gesturestart",u.zoom.onGestureStart,d),u.slides[c]("gesturechange",u.zoom.onGestureChange,d),u.slides[c]("gestureend",u.zoom.onGestureEnd,d)):"touchstart"===u.touchEvents.start&&(u.slides[c](u.touchEvents.start,u.zoom.onGestureStart,d),u.slides[c](u.touchEvents.move,u.zoom.onGestureChange,d),u.slides[c](u.touchEvents.end,u.zoom.onGestureEnd,d)),u[c]("touchStart",u.zoom.onTouchStart),u.slides.each(function(b,d){a(d).find("."+u.params.zoomContainerClass).length>0&&a(d)[c](u.touchEvents.move,u.zoom.onTouchMove)}),u[c]("touchEnd",u.zoom.onTouchEnd),u[c]("transitionEnd",u.zoom.onTransitionEnd),u.params.zoomToggle&&u.on("doubleTap",u.zoom.toggleZoom)}},init:function(){u.zoom.attachEvents()},destroy:function(){u.zoom.attachEvents(!0)}},u._plugins=[];for(var L in u.plugins){var M=u.plugins[L](u,u.params[L]);M&&u._plugins.push(M)}return u.callPlugins=function(a){for(var b=0;b<u._plugins.length;b++)a in u._plugins[b]&&u._plugins[b][a](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},u.emitterEventListeners={},u.emit=function(a){u.params[a]&&u.params[a](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);var b;if(u.emitterEventListeners[a])for(b=0;b<u.emitterEventListeners[a].length;b++)u.emitterEventListeners[a][b](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);u.callPlugins&&u.callPlugins(a,arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},u.on=function(a,b){return a=m(a),u.emitterEventListeners[a]||(u.emitterEventListeners[a]=[]),u.emitterEventListeners[a].push(b),u},u.off=function(a,b){var c;if(a=m(a),void 0===b)return u.emitterEventListeners[a]=[],u;if(u.emitterEventListeners[a]&&0!==u.emitterEventListeners[a].length){for(c=0;c<u.emitterEventListeners[a].length;c++)u.emitterEventListeners[a][c]===b&&u.emitterEventListeners[a].splice(c,1);return u}},u.once=function(a,b){a=m(a);var c=function(){b(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]),u.off(a,c)};return u.on(a,c),u},u.a11y={makeFocusable:function(a){return a.attr("tabIndex","0"),a},addRole:function(a,b){return a.attr("role",b),a},addLabel:function(a,b){return a.attr("aria-label",b),a},disable:function(a){return a.attr("aria-disabled",!0),a},enable:function(a){return a.attr("aria-disabled",!1),a},onEnterKey:function(b){13===b.keyCode&&(a(b.target).is(u.params.nextButton)?(u.onClickNext(b),u.isEnd?u.a11y.notify(u.params.lastSlideMessage):u.a11y.notify(u.params.nextSlideMessage)):a(b.target).is(u.params.prevButton)&&(u.onClickPrev(b),u.isBeginning?u.a11y.notify(u.params.firstSlideMessage):u.a11y.notify(u.params.prevSlideMessage)),a(b.target).is("."+u.params.bulletClass)&&a(b.target)[0].click())},liveRegion:a('<span class="'+u.params.notificationClass+'" aria-live="assertive" aria-atomic="true"></span>'),notify:function(a){var b=u.a11y.liveRegion;0!==b.length&&(b.html(""),b.html(a))},init:function(){u.params.nextButton&&u.nextButton&&u.nextButton.length>0&&(u.a11y.makeFocusable(u.nextButton),u.a11y.addRole(u.nextButton,"button"),u.a11y.addLabel(u.nextButton,u.params.nextSlideMessage)),u.params.prevButton&&u.prevButton&&u.prevButton.length>0&&(u.a11y.makeFocusable(u.prevButton),u.a11y.addRole(u.prevButton,"button"),u.a11y.addLabel(u.prevButton,u.params.prevSlideMessage)),a(u.container).append(u.a11y.liveRegion)},initPagination:function(){u.params.pagination&&u.params.paginationClickable&&u.bullets&&u.bullets.length&&u.bullets.each(function(){var b=a(this);u.a11y.makeFocusable(b),u.a11y.addRole(b,"button"),u.a11y.addLabel(b,u.params.paginationBulletMessage.replace(/{{index}}/,b.index()+1))})},destroy:function(){u.a11y.liveRegion&&u.a11y.liveRegion.length>0&&u.a11y.liveRegion.remove()}},u.init=function(){u.params.loop&&u.createLoop(),u.updateContainerSize(),u.updateSlidesSize(),u.updatePagination(),u.params.scrollbar&&u.scrollbar&&(u.scrollbar.set(),u.params.scrollbarDraggable&&u.scrollbar.enableDraggable()),"slide"!==u.params.effect&&u.effects[u.params.effect]&&(u.params.loop||u.updateProgress(),u.effects[u.params.effect].setTranslate()),u.params.loop?u.slideTo(u.params.initialSlide+u.loopedSlides,0,u.params.runCallbacksOnInit):(u.slideTo(u.params.initialSlide,0,u.params.runCallbacksOnInit),0===u.params.initialSlide&&(u.parallax&&u.params.parallax&&u.parallax.setTranslate(),u.lazy&&u.params.lazyLoading&&(u.lazy.load(),u.lazy.initialImageLoaded=!0))),u.attachEvents(),u.params.observer&&u.support.observer&&u.initObservers(),u.params.preloadImages&&!u.params.lazyLoading&&u.preloadImages(),u.params.zoom&&u.zoom&&u.zoom.init(),u.params.autoplay&&u.startAutoplay(),u.params.keyboardControl&&u.enableKeyboardControl&&u.enableKeyboardControl(),u.params.mousewheelControl&&u.enableMousewheelControl&&u.enableMousewheelControl(),u.params.hashnavReplaceState&&(u.params.replaceState=u.params.hashnavReplaceState),u.params.history&&u.history&&u.history.init(),u.params.hashnav&&u.hashnav&&u.hashnav.init(),u.params.a11y&&u.a11y&&u.a11y.init(),u.emit("onInit",u)},u.cleanupStyles=function(){u.container.removeClass(u.classNames.join(" ")).removeAttr("style"),u.wrapper.removeAttr("style"),u.slides&&u.slides.length&&u.slides.removeClass([u.params.slideVisibleClass,u.params.slideActiveClass,u.params.slideNextClass,u.params.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-column").removeAttr("data-swiper-row"),u.paginationContainer&&u.paginationContainer.length&&u.paginationContainer.removeClass(u.params.paginationHiddenClass),u.bullets&&u.bullets.length&&u.bullets.removeClass(u.params.bulletActiveClass),u.params.prevButton&&a(u.params.prevButton).removeClass(u.params.buttonDisabledClass),u.params.nextButton&&a(u.params.nextButton).removeClass(u.params.buttonDisabledClass),u.params.scrollbar&&u.scrollbar&&(u.scrollbar.track&&u.scrollbar.track.length&&u.scrollbar.track.removeAttr("style"),u.scrollbar.drag&&u.scrollbar.drag.length&&u.scrollbar.drag.removeAttr("style"))},u.destroy=function(a,b){u.detachEvents(),u.stopAutoplay(),u.params.scrollbar&&u.scrollbar&&u.params.scrollbarDraggable&&u.scrollbar.disableDraggable(),u.params.loop&&u.destroyLoop(),b&&u.cleanupStyles(),u.disconnectObservers(),u.params.zoom&&u.zoom&&u.zoom.destroy(),u.params.keyboardControl&&u.disableKeyboardControl&&u.disableKeyboardControl(),u.params.mousewheelControl&&u.disableMousewheelControl&&u.disableMousewheelControl(),u.params.a11y&&u.a11y&&u.a11y.destroy(),u.params.history&&!u.params.replaceState&&window.removeEventListener("popstate",u.history.setHistoryPopState),u.params.hashnav&&u.hashnav&&u.hashnav.destroy(),u.emit("onDestroy"),a!==!1&&(u=null)},u.init(),u}};b.prototype={isSafari:function(){var a=window.navigator.userAgent.toLowerCase();return a.indexOf("safari")>=0&&a.indexOf("chrome")<0&&a.indexOf("android")<0}(),isUiWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(window.navigator.userAgent),isArray:function(a){return"[object Array]"===Object.prototype.toString.apply(a)},browser:{ie:window.navigator.pointerEnabled||window.navigator.msPointerEnabled,ieTouch:window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>1||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>1,lteIE9:function(){var a=document.createElement("div");return a.innerHTML="<!--[if lte IE 9]><i></i><![endif]-->",1===a.getElementsByTagName("i").length}()},device:function(){var a=window.navigator.userAgent,b=a.match(/(Android);?[\s\/]+([\d.]+)?/),c=a.match(/(iPad).*OS\s([\d_]+)/),d=a.match(/(iPod)(.*OS\s([\d_]+))?/),e=!c&&a.match(/(iPhone\sOS|iOS)\s([\d_]+)/);return{ios:c||e||d,android:b}}(),support:{touch:window.Modernizr&&Modernizr.touch===!0||function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}(),transforms3d:window.Modernizr&&Modernizr.csstransforms3d===!0||function(){var a=document.createElement("div").style;return"webkitPerspective"in a||"MozPerspective"in a||"OPerspective"in a||"MsPerspective"in a||"perspective"in a}(),flexbox:function(){for(var a=document.createElement("div").style,b="alignItems webkitAlignItems webkitBoxAlign msFlexAlign mozBoxAlign webkitFlexDirection msFlexDirection mozBoxDirection mozBoxOrient webkitBoxDirection webkitBoxOrient".split(" "),c=0;c<b.length;c++)if(b[c]in a)return!0}(),observer:function(){return"MutationObserver"in window||"WebkitMutationObserver"in window}(),passiveListener:function(){var a=!1;try{var b=Object.defineProperty({},"passive",{get:function(){a=!0}});window.addEventListener("testPassiveListener",null,b)}catch(a){}return a}(),gestures:function(){return"ongesturestart"in window}()},plugins:{}};for(var c=["jQuery","Zepto","Dom7"],d=0;d<c.length;d++)window[c[d]]&&function(a){a.fn.swiper=function(c){var d;return a(this).each(function(){var a=new b(this,c);d||(d=a)}),d}}(window[c[d]]);var e;e="undefined"==typeof Dom7?window.Dom7||window.Zepto||window.jQuery:Dom7,e&&("transitionEnd"in e.fn||(e.fn.transitionEnd=function(a){function b(f){if(f.target===this)for(a.call(this,f),c=0;c<d.length;c++)e.off(d[c],b)}var c,d=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],e=this;if(a)for(c=0;c<d.length;c++)e.on(d[c],b);return this}),"transform"in e.fn||(e.fn.transform=function(a){for(var b=0;b<this.length;b++){var c=this[b].style;c.webkitTransform=c.MsTransform=c.msTransform=c.MozTransform=c.OTransform=c.transform=a}return this}),"transition"in e.fn||(e.fn.transition=function(a){"string"!=typeof a&&(a+="ms");for(var b=0;b<this.length;b++){var c=this[b].style;c.webkitTransitionDuration=c.MsTransitionDuration=c.msTransitionDuration=c.MozTransitionDuration=c.OTransitionDuration=c.transitionDuration=a}return this}),"outerWidth"in e.fn||(e.fn.outerWidth=function(a){return this.length>0?a?this[0].offsetWidth+parseFloat(this.css("margin-right"))+parseFloat(this.css("margin-left")):this[0].offsetWidth:null})),window.Swiper=b}(),"undefined"!=typeof module?module.exports=window.Swiper:"function"==typeof define&&define.amd&&define([],function(){"use strict";return window.Swiper}),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.toggle"),f="object"==typeof b&&b;e||d.data("bs.toggle",e=new c(this,f)),"string"==typeof b&&e[b]&&e[b]()})}var c=function(b,c){this.$element=a(b),this.options=a.extend({},this.defaults(),c),this.render()};c.VERSION="2.2.0",c.DEFAULTS={on:"On",off:"Off",onstyle:"primary",offstyle:"default",size:"normal",style:"",width:null,height:null},c.prototype.defaults=function(){return{on:this.$element.attr("data-on")||c.DEFAULTS.on,off:this.$element.attr("data-off")||c.DEFAULTS.off,onstyle:this.$element.attr("data-onstyle")||c.DEFAULTS.onstyle,offstyle:this.$element.attr("data-offstyle")||c.DEFAULTS.offstyle,size:this.$element.attr("data-size")||c.DEFAULTS.size,style:this.$element.attr("data-style")||c.DEFAULTS.style,width:this.$element.attr("data-width")||c.DEFAULTS.width,height:this.$element.attr("data-height")||c.DEFAULTS.height}},c.prototype.render=function(){this._onstyle="btn-"+this.options.onstyle,this._offstyle="btn-"+this.options.offstyle;var b="large"===this.options.size?"btn-lg":"small"===this.options.size?"btn-sm":"mini"===this.options.size?"btn-xs":"",c=a('<label class="btn">').html(this.options.on).addClass(this._onstyle+" "+b),d=a('<label class="btn">').html(this.options.off).addClass(this._offstyle+" "+b+" active"),e=a('<span class="toggle-handle btn btn-default">').addClass(b),f=a('<div class="toggle-group">').append(c,d,e),g=a('<div class="toggle btn" data-toggle="toggle">').addClass(this.$element.prop("checked")?this._onstyle:this._offstyle+" off").addClass(b).addClass(this.options.style);this.$element.wrap(g),a.extend(this,{$toggle:this.$element.parent(),$toggleOn:c,$toggleOff:d,$toggleGroup:f}),this.$toggle.append(f);var h=this.options.width||Math.max(c.outerWidth(),d.outerWidth())+e.outerWidth()/2,i=this.options.height||Math.max(c.outerHeight(),d.outerHeight());c.addClass("toggle-on"),d.addClass("toggle-off"),this.$toggle.css({width:h,height:i}),this.options.height&&(c.css("line-height",c.height()+"px"),d.css("line-height",d.height()+"px")),this.update(!0),this.trigger(!0)},c.prototype.toggle=function(){this.$element.prop("checked")?this.off():this.on()},c.prototype.on=function(a){return this.$element.prop("disabled")?!1:(this.$toggle.removeClass(this._offstyle+" off").addClass(this._onstyle),this.$element.prop("checked",!0),void(a||this.trigger()))},c.prototype.off=function(a){return this.$element.prop("disabled")?!1:(this.$toggle.removeClass(this._onstyle).addClass(this._offstyle+" off"),this.$element.prop("checked",!1),void(a||this.trigger()))},c.prototype.enable=function(){this.$toggle.removeAttr("disabled"),this.$element.prop("disabled",!1)},c.prototype.disable=function(){this.$toggle.attr("disabled","disabled"),this.$element.prop("disabled",!0)},c.prototype.update=function(a){this.$element.prop("disabled")?this.disable():this.enable(),this.$element.prop("checked")?this.on(a):this.off(a)},c.prototype.trigger=function(b){this.$element.off("change.bs.toggle"),b||this.$element.change(),this.$element.on("change.bs.toggle",a.proxy(function(){this.update()},this))},c.prototype.destroy=function(){this.$element.off("change.bs.toggle"),this.$toggleGroup.remove(),this.$element.removeData("bs.toggle"),this.$element.unwrap()};var d=a.fn.bootstrapToggle;a.fn.bootstrapToggle=b,a.fn.bootstrapToggle.Constructor=c,a.fn.toggle.noConflict=function(){return a.fn.bootstrapToggle=d,this},a(function(){a("input[type=checkbox][data-toggle^=toggle]").bootstrapToggle()}),a(document).on("click.bs.toggle","div[data-toggle^=toggle]",function(b){var c=a(this).find("input[type=checkbox]");c.bootstrapToggle("toggle"),b.preventDefault()})}(jQuery);